"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[2663],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>u});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),s=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=s(e.components);return r.createElement(c.Provider,{value:n},e.children)},l={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),m=s(t),u=a,g=m["".concat(c,".").concat(u)]||m[u]||l[u]||o;return t?r.createElement(g,i(i({ref:n},d),{},{components:t})):r.createElement(g,i({ref:n},d))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=m;var p={};for(var c in n)hasOwnProperty.call(n,c)&&(p[c]=n[c]);p.originalType=e,p.mdxType="string"==typeof e?e:a,i[1]=p;for(var s=2;s<o;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},98763:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>p,toc:()=>s});var r=t(87462),a=(t(67294),t(3905));const o={title:"Migraci\xf3n de BD",description:"Manejo de Migraci\xf3n de BD en Casdoor",keywords:["despliegue","Base de datos","Migraci\xf3n"],authors:["forestmgy"]},i=void 0,p={unversionedId:"deployment/db-migration",id:"deployment/db-migration",title:"Migraci\xf3n de BD",description:"Manejo de Migraci\xf3n de BD en Casdoor",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/deployment/db-migration.md",sourceDirName:"deployment",slug:"/deployment/db-migration",permalink:"/es/docs/deployment/db-migration",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/deployment/db-migration.md",tags:[],version:"current",frontMatter:{title:"Migraci\xf3n de BD",description:"Manejo de Migraci\xf3n de BD en Casdoor",keywords:["despliegue","Base de datos","Migraci\xf3n"],authors:["forestmgy"]},sidebar:"tutorialSidebar",previous:{title:"Alojamiento de Archivos Est\xe1ticos en una Intranet",permalink:"/es/docs/deployment/deploy-intranet"},next:{title:"How to Connect to Casdoor",permalink:"/es/docs/category/how-to-connect-to-casdoor"}},c={},s=[{value:"C\xf3mo funciona",id:"c\xf3mo-funciona",level:2}],d={toc:s};function l(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Al actualizar la base de datos, existe un riesgo de p\xe9rdida de datos, como cuando se elimina un campo antiguo. Afortunadamente, Casdoor utiliza ",(0,a.kt)("a",{parentName:"p",href:"https://xorm.io/"},"xorm"),", que ayuda con muchos problemas de migraci\xf3n de bases de datos. Sin embargo, algunas migraciones de esquema y datos a\xfan deben manejarse manualmente, como cuando se cambia el nombre de un campo."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Consulta la ",(0,a.kt)("a",{parentName:"p",href:"https://xorm.io/docs/chapter-03/readme/"},"documentaci\xf3n de xorm")," para entender mejor las operaciones de esquema de xorm.")),(0,a.kt)("h2",{id:"c\xf3mo-funciona"},"C\xf3mo funciona"),(0,a.kt)("p",null,"Como se mencion\xf3 anteriormente, xorm no puede manejar cambios en el nombre de los campos. Para abordar esto, xorm proporciona un paquete ",(0,a.kt)("a",{parentName:"p",href:"https://gitea.com/xorm/xorm/src/branch/v1/migrate"},"migrate")," que puede ayudar con este problema."),(0,a.kt)("p",null,"Para manejar el cambio de nombre de un campo, puedes escribir c\xf3digo como este:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'migrations := []*migrate.Migration{\n        {\n            ID: "CasbinRule--fill ptype field with p",\n            Migrate: func(tx *xorm.Engine) error {\n                _, err := tx.Cols("ptype").Update(&xormadapter.CasbinRule{\n                    Ptype: "p",\n                })\n                return err\n            },\n            Rollback: func(tx *xorm.Engine) error {\n                return tx.DropTables(&xormadapter.CasbinRule{})\n            },\n        },\n    }\n    m.Migrate()\n')),(0,a.kt)("p",null,"Nuestro objetivo es ",(0,a.kt)("strong",{parentName:"p"},"renombrar ",(0,a.kt)("inlineCode",{parentName:"strong"},"p_type")," a ",(0,a.kt)("inlineCode",{parentName:"strong"},"ptype")),". Sin embargo, dado que xorm ",(0,a.kt)("strong",{parentName:"p"},"no soporta el cambio de nombre de campos"),", debemos recurrir a un enfoque m\xe1s intrincado: asignar el valor de ",(0,a.kt)("inlineCode",{parentName:"p"},"p_type")," a ",(0,a.kt)("inlineCode",{parentName:"p"},"ptype"),", y posteriormente eliminar el campo ",(0,a.kt)("inlineCode",{parentName:"p"},"p_type"),"."),(0,a.kt)("p",null,"El campo ",(0,a.kt)("inlineCode",{parentName:"p"},"ID")," identifica de manera \xfanica la migraci\xf3n que se est\xe1 realizando. Despu\xe9s de que se ejecute ",(0,a.kt)("inlineCode",{parentName:"p"},"m.Migrate()"),", el valor de ",(0,a.kt)("inlineCode",{parentName:"p"},"ID")," se agregar\xe1 a la tabla de migraciones de la base de datos."),(0,a.kt)("p",null,"Al iniciar el proyecto de nuevo, la base de datos verificar\xe1 si existe alg\xfan campo ",(0,a.kt)("inlineCode",{parentName:"p"},"ID")," en la tabla y se abstendr\xe1 de realizar cualquier operaci\xf3n asociada con el mismo ",(0,a.kt)("inlineCode",{parentName:"p"},"ID"),"."))}l.isMDXComponent=!0}}]);