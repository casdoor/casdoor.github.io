"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[1061],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>u});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var d=r.createContext({}),p=function(e){var n=r.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=p(e.components);return r.createElement(d.Provider,{value:n},e.children)},l={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,d=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(t),u=o,g=c["".concat(d,".").concat(u)]||c[u]||l[u]||a;return t?r.createElement(g,i(i({ref:n},m),{},{components:t})):r.createElement(g,i({ref:n},m))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=c;var s={};for(var d in n)hasOwnProperty.call(n,d)&&(s[d]=n[d]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},43100:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(87462),o=(t(67294),t(3905));const a={title:"Migration de base de donn\xe9es",description:"Gestion de la migration de base de donn\xe9es dans Casdoor",keywords:["d\xe9ploiement","Base de donn\xe9es","Migration"],authors:["forestmgy"]},i=void 0,s={unversionedId:"deployment/db-migration",id:"deployment/db-migration",title:"Migration de base de donn\xe9es",description:"Gestion de la migration de base de donn\xe9es dans Casdoor",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/deployment/db-migration.md",sourceDirName:"deployment",slug:"/deployment/db-migration",permalink:"/fr/docs/deployment/db-migration",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/deployment/db-migration.md",tags:[],version:"current",frontMatter:{title:"Migration de base de donn\xe9es",description:"Gestion de la migration de base de donn\xe9es dans Casdoor",keywords:["d\xe9ploiement","Base de donn\xe9es","Migration"],authors:["forestmgy"]},sidebar:"tutorialSidebar",previous:{title:"H\xe9bergement de fichiers statiques dans un intranet",permalink:"/fr/docs/deployment/deploy-intranet"},next:{title:"How to Connect to Casdoor",permalink:"/fr/docs/category/how-to-connect-to-casdoor"}},d={},p=[{value:"Comment \xe7a marche",id:"comment-\xe7a-marche",level:2}],m={toc:p};function l(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Lors de la mise \xe0 niveau de la base de donn\xe9es, il existe un risque de perte de donn\xe9es, comme lors de la suppression d'un ancien champ. Heureusement, Casdoor utilise ",(0,o.kt)("a",{parentName:"p",href:"https://xorm.io/"},"xorm"),", qui aide \xe0 r\xe9soudre de nombreux probl\xe8mes de migration de base de donn\xe9es. Cependant, certaines migrations de sch\xe9ma et de donn\xe9es doivent encore \xeatre g\xe9r\xe9es manuellement, comme lorsqu'un nom de champ est chang\xe9."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Consultez la ",(0,o.kt)("a",{parentName:"p",href:"https://xorm.io/docs/chapter-03/readme/"},"documentation xorm")," pour mieux comprendre les op\xe9rations de sch\xe9ma de xorm.")),(0,o.kt)("h2",{id:"comment-\xe7a-marche"},"Comment \xe7a marche"),(0,o.kt)("p",null,"Comme mentionn\xe9 pr\xe9c\xe9demment, xorm ne peut pas g\xe9rer les changements de nom de champ. Pour r\xe9soudre ce probl\xe8me, xorm fournit un package ",(0,o.kt)("a",{parentName:"p",href:"https://gitea.com/xorm/xorm/src/branch/v1/migrate"},"migrate")," qui peut aider avec ce probl\xe8me."),(0,o.kt)("p",null,"Pour g\xe9rer le renommage de champ, vous pouvez \xe9crire du code comme ceci :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'migrations := []*migrate.Migration{\n        {\n            ID: "CasbinRule--fill ptype field with p",\n            Migrate: func(tx *xorm.Engine) error {\n                _, err := tx.Cols("ptype").Update(&xormadapter.CasbinRule{\n                    Ptype: "p",\n                })\n                return err\n            },\n            Rollback: func(tx *xorm.Engine) error {\n                return tx.DropTables(&xormadapter.CasbinRule{})\n            },\n        },\n    }\n    m.Migrate()\n')),(0,o.kt)("p",null,"Notre objectif est de ",(0,o.kt)("strong",{parentName:"p"},"renommer ",(0,o.kt)("inlineCode",{parentName:"strong"},"p_type")," en ",(0,o.kt)("inlineCode",{parentName:"strong"},"ptype")),". Cependant, puisque xorm ",(0,o.kt)("strong",{parentName:"p"},"ne prend pas en charge le renommage de champ"),", nous devons recourir \xe0 une approche plus complexe : assigner la valeur de ",(0,o.kt)("inlineCode",{parentName:"p"},"p_type")," \xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"ptype"),", puis supprimer le champ ",(0,o.kt)("inlineCode",{parentName:"p"},"p_type"),"."),(0,o.kt)("p",null,"Le champ ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," identifie de mani\xe8re unique la migration en cours. Apr\xe8s l'ex\xe9cution de ",(0,o.kt)("inlineCode",{parentName:"p"},"m.Migrate()"),", la valeur de ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," sera ajout\xe9e \xe0 la table des migrations de la base de donn\xe9es."),(0,o.kt)("p",null,"Lors du red\xe9marrage du projet, la base de donn\xe9es v\xe9rifiera l'existence d'un champ ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," dans la table et s'abstiendra de r\xe9aliser toute op\xe9ration associ\xe9e au m\xeame ",(0,o.kt)("inlineCode",{parentName:"p"},"ID"),"."))}l.isMDXComponent=!0}}]);