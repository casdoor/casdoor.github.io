"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[2015],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>m});var n=t(67294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),c=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},d=function(e){var a=c(e.components);return n.createElement(l.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(t),m=o,g=u["".concat(l,".").concat(m)]||u[m]||p[m]||r;return t?n.createElement(g,i(i({ref:a},d),{},{components:t})):n.createElement(g,i({ref:a},d))}));function m(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=u;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=t[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},65074:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var n=t(87462),o=(t(67294),t(3905));const r={title:"GitLab",description:"Usar Casdoor para autenticaci\xf3n en un servidor GitLab auto-desarrollado",keywords:["GitLab"],authors:["Steve0x2a"]},i=void 0,s={unversionedId:"integration/ruby/gitlab",id:"integration/ruby/gitlab",title:"GitLab",description:"Usar Casdoor para autenticaci\xf3n en un servidor GitLab auto-desarrollado",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/integration/ruby/gitlab.md",sourceDirName:"integration/ruby",slug:"/integration/ruby/gitlab",permalink:"/es/docs/integration/ruby/gitlab",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/ruby/gitlab.md",tags:[],version:"current",frontMatter:{title:"GitLab",description:"Usar Casdoor para autenticaci\xf3n en un servidor GitLab auto-desarrollado",keywords:["GitLab"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Ruby",permalink:"/es/docs/category/ruby"},next:{title:"Haskell",permalink:"/es/docs/category/haskell"}},l={},c=[{value:"Paso 1: Desplegar Casdoor y GitLab",id:"paso-1-desplegar-casdoor-y-gitlab",level:2},{value:"Paso 2: Configurar aplicaci\xf3n Casdoor",id:"paso-2-configurar-aplicaci\xf3n-casdoor",level:2},{value:"Paso 3: Configurar GitLab",id:"paso-3-configurar-gitlab",level:2}],d={toc:c};function p(e){let{components:a,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},d,r,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Casdoor puede utilizar el protocolo OIDC para enlazar a un servidor GitLab auto-desplegado, y este documento te mostrar\xe1 c\xf3mo hacerlo."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Como indican los ",(0,o.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/administration/auth/oidc.html#configure-keycloak"},"documentos de GitLab"),", GitLab solo funciona con proveedores de OpenID que usen HTTPS, por lo que necesitas desplegar Casdoor con HTTPS, como poner Casdoor detr\xe1s de un proxy inverso NGINX con una configuraci\xf3n de certificado SSL. Casdoor por s\xed mismo solo escucha en el puerto 8000 por defecto a trav\xe9s de HTTP y no tiene funcionalidad relacionada con HTTPS.")),(0,o.kt)("p",null,"Los siguientes son algunos de los nombres mencionados en la configuraci\xf3n:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": El nombre de dominio o IP donde se despliega el servidor Casdoor, por ejemplo, ",(0,o.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),"."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"GITLAB_HOSTNAME"),": El nombre de dominio o IP donde se despliega GitLab, por ejemplo, ",(0,o.kt)("inlineCode",{parentName:"p"},"https://gitlab.com"),"."),(0,o.kt)("h2",{id:"paso-1-desplegar-casdoor-y-gitlab"},"Paso 1: Desplegar Casdoor y GitLab"),(0,o.kt)("p",null,"Primero, se deben desplegar Casdoor y GitLab."),(0,o.kt)("p",null,"Despu\xe9s de un despliegue exitoso, necesitas asegurarte:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Casdoor puede ser iniciado sesi\xf3n y utilizado normalmente."),(0,o.kt)("li",{parentName:"ol"},"Establece el valor de ",(0,o.kt)("inlineCode",{parentName:"li"},"origin")," de Casdoor (conf/app.conf) en ",(0,o.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,o.kt)("img",{alt:"Configuraci\xf3n de Casdoor",src:t(66496).Z,width:"1013",height:"448"}))),(0,o.kt)("h2",{id:"paso-2-configurar-aplicaci\xf3n-casdoor"},"Paso 2: Configurar aplicaci\xf3n Casdoor"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Crea o utiliza una aplicaci\xf3n Casdoor existente."),(0,o.kt)("li",{parentName:"ol"},"A\xf1ade una URL de redirecci\xf3n: ",(0,o.kt)("inlineCode",{parentName:"li"},"http://GITLAB_HOSTNAME/users/auth/openid_connect/callback"),"."),(0,o.kt)("li",{parentName:"ol"},"A\xf1ade el proveedor que desees y complementa otros ajustes.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Configuraci\xf3n de la Aplicaci\xf3n",src:t(18687).Z,width:"1571",height:"658"})," Notablemente, puedes obtener dos valores en la p\xe1gina de configuraci\xf3n de la aplicaci\xf3n: ",(0,o.kt)("inlineCode",{parentName:"p"},"Client ID")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"Client secret")," (ver la imagen arriba), y los usaremos en el siguiente paso."),(0,o.kt)("p",null,"Abre tu navegador favorito y visita: ",(0,o.kt)("strong",{parentName:"p"},"http://",(0,o.kt)("inlineCode",{parentName:"strong"},"CASDOOR_HOSTNAME"),"/.well-known/openid-configuration"),", donde ver\xe1s la configuraci\xf3n OIDC de Casdoor."),(0,o.kt)("h2",{id:"paso-3-configurar-gitlab"},"Paso 3: Configurar GitLab"),(0,o.kt)("p",null,"Puedes seguir los pasos a continuaci\xf3n para configurarlo, o hacer cambios personalizados de acuerdo a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/administration/auth/oidc.html#casdoor"},"este documento")," (por ejemplo, si est\xe1s instalando GitLab usando c\xf3digo fuente en lugar del Omnibus)."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"En tu servidor GitLab, abre el archivo de configuraci\xf3n."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo editor /etc/gitlab/gitlab.rb\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"A\xf1ade la configuraci\xf3n del proveedor. (La URL de HOSTNAME debe incluir http o https)"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},'gitlab_rails[\'omniauth_providers\'] = [\n    {\n        name: "openid_connect",\n        label: "Casdoor", # optional label for the login button, defaults to "Openid Connect"\n        args: {\n            name: "openid_connect",\n            scope: ["openid", "profile", "email"],\n            response_type: "code",\n            issuer:  "<CASDOOR_HOSTNAME>",\n            client_auth_method: "query",\n            discovery: true,\n            uid_field: "preferred_username",\n            client_options: {\n                identifier: "<YOUR CLIENT ID>",\n                secret: "<YOUR CLIENT SECRET>",\n                redirect_uri: "<GITLAB_HOSTNAME>/users/auth/openid_connect/callback"\n            }\n        }\n    }\n]\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Reinicia tu servidor GitLab.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Cada usuario registrado puede abrir ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"GITLAB_HOSTNAME"),"/-/profile/account")," y conectar la cuenta Casdoor. ",(0,o.kt)("img",{alt:"Conexi\xf3n GitLab",src:t(11405).Z,width:"2648",height:"926"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Finalizar. Ahora, puedes iniciar sesi\xf3n en tu propio GitLab usando Casdoor. ",(0,o.kt)("img",{alt:"Inicio de sesi\xf3n GitLab",src:t(149).Z,width:"2127",height:"1315"})))))}p.isMDXComponent=!0},66496:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},18687:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/appsetting_gitlab-a7b6bb0c825259b068b3761fc249e79d.png"},11405:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/gitlab_connect-f62ead92f802fcdb4db244f128b04711.png"},149:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/gitlab_login-190fea801337b81056835c566872d439.png"}}]);