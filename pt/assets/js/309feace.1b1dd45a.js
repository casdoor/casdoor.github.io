"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[3393],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>m});var o=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,o,n=function(e,t){if(null==e)return{};var a,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=o.createContext({}),p=function(e){var t=o.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},l=function(e){var t=p(e.components);return o.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=p(a),m=n,k=u["".concat(c,".").concat(m)]||u[m]||d[m]||r;return a?o.createElement(k,s(s({ref:t},l),{},{components:a})):o.createElement(k,s({ref:t},l))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,s=new Array(r);s[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:n,s[1]=i;for(var p=2;p<r;p++)s[p]=a[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,a)}u.displayName="MDXCreateElement"},92318:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var o=a(87462),n=(a(67294),a(3905));const r={title:"OAuth 2.0",description:"Usando Access Token para autenticar clientes",keywords:["OAuth 2.0","access token","refresh token"],authors:["nomeguy"]},s=void 0,i={unversionedId:"how-to-connect/oauth",id:"how-to-connect/oauth",title:"OAuth 2.0",description:"Usando Access Token para autenticar clientes",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/how-to-connect/oauth.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/oauth",permalink:"/pt/docs/how-to-connect/oauth",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/oauth.md",tags:[],version:"current",frontMatter:{title:"OAuth 2.0",description:"Usando Access Token para autenticar clientes",keywords:["OAuth 2.0","access token","refresh token"],authors:["nomeguy"]},sidebar:"tutorialSidebar",previous:{title:"Nuxt",permalink:"/pt/docs/how-to-connect/nuxt"},next:{title:"Usando Casdoor como um Servidor CAS",permalink:"/pt/docs/how-to-connect/cas"}},c={},p=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Como Obter um Access Token",id:"como-obter-um-access-token",level:2},{value:'Authorization Code Grant<span id="1"></span>',id:"authorization-code-grant",level:3},{value:"Escopos Dispon\xedveis",id:"escopos-dispon\xedveis",level:4},{value:"Implicit Grant",id:"implicit-grant",level:3},{value:"Resource Owner Password Credentials Grant",id:"resource-owner-password-credentials-grant",level:3},{value:"Client Credentials Grant",id:"client-credentials-grant",level:3},{value:"Refresh Token",id:"refresh-token",level:3},{value:"Como Verificar Access Token",id:"como-verificar-access-token",level:2},{value:"Como Usar <code>AccessToken</code>",id:"como-usar-accesstoken",level:2},{value:"Diferen\xe7as entre as APIs <code>userinfo</code> e <code>get-account</code>",id:"diferen\xe7as-entre-as-apis-userinfo-e-get-account",level:2}],l={toc:p};function d(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,o.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"introdu\xe7\xe3o"},"Introdu\xe7\xe3o"),(0,n.kt)("p",null,"O Casdoor suporta o uso de Access Token para autenticar clientes. Nesta se\xe7\xe3o, mostraremos como obter um Access Token, como verificar um Access Token e como usar um Access Token."),(0,n.kt)("h2",{id:"como-obter-um-access-token"},"Como Obter um Access Token"),(0,n.kt)("p",null,"H\xe1 duas maneiras de obter um Access Token: voc\xea pode usar os ",(0,n.kt)("a",{parentName:"p",href:"/docs/how-to-connect/sdk"},"SDKs do Casdoor"),". Para informa\xe7\xf5es detalhadas, por favor consulte a documenta\xe7\xe3o do SDK. Aqui, mostraremos principalmente como usar a API para obter o Access Token."),(0,n.kt)("p",null,"O Casdoor suporta quatro tipos de concess\xe3o OAuth: ",(0,n.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.1"},"Authorization Code Grant"),", ",(0,n.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.2"},"Implicit Grant"),", ",(0,n.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.3"},"Resource Owner Password Credentials Grant")," e ",(0,n.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.4"},"Client Credentials Grant"),"."),(0,n.kt)("p",null,"Por raz\xf5es de seguran\xe7a, o aplicativo Casdoor tem o modo de c\xf3digo de autoriza\xe7\xe3o ativado por padr\xe3o. Se voc\xea precisa usar outros modos, por favor v\xe1 ao aplicativo apropriado para configur\xe1-lo."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Tipos de Concess\xe3o",src:a(67093).Z,width:"1493",height:"529"})),(0,n.kt)("h3",{id:"authorization-code-grant"},"Authorization Code Grant",(0,n.kt)("span",{id:"1"})),(0,n.kt)("p",null,"Primeiro, redirecione seus usu\xe1rios para:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/login/oauth/authorize?\nclient_id=CLIENT_ID&\nredirect_uri=REDIRECT_URI&\nresponse_type=code&\nscope=openid&\nstate=STATE\n")),(0,n.kt)("h4",{id:"escopos-dispon\xedveis"},"Escopos Dispon\xedveis"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Nome"),(0,n.kt)("th",{parentName:"tr",align:null},"Descri\xe7\xe3o"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"openid (no scope)"),(0,n.kt)("td",{parentName:"tr",align:null},"sub (id do usu\xe1rio), iss (emissor) e aud (audi\xeancia)")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"profile"),(0,n.kt)("td",{parentName:"tr",align:null},"informa\xe7\xf5es do perfil do usu\xe1rio, incluindo nome, displayName e avatar")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"email"),(0,n.kt)("td",{parentName:"tr",align:null},"endere\xe7o de email do usu\xe1rio")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"address"),(0,n.kt)("td",{parentName:"tr",align:null},"endere\xe7o do usu\xe1rio")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"phone"),(0,n.kt)("td",{parentName:"tr",align:null},"n\xfamero de telefone do usu\xe1rio")))),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Sua Aplica\xe7\xe3o OAuth pode solicitar os escopos no redirecionamento inicial. Voc\xea pode especificar m\xfaltiplos escopos separando-os com um espa\xe7o usando %20:"),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-text"},"https://<CASDOOR_HOST>/login/oauth/authorize?\nclient_id=...&\nscope=openid%20email\n")),(0,n.kt)("p",{parentName:"admonition"},"Para mais detalhes, por favor veja o ",(0,n.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfoResponse"},"padr\xe3o OIDC"))),(0,n.kt)("p",null,"Ap\xf3s seu usu\xe1rio se autenticar com o Casdoor, o Casdoor ir\xe1 redirecion\xe1-lo para:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-url"},"https://REDIRECT_URI?code=CODE&state=STATE\n")),(0,n.kt)("p",null,"Agora que voc\xea obteve o c\xf3digo de autoriza\xe7\xe3o, fa\xe7a uma solicita\xe7\xe3o POST para:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/api/login/oauth/access_token\n")),(0,n.kt)("p",null,"na sua aplica\xe7\xe3o backend:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "authorization_code",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n    "code": Code,\n}\n')),(0,n.kt)("p",null,"Voc\xea receber\xe1 a seguinte resposta:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"O Casdoor tamb\xe9m suporta o recurso ",(0,n.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7636"},"PKCE"),". Ao obter o c\xf3digo de autoriza\xe7\xe3o, voc\xea pode adicionar dois par\xe2metros para habilitar o PKCE:"),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-url"},"&code_challenge_method=S256&code_challenge=YOUR_CHANNELLENGE\n")),(0,n.kt)("p",{parentName:"admonition"},"Ao obter o token, voc\xea precisa passar o par\xe2metro ",(0,n.kt)("inlineCode",{parentName:"p"},"code_verifier")," para verificar o PKCE. Vale mencionar que com o PKCE habilitado, ",(0,n.kt)("inlineCode",{parentName:"p"},"Client_Secret")," n\xe3o \xe9 necess\xe1rio, mas se voc\xea pass\xe1-lo, deve ser o valor correto.")),(0,n.kt)("h3",{id:"implicit-grant"},"Implicit Grant"),(0,n.kt)("p",null,"Talvez sua aplica\xe7\xe3o n\xe3o tenha um backend, e voc\xea precise usar Implicit Grant. Primeiro, voc\xea precisa ter certeza de que o Implicit Grant est\xe1 habilitado, ent\xe3o redirecione seus usu\xe1rios para:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/login/oauth/authorize?client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&response_type=token&scope=openid&state=STATE\n")),(0,n.kt)("p",null,"Ap\xf3s seu usu\xe1rio se autenticar com o Casdoor, o Casdoor ir\xe1 redirecion\xe1-lo para:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-url"},"https://REDIRECT_URI/#access_token=ACCESS_TOKEN\n")),(0,n.kt)("p",null,"O Casdoor tamb\xe9m suporta o ",(0,n.kt)("a",{parentName:"p",href:"https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html#id_token"},"id_token")," como ",(0,n.kt)("inlineCode",{parentName:"p"},"response_type"),", que \xe9 um recurso do OpenID."),(0,n.kt)("h3",{id:"resource-owner-password-credentials-grant"},"Resource Owner Password Credentials Grant"),(0,n.kt)("p",null,"Se sua aplica\xe7\xe3o n\xe3o tem um frontend que redireciona os usu\xe1rios para o Casdoor, ent\xe3o voc\xea pode precisar disso."),(0,n.kt)("p",null,"Primeiro, voc\xea precisa ter certeza de que o Password Credentials Grant est\xe1 habilitado e enviar uma solicita\xe7\xe3o POST para:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/api/login/oauth/access_token\n")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "password",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n    "username": Username,\n    "password": Password,\n}\n')),(0,n.kt)("p",null,"Voc\xea receber\xe1 a seguinte resposta:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,n.kt)("h3",{id:"client-credentials-grant"},"Client Credentials Grant"),(0,n.kt)("p",null,"Voc\xea tamb\xe9m pode usar Client Credentials Grant quando sua aplica\xe7\xe3o n\xe3o tem um frontend."),(0,n.kt)("p",null,"Primeiro, voc\xea precisa ter certeza de que o Client Credentials Grant est\xe1 habilitado e enviar uma solicita\xe7\xe3o POST para ",(0,n.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/login/oauth/access_token"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "client_credentials",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n}\n')),(0,n.kt)("p",null,"Voc\xea receber\xe1 a seguinte resposta:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,n.kt)("p",null,"\xc9 importante notar que o AccessToken obtido desta forma difere dos tr\xeas primeiros, pois corresponde \xe0 aplica\xe7\xe3o e n\xe3o ao usu\xe1rio."),(0,n.kt)("h3",{id:"refresh-token"},"Refresh Token"),(0,n.kt)("p",null,"Talvez voc\xea queira atualizar seu Access Token, ent\xe3o voc\xea pode usar o ",(0,n.kt)("inlineCode",{parentName:"p"},"refreshToken")," que obteve acima."),(0,n.kt)("p",null,"Primeiro, voc\xea precisa definir o tempo de expira\xe7\xe3o do Refresh Token no aplicativo (padr\xe3o \xe9 0 horas), e enviar uma solicita\xe7\xe3o POST para ",(0,n.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/login/oauth/refresh_token")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "refresh_token",\n    "refresh_token": REFRESH_TOKEN,\n    "scope": SCOPE,\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n}\n')),(0,n.kt)("p",null,"Voc\xea receber\xe1 uma resposta como esta:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,n.kt)("h2",{id:"como-verificar-access-token"},"Como Verificar Access Token"),(0,n.kt)("p",null,"O Casdoor atualmente suporta o endpoint de ",(0,n.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7662"},"introspec\xe7\xe3o de token"),". Este endpoint \xe9 protegido por Autentica\xe7\xe3o B\xe1sica (ClientId:ClientSecret)."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-http"},"POST /api/login/oauth/introspect HTTP/1.1\nHost: CASDOOR_HOST\nAccept: application/json\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=\n\ntoken=ACCESS_TOKEN&token_type_hint=access_token\n")),(0,n.kt)("p",null,"Voc\xea receber\xe1 a seguinte resposta:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "active": true,\n    "client_id": "c58c...",\n    "username": "admin",\n    "token_type": "Bearer",\n    "exp": 1647138242,\n    "iat": 1646533442,\n    "nbf": 1646533442,\n    "sub": "7a6b4a8a-b731-48da-bc44-36ae27338817",\n    "aud": [\n        "c58c..."\n    ],\n    "iss": "http://localhost:8000"\n}\n')),(0,n.kt)("h2",{id:"como-usar-accesstoken"},"Como Usar ",(0,n.kt)("inlineCode",{parentName:"h2"},"AccessToken")),(0,n.kt)("p",null,"Voc\xea pode usar AccessToken para acessar APIs do Casdoor que requerem autentica\xe7\xe3o."),(0,n.kt)("p",null,"Por exemplo, existem duas maneiras diferentes de solicitar ",(0,n.kt)("inlineCode",{parentName:"p"},"/api/userinfo"),"."),(0,n.kt)("p",null,"Tipo 1: Par\xe2metro de consulta"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/userinfo?accessToken=<your_access_token>")),(0,n.kt)("p",null,"Tipo 2: Token Bearer HTTP"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/userinfo"),' with the header: "Authorization: Bearer <your_access_token>"'),(0,n.kt)("p",null,"O Casdoor ir\xe1 analisar o access_token e retornar as informa\xe7\xf5es do usu\xe1rio correspondentes de acordo com o ",(0,n.kt)("inlineCode",{parentName:"p"},"scope"),". Voc\xea receber\xe1 a mesma resposta, que se parece com isto:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "sub": "7a6b4a8a-b731-48da-bc44-36ae27338817",\n    "iss": "http://localhost:8000",\n    "aud": "c58c..."\n}\n')),(0,n.kt)("p",null,"Se voc\xea espera mais informa\xe7\xf5es do usu\xe1rio, adicione ",(0,n.kt)("inlineCode",{parentName:"p"},"scope")," ao obter o AccessToken na etapa ",(0,n.kt)("a",{parentName:"p",href:"#1"},"Authorization Code Grant"),"."),(0,n.kt)("h2",{id:"diferen\xe7as-entre-as-apis-userinfo-e-get-account"},"Diferen\xe7as entre as APIs ",(0,n.kt)("inlineCode",{parentName:"h2"},"userinfo")," e ",(0,n.kt)("inlineCode",{parentName:"h2"},"get-account")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"/api/userinfo"),": Esta API retorna informa\xe7\xf5es do usu\xe1rio como parte do protocolo OIDC. Ela fornece informa\xe7\xf5es limitadas, incluindo apenas as informa\xe7\xf5es b\xe1sicas definidas nos padr\xf5es OIDC. Para uma lista de escopos dispon\xedveis suportados pelo Casdoor, por favor consulte a se\xe7\xe3o de ",(0,n.kt)("a",{parentName:"p",href:"#available-scopes"},"escopos dispon\xedveis"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"/api/get-account"),": Esta API recupera o objeto do usu\xe1rio para a conta atualmente logada. \xc9 uma API espec\xedfica do Casdoor que permite obter todas as informa\xe7\xf5es do ",(0,n.kt)("a",{parentName:"p",href:"/docs/basic/core-concepts#user"},"usu\xe1rio")," no Casdoor."))))}d.isMDXComponent=!0},67093:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/accesstoken_grant_types-a3a06e2f0f56b34ddf752837c834771e.png"}}]);