(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[6437],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,v=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(v,i(i({ref:t},p),{},{components:n})):r.createElement(v,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";var r=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},5064:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(4034),a=n(7294),o=n(2389),i=n(9443);var l=function(){var e=(0,a.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(9558),u=n(6010),p="tabItem_1uMI";function c(e){var t,n,r,o=e.lazy,i=e.block,c=e.defaultValue,d=e.values,m=e.groupId,v=e.className,g=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&"string"==typeof e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=d?d:g.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),h=(0,s.lx)(f,(function(e,t){return e.value===t.value}));if(h.length>0)throw new Error('Docusaurus error: Duplicate values "'+h.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===c?c:null!=(t=null!=c?c:null==(n=g.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(r=g[0])?void 0:r.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var y=l(),k=y.tabGroupChoices,C=y.setTabGroupChoices,N=(0,a.useState)(b),O=N[0],S=N[1],x=[],w=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var T=k[m];null!=T&&T!==O&&f.some((function(e){return e.value===T}))&&S(T)}var E=function(e){var t=e.currentTarget,n=x.indexOf(t),r=f[n].value;r!==O&&(w(t),S(r),null!=m&&C(m,r))},D=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=x.indexOf(e.currentTarget)+1;n=x[r]||x[0];break;case"ArrowLeft":var a=x.indexOf(e.currentTarget)-1;n=x[a]||x[x.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":i},v)},f.map((function(e){var t=e.value,n=e.label;return a.createElement("li",{role:"tab",tabIndex:O===t?0:-1,"aria-selected":O===t,className:(0,u.Z)("tabs__item",p,{"tabs__item--active":O===t}),key:t,ref:function(e){return x.push(e)},onKeyDown:D,onFocus:E,onClick:E},null!=n?n:t)}))),o?(0,a.cloneElement)(g.filter((function(e){return e.props.value===O}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},g.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==O})}))))}function d(e){var t=(0,o.Z)();return a.createElement(c,(0,r.Z)({key:String(t)},e))}},9443:function(e,t,n){"use strict";var r=(0,n(7294).createContext)(void 0);t.Z=r},729:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return d},default:function(){return v}});var r=n(4034),a=n(9973),o=(n(7294),n(3905)),i=n(5064),l=n(8215),s=["components"],u={sidebar_position:1,title:"S\xe9curit\xe9 du printemps"},p=void 0,c={unversionedId:"integration/spring-security",id:"integration/spring-security",isDocsHomePage:!1,title:"S\xe9curit\xe9 du printemps",description:"Casdoor peut utiliser le protocole OIDC comme IDP pour connecter diff\xe9rentes applications. Nous utiliserons ici Spring Security comme exemple pour vous montrer comment utiliser OIDC pour vous connecter \xe0 vos applications.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/integration/spring-security.mdx",sourceDirName:"integration",slug:"/integration/spring-security",permalink:"/fr/docs/integration/spring-security",editUrl:"https://github.com/casdoor/casdoor-website/tree/master/docs/integration/spring-security.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"S\xe9curit\xe9 du printemps"},sidebar:"tutorialSidebar",previous:{title:"APISIX",permalink:"/fr/docs/integration/apisix"},next:{title:"Internationalisation",permalink:"/fr/docs/internationalization"}},d=[{value:"\xc9tape 1. D\xe9ployer la porte de caisse",id:"\xe9tape-1-d\xe9ployer-la-porte-de-caisse",children:[],level:2},{value:"\xc9tape 2. Configurer l&#39;application Casdoor",id:"\xe9tape-2-configurer-lapplication-casdoor",children:[],level:2},{value:"\xc9tape 3. Configurer Spring Security",id:"\xe9tape-3-configurer-spring-security",children:[],level:2},{value:"\xc9tape 4. Commencer avec une d\xe9mo",id:"\xe9tape-4-commencer-avec-une-d\xe9mo",children:[],level:2},{value:"\xc9tape 5. Essayez la d\xe9mo !",id:"\xe9tape-5-essayez-la-d\xe9mo-",children:[],level:2}],m={toc:d};function v(e){var t=e.components,u=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},m,u,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Casdoor peut utiliser le protocole OIDC comme IDP pour connecter diff\xe9rentes applications. Nous utiliserons ici Spring Security comme exemple pour vous montrer comment utiliser OIDC pour vous connecter \xe0 vos applications."),(0,o.kt)("h2",{id:"\xe9tape-1-d\xe9ployer-la-porte-de-caisse"},"\xc9tape 1. D\xe9ployer la porte de caisse"),(0,o.kt)("p",null,"Premi\xe8rement, la Casdoor devrait \xeatre d\xe9ploy\xe9e."),(0,o.kt)("p",null,"Vous pouvez vous r\xe9f\xe9rer \xe0 la documentation officielle de Casdoor pour l'installation du ",(0,o.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Serveur"),"."),(0,o.kt)("p",null,"Apr\xe8s un d\xe9ploiement r\xe9ussi, vous devez vous assurer :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Le serveur Casdoor fonctionne avec succ\xe8s sur ",(0,o.kt)("strong",{parentName:"li"},"http://localhost:8000"),"."),(0,o.kt)("li",{parentName:"ul"},"Ouvrez votre navigateur favori et visitez ",(0,o.kt)("strong",{parentName:"li"},"http://localhost:7001"),", vous verrez la page de connexion de Casdoor."),(0,o.kt)("li",{parentName:"ul"},"La saisie ",(0,o.kt)("inlineCode",{parentName:"li"},"admin")," et ",(0,o.kt)("inlineCode",{parentName:"li"},"123")," pour tester la fonctionnalit\xe9 de connexion fonctionne correctement.")),(0,o.kt)("p",null,"Ensuite, vous pouvez rapidement impl\xe9menter une page de connexion bas\xe9e sur casdoor dans votre propre application avec les \xe9tapes suivantes."),(0,o.kt)("h2",{id:"\xe9tape-2-configurer-lapplication-casdoor"},"\xc9tape 2. Configurer l'application Casdoor"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Cr\xe9er ou utiliser une application Casdoor existante."),(0,o.kt)("li",{parentName:"ol"},"Ajoutez votre url de redirection ",(0,o.kt)("img",{alt:"R\xe9glage de l&#39;application Casdoor",src:n(6362).Z})),(0,o.kt)("li",{parentName:"ol"},"Ajoutez le fournisseur que vous voulez et compl\xe9tez d'autres param\xe8tres.")),(0,o.kt)("p",null,"Sans surprise, vous pouvez obtenir deux valeurs sur la page des param\xe8tres de l'application : ",(0,o.kt)("inlineCode",{parentName:"p"},"ID client")," et ",(0,o.kt)("inlineCode",{parentName:"p"},"secret client")," comme l'image ci-dessus, nous les utiliserons \xe0 l'\xe9tape suivante."),(0,o.kt)("p",null,"Ouvrez votre navigateur favori et visite: ",(0,o.kt)("strong",{parentName:"p"},"http://",(0,o.kt)("inlineCode",{parentName:"strong"},"CASDOOR_HOSTNAME"),"/.well-known/openid-configuration"),", vous verrez la configuration OIDC de Casdoor."),(0,o.kt)("h2",{id:"\xe9tape-3-configurer-spring-security"},"\xc9tape 3. Configurer Spring Security"),(0,o.kt)("p",null,"Spring Security supporte nativement OIDC."),(0,o.kt)("p",null,"Vous pouvez personnaliser les param\xe8tres du client OAuth2 de Spring Security :"),(0,o.kt)("p",null,":::prudence"),(0,o.kt)("p",null,"Vous devriez remplacer la configuration par votre propre instance Casdoor en particulier les ",(0,o.kt)("inlineCode",{parentName:"p"},"<Client ID>")," et autres."),(0,o.kt)("p",null,":::"),(0,o.kt)(i.Z,{defaultValue:"yml",groupId:"import-sdk",values:[{label:"application.yml",value:"yml"},{label:"application.properties",value:"properties"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"yml",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"spring:\n  security:\n    oauth2:\n      client:\n        registration:\n          casdoor:\n            client-id: <Client ID>\n            client-secret: <Client Secret>\n            scope: <Scope>\n            authorization-grant-type: authorization_code\n            redirect-uri: <Redirect URL>\n        provider:\n          casdoor:\n            authorization-uri: http://CASDOOR_HOSTNAME:7001/login/oauth/authorize\n            token-uri: http://CASDOOR_HOSTNAME:8000/api/login/oauth/access_token\n            user-info-uri: http://CASDOOR_HOSTNAME:8000/api/get-account\n            user-name-attribute: name\n"))),(0,o.kt)(l.Z,{value:"properties",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-properties"},"spring.security.oauth2.client.registration.casdoor.client-id=<Client ID>\nspring.security.oauth2.client.registration.casdoor.client-secret=<Client Secret>\nspring.security.oauth2.client.registration.casdoor.scope=<Scope>\nspring.security.oauth2.client.registration.casdoor.authorization-grant-type=authorization_code\nspring.security.oauth2.client.registration.casdoor.redirect-uri=<Redirect URL>\n\nspring.security.oauth2.client.provider.casdoor.authorization-uri=http://CASDOOR_HOSTNAME:7001/login/oauth/authorize\nspring.security.oauth2.client.provider.casdoor.token-uri=http://CASDOOR_HOSTNAME:8000/api/login/oauth/access_token\nspring.security.oauth2.client.provider.casdoor.user-info-uri=http://CASDOOR_HOSTNAME:8000/api/get-account\nspring.security.oauth2.client.provider.casdoor.user-name-attribute=name\n")))),(0,o.kt)("p",null,"Vous pouvez \xe9galement personnaliser les param\xe8tres par ",(0,o.kt)("inlineCode",{parentName:"p"},"ClientRegistration")," dans votre code. Vous pouvez trouver le mapping ",(0,o.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-security/site/docs/5.2.12.RELEASE/reference/html/oauth2.html#oauth2login-boot-property-mappings"},"ici")),(0,o.kt)("h2",{id:"\xe9tape-4-commencer-avec-une-d\xe9mo"},"\xc9tape 4. Commencer avec une d\xe9mo"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Nous pouvons cr\xe9er une application Spring Boot."),(0,o.kt)("li",{parentName:"ol"},"Nous pouvons ajouter une configuration qui prot\xe8ge tous les points de terminaison sauf ",(0,o.kt)("inlineCode",{parentName:"li"},"/")," et ",(0,o.kt)("inlineCode",{parentName:"li"},"/login**")," pour que les utilisateurs puissent se connecter.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@EnableWebSecurity\nde classe publique UiSecurityConfig \xe9tend WebSecurityConfigurerAdapter {\n\n    @Override\n    prot\xe9g\xe9 configure(HttpSecurity http) lance une exception {\n        http. uthorizeRequests().antMatchers("/", "/login**").permitAll().anyRequest().authenticated(). nd()\n                . auth2Login();\n\n    }\n}\n')),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Nous pouvons ajouter une page na\xefve pour que l'utilisateur se connecte.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<title>Spring OAuth Client Thymeleaf - 1</title>\n<link rel="stylesheet"\n    href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />\n</head>\n<body>\n    <nav\n        class="navbar navbar-expand-lg navbar-light bg-light shadow-sm p-3 mb-5">\n        <a class="navbar-brand" th:href="@{/foos/}">Spring OAuth Client\n            Thymeleaf - 1</a>\n    </nav>\n    <div class="container">\n        <label>Welcome ! </label> <br /> <a th:href="@{/foos/}"\n            class="btn btn-primary">Connexion</a>\n    </div>\n</body>\n</html>\n')),(0,o.kt)("p",null,"Lorsque l'utilisateur clique sur le bouton ",(0,o.kt)("inlineCode",{parentName:"p"},"login")," , il sera redirig\xe9 vers ",(0,o.kt)("inlineCode",{parentName:"p"},"casdoor"),"."),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Ensuite, nous pouvons d\xe9finir notre ressource prot\xe9g\xe9e. Nous pouvons exporter un point de terminaison appel\xe9 ",(0,o.kt)("inlineCode",{parentName:"li"},"/foos")," et une page web \xe0 afficher.")),(0,o.kt)("p",null,"Mod\xe8le de donn\xe9es"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"de classe publique FooModel {\n    id long priv\xe9 ;\n    nom priv\xe9 de cha\xeene ;\n\n    public FooModel(id long, nom de cha\xeene) {\n        super();\n        ceci. d = id;\n        ceci. ame = nom;\n    }\n    public Long getId() {\n        id de retour ;\n    }\n    public void setId(Long id) {\n        ceci. d = id;\n    }\n    public String getName() {\n        return name;\n    }\n    public void setName(String name) {\n        ceci. ame = nom;\n    }\n}\n")),(0,o.kt)("p",null,"Contr\xf4leur"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\npublic class FooClientController {\n    @GetMapping("/foos")\n    public String getFoos(Mod\xe8le mod\xe8le) {\n        Liste<FooModel> foos = new ArrayList<>();\n        imb\xe9cile. dd(new FooModel(1L, "a"));\n        foos.add(new FooModel(2L, "b"));\n        foos. dd(new FooModel(3L, "c"));\n        model. ddAttribute("foos", foos);\n        return "foos";\n    }\n}\n')),(0,o.kt)("p",null,"Page Web"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<title>Spring OAuth Client Thymeleaf - 1</title>\n<link rel="stylesheet"\n    href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />\n</head>\n<body>\n    <nav\n        class="navbar navbar-expand-lg navbar-light bg-light shadow-sm p-3 mb-5">\n        <a class="navbar-brand" th:href="@{/foos/}">Spring OAuth Client\n            Thymeleaf -1</a>\n        <ul class="navbar-nav ml-auto">\n            <li class="navbar-text">Hi, <span sec:authentication="name">preferred_username</span>&nbsp;&nbsp;&nbsp;\n            </li>\n        </ul>\n    </nav>\n    <div class="container">\n        <h1>All Foos:</h1>\n        <table class="table table-bordered table-striped">\n            <thead>\n                <tr>\n                    <td>ID</td>\n                    <td>Name</td>\n                </tr>\n            </thead>\n            <tbody>\n                <tr th:if="${foos.empty}">\n                    <td colspan="4">No foos</td>\n                </tr>\n                <tr th:each="foo : ${foos}">\n                    <td><span th:text="${foo.id}"> ID </span></td>\n                    <td><span th:text="${foo.name}"> Name </span></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</body>\n</html>\n')),(0,o.kt)("p",null,":::prudence"),(0,o.kt)("p",null,"Tous les mod\xe8les de page web doivent \xeatre plac\xe9s sous ",(0,o.kt)("inlineCode",{parentName:"p"},"ressources/mod\xe8les"),"."),(0,o.kt)("p",null,":::"),(0,o.kt)("h2",{id:"\xe9tape-5-essayez-la-d\xe9mo-"},"\xc9tape 5. Essayez la d\xe9mo !"),(0,o.kt)("p",null,"Tout d'abord, vous pouvez essayer d'ouvrir votre navigateur favori et visiter directement ",(0,o.kt)("inlineCode",{parentName:"p"},"/foos"),". Il redirigera automatiquement vers la page de connexion de Casdoor. Vous pouvez vous connecter ici ou \xe0 partir de la page racine."),(0,o.kt)("p",null,"Si vous visitez votre page racine, ",(0,o.kt)("img",{alt:"R\xe9glage de l&#39;application Casdoor",src:n(7086).Z})),(0,o.kt)("p",null,"Cliquez sur le bouton ",(0,o.kt)("inlineCode",{parentName:"p"},"login")," et la page redirigera vers la page de connexion de casdoor. ",(0,o.kt)("img",{alt:"R\xe9glage de l&#39;application Casdoor",src:n(7791).Z})),(0,o.kt)("p",null,"Une fois que vous vous \xeates connect\xe9, la page redirigera vers ",(0,o.kt)("inlineCode",{parentName:"p"},"/foos"),". ",(0,o.kt)("img",{alt:"R\xe9glage de l&#39;application Casdoor",src:n(1722).Z})))}v.isMDXComponent=!0},6362:function(e,t,n){"use strict";t.Z=n.p+"assets/images/appsetting_spring_security-f2662d02db2032cea21f3b39b03b6c60.png"},7791:function(e,t,n){"use strict";t.Z=n.p+"assets/images/spring_security_casdoor-c0e156eb1514956214cad0b0d8d3ac98.png"},1722:function(e,t,n){"use strict";t.Z=n.p+"assets/images/spring_security_resource-820aab1821d09e451632a46bb73df602.png"},7086:function(e,t,n){"use strict";t.Z=n.p+"assets/images/spring_security_welcome-5a0d467a89d0134ed035b7718f3c834d.png"}}]);