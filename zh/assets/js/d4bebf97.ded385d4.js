"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[2422],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,b=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(b,i(i({ref:t},c),{},{components:n})):a.createElement(b,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},44839:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={title:"GitLab",description:"\u5728 GitLab \u670d\u52a1\u5668\u4e2d\u4f7f\u7528 Casdoor \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1",keywords:["GitLab"],authors:["Steve0x2a"]},i=void 0,l={unversionedId:"integration/ruby/gitlab",id:"integration/ruby/gitlab",title:"GitLab",description:"\u5728 GitLab \u670d\u52a1\u5668\u4e2d\u4f7f\u7528 Casdoor \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/integration/ruby/gitlab.md",sourceDirName:"integration/ruby",slug:"/integration/ruby/gitlab",permalink:"/zh/docs/integration/ruby/gitlab",draft:!1,editUrl:"https://crowdin.com/project/casdoor-website/zh-CN",tags:[],version:"current",frontMatter:{title:"GitLab",description:"\u5728 GitLab \u670d\u52a1\u5668\u4e2d\u4f7f\u7528 Casdoor \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1",keywords:["GitLab"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Ruby",permalink:"/zh/docs/category/ruby"},next:{title:"\u56fd\u9645\u5316",permalink:"/zh/docs/internationalization"}},s={},p=[{value:"\u7b2c 1 \u6b65\uff1a \u90e8\u7f72 Casdoor \u548c GitLab",id:"\u7b2c-1-\u6b65-\u90e8\u7f72-casdoor-\u548c-gitlab",level:2},{value:"\u7b2c 2 \u6b65\uff1a \u914d\u7f6e Casdoor \u5e94\u7528\u7a0b\u5e8f",id:"\u7b2c-2-\u6b65-\u914d\u7f6e-casdoor-\u5e94\u7528\u7a0b\u5e8f",level:2},{value:"\u7b2c 3 \u6b65\uff1a \u914d\u7f6e GitLab",id:"\u7b2c-3-\u6b65-\u914d\u7f6e-gitlab",level:2}],c={toc:p};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Casdoor \u53ef\u4ee5\u4f7f\u7528 OIDC \u534f\u8bae\u94fe\u63a5\u5230\u79c1\u6709\u90e8\u7f72\u7684 GitLab\uff0c\u8be5\u6587\u6863\u5c06\u5411\u60a8\u5c55\u793a\u5982\u4f55\u5904\u7406\u76f8\u5173\u95ee\u9898\u3002"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"As ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/administration/auth/oidc.html#configure-keycloak"},"GitLab docs")," said, GitLab only works with OpenID providers that use HTTPS, so you need to deploy Casdoor with HTTPS, like putting Casdoor behind a NGINX reverse proxy with SSL certificate setup. Casdoor itself only listens to 8000 port by default via HTTP and has no HTTPS related functionality.")),(0,r.kt)("p",null,"The following are some of the names in the configuration:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": Domain name or IP where Casdoor server is deployed. e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"GITLAB_HOSTNAME"),": Domain name or IP where GitLab is deployed. e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"https://gitlab.com"),"."),(0,r.kt)("h2",{id:"\u7b2c-1-\u6b65-\u90e8\u7f72-casdoor-\u548c-gitlab"},"\u7b2c 1 \u6b65\uff1a \u90e8\u7f72 Casdoor \u548c GitLab"),(0,r.kt)("p",null,"Firstly, the ",(0,r.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Casdoor")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/install/"},"GitLab")," should be deployed."),(0,r.kt)("p",null,"After a successful deployment, you need to ensure:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Casdoor \u53ef\u4ee5\u6b63\u5e38\u767b\u5f55\u4f7f\u7528\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5c06 Casdoor \u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"origin")," \u503c (conf/app.conf) \u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),"\u3002 ",(0,r.kt)("img",{alt:"Casdoor \u914d\u7f6e",src:n(66496).Z,width:"1013",height:"448"}))),(0,r.kt)("h2",{id:"\u7b2c-2-\u6b65-\u914d\u7f6e-casdoor-\u5e94\u7528\u7a0b\u5e8f"},"\u7b2c 2 \u6b65\uff1a \u914d\u7f6e Casdoor \u5e94\u7528\u7a0b\u5e8f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u6216\u4f7f\u7528\u73b0\u6709\u7684 Casdoor \u5e94\u7528\u7a0b\u5e8f\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u91cd\u5b9a\u5411\u7f51\u5740\uff1a",(0,r.kt)("inlineCode",{parentName:"li"},"http://GITLAB_HOSTNAME/users/auth/openid_connect/callback"),"\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u60a8\u60f3\u8981\u7684\u63d0\u4f9b\u5546\u5e76\u8865\u5145\u5176\u4ed6\u8bbe\u7f6e\u3002")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Application Setting",src:n(18687).Z,width:"1571",height:"658"})," Not surprisingly, you can get two values \u200b\u200bon the application settings page: ",(0,r.kt)("inlineCode",{parentName:"p"},"Client ID")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Client secret")," like the picture above, and we will use them in the next step."),(0,r.kt)("p",null,"Open your favorite browser and visit: ",(0,r.kt)("strong",{parentName:"p"},"http://",(0,r.kt)("inlineCode",{parentName:"strong"},"CASDOOR_HOSTNAME"),"/.well-known/openid-configuration"),", you will see the OIDC configure of Casdoor."),(0,r.kt)("h2",{id:"\u7b2c-3-\u6b65-\u914d\u7f6e-gitlab"},"\u7b2c 3 \u6b65\uff1a \u914d\u7f6e GitLab"),(0,r.kt)("p",null,"You can follow the steps below to set this up, or make custom changes according to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/14.6/ee/administration/auth/oidc.html"},"this document"),"(e.g., you are installing GitLab using source code rather than Omnibus)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5728 GitLab \u670d\u52a1\u5668\u4e0a\uff0c\u6253\u5f00\u914d\u7f6e\u6587\u4ef6\u3002"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo editor /etc/gitlab/gitlab.rb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6dfb\u52a0\u63d0\u4f9b\u5546\u914d\u7f6e\u3002  (HOSTNAME \u94fe\u63a5\u5e94\u5305\u62ec http \u6216 https)"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},'gitlab_rails[\'omniauth_providers\'] = [\n    {\n        name: "openid_connect",\n        label: "Casdoor", # \u767b\u5f55\u6309\u94ae\u7684\u53ef\u9009\u6807\u7b7e\uff0c\u9ed8\u8ba4\u4e3a"Openid Connect"\n        args: {\n            name: "openid_connect",\n            scope: ["openid", "profile", "email"],\n            response_type: "code",\n            issuer:  "<CASDOOR_HOSTNAME>",\n            client_auth_method: "query",\n            discovery: true,\n            uid_field: "preferred_username",\n            client_options: {\n                identifier: "<\u4f60\u7684 CLIENT ID>",\n                secret: "<\u4f60\u7684 CLIENT SECRET>",\n                redirect_uri: "<GITLAB_HOSTNAME>/users/auth/openid_connect/callback"\n            }\n        }\n    }\n]\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u91cd\u65b0\u542f\u52a8 GitLab \u670d\u52a1\u5668\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6bcf\u4e2a\u6ce8\u518c\u7528\u6237\u90fd\u53ef\u4ee5\u6253\u5f00",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"GITLAB_HOSTNAME"),"/-/profile/account"),"\uff0c\u8fde\u63a5 Casdoor \u8d26\u53f7\u3002 ",(0,r.kt)("img",{alt:"GitLab \u8fde\u63a5",src:n(11405).Z,width:"2648",height:"926"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5b8c\u6210\uff01 \u73b0\u5728\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 casdoor \u767b\u5f55\u60a8\u81ea\u5df1\u7684 GitLab\u3002 ",(0,r.kt)("img",{alt:"GitLab \u767b\u5f55",src:n(149).Z,width:"2127",height:"1315"})))))}d.isMDXComponent=!0},66496:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},18687:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/appsetting_gitlab-a7b6bb0c825259b068b3761fc249e79d.png"},11405:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/gitlab_connect-f62ead92f802fcdb4db244f128b04711.png"},149:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/gitlab_login-190fea801337b81056835c566872d439.png"}}]);