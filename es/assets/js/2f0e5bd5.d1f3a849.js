"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[8687],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>u});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=n.createContext({}),s=function(e){var a=n.useContext(c),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=s(e.components);return n.createElement(c.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=s(t),u=r,k=m["".concat(c,".").concat(u)]||m[u]||d[u]||o;return t?n.createElement(k,i(i({ref:a},p),{},{components:t})):n.createElement(k,i({ref:a},p))}));function u(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var c in a)hasOwnProperty.call(a,c)&&(l[c]=a[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},16020:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=t(87462),r=(t(67294),t(3905));const o={title:"Keycloak",description:"Usar Keycloak para autenticar usuarios",keywords:["Keycloak"],authors:["seriouszyx"]},i=void 0,l={unversionedId:"provider/saml/keycloak",id:"provider/saml/keycloak",title:"Keycloak",description:"Usar Keycloak para autenticar usuarios",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/provider/saml/keycloak.md",sourceDirName:"provider/saml",slug:"/provider/saml/keycloak",permalink:"/es/docs/provider/saml/keycloak",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/provider/saml/keycloak.md",tags:[],version:"current",frontMatter:{title:"Keycloak",description:"Usar Keycloak para autenticar usuarios",keywords:["Keycloak"],authors:["seriouszyx"]},sidebar:"tutorialSidebar",previous:{title:"Personalizado",permalink:"/es/docs/provider/saml/custom"},next:{title:"Alibaba Cloud IDaaS",permalink:"/es/docs/provider/saml/aliyun"}},c={},s=[{value:"Configurar Keycloak",id:"configurar-keycloak",level:2},{value:"Agregar una entrada de cliente en Keycloak",id:"agregar-una-entrada-de-cliente-en-keycloak",level:2},{value:"Configurar en Casdoor",id:"configurar-en-casdoor",level:2},{value:"Validar el efecto",id:"validar-el-efecto",level:2}],p={toc:s};function d(e){let{components:a,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"El sistema ",(0,r.kt)("a",{parentName:"p",href:"https://www.keycloak.org/"},"Keycloak")," de JBoss es un sistema de gesti\xf3n de identidades de c\xf3digo abierto y ampliamente utilizado que soporta la integraci\xf3n con aplicaciones a trav\xe9s de SAML y OpenID Connect. Tambi\xe9n puede operar como un intermediario de identidad entre otros proveedores como LDAP u otros proveedores SAML y aplicaciones que soportan SAML o OpenID Connect."),(0,r.kt)("p",null,"Aqu\xed hay un ejemplo de c\xf3mo configurar una nueva entrada de cliente en Keycloak y configurar Casdoor para usarlo y permitir el inicio de sesi\xf3n en la UI por usuarios de Keycloak que tienen acceso otorgado a trav\xe9s de la configuraci\xf3n de Keycloak."),(0,r.kt)("h2",{id:"configurar-keycloak"},"Configurar Keycloak"),(0,r.kt)("p",null,"Para este ejemplo, hagamos las siguientes elecciones de configuraci\xf3n y suposiciones:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Supongamos que est\xe1s ejecutando Casdoor en modo de desarrollo localmente. La UI de Casdoor est\xe1 disponible en ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:7001")," y el servidor est\xe1 disponible en ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000"),". Reemplazar con la URL apropiada seg\xfan sea necesario."),(0,r.kt)("li",{parentName:"ul"},"Supongamos que est\xe1s ejecutando Keycloak localmente. La UI de Keycloak est\xe1 disponible en ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8080/auth"),"."),(0,r.kt)("li",{parentName:"ul"},"Basado en eso, la URL del SP ACS para esta implementaci\xf3n ser\xe1: ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ul"},"Nuestro ID de Entidad SP usar\xe1 la misma URL: ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")),(0,r.kt)("p",null,"Puedes usar el reino predeterminado o crear un nuevo reino."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Agregar reino de Keycloak",src:t(78539).Z,width:"2560",height:"590"})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Reino de Keycloak",src:t(95491).Z,width:"2560",height:"965"})),(0,r.kt)("h2",{id:"agregar-una-entrada-de-cliente-en-keycloak"},"Agregar una entrada de cliente en Keycloak"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Para m\xe1s detalles sobre los Clientes de Keycloak, consultar la ",(0,r.kt)("a",{parentName:"p",href:"https://www.keycloak.org/docs/latest/server_admin/index.html#_client-saml-configuration"},"documentaci\xf3n de Keycloak"),".")),(0,r.kt)("p",null,"Hacer clic en ",(0,r.kt)("strong",{parentName:"p"},"Clientes")," en el men\xfa y luego hacer clic en ",(0,r.kt)("strong",{parentName:"p"},"Crear")," para ir a la p\xe1gina ",(0,r.kt)("strong",{parentName:"p"},"Agregar Cliente"),". Llenar los campos de la siguiente manera:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ID del Cliente"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - Esto ser\xe1 el ID de la Entidad SP utilizado en la configuraci\xf3n de Casdoor m\xe1s adelante."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Protocolo del Cliente"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"saml"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Punto Final SAML del Cliente"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - Esta URL es donde quieres que el servidor de Keycloak env\xede las solicitudes y respuestas SAML. Generalmente, las aplicaciones tienen una URL para procesar solicitudes SAML. Se pueden establecer m\xfaltiples URLs en la pesta\xf1a de Configuraci\xf3n del cliente.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Agregar cliente de Keycloak",src:t(15582).Z,width:"2560",height:"961"})),(0,r.kt)("p",null,"Hacer clic en ",(0,r.kt)("strong",{parentName:"p"},"Guardar"),". Esta acci\xf3n crea el cliente y te lleva a la pesta\xf1a ",(0,r.kt)("strong",{parentName:"p"},"Configuraci\xf3n"),"."),(0,r.kt)("p",null,"Los siguientes son parte de la configuraci\xf3n:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Nombre")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"Casdoor"),". Esto solo se usa para mostrar un nombre amigable a los usuarios de Keycloak en la UI de Keycloak. Puedes usar cualquier nombre que prefieras."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Habilitado")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Incluir Declaraci\xf3n de Autenticaci\xf3n")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Firmar Documentos")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Firmar Aserciones")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Encriptar Aserciones")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Firma de Cliente Requerida")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Forzar Formato de Name ID")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Formato de Name ID")," - Seleccionar ",(0,r.kt)("inlineCode",{parentName:"li"},"username"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URIs de Redirecci\xf3n V\xe1lidas")," - Agregar ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL de Procesamiento SAML Principal")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ol"},"Configuraci\xf3n Fina de Punto Final SAML",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL de Enlace POST del Servicio de Consumo de Aserci\xf3n")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL de Enlace de Redirecci\xf3n del Servicio de Consumo de Aserci\xf3n")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")))),(0,r.kt)("p",null,"Guardar la configuraci\xf3n."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configurar cliente de Keycloak",src:t(82142).Z,width:"2557",height:"3014"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Si quieres firmar la solicitud de autenticaci\xf3n, necesitas habilitar la opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Firma de Cliente Requerida")," y subir el certificado generado por ti mismo. La clave privada y el certificado utilizados en Casdoor, ",(0,r.kt)("inlineCode",{parentName:"p"},"token_jwt_key.key")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"token_jwt_key.pem"),", se encuentran en el directorio ",(0,r.kt)("strong",{parentName:"p"},"object"),". En Keycloak, necesitas hacer clic en la pesta\xf1a ",(0,r.kt)("strong",{parentName:"p"},"Claves"),", hacer clic en el bot\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Importar"),", seleccionar ",(0,r.kt)("strong",{parentName:"p"},"Formato de Archivo")," como ",(0,r.kt)("strong",{parentName:"p"},"Certificado PEM")," y subir el certificado.")),(0,r.kt)("p",null,"Hacer clic en la pesta\xf1a ",(0,r.kt)("strong",{parentName:"p"},"Instalaci\xf3n"),"."),(0,r.kt)("p",null,"Para Keycloak <= 5.0.0, seleccionar Opci\xf3n de Formato - ",(0,r.kt)("strong",{parentName:"p"},"SAML Metadata IDPSSODescriptor")," y copiar los metadatos."),(0,r.kt)("p",null,"Para Keycloak 6.0.0+, seleccionar Opci\xf3n de Formato - ",(0,r.kt)("strong",{parentName:"p"},"Archivos de Mod Auth Mellon")," y hacer clic en ",(0,r.kt)("strong",{parentName:"p"},"Descargar"),". Descomprimir el .zip descargado, localizar ",(0,r.kt)("inlineCode",{parentName:"p"},"idp-metadata.xml")," y copiar los metadatos."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Descargar metadatos",src:t(82235).Z,width:"2560",height:"596"})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Copiar metadatos",src:t(7962).Z,width:"1002",height:"241"})),(0,r.kt)("h2",{id:"configurar-en-casdoor"},"Configurar en Casdoor"),(0,r.kt)("p",null,"Crear un nuevo proveedor en Casdoor."),(0,r.kt)("p",null,"Seleccionar categor\xeda como ",(0,r.kt)("strong",{parentName:"p"},"SAML"),", tipo como ",(0,r.kt)("strong",{parentName:"p"},"Keycloak"),". Copiar el contenido de los metadatos y pegarlo en el campo ",(0,r.kt)("strong",{parentName:"p"},"Metadatos"),". Los valores de ",(0,r.kt)("strong",{parentName:"p"},"Punto Final"),", ",(0,r.kt)("strong",{parentName:"p"},"IdP")," y ",(0,r.kt)("strong",{parentName:"p"},"URL del Emisor")," se generar\xe1n autom\xe1ticamente despu\xe9s de hacer clic en el bot\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Analizar"),". Finalmente, hacer clic en el bot\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Guardar"),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Si habilitas la opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Firma de Cliente Requerida")," en Keycloak y subes el certificado, por favor habilita la opci\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Firmar solicitud")," en Casdoor.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Proveedor de Casdoor",src:t(33666).Z,width:"2505",height:"1272"})),(0,r.kt)("p",null,"Editar la aplicaci\xf3n que deseas configurar en Casdoor. Seleccionar el proveedor que acabas de agregar y hacer clic en el bot\xf3n ",(0,r.kt)("strong",{parentName:"p"},"Guardar"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Agregar proveedor para la aplicaci\xf3n",src:t(30464).Z,width:"2487",height:"255"})),(0,r.kt)("h2",{id:"validar-el-efecto"},"Validar el efecto"),(0,r.kt)("p",null,"Ir a la aplicaci\xf3n que acabas de configurar y encontrar\xe1s un icono de Keycloak en la p\xe1gina de inicio de sesi\xf3n."),(0,r.kt)("p",null,"Hacer clic en el icono y ser\xe1s redirigido a la p\xe1gina de inicio de sesi\xf3n de Keycloak. Despu\xe9s de una autenticaci\xf3n exitosa, iniciar\xe1s sesi\xf3n en Casdoor."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Inicio de sesi\xf3n de Casdoor",src:t(42062).Z,width:"1280",height:"720"})))}d.isMDXComponent=!0},30464:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_casdoor_app-c3afe561f88f7c5ade9973f8aa706dec.png"},42062:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_casdoor_login-5080e3bced4808bd768772ecfb15ca97.gif"},33666:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_casdoor_provider-238d41bdb7a2ce7eab3252b45b8f7d63.png"},15582:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_client_add-a22a58cfe1cac19aac7c471f4b95a391.png"},82142:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_client_configure-d8a4520b9809494ac277da30d02a8d35.png"},7962:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_client_copy-3233ceff3f6b91883873e5441c6e50fe.png"},82235:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_client_install-e8ed45db439c33e32b2f46fbdc476f40.png"},95491:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_realm-aa47ec9142083126d9c9f1ce79c75eac.png"},78539:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/keycloak_realm_add-9a27d681ede089b89474ebd0acc155c0.png"}}]);