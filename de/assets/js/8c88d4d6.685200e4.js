"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[9491],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>m});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=i.createContext({}),l=function(e){var n=i.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=l(e.components);return i.createElement(u.Provider,{value:n},e.children)},h={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},p=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,u=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=l(t),m=r,c=p["".concat(u,".").concat(m)]||p[m]||h[m]||a;return t?i.createElement(c,o(o({ref:n},d),{},{components:t})):i.createElement(c,o({ref:n},d))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=p;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<a;l++)o[l]=t[l];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}p.displayName="MDXCreateElement"},23541:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var i=t(87462),r=(t(67294),t(3905));const a={title:"NginxCommunityVersion",description:"Verwendung von Casdoor mit Nginx (nicht Nginx-Plus) und Oauth2-Proxy",keywords:["nginx","OAuth2-Proxy","nginx-community-version"],authors:["gzyzhy"]},o=void 0,s={unversionedId:"integration/C++/NginxCommunityVersion",id:"integration/C++/NginxCommunityVersion",title:"NginxCommunityVersion",description:"Verwendung von Casdoor mit Nginx (nicht Nginx-Plus) und Oauth2-Proxy",source:"@site/i18n/de/docusaurus-plugin-content-docs/current/integration/C++/NginxCommunityVersion.md",sourceDirName:"integration/C++",slug:"/integration/C++/NginxCommunityVersion",permalink:"/de/docs/integration/C++/NginxCommunityVersion",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/C++/NginxCommunityVersion.md",tags:[],version:"current",frontMatter:{title:"NginxCommunityVersion",description:"Verwendung von Casdoor mit Nginx (nicht Nginx-Plus) und Oauth2-Proxy",keywords:["nginx","OAuth2-Proxy","nginx-community-version"],authors:["gzyzhy"]},sidebar:"tutorialSidebar",previous:{title:"Nginx",permalink:"/de/docs/integration/C++/Nginx"},next:{title:"Envoy",permalink:"/de/docs/integration/C++/Envoy"}},u={},l=[{value:"Voraussetzungen",id:"voraussetzungen",level:2},{value:"I. Casdoor konfigurieren",id:"i-casdoor-konfigurieren",level:2},{value:"II. Oauth2-Proxy konfigurieren",id:"ii-oauth2-proxy-konfigurieren",level:2},{value:"III. Nginx konfigurieren",id:"iii-nginx-konfigurieren",level:2},{value:"Testen",id:"testen",level:2},{value:"Fehlerbehebung",id:"fehlerbehebung",level:2}],d={toc:l};function h(e){let{components:n,...a}=e;return(0,r.kt)("wrapper",(0,i.Z)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"voraussetzungen"},"Voraussetzungen"),(0,r.kt)("p",null,"Dieser Leitfaden setzt voraus, dass Sie die folgenden Bedingungen haben:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Laufender Casdoor-Dienst. Wenn Sie den Casdoor-Dienst noch nicht installiert haben, beziehen Sie sich bitte auf ",(0,r.kt)("a",{parentName:"li",href:"https://casdoor.org/docs/basic/server-installation"},"Server Installation")," oder ",(0,r.kt)("a",{parentName:"li",href:"https://casdoor.org/docs/basic/try-with-docker"},"Versuchen Sie es mit Docker"),"."),(0,r.kt)("li",{parentName:"ul"},"Nginx Open-Source-Edition mit aktiviertem ",(0,r.kt)("inlineCode",{parentName:"li"},"ngx_http_auth_request_module")," Modul zur Kompilierungszeit. Wenn Sie nicht wissen, wie Sie das ",(0,r.kt)("inlineCode",{parentName:"li"},"ngx_http_auth_request_module")," Modul aktivieren, beziehen Sie sich bitte auf das ",(0,r.kt)("a",{parentName:"li",href:"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html"},"Nginx Modul Dokument"),"."),(0,r.kt)("li",{parentName:"ul"},"Die Website, auf der Sie die Authentifizierung aktivieren m\xf6chten, ist erfolgreich auf Nginx bereitgestellt, mit einem ",(0,r.kt)("strong",{parentName:"li"},"konfigurierten Domainnamen")," (anstatt einer IP-Adresse) und kann normal aufgerufen werden."),(0,r.kt)("li",{parentName:"ul"},"OAuth2-Proxy-Tool (derzeit sind die folgenden zwei beliebten Projekte mit vielen Sternen auf GitHub verf\xfcgbar, und Sie m\xfcssen eines davon ausw\xe4hlen):")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"oauth2-proxy/oauth2-proxy (in diesem Artikel verwendet) ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub")," ODER ",(0,r.kt)("a",{parentName:"li",href:"https://oauth2-proxy.github.io/oauth2-proxy"},"Offizielle-Webseite")),(0,r.kt)("li",{parentName:"ol"},"vouch/vouch-proxy ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/vouch/vouch-proxy"},"GitHub"))),(0,r.kt)("h2",{id:"i-casdoor-konfigurieren"},"I. Casdoor konfigurieren"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hinweis"),": Die Operationen in diesem Artikel basieren auf der Casdoor GUI zum Zeitpunkt der Ver\xf6ffentlichung, aber die Casdoor GUI kann sich je nach Version \xe4ndern. Bitte folgen Sie den in diesem Artikel bereitgestellten Referenzen, um Ihre bereitgestellte Casdoor-Version zu konfigurieren."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hinweis"),": Die Schl\xfcssel, Passw\xf6rter, Benutzernamen und andere vertrauliche Informationen, die in diesem Artikel erw\xe4hnt werden, sind alle Beispiele. Aus Sicherheitsgr\xfcnden m\xfcssen Sie sie durch Ihre eigenen relevanten Inhalte ersetzen, wenn Sie sie bereitstellen."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Melden Sie sich bei Ihrem Casdoor-Admin-Konto an.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'In der oberen Leiste w\xe4hlen Sie "Identit\xe4tsauthentifizierung" > "Anwendungen" und klicken Sie dann auf "Hinzuf\xfcgen" auf der Seite "Anwendungen".'),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"addApp",src:t(17381).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'Vervollst\xe4ndigen Sie die Anwendungskonfiguration basierend auf Ihren Projektinformationen. In diesem Artikel verwenden wir "Nginx-Community" als Beispielanwendungsnamen.'),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"ConfigureApp",src:t(42002).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'Beachten Sie die Werte der Felder "Client ID" und "Client Secret". Sie werden sp\xe4ter bei der Konfiguration von OAuth2-Proxy verwendet. Dann konfigurieren Sie die "Redirect URL" als ',(0,r.kt)("inlineCode",{parentName:"p"},"https://project.yourdomain.com/oauth2/callback/"),"."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"RecordInfo",src:t(378).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'In der oberen Leiste w\xe4hlen Sie "Casbin-Berechtigungsmanagement" > "Rollen" und klicken Sie dann auf "Hinzuf\xfcgen" auf der Seite "Rollen".'),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"AddRole",src:t(77228).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'Vervollst\xe4ndigen Sie die Rollenkonfiguration basierend auf Ihren Projektinformationen. In diesem Artikel verwenden wir "nginx_role" als Beispielrollennamen.'),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"ConfigureRole",src:t(76532).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'(Optional) In der oberen Leiste w\xe4hlen Sie "Benutzerverwaltung" > "Benutzer" und f\xfcgen dann neue Benutzer basierend auf Ihren Bed\xfcrfnissen hinzu. Wenn die Benutzer, die Sie ben\xf6tigen, bereits existieren, k\xf6nnen Sie diesen Schritt \xfcberspringen. In diesem Artikel erstellen wir einen Beispielbenutzer namens "user".')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'Gehen Sie zur\xfcck zur Seite "Rollen", die in Schritt 5 erw\xe4hnt wurde, bearbeiten Sie die Rolle ',(0,r.kt)("inlineCode",{parentName:"p"},"nginx_role"),' und f\xfcgen Sie die ben\xf6tigten Benutzer zur Option "Eingeschlossene Benutzer" hinzu. In diesem Artikel f\xfcgen wir hier den zuvor erstellten ',(0,r.kt)("inlineCode",{parentName:"p"},"builtin/user")," hinzu."))),(0,r.kt)("h2",{id:"ii-oauth2-proxy-konfigurieren"},"II. Oauth2-Proxy konfigurieren"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hinweis"),": Dieser Artikel verwendet das Oauth2-Proxy-Projekt als Beispiel. Wenn Sie Vouch anstelle von Oauth2-Proxy verwenden m\xf6chten, beziehen Sie sich bitte auf deren offizielle Dokumentation auf ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vouch/vouch-proxy"},"GitHub"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hinweis"),": Dieser Artikel setzt voraus, dass Ihre Website mit einem vertrauensw\xfcrdigen SSL-Zertifikat konfiguriert ist und nur HTTPS-Zugriff erlaubt oder dass Sie eine automatische Weiterleitung von HTTP-Besuchern zu HTTPS eingerichtet haben. Dies hilft, den Schutz von Cookies zu maximieren und verhindert das b\xf6swillige Auslesen von Anmeldetokens. Wenn Ihre Website \xfcber das unsichere HTTP-Protokoll aufgerufen werden muss, \xe4ndern Sie bitte die entsprechenden Befehle. Weitere Hilfe zur Bereitstellung \xfcber HTTP finden Sie in der offiziellen Dokumentation von Oauth2-Proxy auf ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Tipps"),": ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"OAuth2-Proxy"),' bietet verschiedene Bereitstellungsmethoden (wie Quellcodekompilierung, Docker-Installation usw.). Zur Vereinfachung der Erkl\xe4rung verwendet dieser Artikel das "vorgefertigte Bin\xe4r" f\xfcr die Bereitstellung.'),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Gehen Sie zur ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy/releases"},"GitHub Releases")," Seite und laden Sie das Bin\xe4rpaket herunter, das Ihrem Betriebssystem und Ihrer CPU-Architektur entspricht.\nStand 1. Januar 2024 ist die neueste Release-Version von OAuth-Proxy ",(0,r.kt)("inlineCode",{parentName:"p"},"V7.5.1"),". Wenn Sie das Bin\xe4rpaket f\xfcr diese Version herunterladen m\xf6chten, k\xf6nnen Sie den folgenden Befehl f\xfcr Linux mit AMD64 ausf\xfchren:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"wget -O oauth2-proxy-linux.tar.gz https://github.com/oauth2-proxy/oauth2-proxy/releases/download/v7.5.1/oauth2-proxy-v7.5.1.linux-amd64.tar.gz\n")),(0,r.kt)("p",{parentName:"li"},"Es wird dringend empfohlen, dass Sie den von der offiziellen Website auf der ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy/releases"},"GitHub Releases")," Seite bereitgestellten ",(0,r.kt)("inlineCode",{parentName:"p"},"SHA256SUM")," Wert nach dem Herunterladen des komprimierten Pakets \xfcberpr\xfcfen und ihn Zeichen f\xfcr Zeichen mit dem ",(0,r.kt)("inlineCode",{parentName:"p"},"SHA256SUM")," Wert des von Ihnen heruntergeladenen Pakets vergleichen.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Extrahieren Sie das heruntergeladene Paket:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"tar -zxvf oauth2-proxy-*.tar.gz\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Betreten Sie das extrahierte Verzeichnis:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd oauth2-proxy-v7.5.1.linux-amd64\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verschieben Sie die erhaltene Bin\xe4rdatei nach ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/local/bin")," und konfigurieren Sie sie mit ausf\xfchrbaren Berechtigungen. M\xf6glicherweise m\xfcssen Sie Berechtigungen mit ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," erh\xf6hen, je nach Ihrer Situation."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cp ./oauth2-proxy /usr/local/bin\ncd /usr/local/bin\nchmod +x ./oauth2-proxy\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Testen Sie die Bin\xe4rinstallation. Wenn die Installation erfolgreich ist, sollten Sie nach Ausf\xfchrung des folgenden Befehls eine Ausgabe \xe4hnlich ",(0,r.kt)("inlineCode",{parentName:"p"},"oauth2-proxy v7.5.1 (gebaut mit go1.21.1)")," sehen."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\noauth2-proxy --version\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"F\xfchren Sie oauth2-proxy mit Befehlszeilenparametern aus. Parameter, die mit ","[erforderlich]"," gekennzeichnet sind, m\xfcssen gem\xe4\xdf Ihrer spezifischen Situation konfiguriert werden, w\xe4hrend Parameter, die mit ","[optional]"," gekennzeichnet sind, die Leistung optimieren k\xf6nnen, aber auch weggelassen werden k\xf6nnen. Um sicherzustellen, dass oauth2-proxy im Hintergrund laufen kann, k\xf6nnen Sie Prozess\xfcberwachungstools wie ",(0,r.kt)("inlineCode",{parentName:"p"},"Screen")," oder ",(0,r.kt)("inlineCode",{parentName:"p"},"Supervisor")," oder Terminaltools verwenden."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"oauth2-proxy \\ \n--provider=oidc \\ #[required] Do not change\n--client-id=abc123456def \\ #[required] \"Client ID\" obtained in step I.4 above\n--client-secret=abc123456def \\ #[required] \"Client Secret\" obtained in step I.4 above\n--oidc-issuer-url=https://auth.yourdomain.com \\ #[required] Your Casdoor URL (domain name or public IP)\n--redirect-url=https://project.yourdomain.com/oauth2/callback \\ #[required] https://domain-of-the-project-to-protect/oauth2/callback \n--scope=email+profile+groups+openid \\ #[required] Obtained from Casdoor: user email, user profile, groups, and login authentication\n--cookie-domain=project.yourdomain.com \\ #[required] Domain name of the project you want to protect\n--whitelist-domain=project.yourdomain.com \\ #[required] Domain name of the project you want to protect\n--cookie-secret=abc123456def \\ #[required] Please generate a random string of numbers and letters and fill it in here\n--email-domain=* \\ #[required] List of acceptable user email domains (* means accept all domains). If the user's email suffix is not in this list, a 403 error will be returned even if the login is successful.\n--insecure-oidc-allow-unverified-email=true \\ #[required] Whether to accept users with unverified email addresses\n--http-address=http://127.0.0.1:65534 \\ #[required] Address that oauth2-proxy listens on. The port number here can be set arbitrarily. Please record the value you set, as it will be needed for configuring Nginx later.\n--cookie-expire=24h0m0s \\ #[optional] Cookie expiration time. After this period, users will need to log in again.\n--custom-sign-in-logo=https://cdn.yourdomain.com/pic/proj.png \\ #[optional] Icon displayed on the login page. It is recommended to use a rectangular image rather than a square one.\n--session-store-type=redis \\ #[optional] Use Redis cache. If you don't need Redis, you can delete this item.\n--redis-connection-url=redis://127.0.0.1:6379/0 \\ #[optional] Redis URL. If you don't need Redis, you can delete this item.\n--redis-password=123456 #[optional] Redis connection password. If you don't need Redis or Redis has no password, you can delete this item.\n")))),(0,r.kt)("h2",{id:"iii-nginx-konfigurieren"},"III. Nginx konfigurieren"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hinweis"),": Bitte best\xe4tigen Sie erneut, dass Ihr Nginx das ",(0,r.kt)("inlineCode",{parentName:"p"},"ngx_http_auth_request_module")," Modul beim Kompilieren und Installieren aus dem Quellcode aktiviert hat (der Kompilierungsbefehl enth\xe4lt ",(0,r.kt)("inlineCode",{parentName:"p"},"--with_http_auth_request_module"),"). Wenn Sie nicht wissen, wie Sie das ",(0,r.kt)("inlineCode",{parentName:"p"},"ngx_http_auth_request_module")," Modul aktivieren, beziehen Sie sich bitte auf das ",(0,r.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html"},"Nginx Modul Dokument"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Tipps"),": Nginx, das mit dem Baota-Panel-Tool installiert wurde, aktiviert dieses Modul standardm\xe4\xdfig nicht."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\xd6ffnen Sie die Konfigurationsdatei der bereits bereitgestellten und zu sch\xfctzenden Website und nehmen Sie die folgenden \xc4nderungen vor:"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Hinweis"),": Sie m\xfcssen diese Konfigurationsdatei gem\xe4\xdf Ihrer spezifischen Situation anpassen. Aufgrund von Nginx-Versionen und anderen Faktoren funktioniert diese Konfigurationsdatei m\xf6glicherweise nicht reibungslos auf allen Nginx-Instanzen. Bitte passen Sie den relevanten Inhalt basierend auf Ihren eigenen Nginx-Informationen an."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-nginx"},'server {\n    listen 443 ssl http2;\n\n    include /path/to/ssl.conf;\n\n    # Add the following content\n    location ^~ /oauth2/ {\n        proxy_pass       http://127.0.0.1:65534; # Change this to the "--http-address" configured in step II.6\n\n        proxy_set_header Host                    $host;\n        proxy_set_header X-Real-IP               $remote_addr;\n        proxy_set_header X-Scheme                $scheme;\n\n        proxy_set_header X-Auth-Request-Redirect $request_uri;\n        # or, if you are handling multiple domains:\n        # proxy_set_header X-Auth-Request-Redirect $scheme://$host$request_uri;\n    }\n    location = /oauth2/auth {\n        proxy_pass       http://127.0.0.1:65534; # Change this to the "--http-address" configured in step II.6\n\n        proxy_set_header Host             $host;\n        proxy_set_header X-Real-IP        $remote_addr;\n        proxy_set_header X-Scheme         $scheme;\n        proxy_set_header Content-Length   "";\n        proxy_pass_request_body           off;\n    }\n    location ^~ / {\n        auth_request /oauth2/auth;\n        error_page 401 = /oauth2/sign_in;\n\n        auth_request_set $user   $upstream_http_x_auth_request_user; \n        auth_request_set $email  $upstream_http_x_auth_request_email; \n        proxy_set_header X-User  $user; # Pass the username of the user logged in to your backend service\n        proxy_set_header X-Email $email; # Pass the email of the user logged in to your backend service\n\n        auth_request_set $token  $upstream_http_x_auth_request_access_token;\n        proxy_set_header X-Access-Token $token; # Pass the user\'s login token to your backend service\n\n        # The following configurations are related to cookie validation for user login\n        auth_request_set $auth_cookie $upstream_http_set_cookie;\n        add_header Set-Cookie $auth_cookie;\n\n        auth_request_set $auth_cookie_name_upstream_1 $upstream_cookie_auth_cookie_name_1;\n\n        if ($auth_cookie ~* "(; .*)") {\n            set $auth_cookie_name_0 $auth_cookie;\n            set $auth_cookie_name_1 "auth_cookie_name_1=$auth_cookie_name_upstream_1$1";\n        }   \n\n        if ($auth_cookie_name_upstream_1) {\n            add_header Set-Cookie $auth_cookie_name_0;\n            add_header Set-Cookie $auth_cookie_name_1;\n        }\n        proxy_no_cache $cookie_session;\n\n        # Provide the web page to the user after successful validation\n\n        proxy_pass http://127.0.0.1:8080; # The address where your backend service runs\n        # Note: This is not the Casdoor deployment address or the Oauth2-Proxy running address, but the address where your backend service that needs login protection runs.\n\n        # Then add configurations to pass user IP, Connection request headers, etc., to your backend service, for example:\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection upgrade;\n        proxy_set_header Accept-Encoding gzip;\n    }\n    access_log /path/to/access_log.log;\n    error_log /path/to/error_log.log;\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Speichern Sie die Datei und laden Sie Ihr Nginx neu."))),(0,r.kt)("h2",{id:"testen"},"Testen"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Als N\xe4chstes k\xf6nnen Sie Ihre Implementierung testen."),(0,r.kt)("li",{parentName:"ul"},"Unter normalen Umst\xe4nden durchlaufen Ihre Benutzer den folgenden Prozess, wenn sie sich bei Ihrem Dienst anmelden:"),(0,r.kt)("li",{parentName:"ul"},"\xd6ffnen Sie die URL ",(0,r.kt)("inlineCode",{parentName:"li"},"project.yourdomain.com"),' in einem Browser -> Sehen Sie nur eine Seite, die eine Anmeldung erfordert, einschlie\xdflich einer Schaltfl\xe4che mit der Aufschrift "Anmelden mit OpenID Connect" -> Klicken Sie auf die Schaltfl\xe4che und werden Sie zu Ihrer Casdoor-Adresse weitergeleitet, wo Sie aufgefordert werden, sich anzumelden -> Benutzer geben ihren Benutzernamen und ihr Passwort ein, und Casdoor \xfcberpr\xfcft ihre Anmeldeinformationen -> Automatische Weiterleitung zur\xfcck zu Ihrer URL ',(0,r.kt)("inlineCode",{parentName:"li"},"project.yourdomain.com")," -> Erfolgreicher Zugriff auf Ihren Dienst -> Benutzer werden aufgefordert, sich erneut anzumelden, wenn die von Ihnen festgelegte ",(0,r.kt)("inlineCode",{parentName:"li"},"--cookie-expire")," Zeit abl\xe4uft.")),(0,r.kt)("h2",{id:"fehlerbehebung"},"Fehlerbehebung"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Wenn Ihr Projekt nicht wie erwartet l\xe4uft, \xfcberpr\xfcfen Sie bitte Ihre Nginx-Konfiguration und Oauth2-Proxy-Konfigurationsparameter auf Richtigkeit."),(0,r.kt)("li",{parentName:"ul"},"Sie k\xf6nnen sich auch auf die offizielle Dokumentation von Oauth2-Proxy auf ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub")," beziehen."),(0,r.kt)("li",{parentName:"ul"},"Wenn Sie Fehler in diesem Dokument finden, k\xf6nnen Sie gerne Bearbeitungen auf GitHub anfordern.")))}h.isMDXComponent=!0},77228:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/AddRole-b385b307305fe11ca476ee9d0b41ab0d.png"},42002:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ConfigureApp-fc36fc06dd93b4e8ff438a160c34a255.png"},76532:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ConfigureRole-ba58c31b5d67a3929107a49083d6c505.png"},378:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/RecordInfo-f8bf04f982122eba51e222fd47375ce0.png"},17381:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/addApp-ce709a1272f7c601539f9dc5dfe90894.png"}}]);