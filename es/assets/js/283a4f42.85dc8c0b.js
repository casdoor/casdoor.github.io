"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[3613],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>m});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=n.createContext({}),s=function(e){var a=n.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},c=function(e){var a=s(e.components);return n.createElement(d.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,d=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=r,k=u["".concat(d,".").concat(m)]||u[m]||p[m]||o;return t?n.createElement(k,i(i({ref:a},c),{},{components:t})):n.createElement(k,i({ref:a},c))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var d in a)hasOwnProperty.call(a,d)&&(l[d]=a[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},47706:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=t(87462),r=(t(67294),t(3905));const o={title:"Next.js",description:"Usando Casdoor en un proyecto Next.js",keywords:["nextjs"],authors:["SamYSF"]},i=void 0,l={unversionedId:"how-to-connect/nextjs",id:"how-to-connect/nextjs",title:"Next.js",description:"Usando Casdoor en un proyecto Next.js",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/how-to-connect/nextjs.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/nextjs",permalink:"/es/docs/how-to-connect/nextjs",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/nextjs.md",tags:[],version:"current",frontMatter:{title:"Next.js",description:"Usando Casdoor en un proyecto Next.js",keywords:["nextjs"],authors:["SamYSF"]},sidebar:"tutorialSidebar",previous:{title:"Complemento Casdoor",permalink:"/es/docs/how-to-connect/plugin"},next:{title:"Nuxt",permalink:"/es/docs/how-to-connect/nuxt"}},d={},s=[{value:"Paso 1: Desplegar Casdoor",id:"paso-1-desplegar-casdoor",level:2},{value:"Paso 2: A\xf1adir Middleware",id:"paso-2-a\xf1adir-middleware",level:2},{value:"Ejemplo",id:"ejemplo",level:3},{value:"Paso 3: Usar Casdoor SDK",id:"paso-3-usar-casdoor-sdk",level:2},{value:"1.Instalar el SDK",id:"1instalar-el-sdk",level:3},{value:"2.Inicializar el SDK",id:"2inicializar-el-sdk",level:3},{value:"Ejemplo",id:"ejemplo-1",level:3},{value:"3.Redirigir a la P\xe1gina de Inicio de Sesi\xf3n",id:"3redirigir-a-la-p\xe1gina-de-inicio-de-sesi\xf3n",level:3},{value:"4.Obtener Token y Almacenamiento",id:"4obtener-token-y-almacenamiento",level:3},{value:"Paso 4: A\xf1adir Funci\xf3n de Autenticaci\xf3n de Middleware",id:"paso-4-a\xf1adir-funci\xf3n-de-autenticaci\xf3n-de-middleware",level:2},{value:"Ejemplo",id:"ejemplo-2",level:3}],c={toc:s};function p(e){let{components:a,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/casdoor/nextjs-auth"},"nextjs-auth")," es un ejemplo de c\xf3mo integrar casdoor en un proyecto next-js. Te guiaremos a trav\xe9s de los siguientes pasos."),(0,r.kt)("h2",{id:"paso-1-desplegar-casdoor"},"Paso 1: Desplegar Casdoor"),(0,r.kt)("p",null,"Primero, Casdoor debe ser desplegado."),(0,r.kt)("p",null,"Puedes consultar la documentaci\xf3n oficial de Casdoor para la ",(0,r.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Instalaci\xf3n del Servidor"),". Por favor, despliega tu instancia de Casdoor en ",(0,r.kt)("strong",{parentName:"p"},"modo producci\xf3n"),"."),(0,r.kt)("p",null,"Despu\xe9s de un despliegue exitoso, aseg\xfarate de lo siguiente:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Abre tu navegador favorito y visita ",(0,r.kt)("strong",{parentName:"li"},"http\\://localhost:8000"),". Ver\xe1s la p\xe1gina de inicio de sesi\xf3n de Casdoor."),(0,r.kt)("li",{parentName:"ul"},"Prueba la funcionalidad de inicio de sesi\xf3n ingresando ",(0,r.kt)("inlineCode",{parentName:"li"},"admin")," como nombre de usuario y ",(0,r.kt)("inlineCode",{parentName:"li"},"123")," como contrase\xf1a.")),(0,r.kt)("p",null,"Despu\xe9s de eso, puedes implementar r\xe1pidamente una p\xe1gina de inicio de sesi\xf3n basada en Casdoor en tu propia aplicaci\xf3n utilizando los siguientes pasos."),(0,r.kt)("h2",{id:"paso-2-a\xf1adir-middleware"},"Paso 2: A\xf1adir Middleware"),(0,r.kt)("p",null,"El Middleware te permite ejecutar c\xf3digo antes de que se complete una solicitud. Luego, bas\xe1ndote en la solicitud entrante, puedes modificar la respuesta reescribiendo, redirigiendo, modificando las cabeceras de la solicitud o respuesta, o respondiendo directamente."),(0,r.kt)("p",null,"Usa el archivo ",(0,r.kt)("inlineCode",{parentName:"p"},"middleware.ts")," (o ",(0,r.kt)("inlineCode",{parentName:"p"},".js"),") en la ra\xedz de tu proyecto para definir Middleware. Por ejemplo, al mismo nivel que ",(0,r.kt)("inlineCode",{parentName:"p"},"pages")," o ",(0,r.kt)("inlineCode",{parentName:"p"},"app"),", o dentro de ",(0,r.kt)("inlineCode",{parentName:"p"},"src")," si es aplicable."),(0,r.kt)("h3",{id:"ejemplo"},"Ejemplo"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'//define which paths Middleware will run on\nconst protectedRoutes = ["/profile"];\n\nexport default function middleware(req) {\n  if (protectedRoutes.includes(req.nextUrl.pathname)) {\n    //redirect the incoming request to a different URL\n    return NextResponse.redirect(new URL("/login", req.url));\n  }\n}\n')),(0,r.kt)("p",null,"Consulta la documentaci\xf3n oficial de next.js ",(0,r.kt)("a",{parentName:"p",href:"https://nextjs.org/docs/app/building-your-application/routing/middleware"},"middleware")," para m\xe1s detalles."),(0,r.kt)("h2",{id:"paso-3-usar-casdoor-sdk"},"Paso 3: Usar Casdoor SDK"),(0,r.kt)("h3",{id:"1instalar-el-sdk"},"1.Instalar el SDK"),(0,r.kt)("p",null,"Primero, instala ",(0,r.kt)("inlineCode",{parentName:"p"},"casdoor-js-sdk")," v\xeda NPM o Yarn:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npm install casdoor-js-sdk\n")),(0,r.kt)("p",null,"O:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add casdoor-js-sdk\n")),(0,r.kt)("h3",{id:"2inicializar-el-sdk"},"2.Inicializar el SDK"),(0,r.kt)("p",null,"Luego inicializa 6 par\xe1metros de tipo cadena en el siguiente orden:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nombre"),(0,r.kt)("th",{parentName:"tr",align:null},"Requerido"),(0,r.kt)("th",{parentName:"tr",align:null},"Descripci\xf3n"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"serverUrl"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xed"),(0,r.kt)("td",{parentName:"tr",align:null},"URL del servidor de Casdoor, como ",(0,r.kt)("inlineCode",{parentName:"td"},"http://localhost:8000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"clientId"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xed"),(0,r.kt)("td",{parentName:"tr",align:null},"ID del cliente de la aplicaci\xf3n")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"clientSecret"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xed"),(0,r.kt)("td",{parentName:"tr",align:null},"Secreto del cliente de la aplicaci\xf3n")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"organizationName"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xed"),(0,r.kt)("td",{parentName:"tr",align:null},"Organizaci\xf3n de la aplicaci\xf3n")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"appName"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xed"),(0,r.kt)("td",{parentName:"tr",align:null},"Nombre de la aplicaci\xf3n")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"redirectPath"),(0,r.kt)("td",{parentName:"tr",align:null},"S\xed"),(0,r.kt)("td",{parentName:"tr",align:null},"URL redirigida")))),(0,r.kt)("h3",{id:"ejemplo-1"},"Ejemplo"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const sdkConfig = {\n  serverUrl: "https://door.casdoor.com",\n  clientId: "294b09fbc17f95daf2fe",\n  clientSecret: "dd8982f7046ccba1bbd7851d5c1ece4e52bf039d",\n  organizationName: "casbin",\n  appName: "app-vue-python-example",\n  redirectPath: "/callback",\n};\n')),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Reemplaza los valores de configuraci\xf3n con los de tu propia instancia de Casdoor, especialmente el ",(0,r.kt)("inlineCode",{parentName:"p"},"clientId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"clientSecret")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"serverUrl"),".")),(0,r.kt)("h3",{id:"3redirigir-a-la-p\xe1gina-de-inicio-de-sesi\xf3n"},"3.Redirigir a la P\xe1gina de Inicio de Sesi\xf3n"),(0,r.kt)("p",null,"Cuando necesites autenticar usuarios que acceden a tu aplicaci\xf3n, puedes enviar la URL objetivo y redirigir a la p\xe1gina de inicio de sesi\xf3n proporcionada por Casdoor."),(0,r.kt)("p",null,"Aseg\xfarate de haber a\xf1adido la URL de callback (por ejemplo, ",(0,r.kt)("strong",{parentName:"p"},"http\\://localhost:8080/callback"),") en la configuraci\xf3n de la aplicaci\xf3n de antemano."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const CasdoorSDK = new Sdk(sdkConfig);\nCasdoorSDK.signin_redirect();\n")),(0,r.kt)("h3",{id:"4obtener-token-y-almacenamiento"},"4.Obtener Token y Almacenamiento"),(0,r.kt)("p",null,"Despu\xe9s de que la verificaci\xf3n de Casdoor sea aprobada, redirigir\xe1 de vuelta a tu aplicaci\xf3n con token."),(0,r.kt)("p",null,"Puedes optar por usar cookie para almacenar el token."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'CasdoorSDK.exchangeForAccessToken()\n  .then((res) => {\n    if (res && res.access_token) {\n      //Get Token\n      return CasdoorSDK.getUserInfo(res.access_token);\n    }\n  })\n  .then((res) => {\n    // Storage Token\n    Cookies.set("casdoorUser", JSON.stringify(res));\n  });\n')),(0,r.kt)("p",null,"Puedes consultar la documentaci\xf3n oficial de Casdoor para el ",(0,r.kt)("a",{parentName:"p",href:"https://casdoor.org/docs/how-to-connect/sdk/#how-to-use-casdoor-sdk"},"C\xf3mo usar Casdoor SDK"),"."),(0,r.kt)("h2",{id:"paso-4-a\xf1adir-funci\xf3n-de-autenticaci\xf3n-de-middleware"},"Paso 4: A\xf1adir Funci\xf3n de Autenticaci\xf3n de Middleware"),(0,r.kt)("p",null,"cuando los usuarios intentan acceder a una ruta protegida, la funci\xf3n de Autenticaci\xf3n de Middleware verifica su identidad. Si el usuario no est\xe1 autenticado, se le redirige a una p\xe1gina de inicio de sesi\xf3n o se le niega el acceso."),(0,r.kt)("h3",{id:"ejemplo-2"},"Ejemplo"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'//protected route\nconst protectedRoutes = ["/profile"];\nconst casdoorUserCookie = req.cookies.get("casdoorUser");\nconst isAuthenticated = casdoorUserCookie ? true : false;\n\n//Authentication Function\nif (!isAuthenticated && protectedRoutes.includes(req.nextUrl.pathname)) {\n  return NextResponse.redirect(new URL("/login", req.url));\n}\n')))}p.isMDXComponent=!0}}]);