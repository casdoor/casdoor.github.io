(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4986],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,f=d["".concat(l,".").concat(m)]||d[m]||c[m]||i;return n?r.createElement(f,a(a({ref:t},u),{},{components:n})):r.createElement(f,a({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2634:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var r=n(4034),o=n(9973),i=(n(7294),n(3905)),a=["components"],s={sidebar_position:1,title:"APISIX"},l=void 0,p={unversionedId:"integration/apisix",id:"integration/apisix",isDocsHomePage:!1,title:"APISIX",description:"Casdoor peut utiliser le protocole OIDC pour \xe9tablir un lien vers APISIX, et ce document vous montrera comment le faire.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/integration/apisix.md",sourceDirName:"integration",slug:"/integration/apisix",permalink:"/fr/docs/integration/apisix",editUrl:"https://github.com/casdoor/casdoor-website/tree/master/docs/integration/apisix.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"APISIX"},sidebar:"tutorialSidebar",previous:{title:"Jenkins (OIDC)",permalink:"/fr/docs/integration/jenkins"},next:{title:"S\xe9curit\xe9 du printemps",permalink:"/fr/docs/integration/spring-security"}},u=[{value:"\xc9tape 1. D\xe9ployer Casdoor et APISIX",id:"\xe9tape-1-d\xe9ployer-casdoor-et-apisix",children:[],level:2},{value:"\xc9tape 2. Configurer l&#39;application Casdoor",id:"\xe9tape-2-configurer-lapplication-casdoor",children:[],level:2},{value:"\xc9tape 3. Configure APISIX",id:"\xe9tape-3-configure-apisix",children:[],level:2}],c={toc:u};function d(e){var t=e.components,s=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Casdoor peut utiliser le protocole OIDC pour \xe9tablir un lien vers APISIX, et ce document vous montrera comment le faire."),(0,i.kt)("p",null,"Voici quelques noms dans la configuration :"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": Nom de domaine ou IP o\xf9 le serveur Casdoor est d\xe9ploy\xe9."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"APISIX_HOSTNAME"),": Nom de domaine ou IP o\xf9 APISIX est d\xe9ploy\xe9."),(0,i.kt)("h2",{id:"\xe9tape-1-d\xe9ployer-casdoor-et-apisix"},"\xc9tape 1. D\xe9ployer Casdoor et APISIX"),(0,i.kt)("p",null,"Premi\xe8rement, la ",(0,i.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Casdoor")," et ",(0,i.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/how-to-build/"},"APISIX")," doivent \xeatre d\xe9ploy\xe9es."),(0,i.kt)("p",null,"Apr\xe8s un d\xe9ploiement r\xe9ussi, vous devez vous assurer :"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Casdoor peut \xeatre connect\xe9 et utilis\xe9 normalement."),(0,i.kt)("li",{parentName:"ol"},"D\xe9finissez la valeur ",(0,i.kt)("inlineCode",{parentName:"li"},"origine")," de Casdoor (conf/app.conf) \xe0 ",(0,i.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,i.kt)("img",{alt:"Conf Casdoor",src:n(9541).Z}))),(0,i.kt)("h2",{id:"\xe9tape-2-configurer-lapplication-casdoor"},"\xc9tape 2. Configurer l'application Casdoor"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Cr\xe9er ou utiliser une application Casdoor existante."),(0,i.kt)("li",{parentName:"ol"},"Ajouter une URL de redirection : ",(0,i.kt)("inlineCode",{parentName:"li"},"http://APISIX_HOSTNAME/REDIRECTWHATYOUWANT"),",et changer ",(0,i.kt)("inlineCode",{parentName:"li"},"REDIRECTWHATYOUWANT")," \xe0 l'URL de redirection dont vous avez besoin."),(0,i.kt)("li",{parentName:"ol"},'S\xe9lectionnez "JWT-Empty" pour l\'option de format de jeton'),(0,i.kt)("li",{parentName:"ol"},"Ajoutez le fournisseur que vous voulez et compl\xe9tez d'autres param\xe8tres.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Param\xe8tres de l&#39;application",src:n(6813).Z})," Sans surprise, vous pouvez obtenir deux valeurs sur la page des param\xe8tres de l'application : ",(0,i.kt)("inlineCode",{parentName:"p"},"ID client")," et ",(0,i.kt)("inlineCode",{parentName:"p"},"secret client")," comme l'image ci-dessus, nous les utiliserons \xe0 l'\xe9tape suivante."),(0,i.kt)("p",null,"Ouvrez votre navigateur favori et visite: ",(0,i.kt)("strong",{parentName:"p"},"http://",(0,i.kt)("inlineCode",{parentName:"strong"},"CASDOOR_HOSTNAME"),"/.well-known/openid-configuration"),", vous verrez la configuration OIDC de Casdoor."),(0,i.kt)("h2",{id:"\xe9tape-3-configure-apisix"},"\xc9tape 3. Configure APISIX"),(0,i.kt)("p",null,"APISIX a le support officiel ",(0,i.kt)("a",{parentName:"p",href:"https://apisix.apache.org/docs/apisix/plugins/openid-connect/"},"OIDC")," , qui est impl\xe9ment\xe9 en utilisant ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/zmartzone/lua-resty-openidc"},"lua-resty-openidc"),"."),(0,i.kt)("p",null,"Vous pouvez personnaliser les param\xe8tres selon la documentation APISIX OIDC dans laquelle les param\xe8tres de routage suivants seront utilis\xe9s :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'#Utilisez votre propre X-Api-Key\n$ curl -XPOST APISIX_HOSTNAME/apisix/admin/routes -H "X-Api-Key: edd1c9f034335f136f87ad84b625c8f1" -d \'{\n  "uri": "/get",\n  "name": "apisix_casdoor_test",\n  "plugins": {\n    "openid-connect": {\n      "client_id": "ID client",\n      "client_secret": "Client secret",\n      "discovery": "http://CASDOOR_HOSTNAME/. ell-known/openid-configuration",\n      "introspection_endpoint_auth_method": "client_secret_basic",\n      "logout_path": "/logout",\n      "realm": "master",\n      "redirect_uri": "http://APISIX_HOSTNAME/REDIRECTWHATYOUWANT",\n      "porteur_seulement": false,\n      "set_id_token_header": false,\n      "access_token_in_authorization_header": vrai,\n      "set_access_token_header": true,\n      "set_userinfo_header": false,\n      "royaume": "master"\n    }\n  },\n  "amon": {\n    "type": "roundrobin",\n    "nodes": {\n      "httpbin. rg:80": 1\n    }\n\n}\'\n')),(0,i.kt)("p",null,"Maintenant, visitez ",(0,i.kt)("inlineCode",{parentName:"p"},"http://APISIX_HOSTNAME/get"),", le navigateur vous redirigera vers la page de connexion de casdoor et apr\xe8s avoir r\xe9ussi \xe0 se connecter, vous ne serez pas surpris de voir que nous avons envoy\xe9 une requ\xeate \xe0 httpbin. rg. ",(0,i.kt)("img",{alt:"APISIX_Result",src:n(5637).Z})))}d.isMDXComponent=!0},5637:function(e,t,n){"use strict";t.Z=n.p+"assets/images/apisix_result-3475043d31a06fd90894e80e8b4ca9f3.png"},6813:function(e,t,n){"use strict";t.Z=n.p+"assets/images/casdoor_jwtempty-68f57615f6dc135f498b45e6b2d7bf57.png"},9541:function(e,t,n){"use strict";t.Z=n.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"}}]);