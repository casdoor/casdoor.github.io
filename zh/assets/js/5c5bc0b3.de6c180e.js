"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4362],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(t),m=o,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||r;return t?a.createElement(h,i(i({ref:n},c),{},{components:t})):a.createElement(h,i({ref:n},c))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},39055:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=t(87462),o=(t(67294),t(3905));const r={title:"MCP Server",description:"Using Casdoor's Model Context Protocol (MCP) server for application management",keywords:["MCP","Model Context Protocol","API","automation","JSON-RPC"],authors:["hsluoyz"]},i=void 0,s={unversionedId:"basic/mcp",id:"basic/mcp",title:"MCP Server",description:"Using Casdoor's Model Context Protocol (MCP) server for application management",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/basic/mcp.md",sourceDirName:"basic",slug:"/basic/mcp",permalink:"/zh/docs/basic/mcp",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/basic/mcp.md",tags:[],version:"current",frontMatter:{title:"MCP Server",description:"Using Casdoor's Model Context Protocol (MCP) server for application management",keywords:["MCP","Model Context Protocol","API","automation","JSON-RPC"],authors:["hsluoyz"]},sidebar:"tutorialSidebar",previous:{title:"Casdoor \u516c\u5171 API",permalink:"/zh/docs/basic/public-api"},next:{title:"\u6559\u7a0b",permalink:"/zh/docs/basic/tutorials"}},l={},p=[{value:"What is MCP?",id:"what-is-mcp",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Available Tools",id:"available-tools",level:2},{value:"Application Management Tools",id:"application-management-tools",level:3},{value:"Response Format",id:"response-format",level:2},{value:"Permission Model",id:"permission-model",level:2},{value:"Integration Example",id:"integration-example",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Additional Features",id:"additional-features",level:2}],c={toc:p};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Casdoor provides a Model Context Protocol (MCP) server at ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/mcp")," that enables programmatic management of applications and other resources through a standardized JSON-RPC 2.0 interface. MCP servers expose tools that AI assistants and other clients can use to interact with your Casdoor instance."),(0,o.kt)("h2",{id:"what-is-mcp"},"What is MCP?"),(0,o.kt)("p",null,"The Model Context Protocol is a JSON-RPC 2.0 protocol that defines a standard way for clients (like AI assistants or automation tools) to discover and invoke tools provided by servers. Casdoor's MCP implementation allows clients to manage applications, users, and other resources without needing to understand Casdoor's specific REST API structure."),(0,o.kt)("h2",{id:"getting-started"},"Getting Started"),(0,o.kt)("p",null,"The MCP endpoint is available at ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/mcp")," and accepts POST requests with JSON-RPC 2.0 payloads. Before making tool calls, clients must complete the initialization handshake:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'POST /api/mcp\n{\n  "jsonrpc": "2.0",\n  "id": 1,\n  "method": "initialize",\n  "params": {\n    "protocolVersion": "2024-11-05",\n    "capabilities": {},\n    "clientInfo": {\n      "name": "my-client",\n      "version": "1.0.0"\n    }\n  }\n}\n')),(0,o.kt)("p",null,"The server responds with its capabilities:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 1,\n  "result": {\n    "protocolVersion": "2024-11-05",\n    "capabilities": {\n      "tools": {\n        "listChanged": true\n      }\n    },\n    "serverInfo": {\n      "name": "Casdoor MCP Server",\n      "version": "1.0.0"\n    }\n  }\n}\n')),(0,o.kt)("p",null,"After initialization, send a notification to indicate the client is ready:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'POST /api/mcp\n{\n  "jsonrpc": "2.0",\n  "method": "notifications/initialized"\n}\n')),(0,o.kt)("h2",{id:"authentication"},"Authentication"),(0,o.kt)("p",null,"MCP requests require authentication using any of the methods described in the ",(0,o.kt)("a",{parentName:"p",href:"/docs/basic/public-api"},"Public API authentication")," documentation. The most common approaches are:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Using an access token")," (for user-scoped operations):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST https://your-casdoor.com/api/mcp \\\n  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"jsonrpc":"2.0","id":1,"method":"tools/list"}\'\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Using client credentials")," (for service accounts):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST https://your-casdoor.com/api/mcp \\\n  -u "CLIENT_ID:CLIENT_SECRET" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"jsonrpc":"2.0","id":1,"method":"tools/list"}\'\n')),(0,o.kt)("p",null,"Unauthenticated requests receive a JSON-RPC error response:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 1,\n  "error": {\n    "code": -32001,\n    "message": "Unauthorized",\n    "data": "Unauthorized operation"\n  }\n}\n')),(0,o.kt)("h2",{id:"available-tools"},"Available Tools"),(0,o.kt)("p",null,"To discover available tools, call the ",(0,o.kt)("inlineCode",{parentName:"p"},"tools/list")," method:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'POST /api/mcp\n{\n  "jsonrpc": "2.0",\n  "id": 2,\n  "method": "tools/list"\n}\n')),(0,o.kt)("p",null,"The server returns tool definitions with input schemas:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 2,\n  "result": {\n    "tools": [\n      {\n        "name": "get_applications",\n        "description": "Get all applications for a specific owner",\n        "inputSchema": {\n          "type": "object",\n          "properties": {\n            "owner": {\n              "type": "string",\n              "description": "The owner of applications"\n            }\n          },\n          "required": ["owner"]\n        }\n      }\n    ]\n  }\n}\n')),(0,o.kt)("h3",{id:"application-management-tools"},"Application Management Tools"),(0,o.kt)("p",null,"The MCP server currently provides these application management tools:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"get_applications")," - Retrieve all applications for an organization:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 3,\n  "method": "tools/call",\n  "params": {\n    "name": "get_applications",\n    "arguments": {\n      "owner": "my-org"\n    }\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"get_application")," - Get details of a specific application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 4,\n  "method": "tools/call",\n  "params": {\n    "name": "get_application",\n    "arguments": {\n      "id": "my-org/my-app"\n    }\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"add_application")," - Create a new application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 5,\n  "method": "tools/call",\n  "params": {\n    "name": "add_application",\n    "arguments": {\n      "application": {\n        "owner": "my-org",\n        "name": "new-app",\n        "displayName": "New Application",\n        "organization": "my-org"\n      }\n    }\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"update_application")," - Modify an existing application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 6,\n  "method": "tools/call",\n  "params": {\n    "name": "update_application",\n    "arguments": {\n      "id": "my-org/my-app",\n      "application": {\n        "owner": "my-org",\n        "name": "my-app",\n        "displayName": "Updated Name"\n      }\n    }\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"delete_application")," - Remove an application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 7,\n  "method": "tools/call",\n  "params": {\n    "name": "delete_application",\n    "arguments": {\n      "application": {\n        "owner": "my-org",\n        "name": "old-app"\n      }\n    }\n  }\n}\n')),(0,o.kt)("h2",{id:"response-format"},"Response Format"),(0,o.kt)("p",null,"Tool calls return results in a structured format:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 3,\n  "result": {\n    "content": [\n      {\n        "type": "text",\n        "text": "[{\\"name\\":\\"app1\\",\\"displayName\\":\\"App 1\\"}]"\n      }\n    ]\n  }\n}\n')),(0,o.kt)("p",null,"When errors occur during tool execution, the response includes an ",(0,o.kt)("inlineCode",{parentName:"p"},"isError")," flag:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 5,\n  "result": {\n    "content": [\n      {\n        "type": "text",\n        "text": "application quota is exceeded"\n      }\n    ],\n    "isError": true\n  }\n}\n')),(0,o.kt)("h2",{id:"permission-model"},"Permission Model"),(0,o.kt)("p",null,"The MCP server follows Casdoor's standard permission model. When you authenticate with client credentials, you operate with the privileges of that application's organization admin. Access tokens provide the permissions of the authenticated user."),(0,o.kt)("p",null,"Some operations have specific requirements. Creating applications checks against your organization's application quota. IP whitelist validation runs for applications with restricted access. Demo mode applies additional constraints to prevent modifications to the demonstration instance."),(0,o.kt)("h2",{id:"integration-example"},"Integration Example"),(0,o.kt)("p",null,"Here's a complete example showing how to connect to Casdoor's MCP server and create an application:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import requests\nimport json\n\n# Server configuration\nserver_url = "https://your-casdoor.com/api/mcp"\nclient_id = "your-client-id"\nclient_secret = "your-client-secret"\n\n# Create a session with authentication\nsession = requests.Session()\nsession.auth = (client_id, client_secret)\nsession.headers.update({"Content-Type": "application/json"})\n\n# Initialize the connection\ninit_request = {\n    "jsonrpc": "2.0",\n    "id": 1,\n    "method": "initialize",\n    "params": {\n        "protocolVersion": "2024-11-05",\n        "capabilities": {},\n        "clientInfo": {"name": "python-client", "version": "1.0.0"}\n    }\n}\nresponse = session.post(server_url, json=init_request)\nprint("Initialize:", response.json())\n\n# Send initialized notification\nnotify_request = {\n    "jsonrpc": "2.0",\n    "method": "notifications/initialized"\n}\nsession.post(server_url, json=notify_request)\n\n# List available tools\nlist_tools_request = {\n    "jsonrpc": "2.0",\n    "id": 2,\n    "method": "tools/list"\n}\nresponse = session.post(server_url, json=list_tools_request)\nprint("Tools:", response.json())\n\n# Create a new application\ncreate_app_request = {\n    "jsonrpc": "2.0",\n    "id": 3,\n    "method": "tools/call",\n    "params": {\n        "name": "add_application",\n        "arguments": {\n            "application": {\n                "owner": "my-org",\n                "name": "automated-app",\n                "displayName": "Automated Application",\n                "organization": "my-org"\n            }\n        }\n    }\n}\nresponse = session.post(server_url, json=create_app_request)\nprint("Create application:", response.json())\n')),(0,o.kt)("h2",{id:"error-handling"},"Error Handling"),(0,o.kt)("p",null,"The MCP server returns standard JSON-RPC 2.0 error codes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"-32700"),": Parse error - Invalid JSON"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"-32600"),": Invalid Request - Missing required fields"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"-32601"),": Method not found - Unknown method name"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"-32602"),": Invalid params - Malformed parameters"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"-32001"),": Unauthorized - Authentication failed")),(0,o.kt)("p",null,"Invalid JSON triggers a parse error:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": null,\n  "error": {\n    "code": -32700,\n    "message": "Parse error",\n    "data": "unexpected character at position 12"\n  }\n}\n')),(0,o.kt)("p",null,"Unknown methods return method not found:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 8,\n  "error": {\n    "code": -32601,\n    "message": "Method not found",\n    "data": "Method \'unknown_method\' not found"\n  }\n}\n')),(0,o.kt)("h2",{id:"additional-features"},"Additional Features"),(0,o.kt)("p",null,"The MCP server implements the full JSON-RPC 2.0 specification including notifications (requests without an ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," field) and batch requests. The ",(0,o.kt)("inlineCode",{parentName:"p"},"ping")," method provides a simple health check:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 9,\n  "method": "ping"\n}\n')),(0,o.kt)("p",null,"When running in demo mode, the server restricts write operations to protect the demonstration instance while allowing all read operations and authentication flows."))}d.isMDXComponent=!0}}]);