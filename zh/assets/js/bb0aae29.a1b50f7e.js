"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[3943],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(a),m=o,u=d["".concat(s,".").concat(m)]||d[m]||k[m]||r;return a?n.createElement(u,l(l({ref:t},c),{},{components:a})):n.createElement(u,l({ref:t},c))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,l=new Array(r);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},35347:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var n=a(87462),o=(a(67294),a(3905));const r={title:"Keycloak",description:"\u4f7f\u7528 Keycloak \u9a8c\u8bc1\u7528\u6237",keywords:["Keycloak"],authors:["seriouszyx"]},l=void 0,i={unversionedId:"provider/saml/keycloak",id:"provider/saml/keycloak",title:"Keycloak",description:"\u4f7f\u7528 Keycloak \u9a8c\u8bc1\u7528\u6237",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/provider/saml/keycloak.md",sourceDirName:"provider/saml",slug:"/provider/saml/keycloak",permalink:"/zh/docs/provider/saml/keycloak",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/provider/saml/keycloak.md",tags:[],version:"current",frontMatter:{title:"Keycloak",description:"\u4f7f\u7528 Keycloak \u9a8c\u8bc1\u7528\u6237",keywords:["Keycloak"],authors:["seriouszyx"]},sidebar:"tutorialSidebar",previous:{title:"Aliyun IDaaS",permalink:"/zh/docs/provider/saml/aliyun"},next:{title:"Payment",permalink:"/zh/docs/category/payment"}},s={},p=[{value:"Configure Keycloak",id:"configure-keycloak",level:2},{value:"\u5728 Keycloak \u4e2d\u6dfb\u52a0\u5ba2\u6237\u7aef\u6761\u76ee",id:"\u5728-keycloak-\u4e2d\u6dfb\u52a0\u5ba2\u6237\u7aef\u6761\u76ee",level:2},{value:"\u5728Casdoor\u914d\u7f6e",id:"\u5728casdoor\u914d\u7f6e",level:2},{value:"\u9a8c\u8bc1\u6548\u679c",id:"\u9a8c\u8bc1\u6548\u679c",level:2}],c={toc:p};function k(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The JBoss ",(0,o.kt)("a",{parentName:"p",href:"https://www.keycloak.org/"},"Keycloak")," system is a widely used and open-source identity management system that supports integration with applications via SAML and OpenID Connect. It can also operate as an identity broker between other providers such as LDAP or other SAML providers and applications that support SAML or OpenID Connect."),(0,o.kt)("p",null,"Here is an example of how to configure a new client entry in Keycloak and configure Casdoor to use it to allow UI login by Keycloak users who are granted access via Keycloak configuration."),(0,o.kt)("h2",{id:"configure-keycloak"},"Configure Keycloak"),(0,o.kt)("p",null,"For this example, let's make the following configuration choices and assumptions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Assume that you are running Casdoor in dev mode locally. The Casdoor UI is available at ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:7001")," and the server is available at ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000"),". Replace with the appropriate URL as needed."),(0,o.kt)("li",{parentName:"ul"},"Assume that you are running Keycloak locally. The Keycloak UI is available at ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8080/auth"),"."),(0,o.kt)("li",{parentName:"ul"},"\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u7528\u4e8e\u6b64\u90e8\u7f72\u7684SPACS URL\u5c06\u662f\uff1a ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"\u3002"),(0,o.kt)("li",{parentName:"ul"},"Our SP Entity ID will use the same URL: ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")),(0,o.kt)("p",null,"You can use the default realm or create a new realm."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Add Keycloak realm",src:a(78539).Z,width:"2560",height:"590"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Keycloak realm",src:a(95491).Z,width:"2560",height:"965"})),(0,o.kt)("h2",{id:"\u5728-keycloak-\u4e2d\u6dfb\u52a0\u5ba2\u6237\u7aef\u6761\u76ee"},"\u5728 Keycloak \u4e2d\u6dfb\u52a0\u5ba2\u6237\u7aef\u6761\u76ee"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"For more details about Keycloak Clients, refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://www.keycloak.org/docs/latest/server_admin/index.html#_client-saml-configuration"},"Keycloak documentation"),".")),(0,o.kt)("p",null,"\u5728\u83dc\u5355\u4e2d\u70b9\u51fb ",(0,o.kt)("strong",{parentName:"p"},"\u5ba2\u6237\u7aef")," \u7136\u540e\u70b9\u51fb ",(0,o.kt)("strong",{parentName:"p"},"\u521b\u5efa")," \u53bb\u5230 ",(0,o.kt)("strong",{parentName:"p"},"\u6dfb\u52a0\u5ba2\u6237\u7aef")," \u9875\u9762\u3002 Fill in the fields as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"\u5ba2\u6237\u7aef ID"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - \u8fd9\u5c06\u662f\u4ee5\u540e\u5728 Casdoor \u914d\u7f6e\u4e2d\u4f7f\u7528\u7684 SP \u5b9e\u4f53ID\u3002"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Client Protocol"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"saml"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Client SAML Endpoint"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - This URL is where you want the Keycloak server to send SAML requests and responses. Generally, applications have one URL for processing SAML requests. Multiple URLs can be set in the Settings tab of the client.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Add Keycloak client",src:a(15582).Z,width:"2560",height:"961"})),(0,o.kt)("p",null,"\u5355\u51fb ",(0,o.kt)("strong",{parentName:"p"},"Save\uff08\u4fdd\u5b58\uff09"),"\u3002 \u6b64\u52a8\u4f5c\u521b\u5efa\u5ba2\u6237\u7aef\u5e76\u5c06\u60a8\u5e26\u5230 ",(0,o.kt)("strong",{parentName:"p"},"\u8bbe\u7f6e")," \u9009\u9879\u5361\u3002"),(0,o.kt)("p",null,"The following are part of the settings:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"\u540d\u79f0")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Casdoor"),". This is only used to display a friendly name to Keycloak users in the Keycloak UI. You can use any name you prefer."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Enabled")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Include Authn Statement")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Sign Documents")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Sign Assertions")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Encrypt Assertions")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Client Signature Required")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Force Name ID Format")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Name ID Format")," - Select ",(0,o.kt)("inlineCode",{parentName:"li"},"username"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"\u6709\u6548\u91cd\u5b9a\u5411 URI")," - \u6dfb\u52a0 ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Master SAML \u5904\u7406 URL")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,o.kt)("li",{parentName:"ol"},"\u7cbe\u826f\u7684\u8c37\u7269SAML\u7aef\u70b9\u914d\u7f6e",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"\u58f0\u660e\u6d88\u8d39\u8005\u670d\u52a1\u516c\u5f00\u7ed1\u5b9aURL")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"\u3002"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"\u58f0\u660e\u6d88\u8d39\u8005\u670d\u52a1\u91cd\u5b9a\u5411\u7ed1\u5b9aURL")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"\u3002")))),(0,o.kt)("p",null,"\u4fdd\u5b58\u8be5\u914d\u7f6e\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Configure Keycloak client",src:a(82142).Z,width:"2557",height:"3014"})),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"If you want to sign the authn request, you need to enable the ",(0,o.kt)("strong",{parentName:"p"},"Client Signature Required")," option and upload the certificate generated by yourself. The private key and certificate used in Casdoor, ",(0,o.kt)("inlineCode",{parentName:"p"},"token_jwt_key.key")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"token_jwt_key.pem"),", are located in the ",(0,o.kt)("strong",{parentName:"p"},"object")," directory. In Keycloak, you need to click the ",(0,o.kt)("strong",{parentName:"p"},"Keys")," tab, click the ",(0,o.kt)("strong",{parentName:"p"},"Import")," button, select ",(0,o.kt)("strong",{parentName:"p"},"Archive Format")," as ",(0,o.kt)("strong",{parentName:"p"},"Certificate PEM"),", and upload the certificate.")),(0,o.kt)("p",null,"\u70b9\u51fb ",(0,o.kt)("strong",{parentName:"p"},"\u5b89\u88c5")," \u6807\u7b7e\u9875\u3002"),(0,o.kt)("p",null,"For Keycloak <= 5.0.0, select Format Option - ",(0,o.kt)("strong",{parentName:"p"},"SAML Metadata IDPSSODescriptor")," and copy the metadata."),(0,o.kt)("p",null,"\u5bf9\u4e8eKeycloak 6.0.0+\uff0c\u9009\u62e9\u683c\u5f0f\u9009\u9879 - ",(0,o.kt)("strong",{parentName:"p"},"Mod Mellon \u6587\u4ef6")," \u5e76\u70b9\u51fb ",(0,o.kt)("strong",{parentName:"p"},"\u4e0b\u8f7d"),"\u3002 Unzip the downloaded.zip, locate ",(0,o.kt)("inlineCode",{parentName:"p"},"idp-metadata.xml"),", and copy the metadata."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u5143\u6570\u636e\u4e0b\u8f7d",src:a(82235).Z,width:"2560",height:"596"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u590d\u5236\u5143\u6570\u636e",src:a(7962).Z,width:"1002",height:"241"})),(0,o.kt)("h2",{id:"\u5728casdoor\u914d\u7f6e"},"\u5728Casdoor\u914d\u7f6e"),(0,o.kt)("p",null,"\u5728 Casdoor \u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u63d0\u4f9b\u5546\u3002"),(0,o.kt)("p",null,"\u9009\u62e9\u5206\u7c7b\u4e3a ",(0,o.kt)("strong",{parentName:"p"},"SAML"),", \u8f93\u5165 ",(0,o.kt)("strong",{parentName:"p"},"Keycloak"),". Copy the content of metadata and paste it into the ",(0,o.kt)("strong",{parentName:"p"},"Metadata")," field. The values of ",(0,o.kt)("strong",{parentName:"p"},"Endpoint"),", ",(0,o.kt)("strong",{parentName:"p"},"IdP"),", and ",(0,o.kt)("strong",{parentName:"p"},"Issuer URL")," will be generated automatically after clicking the ",(0,o.kt)("strong",{parentName:"p"},"Parse")," button. Finally, click the ",(0,o.kt)("strong",{parentName:"p"},"Save")," button."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"\u5982\u679c\u60a8\u5728 Keycloak \u4e2d\u542f\u7528 ",(0,o.kt)("strong",{parentName:"p"},"\u5ba2\u6237\u7aef\u7b7e\u540d\u9700\u8981")," \u9009\u9879\u5e76\u4e0a\u4f20\u8bc1\u4e66\uff0c \u8bf7\u5728 Casdoor \u4e2d\u542f\u7528 ",(0,o.kt)("strong",{parentName:"p"},"\u7b7e\u540d\u8bf7\u6c42")," \u9009\u9879\u3002")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Casdoor \u63d0\u4f9b\u5546",src:a(33666).Z,width:"2505",height:"1272"})),(0,o.kt)("p",null,"\u7f16\u8f91\u60a8\u60f3\u8981\u5728 Cassdoor \u4e2d\u914d\u7f6e\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 Select the provider you just added and click the ",(0,o.kt)("strong",{parentName:"p"},"Save")," button."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u63d0\u4f9b\u5546",src:a(96960).Z,width:"2487",height:"255"})),(0,o.kt)("h2",{id:"\u9a8c\u8bc1\u6548\u679c"},"\u9a8c\u8bc1\u6548\u679c"),(0,o.kt)("p",null,"Go to the application you just configured and you will find a Keycloak icon on the login page."),(0,o.kt)("p",null,"Click the icon and you will be redirected to the Keycloak login page. After successful authentication, you will be logged into Casdoor."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Casdoor \u767b\u5f55",src:a(42062).Z,width:"1280",height:"720"})))}k.isMDXComponent=!0},96960:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_casdoor_app-c3afe561f88f7c5ade9973f8aa706dec.png"},42062:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_casdoor_login-5080e3bced4808bd768772ecfb15ca97.gif"},33666:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_casdoor_provider-238d41bdb7a2ce7eab3252b45b8f7d63.png"},15582:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_client_add-a22a58cfe1cac19aac7c471f4b95a391.png"},82142:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_client_configure-d8a4520b9809494ac277da30d02a8d35.png"},7962:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_client_copy-3233ceff3f6b91883873e5441c6e50fe.png"},82235:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_client_install-e8ed45db439c33e32b2f46fbdc476f40.png"},95491:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_realm-aa47ec9142083126d9c9f1ce79c75eac.png"},78539:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak_realm_add-9a27d681ede089b89474ebd0acc155c0.png"}}]);