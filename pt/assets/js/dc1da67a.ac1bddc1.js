"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[7845],{3905:(e,a,o)=>{o.d(a,{Zo:()=>p,kt:()=>m});var r=o(67294);function t(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function n(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,r)}return o}function s(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?n(Object(o),!0).forEach((function(a){t(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function i(e,a){if(null==e)return{};var o,r,t=function(e,a){if(null==e)return{};var o,r,t={},n=Object.keys(e);for(r=0;r<n.length;r++)o=n[r],a.indexOf(o)>=0||(t[o]=e[o]);return t}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var u=r.createContext({}),l=function(e){var a=r.useContext(u),o=a;return e&&(o="function"==typeof e?e(a):s(s({},a),e)),o},p=function(e){var a=l(e.components);return r.createElement(u.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},d=r.forwardRef((function(e,a){var o=e.components,t=e.mdxType,n=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=l(o),m=t,g=d["".concat(u,".").concat(m)]||d[m]||c[m]||n;return o?r.createElement(g,s(s({ref:a},p),{},{components:o})):r.createElement(g,s({ref:a},p))}));function m(e,a){var o=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var n=o.length,s=new Array(n);s[0]=d;var i={};for(var u in a)hasOwnProperty.call(a,u)&&(i[u]=a[u]);i.originalType=e,i.mdxType="string"==typeof e?e:t,s[1]=i;for(var l=2;l<n;l++)s[l]=o[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,o)}d.displayName="MDXCreateElement"},89839:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>u,contentTitle:()=>s,default:()=>c,frontMatter:()=>n,metadata:()=>i,toc:()=>l});var r=o(87462),t=(o(67294),o(3905));const n={title:"Hasura",metaTitle:"Hasura | Tutorial de Autentica\xe7\xe3o Hasura",metaDescription:"Aprenda a integrar o Casdoor com o Hasura para proteger suas aplica\xe7\xf5es usando JWT"},s=void 0,i={unversionedId:"integration/Haskell/Hasura",id:"integration/Haskell/Hasura",title:"Hasura",description:"Antes da integra\xe7\xe3o, precisamos implantar o Casdoor localmente.",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/integration/Haskell/Hasura.md",sourceDirName:"integration/Haskell",slug:"/integration/Haskell/Hasura",permalink:"/pt/docs/integration/Haskell/Hasura",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/Haskell/Hasura.md",tags:[],version:"current",frontMatter:{title:"Hasura",metaTitle:"Hasura | Tutorial de Autentica\xe7\xe3o Hasura",metaDescription:"Aprenda a integrar o Casdoor com o Hasura para proteger suas aplica\xe7\xf5es usando JWT"},sidebar:"tutorialSidebar",previous:{title:"Haskell",permalink:"/pt/docs/category/haskell"},next:{title:"Python",permalink:"/pt/docs/category/python"}},u={},l=[{value:"Configurar aplica\xe7\xe3o Casdoor",id:"configurar-aplica\xe7\xe3o-casdoor",level:2},{value:"Adicione um usu\xe1rio no Casdoor",id:"adicione-um-usu\xe1rio-no-casdoor",level:2},{value:"Construa o Aplicativo Hasura",id:"construa-o-aplicativo-hasura",level:2},{value:"Configure o Hasura com o Casdoor",id:"configure-o-hasura-com-o-casdoor",level:2},{value:"Recupere o Token JWT",id:"recupere-o-token-jwt",level:2}],p={toc:l};function c(e){let{components:a,...n}=e;return(0,t.kt)("wrapper",(0,r.Z)({},p,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("p",null,"Antes da integra\xe7\xe3o, precisamos implantar o Casdoor localmente."),(0,t.kt)("p",null,"Ent\xe3o podemos implementar rapidamente uma p\xe1gina de login baseada em Casdoor em nosso pr\xf3prio aplicativo com os seguintes passos."),(0,t.kt)("h2",{id:"configurar-aplica\xe7\xe3o-casdoor"},"Configurar aplica\xe7\xe3o Casdoor"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Crie ou use uma aplica\xe7\xe3o Casdoor existente."),(0,t.kt)("li",{parentName:"ol"},"Adicione uma URL de redirecionamento: ",(0,t.kt)("inlineCode",{parentName:"li"},"http://CASDOOR_HOSTNAME/login")," ",(0,t.kt)("img",{alt:"Configura\xe7\xe3o da Aplica\xe7\xe3o Casdoor",src:o(78479).Z,width:"1767",height:"146"})),(0,t.kt)("li",{parentName:"ol"},"Copie o ID do cliente; precisaremos dele nos passos seguintes.")),(0,t.kt)("h2",{id:"adicione-um-usu\xe1rio-no-casdoor"},"Adicione um usu\xe1rio no Casdoor"),(0,t.kt)("p",null,"Agora que voc\xea tem o aplicativo, mas n\xe3o um usu\xe1rio. Isso significa que voc\xea precisa criar um usu\xe1rio e atribuir o papel."),(0,t.kt)("p",null,'V\xe1 para a p\xe1gina "Usu\xe1rios" e clique em "Adicionar usu\xe1rio" no canto superior direito. Isso abre uma nova p\xe1gina onde voc\xea pode adicionar o novo usu\xe1rio.'),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Imagem mostrando a p\xe1gina de usu\xe1rios",src:o(77596).Z,width:"1856",height:"657"})),(0,t.kt)("p",null,"Salve o usu\xe1rio ap\xf3s adicionar um nome de usu\xe1rio e adicionar a organiza\xe7\xe3o Hasura (outros detalhes s\xe3o opcionais)."),(0,t.kt)("p",null,'Agora voc\xea precisa configurar uma senha para o seu usu\xe1rio, o que pode ser feito clicando em "gerenciar sua senha".'),(0,t.kt)("p",null,"Escolha uma senha para o seu usu\xe1rio e confirme-a."),(0,t.kt)("h2",{id:"construa-o-aplicativo-hasura"},"Construa o Aplicativo Hasura"),(0,t.kt)("p",null,"Inicie o Hasura pelo Docker ou Hasura Cloud."),(0,t.kt)("p",null,"Agora crie uma tabela ",(0,t.kt)("inlineCode",{parentName:"p"},"users")," com as seguintes colunas:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"id")," do tipo Texto (Chave Prim\xe1ria)"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"username")," do tipo Texto")),(0,t.kt)("p",null,"Consulte a imagem abaixo para refer\xeancia."),(0,t.kt)("p",null,(0,t.kt)("img",{parentName:"p",src:"https://graphql-engine-cdn.hasura.io/learn-hasura/assets/graphql-hasura-authentication/keycloak/hasura-create-table.png",alt:"Imagem mostrando como criar uma tabela no Hasura"})),(0,t.kt)("p",null,"O pr\xf3ximo passo \xe9 criar um papel ",(0,t.kt)("inlineCode",{parentName:"p"},"user")," para o aplicativo. Os usu\xe1rios devem poder ver apenas seus pr\xf3prios registros, mas n\xe3o os registros de outras pessoas."),(0,t.kt)("p",null,"Configure o papel ",(0,t.kt)("inlineCode",{parentName:"p"},"user")," conforme mostrado na imagem abaixo. Para mais informa\xe7\xf5es, leia sobre ",(0,t.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/auth/authorization/permission-rules/"},"configurar regras de permiss\xe3o no Hasura"),"."),(0,t.kt)("p",null,(0,t.kt)("img",{parentName:"p",src:"https://graphql-engine-cdn.hasura.io/learn-hasura/assets/graphql-hasura-authentication/keycloak/hasura-set-permissions.png",alt:"Imagem mostrando como configurar permiss\xf5es no Hasura"})),(0,t.kt)("p",null,"Dessa forma, os usu\xe1rios n\xe3o podem ler os registros de outras pessoas. Eles s\xf3 podem acessar os pr\xf3prios."),(0,t.kt)("p",null,"Para fins de teste, adicione um usu\xe1rio fict\xedcio. Isso \xe9 para garantir que, quando voc\xea usa o token JWT, voc\xea s\xf3 veja os detalhes do seu usu\xe1rio e n\xe3o os detalhes de outros usu\xe1rios."),(0,t.kt)("p",null,(0,t.kt)("img",{parentName:"p",src:"https://graphql-engine-cdn.hasura.io/learn-hasura/assets/graphql-hasura-authentication/keycloak/hasura-dummy-user.png",alt:"Imagem mostrando como adicionar um registro de tabela no Hasura"})),(0,t.kt)("p",null,"Agora voc\xea precisa definir o ",(0,t.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," no Hasura."),(0,t.kt)("h2",{id:"configure-o-hasura-com-o-casdoor"},"Configure o Hasura com o Casdoor"),(0,t.kt)("p",null,"Neste passo, voc\xea precisa adicionar o ",(0,t.kt)("strong",{parentName:"p"},"HASURA_GRAPHQL_JWT_SECRET")," ao Hasura."),(0,t.kt)("p",null,"Para fazer isso, v\xe1 para o docker-compose.yaml do Hasura e adicione o novo ",(0,t.kt)("inlineCode",{parentName:"p"},"HASURA_GRAPHQL_JWT_SECRET")," como abaixo."),(0,t.kt)("p",null,"O ",(0,t.kt)("inlineCode",{parentName:"p"},"HASURA_GRAPHQL_JWT_SECRET")," deve estar no seguinte formato. Lembre-se de mudar ",(0,t.kt)("inlineCode",{parentName:"p"},"<endpoint do Casdoor>")," para a URL do seu pr\xf3prio Casdoor (como ",(0,t.kt)("inlineCode",{parentName:"p"},"https://door.casdoor.com"),")"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'HASURA_GRAPHQL_JWT_SECRET: \'{"claims_map": {\n      "x-hasura-allowed-roles": {"path": "$.roles"},\n      "x-hasura-default-role": {"path": "$.roles[0]"},\n      "x-hasura-user-id": {"path": "$.id"}\n    },"jwk_url":"<Casdoor endpoint>/.well-known/jwks"}\'\n')),(0,t.kt)("p",null,"Salve a altera\xe7\xe3o e recarregue o docker."),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Adicione a URL do JWT do Clerk ao Hasura",src:o(40876).Z,width:"963",height:"242"})),(0,t.kt)("h2",{id:"recupere-o-token-jwt"},"Recupere o Token JWT"),(0,t.kt)("p",null,"Como n\xe3o h\xe1 implementa\xe7\xe3o do cliente, voc\xea pode obter seu token de acesso fazendo uma solicita\xe7\xe3o pela URL abaixo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-url"},"http://localhost:8000/login/oauth/authorize?client_id=<client ID>&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Flogin&scope=read&state=app-built-in<public certificate>>\n")),(0,t.kt)("p",null,"Mude o ",(0,t.kt)("inlineCode",{parentName:"p"},"client ID")," para o ID que voc\xea copiou antes e insira o certificado p\xfablico do Casdoor, que voc\xea pode encontrar na p\xe1gina de Certificados do Casdoor."),(0,t.kt)("p",null,"Ent\xe3o insira o nome de usu\xe1rio e senha que voc\xea criou para o Hasura antes."),(0,t.kt)("p",null,'Clique em "Entrar"'),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Recupere o Token JWT",src:o(20588).Z,width:"1871",height:"846"})),(0,t.kt)("p",null,"Volte para a p\xe1gina Casdoor/Token."),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"P\xe1gina de Token",src:o(16786).Z,width:"1827",height:"793"})),(0,t.kt)("p",null,'Encontre o Nome de Usu\xe1rio que voc\xea inseriu antes, ent\xe3o clique em "editar"'),(0,t.kt)("p",null,"Copie o Token de Acesso"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Token de Acesso",src:o(51355).Z,width:"1843",height:"814"})),(0,t.kt)("p",null,"Agora voc\xea pode usar o token de acesso para fazer a solicita\xe7\xe3o autenticada. O Hasura retornou o usu\xe1rio apropriado em vez de retornar todos os usu\xe1rios do banco de dados."),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Imagem mostrando o token de acesso do Casdoor sendo usado no Hasura",src:o(37884).Z,width:"1819",height:"922"})))}c.isMDXComponent=!0},40876:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/JWT-4529538a012c1b4739a3e8269107278a.png"},51355:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/access-a7d8fb20ba05b1a548f603664c912c9f.png"},78479:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/cas-5af2f28e52ed3cd92f069520979945f5.png"},37884:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/hasura-0ab496d67e2e34ed63dc93407053abe0.png"},20588:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/login-537105fddeaaeff5471ca0cd0c5e2f21.png"},16786:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/tokens-d3624b07df57028c7a6085d18855c0f5.png"},77596:(e,a,o)=>{o.d(a,{Z:()=>r});const r=o.p+"assets/images/user-bd4da280495b507962f00e452754e5a7.png"}}]);