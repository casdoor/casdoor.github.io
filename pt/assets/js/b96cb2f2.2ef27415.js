"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4262],{3905:(e,o,a)=>{a.d(o,{Zo:()=>c,kt:()=>m});var t=a(67294);function r(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}function n(e,o){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?n(Object(a),!0).forEach((function(o){r(e,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))}))}return e}function s(e,o){if(null==e)return{};var a,t,r=function(e,o){if(null==e)return{};var a,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)a=n[t],o.indexOf(a)>=0||(r[a]=e[a]);return r}(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)a=n[t],o.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=t.createContext({}),p=function(e){var o=t.useContext(l),a=o;return e&&(a="function"==typeof e?e(o):i(i({},o),e)),a},c=function(e){var o=p(e.components);return t.createElement(l.Provider,{value:o},e.children)},d={inlineCode:"code",wrapper:function(e){var o=e.children;return t.createElement(t.Fragment,{},o)}},u=t.forwardRef((function(e,o){var a=e.components,r=e.mdxType,n=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,g=u["".concat(l,".").concat(m)]||u[m]||d[m]||n;return a?t.createElement(g,i(i({ref:o},c),{},{components:a})):t.createElement(g,i({ref:o},c))}));function m(e,o){var a=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var n=a.length,i=new Array(n);i[0]=u;var s={};for(var l in o)hasOwnProperty.call(o,l)&&(s[l]=o[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<n;p++)i[p]=a[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},748:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>n,metadata:()=>s,toc:()=>p});var t=a(87462),r=(a(67294),a(3905));const n={title:"GitLab",description:"Usando Casdoor para autentica\xe7\xe3o em um servidor GitLab auto-desenvolvido",keywords:["GitLab"],authors:["Steve0x2a"]},i=void 0,s={unversionedId:"integration/ruby/gitlab",id:"integration/ruby/gitlab",title:"GitLab",description:"Usando Casdoor para autentica\xe7\xe3o em um servidor GitLab auto-desenvolvido",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/integration/ruby/gitlab.md",sourceDirName:"integration/ruby",slug:"/integration/ruby/gitlab",permalink:"/pt/docs/integration/ruby/gitlab",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/ruby/gitlab.md",tags:[],version:"current",frontMatter:{title:"GitLab",description:"Usando Casdoor para autentica\xe7\xe3o em um servidor GitLab auto-desenvolvido",keywords:["GitLab"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Ruby",permalink:"/pt/docs/category/ruby"},next:{title:"Haskell",permalink:"/pt/docs/category/haskell"}},l={},p=[{value:"Passo 1: Implantar Casdoor e GitLab",id:"passo-1-implantar-casdoor-e-gitlab",level:2},{value:"Passo 2: Configurar aplica\xe7\xe3o Casdoor",id:"passo-2-configurar-aplica\xe7\xe3o-casdoor",level:2},{value:"Passo 3: Configurar GitLab",id:"passo-3-configurar-gitlab",level:2}],c={toc:p};function d(e){let{components:o,...n}=e;return(0,r.kt)("wrapper",(0,t.Z)({},c,n,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"O Casdoor pode usar o protocolo OIDC para se conectar a um servidor GitLab auto-implantado, e este documento mostrar\xe1 como fazer isso."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Como os ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/administration/auth/oidc.html#configure-keycloak"},"documentos do GitLab")," afirmam, o GitLab s\xf3 funciona com provedores OpenID que usam HTTPS, ent\xe3o voc\xea precisa implantar o Casdoor com HTTPS, como colocar o Casdoor atr\xe1s de um proxy reverso NGINX com uma configura\xe7\xe3o de certificado SSL. O pr\xf3prio Casdoor s\xf3 escuta na porta 8000 por padr\xe3o via HTTP e n\xe3o possui funcionalidade relacionada ao HTTPS.")),(0,r.kt)("p",null,"A seguir est\xe3o alguns dos nomes mencionados na configura\xe7\xe3o:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": O nome de dom\xednio ou IP onde o servidor Casdoor est\xe1 implantado, por exemplo, ",(0,r.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"GITLAB_HOSTNAME"),": O nome de dom\xednio ou IP onde o GitLab est\xe1 implantado, por exemplo, ",(0,r.kt)("inlineCode",{parentName:"p"},"https://gitlab.com"),"."),(0,r.kt)("h2",{id:"passo-1-implantar-casdoor-e-gitlab"},"Passo 1: Implantar Casdoor e GitLab"),(0,r.kt)("p",null,"Primeiramente, Casdoor e GitLab devem ser implantados."),(0,r.kt)("p",null,"Ap\xf3s uma implanta\xe7\xe3o bem-sucedida, voc\xea precisa garantir:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"O Casdoor pode ser acessado e usado normalmente."),(0,r.kt)("li",{parentName:"ol"},"Defina o valor de ",(0,r.kt)("inlineCode",{parentName:"li"},"origin")," do Casdoor (conf/app.conf) para ",(0,r.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,r.kt)("img",{alt:"Configura\xe7\xe3o do Casdoor",src:a(66496).Z,width:"1013",height:"448"}))),(0,r.kt)("h2",{id:"passo-2-configurar-aplica\xe7\xe3o-casdoor"},"Passo 2: Configurar aplica\xe7\xe3o Casdoor"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Crie ou use uma aplica\xe7\xe3o Casdoor existente."),(0,r.kt)("li",{parentName:"ol"},"Adicione uma URL de redirecionamento: ",(0,r.kt)("inlineCode",{parentName:"li"},"http://GITLAB_HOSTNAME/users/auth/openid_connect/callback"),"."),(0,r.kt)("li",{parentName:"ol"},"Adicione o provedor que deseja e complemente outras configura\xe7\xf5es.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configura\xe7\xe3o da Aplica\xe7\xe3o",src:a(18687).Z,width:"1571",height:"658"})," Notavelmente, voc\xea pode obter dois valores na p\xe1gina de configura\xe7\xf5es da aplica\xe7\xe3o: ",(0,r.kt)("inlineCode",{parentName:"p"},"Client ID")," e ",(0,r.kt)("inlineCode",{parentName:"p"},"Client secret")," (veja a imagem acima), e n\xf3s os usaremos na pr\xf3xima etapa."),(0,r.kt)("p",null,"Abra seu navegador favorito e visite: ",(0,r.kt)("strong",{parentName:"p"},"http://",(0,r.kt)("inlineCode",{parentName:"strong"},"CASDOOR_HOSTNAME"),"/.well-known/openid-configuration"),", onde voc\xea ver\xe1 a configura\xe7\xe3o OIDC do Casdoor."),(0,r.kt)("h2",{id:"passo-3-configurar-gitlab"},"Passo 3: Configurar GitLab"),(0,r.kt)("p",null,"Voc\xea pode seguir os passos abaixo para configurar isso, ou fazer altera\xe7\xf5es personalizadas de acordo com ",(0,r.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/administration/auth/oidc.html#casdoor"},"este documento")," (por exemplo, se voc\xea est\xe1 instalando o GitLab usando o c\xf3digo-fonte em vez do Omnibus)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"No seu servidor GitLab, abra o arquivo de configura\xe7\xe3o."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo editor /etc/gitlab/gitlab.rb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Adicione a configura\xe7\xe3o do provedor. (A URL HOSTNAME deve incluir http ou https)"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},'gitlab_rails[\'omniauth_providers\'] = [\n    {\n        name: "openid_connect",\n        label: "Casdoor", # optional label for the login button, defaults to "Openid Connect"\n        args: {\n            name: "openid_connect",\n            scope: ["openid", "profile", "email"],\n            response_type: "code",\n            issuer:  "<CASDOOR_HOSTNAME>",\n            client_auth_method: "query",\n            discovery: true,\n            uid_field: "preferred_username",\n            client_options: {\n                identifier: "<YOUR CLIENT ID>",\n                secret: "<YOUR CLIENT SECRET>",\n                redirect_uri: "<GITLAB_HOSTNAME>/users/auth/openid_connect/callback"\n            }\n        }\n    }\n]\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Reinicie o seu servidor GitLab.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Cada usu\xe1rio registrado pode abrir ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"GITLAB_HOSTNAME"),"/-/profile/account")," e conectar a conta Casdoor. ",(0,r.kt)("img",{alt:"Conex\xe3o GitLab",src:a(11405).Z,width:"2648",height:"926"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Concluir. Agora, voc\xea pode fazer login no seu pr\xf3prio GitLab usando Casdoor. ",(0,r.kt)("img",{alt:"Login GitLab",src:a(149).Z,width:"2127",height:"1315"})))))}d.isMDXComponent=!0},66496:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},18687:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/appsetting_gitlab-a7b6bb0c825259b068b3761fc249e79d.png"},11405:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/gitlab_connect-f62ead92f802fcdb4db244f128b04711.png"},149:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/gitlab_login-190fea801337b81056835c566872d439.png"}}]);