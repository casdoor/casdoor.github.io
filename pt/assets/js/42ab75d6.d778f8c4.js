"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4543],{3905:(e,o,a)=>{a.d(o,{Zo:()=>d,kt:()=>m});var t=a(67294);function r(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}function n(e,o){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?n(Object(a),!0).forEach((function(o){r(e,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))}))}return e}function s(e,o){if(null==e)return{};var a,t,r=function(e,o){if(null==e)return{};var a,t,r={},n=Object.keys(e);for(t=0;t<n.length;t++)a=n[t],o.indexOf(a)>=0||(r[a]=e[a]);return r}(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)a=n[t],o.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var u=t.createContext({}),p=function(e){var o=t.useContext(u),a=o;return e&&(a="function"==typeof e?e(o):i(i({},o),e)),a},d=function(e){var o=p(e.components);return t.createElement(u.Provider,{value:o},e.children)},c={inlineCode:"code",wrapper:function(e){var o=e.children;return t.createElement(t.Fragment,{},o)}},l=t.forwardRef((function(e,o){var a=e.components,r=e.mdxType,n=e.originalType,u=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),l=p(a),m=r,h=l["".concat(u,".").concat(m)]||l[m]||c[m]||n;return a?t.createElement(h,i(i({ref:o},d),{},{components:a})):t.createElement(h,i({ref:o},d))}));function m(e,o){var a=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var n=a.length,i=new Array(n);i[0]=l;var s={};for(var u in o)hasOwnProperty.call(o,u)&&(s[u]=o[u]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<n;p++)i[p]=a[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}l.displayName="MDXCreateElement"},82712:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>n,metadata:()=>s,toc:()=>p});var t=a(87462),r=(a(67294),a(3905));const n={title:"Vers\xe3o Comunit\xe1ria do Nginx",description:"Usando Casdoor com Nginx (N\xe3o Nginx-Plus) e Oauth2-Proxy",keywords:["nginx","OAuth2-Proxy","nginx-community-version"],authors:["gzyzhy"]},i=void 0,s={unversionedId:"integration/C++/NginxCommunityVersion",id:"integration/C++/NginxCommunityVersion",title:"Vers\xe3o Comunit\xe1ria do Nginx",description:"Usando Casdoor com Nginx (N\xe3o Nginx-Plus) e Oauth2-Proxy",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/integration/C++/NginxCommunityVersion.md",sourceDirName:"integration/C++",slug:"/integration/C++/NginxCommunityVersion",permalink:"/pt/docs/integration/C++/NginxCommunityVersion",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/C++/NginxCommunityVersion.md",tags:[],version:"current",frontMatter:{title:"Vers\xe3o Comunit\xe1ria do Nginx",description:"Usando Casdoor com Nginx (N\xe3o Nginx-Plus) e Oauth2-Proxy",keywords:["nginx","OAuth2-Proxy","nginx-community-version"],authors:["gzyzhy"]},sidebar:"tutorialSidebar",previous:{title:"Nginx",permalink:"/pt/docs/integration/C++/Nginx"},next:{title:"Envoy",permalink:"/pt/docs/integration/C++/Envoy"}},u={},p=[{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"I. Configurar Casdoor",id:"i-configurar-casdoor",level:2},{value:"II. Configurar Oauth2-Proxy",id:"ii-configurar-oauth2-proxy",level:2},{value:"III. Configurar Nginx",id:"iii-configurar-nginx",level:2},{value:"Testando",id:"testando",level:2},{value:"Solu\xe7\xe3o de problemas",id:"solu\xe7\xe3o-de-problemas",level:2}],d={toc:p};function c(e){let{components:o,...n}=e;return(0,r.kt)("wrapper",(0,t.Z)({},d,n,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"pr\xe9-requisitos"},"Pr\xe9-requisitos"),(0,r.kt)("p",null,"Este guia pressup\xf5e que voc\xea tenha as seguintes condi\xe7\xf5es:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Servi\xe7o Casdoor em execu\xe7\xe3o. Se voc\xea ainda n\xe3o instalou o servi\xe7o Casdoor, consulte ",(0,r.kt)("a",{parentName:"li",href:"https://casdoor.org/docs/basic/server-installation"},"Instala\xe7\xe3o do Servidor")," ou ",(0,r.kt)("a",{parentName:"li",href:"https://casdoor.org/docs/basic/try-with-docker"},"Experimente com Docker"),"."),(0,r.kt)("li",{parentName:"ul"},"Edi\xe7\xe3o de c\xf3digo aberto do Nginx com o m\xf3dulo ",(0,r.kt)("inlineCode",{parentName:"li"},"ngx_http_auth_request_module")," habilitado no momento da compila\xe7\xe3o. Se voc\xea n\xe3o sabe como habilitar o m\xf3dulo ",(0,r.kt)("inlineCode",{parentName:"li"},"ngx_http_auth_request_module"),", consulte o ",(0,r.kt)("a",{parentName:"li",href:"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html"},"Documento do M\xf3dulo Nginx"),"."),(0,r.kt)("li",{parentName:"ul"},"O site no qual voc\xea deseja habilitar a autentica\xe7\xe3o est\xe1 implantado com sucesso no Nginx, com um ",(0,r.kt)("strong",{parentName:"li"},"nome de dom\xednio configurado")," (em vez de usar um endere\xe7o IP) e pode ser acessado normalmente."),(0,r.kt)("li",{parentName:"ul"},"Ferramenta OAuth2-Proxy (atualmente, os dois projetos populares a seguir com muitas estrelas est\xe3o dispon\xedveis no GitHub, e voc\xea precisa escolher um deles):")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"oauth2-proxy/oauth2-proxy (usado neste artigo) ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub")," OU ",(0,r.kt)("a",{parentName:"li",href:"https://oauth2-proxy.github.io/oauth2-proxy"},"Site Oficial")),(0,r.kt)("li",{parentName:"ol"},"vouch/vouch-proxy ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/vouch/vouch-proxy"},"GitHub"))),(0,r.kt)("h2",{id:"i-configurar-casdoor"},"I. Configurar Casdoor"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Nota"),": As opera\xe7\xf5es neste artigo s\xe3o baseadas na GUI do Casdoor no momento da publica\xe7\xe3o, mas a GUI do Casdoor pode mudar dependendo da vers\xe3o. Siga as refer\xeancias fornecidas neste artigo para configurar sua vers\xe3o do Casdoor implantada."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Nota"),": As chaves, senhas, nomes de usu\xe1rio e outras informa\xe7\xf5es confidenciais mencionadas neste artigo s\xe3o todos exemplos. Por raz\xf5es de seguran\xe7a, voc\xea deve substitu\xed-las pelo seu pr\xf3prio conte\xfado relevante ao implantar."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fa\xe7a login na sua conta de administrador do Casdoor.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Na barra superior, selecione 'Autentica\xe7\xe3o de Identidade' > 'Aplica\xe7\xf5es', e ent\xe3o clique em 'Adicionar' na p\xe1gina 'Aplica\xe7\xf5es'."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"addApp",src:a(17381).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Complete a configura\xe7\xe3o da aplica\xe7\xe3o com base nas informa\xe7\xf5es do seu projeto. Neste artigo, usamos 'Nginx-Community' como o nome de aplica\xe7\xe3o de exemplo."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"ConfigureApp",src:a(42002).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Anote os valores dos campos 'Client ID' e 'Client Secret'. Eles ser\xe3o usados ao configurar o OAuth2-Proxy mais tarde. Em seguida, configure a 'URL de Redirecionamento' como ",(0,r.kt)("inlineCode",{parentName:"p"},"https://project.yourdomain.com/oauth2/callback/"),"."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"RecordInfo",src:a(378).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Na barra superior, selecione 'Gerenciamento de Permiss\xf5es Casbin' > 'Fun\xe7\xf5es', e ent\xe3o clique em 'Adicionar' na p\xe1gina 'Fun\xe7\xf5es'."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"AddRole",src:a(77228).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Complete a configura\xe7\xe3o da fun\xe7\xe3o com base nas informa\xe7\xf5es do seu projeto. Neste artigo, usamos 'nginx_role' como o nome da fun\xe7\xe3o de exemplo."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"ConfigureRole",src:a(76532).Z,width:"2532",height:"1170"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"(Opcional) Na barra superior, selecione 'Gerenciamento de Usu\xe1rios' > 'Usu\xe1rios', e ent\xe3o adicione novos usu\xe1rios conforme sua necessidade. Se os usu\xe1rios que voc\xea precisa j\xe1 existem, voc\xea pode pular esta etapa. Neste artigo, criamos um usu\xe1rio de exemplo chamado 'user'.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Volte para a p\xe1gina 'Fun\xe7\xf5es' mencionada no passo 5, edite a fun\xe7\xe3o ",(0,r.kt)("inlineCode",{parentName:"p"},"nginx_role")," e adicione os usu\xe1rios necess\xe1rios \xe0 op\xe7\xe3o 'Usu\xe1rios Inclu\xeddos'. Neste artigo, adicionamos o ",(0,r.kt)("inlineCode",{parentName:"p"},"builtin/user")," previamente criado aqui."))),(0,r.kt)("h2",{id:"ii-configurar-oauth2-proxy"},"II. Configurar Oauth2-Proxy"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Nota"),": Este artigo usa o projeto Oauth2-Proxy como exemplo. Se voc\xea quiser usar o Vouch em vez do Oauth2-Proxy, consulte a documenta\xe7\xe3o oficial deles no ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vouch/vouch-proxy"},"GitHub"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Nota"),": Este artigo pressup\xf5e que seu site est\xe1 configurado com um certificado SSL confi\xe1vel e permite apenas acesso HTTPS, ou que voc\xea configurou redirecionamento autom\xe1tico de visitantes HTTP para HTTPS. Isso ajuda a maximizar a prote\xe7\xe3o de cookies e impede a leitura maliciosa de tokens de login. Se o seu site precisa ser acessado via protocolo HTTP inseguro, modifique os comandos relevantes de acordo. Para mais ajuda com a implanta\xe7\xe3o via HTTP, consulte a documenta\xe7\xe3o oficial do Oauth2-Proxy no ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Dicas"),": ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"OAuth2-Proxy")," oferece v\xe1rios m\xe9todos de implanta\xe7\xe3o (como compila\xe7\xe3o de c\xf3digo-fonte, instala\xe7\xe3o via Docker, etc.). Para facilitar a explica\xe7\xe3o, este artigo usa o 'bin\xe1rio pr\xe9-constru\xeddo' para implanta\xe7\xe3o."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"V\xe1 para a p\xe1gina ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy/releases"},"GitHub Releases")," e baixe o pacote bin\xe1rio correspondente ao seu sistema operacional e arquitetura de CPU.\nAt\xe9 1 de janeiro de 2024, a vers\xe3o de lan\xe7amento mais recente do OAuth-Proxy \xe9 ",(0,r.kt)("inlineCode",{parentName:"p"},"V7.5.1"),". Se voc\xea quiser baixar o pacote bin\xe1rio para esta vers\xe3o, voc\xea pode executar o seguinte comando para Linux com AMD64:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"wget -O oauth2-proxy-linux.tar.gz https://github.com/oauth2-proxy/oauth2-proxy/releases/download/v7.5.1/oauth2-proxy-v7.5.1.linux-amd64.tar.gz\n")),(0,r.kt)("p",{parentName:"li"},"\xc9 altamente recomend\xe1vel que voc\xea verifique o valor ",(0,r.kt)("inlineCode",{parentName:"p"},"SHA256SUM")," fornecido pelo site oficial na p\xe1gina ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy/releases"},"GitHub Releases")," ap\xf3s baixar o pacote compactado e compare-o com o valor ",(0,r.kt)("inlineCode",{parentName:"p"},"SHA256SUM")," do pacote que voc\xea baixou, caractere por caractere.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Extraia o pacote baixado:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"tar -zxvf oauth2-proxy-*.tar.gz\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Entre no diret\xf3rio extra\xeddo:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd oauth2-proxy-v7.5.1.linux-amd64\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Mova o arquivo bin\xe1rio obtido para ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/local/bin")," e configure-o com permiss\xf5es de execu\xe7\xe3o. Voc\xea pode precisar elevar permiss\xf5es usando ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," dependendo da sua situa\xe7\xe3o."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cp ./oauth2-proxy /usr/local/bin\ncd /usr/local/bin\nchmod +x ./oauth2-proxy\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Teste a instala\xe7\xe3o do bin\xe1rio. Se a instala\xe7\xe3o for bem-sucedida, ap\xf3s executar o seguinte comando, voc\xea deve ver uma sa\xedda semelhante a ",(0,r.kt)("inlineCode",{parentName:"p"},"oauth2-proxy v7.5.1 (constru\xeddo com go1.21.1)"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\noauth2-proxy --version\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Execute o oauth2-proxy com par\xe2metros de linha de comando. Par\xe2metros marcados com ","[obrigat\xf3rio]"," devem ser configurados de acordo com sua situa\xe7\xe3o espec\xedfica, enquanto par\xe2metros marcados com ","[opcional]"," podem otimizar o desempenho, mas tamb\xe9m podem ser omitidos. Para garantir que o oauth2-proxy possa ser executado em segundo plano, voc\xea pode usar ferramentas de monitoramento de processos como ",(0,r.kt)("inlineCode",{parentName:"p"},"Screen")," ou ",(0,r.kt)("inlineCode",{parentName:"p"},"Supervisor")," ou ferramentas de terminal."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"oauth2-proxy \\ \n--provider=oidc \\ #[required] Do not change\n--client-id=abc123456def \\ #[required] \"Client ID\" obtained in step I.4 above\n--client-secret=abc123456def \\ #[required] \"Client Secret\" obtained in step I.4 above\n--oidc-issuer-url=https://auth.yourdomain.com \\ #[required] Your Casdoor URL (domain name or public IP)\n--redirect-url=https://project.yourdomain.com/oauth2/callback \\ #[required] https://domain-of-the-project-to-protect/oauth2/callback \n--scope=email+profile+groups+openid \\ #[required] Obtained from Casdoor: user email, user profile, groups, and login authentication\n--cookie-domain=project.yourdomain.com \\ #[required] Domain name of the project you want to protect\n--whitelist-domain=project.yourdomain.com \\ #[required] Domain name of the project you want to protect\n--cookie-secret=abc123456def \\ #[required] Please generate a random string of numbers and letters and fill it in here\n--email-domain=* \\ #[required] List of acceptable user email domains (* means accept all domains). If the user's email suffix is not in this list, a 403 error will be returned even if the login is successful.\n--insecure-oidc-allow-unverified-email=true \\ #[required] Whether to accept users with unverified email addresses\n--http-address=http://127.0.0.1:65534 \\ #[required] Address that oauth2-proxy listens on. The port number here can be set arbitrarily. Please record the value you set, as it will be needed for configuring Nginx later.\n--cookie-expire=24h0m0s \\ #[optional] Cookie expiration time. After this period, users will need to log in again.\n--custom-sign-in-logo=https://cdn.yourdomain.com/pic/proj.png \\ #[optional] Icon displayed on the login page. It is recommended to use a rectangular image rather than a square one.\n--session-store-type=redis \\ #[optional] Use Redis cache. If you don't need Redis, you can delete this item.\n--redis-connection-url=redis://127.0.0.1:6379/0 \\ #[optional] Redis URL. If you don't need Redis, you can delete this item.\n--redis-password=123456 #[optional] Redis connection password. If you don't need Redis or Redis has no password, you can delete this item.\n")))),(0,r.kt)("h2",{id:"iii-configurar-nginx"},"III. Configurar Nginx"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Nota"),": Por favor, confirme novamente que seu Nginx habilitou o m\xf3dulo ",(0,r.kt)("inlineCode",{parentName:"p"},"ngx_http_auth_request_module")," ao compilar e instalar a partir do c\xf3digo-fonte (o comando de compila\xe7\xe3o inclui ",(0,r.kt)("inlineCode",{parentName:"p"},"--with_http_auth_request_module"),"). Se voc\xea n\xe3o sabe como habilitar o m\xf3dulo ",(0,r.kt)("inlineCode",{parentName:"p"},"ngx_http_auth_request_module"),", consulte o ",(0,r.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html"},"Documento do M\xf3dulo Nginx"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Dicas"),": Nginx instalado usando a ferramenta do painel Baota n\xe3o habilita este m\xf3dulo por padr\xe3o."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Abra o arquivo de configura\xe7\xe3o do site que voc\xea j\xe1 implantou e deseja proteger, e fa\xe7a as seguintes modifica\xe7\xf5es:"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Nota"),": Voc\xea precisa ajustar este arquivo de configura\xe7\xe3o de acordo com sua situa\xe7\xe3o espec\xedfica. Devido a vers\xf5es do Nginx e outros fatores, este arquivo de configura\xe7\xe3o pode n\xe3o funcionar sem problemas em todas as inst\xe2ncias do Nginx. Ajuste o conte\xfado relevante com base nas informa\xe7\xf5es do seu pr\xf3prio Nginx."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-nginx"},'server {\n    listen 443 ssl http2;\n\n    include /path/to/ssl.conf;\n\n    # Add the following content\n    location ^~ /oauth2/ {\n        proxy_pass       http://127.0.0.1:65534; # Change this to the "--http-address" configured in step II.6\n\n        proxy_set_header Host                    $host;\n        proxy_set_header X-Real-IP               $remote_addr;\n        proxy_set_header X-Scheme                $scheme;\n\n        proxy_set_header X-Auth-Request-Redirect $request_uri;\n        # or, if you are handling multiple domains:\n        # proxy_set_header X-Auth-Request-Redirect $scheme://$host$request_uri;\n    }\n    location = /oauth2/auth {\n        proxy_pass       http://127.0.0.1:65534; # Change this to the "--http-address" configured in step II.6\n\n        proxy_set_header Host             $host;\n        proxy_set_header X-Real-IP        $remote_addr;\n        proxy_set_header X-Scheme         $scheme;\n        proxy_set_header Content-Length   "";\n        proxy_pass_request_body           off;\n    }\n    location ^~ / {\n        auth_request /oauth2/auth;\n        error_page 401 = /oauth2/sign_in;\n\n        auth_request_set $user   $upstream_http_x_auth_request_user; \n        auth_request_set $email  $upstream_http_x_auth_request_email; \n        proxy_set_header X-User  $user; # Pass the username of the user logged in to your backend service\n        proxy_set_header X-Email $email; # Pass the email of the user logged in to your backend service\n\n        auth_request_set $token  $upstream_http_x_auth_request_access_token;\n        proxy_set_header X-Access-Token $token; # Pass the user\'s login token to your backend service\n\n        # The following configurations are related to cookie validation for user login\n        auth_request_set $auth_cookie $upstream_http_set_cookie;\n        add_header Set-Cookie $auth_cookie;\n\n        auth_request_set $auth_cookie_name_upstream_1 $upstream_cookie_auth_cookie_name_1;\n\n        if ($auth_cookie ~* "(; .*)") {\n            set $auth_cookie_name_0 $auth_cookie;\n            set $auth_cookie_name_1 "auth_cookie_name_1=$auth_cookie_name_upstream_1$1";\n        }   \n\n        if ($auth_cookie_name_upstream_1) {\n            add_header Set-Cookie $auth_cookie_name_0;\n            add_header Set-Cookie $auth_cookie_name_1;\n        }\n        proxy_no_cache $cookie_session;\n\n        # Provide the web page to the user after successful validation\n\n        proxy_pass http://127.0.0.1:8080; # The address where your backend service runs\n        # Note: This is not the Casdoor deployment address or the Oauth2-Proxy running address, but the address where your backend service that needs login protection runs.\n\n        # Then add configurations to pass user IP, Connection request headers, etc., to your backend service, for example:\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection upgrade;\n        proxy_set_header Accept-Encoding gzip;\n    }\n    access_log /path/to/access_log.log;\n    error_log /path/to/error_log.log;\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Salve o arquivo e recarregue seu Nginx."))),(0,r.kt)("h2",{id:"testando"},"Testando"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A seguir, voc\xea pode testar sua implementa\xe7\xe3o."),(0,r.kt)("li",{parentName:"ul"},"Em circunst\xe2ncias normais, seus usu\xe1rios passar\xe3o pelo seguinte processo ao fazer login no seu servi\xe7o:"),(0,r.kt)("li",{parentName:"ul"},"Abrir a URL ",(0,r.kt)("inlineCode",{parentName:"li"},"project.yourdomain.com")," em um navegador -> Ver apenas uma p\xe1gina que requer login, incluindo um bot\xe3o chamado 'Entrar com OpenID Connect' -> Clicar no bot\xe3o e ser redirecionado para o endere\xe7o do seu Casdoor, onde ser\xe1 solicitado a fazer login -> Usu\xe1rios inserem seu nome de usu\xe1rio e senha, e o Casdoor verifica suas credenciais -> Redirecionamento autom\xe1tico de volta para a sua URL ",(0,r.kt)("inlineCode",{parentName:"li"},"project.yourdomain.com")," -> Acesso bem-sucedido ao seu servi\xe7o -> Usu\xe1rios ser\xe3o solicitados a fazer login novamente quando o tempo ",(0,r.kt)("inlineCode",{parentName:"li"},"--cookie-expire")," que voc\xea definiu expirar.")),(0,r.kt)("h2",{id:"solu\xe7\xe3o-de-problemas"},"Solu\xe7\xe3o de problemas"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Se o seu projeto n\xe3o estiver funcionando conforme o esperado, verifique a corre\xe7\xe3o dos par\xe2metros de configura\xe7\xe3o do Nginx e do Oauth2-Proxy."),(0,r.kt)("li",{parentName:"ul"},"Voc\xea tamb\xe9m pode consultar a documenta\xe7\xe3o oficial do Oauth2-Proxy no ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub"),"."),(0,r.kt)("li",{parentName:"ul"},"Se voc\xea encontrar algum erro neste documento, sinta-se \xe0 vontade para solicitar edi\xe7\xf5es no GitHub.")))}c.isMDXComponent=!0},77228:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/AddRole-b385b307305fe11ca476ee9d0b41ab0d.png"},42002:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/ConfigureApp-fc36fc06dd93b4e8ff438a160c34a255.png"},76532:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/ConfigureRole-ba58c31b5d67a3929107a49083d6c505.png"},378:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/RecordInfo-f8bf04f982122eba51e222fd47375ce0.png"},17381:(e,o,a)=>{a.d(o,{Z:()=>t});const t=a.p+"assets/images/addApp-ce709a1272f7c601539f9dc5dfe90894.png"}}]);