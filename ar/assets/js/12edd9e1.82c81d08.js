"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[5894],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=o.createContext({}),p=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return o.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(t),m=a,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return t?o.createElement(h,s(s({ref:n},c),{},{components:t})):o.createElement(h,s({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,s=new Array(r);s[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var p=2;p<r;p++)s[p]=t[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},29509:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var o=t(87462),a=(t(67294),t(3905));const r={title:"\u0627\u0644\u0646\u0634\u0631 \u0639\u0644\u0649 Kubernetes",description:"\u062a\u0639\u0644\u0645 \u0643\u064a\u0641\u064a\u0629 \u0646\u0634\u0631 Casdoor \u0641\u064a \u0645\u062c\u0645\u0648\u0639\u0629 Kubernetes",keywords:["k8s","Kubernetes","Casdoor","deployment"],authors:["ComradeProgrammer"]},s=void 0,i={unversionedId:"deployment/k8s",id:"deployment/k8s",title:"\u0627\u0644\u0646\u0634\u0631 \u0639\u0644\u0649 Kubernetes",description:"\u062a\u0639\u0644\u0645 \u0643\u064a\u0641\u064a\u0629 \u0646\u0634\u0631 Casdoor \u0641\u064a \u0645\u062c\u0645\u0648\u0639\u0629 Kubernetes",source:"@site/i18n/ar/docusaurus-plugin-content-docs/current/deployment/k8s.md",sourceDirName:"deployment",slug:"/deployment/k8s",permalink:"/ar/docs/deployment/k8s",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/deployment/k8s.md",tags:[],version:"current",frontMatter:{title:"\u0627\u0644\u0646\u0634\u0631 \u0639\u0644\u0649 Kubernetes",description:"\u062a\u0639\u0644\u0645 \u0643\u064a\u0641\u064a\u0629 \u0646\u0634\u0631 Casdoor \u0641\u064a \u0645\u062c\u0645\u0648\u0639\u0629 Kubernetes",keywords:["k8s","Kubernetes","Casdoor","deployment"],authors:["ComradeProgrammer"]},sidebar:"tutorialSidebar",previous:{title:"\u062a\u0646\u0634\u064a\u0637 \u0639\u0644\u0649 NGINX",permalink:"/ar/docs/deployment/nginx"},next:{title:"\u062a\u0647\u064a\u0626\u0629 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a",permalink:"/ar/docs/deployment/data-initialization"}},l={},p=[{value:"\u0646\u0634\u0631 Casdoor \u0641\u064a Kubernetes (k8s)",id:"\u0646\u0634\u0631-casdoor-\u0641\u064a-kubernetes-k8s",level:2},{value:"Exposing Casdoor with Ingress",id:"exposing-casdoor-with-ingress",level:2},{value:"Direct Ingress Access",id:"direct-ingress-access",level:3},{value:"Authentication with ingress-nginx auth annotations",id:"authentication-with-ingress-nginx-auth-annotations",level:3},{value:"Security Considerations",id:"security-considerations",level:3}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u0646\u0634\u0631-casdoor-\u0641\u064a-kubernetes-k8s"},"\u0646\u0634\u0631 Casdoor \u0641\u064a Kubernetes (k8s)"),(0,a.kt)("p",null,'\u0646\u062d\u0646 \u0646\u0642\u062f\u0645 \u0645\u062b\u0627\u0644\u0627\u064b \u0623\u0633\u0627\u0633\u064a\u0627\u064b \u0644\u0646\u0634\u0631 Casdoor \u0641\u064a \u0645\u062c\u0645\u0648\u0639\u0629 Kubernetes. \u0641\u064a \u0627\u0644\u0645\u062c\u0644\u062f \u0627\u0644\u062c\u0630\u0631 \u0644\u0640 Casdoor\u060c \u0633\u062a\u062c\u062f \u0645\u0644\u0641\u0627\u064b \u064a\u0633\u0645\u0649 "k8s.yaml". \u064a\u062d\u062a\u0648\u064a \u0647\u0630\u0627 \u0627\u0644\u0645\u0644\u0641 \u0639\u0644\u0649 \u062a\u0643\u0648\u064a\u0646 \u0645\u062b\u0627\u0644 \u0644\u0646\u0634\u0631 Casdoor \u0641\u064a Kubernetes\u060c \u0628\u0645\u0627 \u0641\u064a \u0630\u0644\u0643 \u0646\u0634\u0631 \u0648\u062e\u062f\u0645\u0629.'),(0,a.kt)("p",null,"\u0642\u0628\u0644 \u0628\u062f\u0621 \u0627\u0644\u0646\u0634\u0631\u060c \u062a\u0623\u0643\u062f \u0645\u0646 \u0623\u0646\u0643 \u0642\u062f \u0642\u0645\u062a \u0628\u062a\u0639\u062f\u064a\u0644 \u0645\u0644\u0641 ",(0,a.kt)("inlineCode",{parentName:"p"},"conf/app.conf")," \u062d\u062a\u0649 \u064a\u062a\u0645\u0643\u0646 Casdoor \u0645\u0646 \u0627\u0644\u0627\u062a\u0635\u0627\u0644 \u0628\u0642\u0627\u0639\u062f\u0629 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0628\u0646\u062c\u0627\u062d \u0648\u0623\u0646 \u0642\u0627\u0639\u062f\u0629 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a \u0646\u0641\u0633\u0647\u0627 \u062a\u0639\u0645\u0644. \u0623\u064a\u0636\u0627\u064b\u060c \u062a\u0623\u0643\u062f \u0645\u0646 \u0623\u0646 Kubernetes \u0642\u0627\u062f\u0631 \u0639\u0644\u0649 \u0633\u062d\u0628 \u0627\u0644\u0635\u0648\u0631 \u0627\u0644\u0644\u0627\u0632\u0645\u0629."),(0,a.kt)("p",null,"\u0644\u0646\u0634\u0631 Casdoor\u060c \u0642\u0645 \u0628\u062a\u0634\u063a\u064a\u0644 \u0627\u0644\u0623\u0645\u0631 \u0627\u0644\u062a\u0627\u0644\u064a:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f k8s.yaml\n")),(0,a.kt)("p",null,"\u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u062d\u0627\u0644\u0629 \u0627\u0644\u0646\u0634\u0631 \u0628\u062a\u0634\u063a\u064a\u0644 \u0627\u0644\u0623\u0645\u0631 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"."),(0,a.kt)("p",null,"\u0625\u0644\u064a\u0643 \u0645\u062d\u062a\u0648\u0649 ",(0,a.kt)("inlineCode",{parentName:"p"},"k8s.yaml"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# this is only an EXAMPLE of deploying casddor in kubernetes\n# please modify this file according to your requirements\napiVersion: v1\nkind: Service\nmetadata:\n  #EDIT IT: if you don't want to run casdoor in default namespace, please modify this field\n  #namespace: casdoor\n  name: casdoor-svc\n  labels:\n    app: casdoor\nspec:\n  #EDIT IT: if you don't want to run casdoor in default namespace, please modify this filed\n  type: NodePort\n  ports:\n    - port: 8000\n  selector:\n    app: casdoor\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  #EDIT IT: if you don't want to run casdoor in default namespace, please modify this field\n  #namespace: casdoor\n  name: casdoor-deployment\n  labels:\n    app: casdoor\nspec:\n  #EDIT IT: if you don't use redis, casdoor should not have multiple replicas\n  replicas: 1\n  selector:\n    matchLabels:\n      app: casdoor\n  template:\n    metadata:\n      labels:\n        app: casdoor\n    spec:\n      containers:\n        - name: casdoor-container\n          image: casbin/casdoor:latest\n          imagePullPolicy: Always\n          ports:\n            - containerPort: 8000\n          volumeMounts:\n            # the mounted directory path in THE CONTAINER\n            - mountPath: /conf\n              name: conf\n          env:       \n            - name: RUNNING_IN_DOCKER\n              value: \"true\"\n      #if you want to deploy this in real prod env, consider the config map\n      volumes:\n        - name: conf\n          hostPath:\n            #EDIT IT: the mounted directory path in THE HOST\n            path: /conf\n\n")),(0,a.kt)("p",null,"\u064a\u0631\u062c\u0649 \u0645\u0644\u0627\u062d\u0638\u0629 \u0623\u0646 \u0647\u0630\u0627 \u0627\u0644\u0645\u0644\u0641 \u0647\u0648 \u0645\u062c\u0631\u062f \u0645\u062b\u0627\u0644. \u064a\u0645\u0643\u0646\u0643 \u0625\u062c\u0631\u0627\u0621 \u062a\u0639\u062f\u064a\u0644\u0627\u062a \u0645\u062e\u062a\u0644\u0641\u0629 \u062d\u0633\u0628 \u0645\u062a\u0637\u0644\u0628\u0627\u062a\u0643\u060c \u0645\u062b\u0644 \u0627\u0633\u062a\u062e\u062f\u0627\u0645 \u0645\u0633\u0627\u062d\u0629 \u0627\u0633\u0645 \u0645\u062e\u062a\u0644\u0641\u0629\u060c \u0646\u0648\u0639 \u062e\u062f\u0645\u0629\u060c \u0623\u0648 ConfigMap \u0644\u062a\u0631\u0643\u064a\u0628 \u0645\u0644\u0641 \u0627\u0644\u062a\u0643\u0648\u064a\u0646. \u0627\u0633\u062a\u062e\u062f\u0627\u0645 ConfigMap \u0647\u0648 \u0646\u0647\u062c \u0645\u0648\u0635\u0649 \u0628\u0647 \u0641\u064a Kubernetes \u0644\u062a\u0631\u0643\u064a\u0628 \u0645\u0644\u0641\u0627\u062a \u0627\u0644\u062a\u0643\u0648\u064a\u0646 \u0641\u064a \u0628\u064a\u0626\u0629 \u0627\u0644\u0625\u0646\u062a\u0627\u062c."),(0,a.kt)("h2",{id:"exposing-casdoor-with-ingress"},"Exposing Casdoor with Ingress"),(0,a.kt)("p",null,"Once Casdoor is deployed, you typically want to expose it externally. There are several approaches to handle authentication for your applications:"),(0,a.kt)("h3",{id:"direct-ingress-access"},"Direct Ingress Access"),(0,a.kt)("p",null,"For simple setups where you want to expose Casdoor itself, create an Ingress resource:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: casdoor-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/ssl-redirect: "true"\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: auth.yourdomain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: casdoor-svc\n            port:\n              number: 8000\n  tls:\n  - hosts:\n    - auth.yourdomain.com\n    secretName: casdoor-tls-secret\n')),(0,a.kt)("p",null,"Your applications can then integrate with Casdoor using the SDK or OAuth 2.0/OIDC protocols directly. This is the recommended approach for most use cases as it gives you full control over the authentication flow in your application code."),(0,a.kt)("h3",{id:"authentication-with-ingress-nginx-auth-annotations"},"Authentication with ingress-nginx auth annotations"),(0,a.kt)("p",null,"While ingress-nginx provides external authentication capabilities through annotations, this approach has significant limitations when used with OAuth2/OIDC providers like Casdoor. The ",(0,a.kt)("inlineCode",{parentName:"p"},"nginx.ingress.kubernetes.io/auth-url")," annotation is designed for simple token validation endpoints, not for complete OAuth2 flows that require redirects and session management."),(0,a.kt)("p",null,"For protecting applications at the ingress level, you should use oauth2-proxy or similar authentication proxies. These tools handle the complete OAuth2/OIDC flow including:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Initiating the login redirect to Casdoor"),(0,a.kt)("li",{parentName:"ul"},"Handling the OAuth2 callback with authorization codes"),(0,a.kt)("li",{parentName:"ul"},"Managing user sessions with cookies"),(0,a.kt)("li",{parentName:"ul"},"Token refresh and validation")),(0,a.kt)("p",null,"Here's how to deploy oauth2-proxy alongside your application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: oauth2-proxy\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: oauth2-proxy\n  template:\n    metadata:\n      labels:\n        app: oauth2-proxy\n    spec:\n      containers:\n      - name: oauth2-proxy\n        image: quay.io/oauth2-proxy/oauth2-proxy:v7.5.1\n        args:\n        - --provider=oidc\n        - --oidc-issuer-url=https://auth.yourdomain.com\n        - --client-id=YOUR_CLIENT_ID\n        - --client-secret=YOUR_CLIENT_SECRET\n        - --redirect-url=https://app.yourdomain.com/oauth2/callback\n        - --cookie-secret=RANDOM_SECRET_32_CHARS\n        - --email-domain=*\n        - --upstream=http://your-app-service:8080\n        - --http-address=0.0.0.0:4180\n        ports:\n        - containerPort: 4180\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: oauth2-proxy-svc\nspec:\n  ports:\n  - port: 4180\n    targetPort: 4180\n  selector:\n    app: oauth2-proxy\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: app-ingress\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: app.yourdomain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: oauth2-proxy-svc\n            port:\n              number: 4180\n  tls:\n  - hosts:\n    - app.yourdomain.com\n    secretName: app-tls-secret\n")),(0,a.kt)("p",null,"This approach ensures proper OAuth2/OIDC flow handling while keeping your application protected at the ingress layer."),(0,a.kt)("h3",{id:"security-considerations"},"Security Considerations"),(0,a.kt)("p",null,"When deploying authentication in Kubernetes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Always use HTTPS/TLS")," - OAuth2 requires secure connections. Configure TLS certificates for your ingress resources using cert-manager or similar tools."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Secure sensitive values")," - Store client secrets, cookie secrets, and other sensitive data in Kubernetes Secrets, not in plain ConfigMaps or deployment manifests."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Use proper RBAC")," - Limit access to authentication configurations and secrets using Kubernetes RBAC policies."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Session management")," - For production deployments with multiple replicas, configure oauth2-proxy to use Redis for session storage to ensure sessions work across pod restarts and multiple instances.")))}u.isMDXComponent=!0}}]);