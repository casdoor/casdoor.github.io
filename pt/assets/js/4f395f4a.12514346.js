"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[8678],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=o.createContext({}),l=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=l(e.components);return o.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=l(t),m=a,h=d["".concat(p,".").concat(m)]||d[m]||u[m]||r;return t?o.createElement(h,s(s({ref:n},c),{},{components:t})):o.createElement(h,s({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,s=new Array(r);s[0]=d;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var l=2;l<r;l++)s[l]=t[l];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},34199:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var o=t(87462),a=(t(67294),t(3905));const r={title:"Implantando no Kubernetes",description:"Aprenda como implantar o Casdoor em um cluster Kubernetes",keywords:["k8s","Kubernetes","Casdoor","deployment"],authors:["ComradeProgrammer"]},s=void 0,i={unversionedId:"deployment/k8s",id:"deployment/k8s",title:"Implantando no Kubernetes",description:"Aprenda como implantar o Casdoor em um cluster Kubernetes",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/deployment/k8s.md",sourceDirName:"deployment",slug:"/deployment/k8s",permalink:"/pt/docs/deployment/k8s",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/deployment/k8s.md",tags:[],version:"current",frontMatter:{title:"Implantando no Kubernetes",description:"Aprenda como implantar o Casdoor em um cluster Kubernetes",keywords:["k8s","Kubernetes","Casdoor","deployment"],authors:["ComradeProgrammer"]},sidebar:"tutorialSidebar",previous:{title:"Implantando no NGINX",permalink:"/pt/docs/deployment/nginx"},next:{title:"Inicializa\xe7\xe3o de Dados",permalink:"/pt/docs/deployment/data-initialization"}},p={},l=[{value:"Implante o Casdoor no Kubernetes (k8s)",id:"implante-o-casdoor-no-kubernetes-k8s",level:2},{value:"Exposing Casdoor with Ingress",id:"exposing-casdoor-with-ingress",level:2},{value:"Direct Ingress Access",id:"direct-ingress-access",level:3},{value:"Authentication with ingress-nginx auth annotations",id:"authentication-with-ingress-nginx-auth-annotations",level:3},{value:"Security Considerations",id:"security-considerations",level:3}],c={toc:l};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"implante-o-casdoor-no-kubernetes-k8s"},"Implante o Casdoor no Kubernetes (k8s)"),(0,a.kt)("p",null,'N\xf3s fornecemos um exemplo b\xe1sico de implanta\xe7\xe3o do Casdoor em um cluster Kubernetes. Na pasta raiz do Casdoor, voc\xea encontrar\xe1 um arquivo chamado "k8s.yaml". Este arquivo cont\xe9m um exemplo de configura\xe7\xe3o para implantar o Casdoor no Kubernetes, incluindo um deployment e um servi\xe7o.'),(0,a.kt)("p",null,"Antes de iniciar a implanta\xe7\xe3o, certifique-se de que voc\xea modificou o arquivo ",(0,a.kt)("inlineCode",{parentName:"p"},"conf/app.conf")," para que o Casdoor possa se conectar ao banco de dados com sucesso e que o pr\xf3prio banco de dados esteja em execu\xe7\xe3o. Al\xe9m disso, certifique-se de que o Kubernetes possa puxar as imagens necess\xe1rias."),(0,a.kt)("p",null,"Para implantar o Casdoor, execute o seguinte comando:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f k8s.yaml\n")),(0,a.kt)("p",null,"Voc\xea pode verificar o status da implanta\xe7\xe3o executando o comando ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods"),"."),(0,a.kt)("p",null,"Aqui est\xe1 o conte\xfado de ",(0,a.kt)("inlineCode",{parentName:"p"},"k8s.yaml"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# this is only an EXAMPLE of deploying casddor in kubernetes\n# please modify this file according to your requirements\napiVersion: v1\nkind: Service\nmetadata:\n  #EDIT IT: if you don't want to run casdoor in default namespace, please modify this field\n  #namespace: casdoor\n  name: casdoor-svc\n  labels:\n    app: casdoor\nspec:\n  #EDIT IT: if you don't want to run casdoor in default namespace, please modify this filed\n  type: NodePort\n  ports:\n    - port: 8000\n  selector:\n    app: casdoor\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  #EDIT IT: if you don't want to run casdoor in default namespace, please modify this field\n  #namespace: casdoor\n  name: casdoor-deployment\n  labels:\n    app: casdoor\nspec:\n  #EDIT IT: if you don't use redis, casdoor should not have multiple replicas\n  replicas: 1\n  selector:\n    matchLabels:\n      app: casdoor\n  template:\n    metadata:\n      labels:\n        app: casdoor\n    spec:\n      containers:\n        - name: casdoor-container\n          image: casbin/casdoor:latest\n          imagePullPolicy: Always\n          ports:\n            - containerPort: 8000\n          volumeMounts:\n            # the mounted directory path in THE CONTAINER\n            - mountPath: /conf\n              name: conf\n          env:       \n            - name: RUNNING_IN_DOCKER\n              value: \"true\"\n      #if you want to deploy this in real prod env, consider the config map\n      volumes:\n        - name: conf\n          hostPath:\n            #EDIT IT: the mounted directory path in THE HOST\n            path: /conf\n\n")),(0,a.kt)("p",null,"Por favor, note que este arquivo \xe9 apenas um exemplo. Voc\xea pode fazer v\xe1rias modifica\xe7\xf5es conforme suas necessidades, como usar um namespace diferente, tipo de servi\xe7o ou um ConfigMap para montar o arquivo de configura\xe7\xe3o. Usar um ConfigMap \xe9 uma abordagem recomendada no Kubernetes para montar arquivos de configura\xe7\xe3o em um ambiente de produ\xe7\xe3o."),(0,a.kt)("h2",{id:"exposing-casdoor-with-ingress"},"Exposing Casdoor with Ingress"),(0,a.kt)("p",null,"Once Casdoor is deployed, you typically want to expose it externally. There are several approaches to handle authentication for your applications:"),(0,a.kt)("h3",{id:"direct-ingress-access"},"Direct Ingress Access"),(0,a.kt)("p",null,"For simple setups where you want to expose Casdoor itself, create an Ingress resource:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: casdoor-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/ssl-redirect: "true"\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: auth.yourdomain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: casdoor-svc\n            port:\n              number: 8000\n  tls:\n  - hosts:\n    - auth.yourdomain.com\n    secretName: casdoor-tls-secret\n')),(0,a.kt)("p",null,"Your applications can then integrate with Casdoor using the SDK or OAuth 2.0/OIDC protocols directly. This is the recommended approach for most use cases as it gives you full control over the authentication flow in your application code."),(0,a.kt)("h3",{id:"authentication-with-ingress-nginx-auth-annotations"},"Authentication with ingress-nginx auth annotations"),(0,a.kt)("p",null,"While ingress-nginx provides external authentication capabilities through annotations, this approach has significant limitations when used with OAuth2/OIDC providers like Casdoor. The ",(0,a.kt)("inlineCode",{parentName:"p"},"nginx.ingress.kubernetes.io/auth-url")," annotation is designed for simple token validation endpoints, not for complete OAuth2 flows that require redirects and session management."),(0,a.kt)("p",null,"For protecting applications at the ingress level, you should use oauth2-proxy or similar authentication proxies. These tools handle the complete OAuth2/OIDC flow including:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Initiating the login redirect to Casdoor"),(0,a.kt)("li",{parentName:"ul"},"Handling the OAuth2 callback with authorization codes"),(0,a.kt)("li",{parentName:"ul"},"Managing user sessions with cookies"),(0,a.kt)("li",{parentName:"ul"},"Token refresh and validation")),(0,a.kt)("p",null,"Here's how to deploy oauth2-proxy alongside your application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: oauth2-proxy\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: oauth2-proxy\n  template:\n    metadata:\n      labels:\n        app: oauth2-proxy\n    spec:\n      containers:\n      - name: oauth2-proxy\n        image: quay.io/oauth2-proxy/oauth2-proxy:v7.5.1\n        args:\n        - --provider=oidc\n        - --oidc-issuer-url=https://auth.yourdomain.com\n        - --client-id=YOUR_CLIENT_ID\n        - --client-secret=YOUR_CLIENT_SECRET\n        - --redirect-url=https://app.yourdomain.com/oauth2/callback\n        - --cookie-secret=RANDOM_SECRET_32_CHARS\n        - --email-domain=*\n        - --upstream=http://your-app-service:8080\n        - --http-address=0.0.0.0:4180\n        ports:\n        - containerPort: 4180\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: oauth2-proxy-svc\nspec:\n  ports:\n  - port: 4180\n    targetPort: 4180\n  selector:\n    app: oauth2-proxy\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: app-ingress\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: app.yourdomain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: oauth2-proxy-svc\n            port:\n              number: 4180\n  tls:\n  - hosts:\n    - app.yourdomain.com\n    secretName: app-tls-secret\n")),(0,a.kt)("p",null,"This approach ensures proper OAuth2/OIDC flow handling while keeping your application protected at the ingress layer."),(0,a.kt)("h3",{id:"security-considerations"},"Security Considerations"),(0,a.kt)("p",null,"When deploying authentication in Kubernetes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Always use HTTPS/TLS")," - OAuth2 requires secure connections. Configure TLS certificates for your ingress resources using cert-manager or similar tools."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Secure sensitive values")," - Store client secrets, cookie secrets, and other sensitive data in Kubernetes Secrets, not in plain ConfigMaps or deployment manifests."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Use proper RBAC")," - Limit access to authentication configurations and secrets using Kubernetes RBAC policies."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Session management")," - For production deployments with multiple replicas, configure oauth2-proxy to use Redis for session storage to ensure sessions work across pod restarts and multiple instances.")))}u.isMDXComponent=!0}}]);