"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[9130],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>g});var n=o(67294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var l=n.createContext({}),c=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):r(r({},t),e)),o},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(o),g=a,m=d["".concat(l,".").concat(g)]||d[g]||p[g]||i;return o?n.createElement(m,r(r({ref:t},u),{},{components:o})):n.createElement(m,r({ref:t},u))}));function g(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=o.length,r=new Array(i);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var c=2;c<i;c++)r[c]=o[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},64877:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var n=o(87462),a=(o(67294),o(3905));const i={title:"Single Sign-Out (SSO Logout)",description:"Implement Single Sign-Out to log users out from all applications simultaneously",keywords:["SSO","Single Sign-Out","Logout","Session Management"],authors:["leo220yuyaodog"]},r=void 0,s={unversionedId:"session/single-sign-out",id:"session/single-sign-out",title:"Single Sign-Out (SSO Logout)",description:"Implement Single Sign-Out to log users out from all applications simultaneously",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/session/single-sign-out.md",sourceDirName:"session",slug:"/session/single-sign-out",permalink:"/fr/docs/session/single-sign-out",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/session/single-sign-out.md",tags:[],version:"current",frontMatter:{title:"Single Sign-Out (SSO Logout)",description:"Implement Single Sign-Out to log users out from all applications simultaneously",keywords:["SSO","Single Sign-Out","Logout","Session Management"],authors:["leo220yuyaodog"]},sidebar:"tutorialSidebar",previous:{title:"How to Enable Single Sign-On",permalink:"/fr/docs/session/single-sign-on"},next:{title:"Vue SDK",permalink:"/fr/docs/how-to-connect/vue-sdk"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"How SSO Logout Works",id:"how-sso-logout-works",level:2},{value:"Logout Notifications",id:"logout-notifications",level:3},{value:"Verifying Logout Notifications",id:"verifying-logout-notifications",level:4},{value:"Configuration",id:"configuration",level:4},{value:"SSO Logout API",id:"sso-logout-api",level:2},{value:"Endpoint",id:"endpoint",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Request Examples",id:"request-examples",level:3},{value:"Logout from All Sessions (Default)",id:"logout-from-all-sessions-default",level:4},{value:"Logout from Current Session Only",id:"logout-from-current-session-only",level:4},{value:"Using Session Cookie",id:"using-session-cookie",level:4},{value:"Using JavaScript Fetch API",id:"using-javascript-fetch-api",level:4},{value:"Response",id:"response",level:3},{value:"Implementing SSO Logout in Your Application",id:"implementing-sso-logout-in-your-application",level:2},{value:"Using Casdoor SDKs",id:"using-casdoor-sdks",level:3},{value:"Go SDK",id:"go-sdk",level:4},{value:"JavaScript SDK",id:"javascript-sdk",level:4},{value:"Python SDK",id:"python-sdk",level:4},{value:"Manual Implementation",id:"manual-implementation",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Clear Local State",id:"1-clear-local-state",level:3},{value:"2. Handle Logout Errors Gracefully",id:"2-handle-logout-errors-gracefully",level:3},{value:"3. Provide User Feedback",id:"3-provide-user-feedback",level:3},{value:"4. Implement Logout Timeout",id:"4-implement-logout-timeout",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"1. Verify Logout Notification Signatures",id:"1-verify-logout-notification-signatures",level:3},{value:"2. Check Notification Timestamp",id:"2-check-notification-timestamp",level:3},{value:"3. Secure Communication",id:"3-secure-communication",level:3},{value:"4. Token Validation",id:"4-token-validation",level:3},{value:"5. CSRF Protection",id:"5-csrf-protection",level:3},{value:"6. Protect Client Secrets",id:"6-protect-client-secrets",level:3},{value:"7. Audit Logging",id:"7-audit-logging",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Logout Not Working Across All Applications",id:"logout-not-working-across-all-applications",level:3},{value:"Token Still Valid After Logout",id:"token-still-valid-after-logout",level:3},{value:"Logout Endpoint Returns Error",id:"logout-endpoint-returns-error",level:3},{value:"Related Documentation",id:"related-documentation",level:2}],u={toc:c};function p(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Single Sign-Out (SSO Logout) is a feature that allows you to log a user out from all applications in an organization simultaneously. When a user logs out from one application, they are automatically logged out from all other applications that are part of the same SSO ecosystem."),(0,a.kt)("p",null,"This is particularly useful in scenarios such as:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Security incidents"),": Immediately terminate all active sessions when a security breach is detected"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Organization-wide logout policies"),": Enforce logout across all services when users leave the organization or change roles"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Compliance requirements"),": Ensure users are completely logged out from all systems when required by regulations"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"User-initiated logout"),": Allow users to log out from all applications with a single action")),(0,a.kt)("h2",{id:"how-sso-logout-works"},"How SSO Logout Works"),(0,a.kt)("p",null,"Casdoor supports two logout modes controlled by the ",(0,a.kt)("inlineCode",{parentName:"p"},"logoutAll")," parameter:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Full SSO Logout")," (default, when ",(0,a.kt)("inlineCode",{parentName:"p"},"logoutAll=true")," or not specified):"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Delete all active sessions"),": All active sessions for the user across all applications in the organization are terminated"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Expire all access tokens"),": All access tokens that were issued to the user are immediately invalidated"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Clear the current session"),": The user's current session and authentication state are cleared"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Send logout notifications"),": Notification providers receive the logout event with all session IDs and token hashes")),(0,a.kt)("p",null,"This ensures that the user is completely logged out from all integrated applications and cannot access any resources without re-authenticating."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Session-Level Logout")," (when ",(0,a.kt)("inlineCode",{parentName:"p"},"logoutAll=false"),"):"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Delete current session"),": Only the current session is terminated"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Clear current authentication state"),": The user's current session and token are cleared"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Send targeted notification"),": Notification providers receive the logout event with the current session ID and associated access token hashes")),(0,a.kt)("p",null,"This allows users to logout from a specific device or browser while remaining logged in on other sessions. This is useful when users share accounts across multiple devices or have concurrent sessions they want to manage individually."),(0,a.kt)("p",null,"The access token hashes included in session-level logout notifications enable your subsystems to identify exactly which tokens need to be invalidated. When a user logs out from a specific browser or device, you can match the token hashes against your active sessions and perform targeted invalidation without affecting other devices where the user remains logged in."),(0,a.kt)("h3",{id:"logout-notifications"},"Logout Notifications"),(0,a.kt)("p",null,"When SSO logout occurs, Casdoor automatically notifies all notification providers configured in the application where the user registered. The notifications include session IDs, access token hashes, and cryptographic signatures for secure, synchronized logout across all integrated systems."),(0,a.kt)("p",null,"Each notification provider receives a POST request with the following payload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "owner": "org-name",\n  "name": "username",\n  "displayName": "John Doe",\n  "email": "user@example.com",\n  "phone": "+1234567890",\n  "id": "user-id",\n  "event": "sso-logout",\n  "sessionIds": ["session-123", "session-456"],\n  "accessTokenHashes": ["hash-abc", "hash-def"],\n  "nonce": "random-nonce-xyz",\n  "timestamp": 1699900000,\n  "signature": "hmac-sha256-signature"\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Notification fields:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sessionIds"),": List of session IDs being logged out (enables targeted session invalidation)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"accessTokenHashes"),": SHA-256 hashes of access tokens being invalidated. Both full SSO logout and session-level logout now include these hashes, allowing your subsystems to match them against active tokens and perform synchronized logout"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"nonce"),": Random value for replay attack protection"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"timestamp"),": Unix timestamp when the notification was generated"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"signature"),": HMAC-SHA256 signature computed using the application's client secret")),(0,a.kt)("h4",{id:"verifying-logout-notifications"},"Verifying Logout Notifications"),(0,a.kt)("p",null,"To prevent malicious logout requests, you should verify the signature of incoming logout notifications:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'// Example verification in Go\nfunc verifyLogoutNotification(notification *SsoLogoutNotification, clientSecret string) bool {\n    data := fmt.Sprintf("%s|%s|%s|%d|%s|%s",\n        notification.Owner,\n        notification.Name,\n        notification.Nonce,\n        notification.Timestamp,\n        strings.Join(notification.SessionIds, ","),\n        strings.Join(notification.AccessTokenHashes, ","))\n    \n    expectedSignature := hmacSHA256(clientSecret, data)\n    return notification.Signature == expectedSignature\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// Example verification in JavaScript\nconst crypto = require('crypto');\n\nfunction verifyLogoutNotification(notification, clientSecret) {\n  const data = `${notification.owner}|${notification.name}|${notification.nonce}|${notification.timestamp}|${notification.sessionIds.join(',')}|${notification.accessTokenHashes.join(',')}`;\n  \n  const expectedSignature = crypto\n    .createHmac('sha256', clientSecret)\n    .update(data)\n    .digest('hex');\n  \n  return notification.signature === expectedSignature;\n}\n")),(0,a.kt)("h4",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"To receive logout notifications, configure a notification provider (such as Custom HTTP, Telegram, or Slack) in your Casdoor application's notification provider settings. For Custom HTTP providers:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Set ",(0,a.kt)("strong",{parentName:"li"},"Receiver")," to your application's webhook endpoint (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"https://app.example.com/api/logout-webhook"),")"),(0,a.kt)("li",{parentName:"ul"},"Set ",(0,a.kt)("strong",{parentName:"li"},"Method")," to POST"),(0,a.kt)("li",{parentName:"ul"},"Set ",(0,a.kt)("strong",{parentName:"li"},"Title")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"content")," (the parameter name for the JSON payload)")),(0,a.kt)("p",null,"Your application can then verify the signature, check the timestamp to prevent replay attacks, and use the session IDs and token hashes to perform targeted logout operations. For more details on configuring notification providers, see the ",(0,a.kt)("a",{parentName:"p",href:"/docs/provider/notification/overview"},"Notification Providers")," documentation."),(0,a.kt)("h2",{id:"sso-logout-api"},"SSO Logout API"),(0,a.kt)("h3",{id:"endpoint"},"Endpoint"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-http"},"GET or POST /api/sso-logout?logoutAll=<true|false>\n")),(0,a.kt)("p",null,"The SSO logout endpoint accepts both ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"POST")," requests, making it flexible for different integration scenarios."),(0,a.kt)("h3",{id:"parameters"},"Parameters"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"logoutAll")," (optional): Controls logout scope. Accepts ",(0,a.kt)("inlineCode",{parentName:"li"},"true"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"1"),", or empty string (default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true")," for backward compatibility)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"true")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"1")," or empty: Logout from all sessions across all applications"),(0,a.kt)("li",{parentName:"ul"},"Any other value (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"false"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"0"),"): Logout from current session only")))),(0,a.kt)("h3",{id:"authentication"},"Authentication"),(0,a.kt)("p",null,"This endpoint requires the user to be authenticated. You can use any of the authentication methods supported by Casdoor:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Access token"),": Include the access token in the ",(0,a.kt)("inlineCode",{parentName:"li"},"Authorization")," header"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Session cookie"),": Use the session cookie that was set during login"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Client credentials"),": Use the application's client ID and secret for machine-to-machine scenarios")),(0,a.kt)("p",null,"For more details on authentication methods, see the ",(0,a.kt)("a",{parentName:"p",href:"/docs/basic/public-api#how-to-authenticate-with-casdoor-public-api"},"Casdoor Public API")," documentation."),(0,a.kt)("h3",{id:"request-examples"},"Request Examples"),(0,a.kt)("h4",{id:"logout-from-all-sessions-default"},"Logout from All Sessions (Default)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST https://door.casdoor.com/api/sso-logout \\\n  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"\n\n# Or explicitly specify logoutAll=true\ncurl -X POST "https://door.casdoor.com/api/sso-logout?logoutAll=true" \\\n  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"\n')),(0,a.kt)("h4",{id:"logout-from-current-session-only"},"Logout from Current Session Only"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST "https://door.casdoor.com/api/sso-logout?logoutAll=false" \\\n  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"\n')),(0,a.kt)("h4",{id:"using-session-cookie"},"Using Session Cookie"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST https://door.casdoor.com/api/sso-logout \\\n  --cookie "casdoor_session_id=abc123def456"\n')),(0,a.kt)("h4",{id:"using-javascript-fetch-api"},"Using JavaScript Fetch API"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// Logout from all sessions\nfetch('https://door.casdoor.com/api/sso-logout', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${accessToken}`\n  },\n  credentials: 'include'\n})\n  .then(response => response.json())\n  .then(data => {\n    console.log('Logout successful:', data);\n    window.location.href = '/login';\n  })\n  .catch(error => {\n    console.error('Logout failed:', error);\n  });\n\n// Logout from current session only\nfetch('https://door.casdoor.com/api/sso-logout?logoutAll=false', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${accessToken}`\n  },\n  credentials: 'include'\n})\n  .then(response => response.json())\n  .then(data => {\n    console.log('Logged out from current session:', data);\n    window.location.href = '/login';\n  });\n")),(0,a.kt)("h3",{id:"response"},"Response"),(0,a.kt)("p",null,"The API returns a standard Casdoor response:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "ok",\n  "msg": "",\n  "data": ""\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Response Fields:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"status"),": Indicates whether the operation was successful (",(0,a.kt)("inlineCode",{parentName:"li"},'"ok"'),") or failed (",(0,a.kt)("inlineCode",{parentName:"li"},'"error"'),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"msg"),": Contains an error message if the operation failed, otherwise empty"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"data"),": Additional data returned by the API, typically empty for logout operations")),(0,a.kt)("h2",{id:"implementing-sso-logout-in-your-application"},"Implementing SSO Logout in Your Application"),(0,a.kt)("h3",{id:"using-casdoor-sdks"},"Using Casdoor SDKs"),(0,a.kt)("p",null,"Most Casdoor SDKs provide built-in support for SSO logout. Here are examples for different platforms:"),(0,a.kt)("h4",{id:"go-sdk"},"Go SDK"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/casdoor/casdoor-go-sdk/casdoorsdk"\n\nfunc logout(w http.ResponseWriter, r *http.Request) {\n    // Get the access token from the session or request\n    token := getAccessTokenFromSession(r)\n    \n    // Call the SSO logout endpoint\n    err := casdoorsdk.Logout(token)\n    if err != nil {\n        http.Error(w, "Logout failed", http.StatusInternalServerError)\n        return\n    }\n    \n    // Clear local session\n    clearSession(w, r)\n    \n    // Redirect to login page\n    http.Redirect(w, r, "/login", http.StatusFound)\n}\n')),(0,a.kt)("h4",{id:"javascript-sdk"},"JavaScript SDK"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'import Sdk from "casdoor-js-sdk";\n\nconst CasdoorSDK = new Sdk({\n  serverUrl: "https://door.casdoor.com",\n  clientId: "YOUR_CLIENT_ID",\n  appName: "YOUR_APP_NAME",\n  organizationName: "YOUR_ORG_NAME",\n});\n\nasync function handleLogout() {\n  try {\n    // Call the SSO logout endpoint\n    await CasdoorSDK.logout();\n    \n    // Clear local state\n    localStorage.removeItem(\'casdoor_token\');\n    sessionStorage.clear();\n    \n    // Redirect to login page\n    window.location.href = \'/login\';\n  } catch (error) {\n    console.error(\'Logout failed:\', error);\n  }\n}\n')),(0,a.kt)("h4",{id:"python-sdk"},"Python SDK"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from casdoor import CasdoorSDK\n\nsdk = CasdoorSDK(\n    endpoint="https://door.casdoor.com",\n    client_id="YOUR_CLIENT_ID",\n    client_secret="YOUR_CLIENT_SECRET",\n    certificate="YOUR_CERT",\n    org_name="YOUR_ORG_NAME",\n    app_name="YOUR_APP_NAME",\n)\n\ndef logout(access_token):\n    try:\n        # Call the SSO logout endpoint\n        result = sdk.logout(access_token)\n        \n        if result[\'status\'] == \'ok\':\n            # Clear local session\n            clear_session()\n            return True\n        else:\n            print(f"Logout failed: {result[\'msg\']}")\n            return False\n    except Exception as e:\n        print(f"Logout error: {e}")\n        return False\n')),(0,a.kt)("h3",{id:"manual-implementation"},"Manual Implementation"),(0,a.kt)("p",null,"If you're not using a Casdoor SDK, you can implement SSO logout manually by making an HTTP request to the logout endpoint:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"async function logout() {\n  const accessToken = localStorage.getItem('access_token');\n  \n  try {\n    // Use the full Casdoor server URL in your application\n    const response = await fetch('https://door.casdoor.com/api/sso-logout', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n        'Content-Type': 'application/json'\n      },\n      credentials: 'include'\n    });\n    \n    const result = await response.json();\n    \n    if (result.status === 'ok') {\n      // Clear local storage\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('user_info');\n      sessionStorage.clear();\n      \n      // Redirect to login page\n      window.location.href = '/login';\n    } else {\n      console.error('Logout failed:', result.msg);\n    }\n  } catch (error) {\n    console.error('Logout error:', error);\n  }\n}\n")),(0,a.kt)("h2",{id:"best-practices"},"Best Practices"),(0,a.kt)("h3",{id:"1-clear-local-state"},"1. Clear Local State"),(0,a.kt)("p",null,"After calling the SSO logout endpoint, make sure to clear all local authentication state:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Remove access tokens from local storage or session storage"),(0,a.kt)("li",{parentName:"ul"},"Clear any cached user information"),(0,a.kt)("li",{parentName:"ul"},"Invalidate any local session cookies"),(0,a.kt)("li",{parentName:"ul"},"Reset application state to the logged-out state")),(0,a.kt)("h3",{id:"2-handle-logout-errors-gracefully"},"2. Handle Logout Errors Gracefully"),(0,a.kt)("p",null,"Even if the SSO logout endpoint fails, you should still clear local authentication state to ensure the user appears logged out from your application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"async function logout() {\n  try {\n    await callSSOLogout();\n  } catch (error) {\n    console.error('SSO logout failed, clearing local state anyway:', error);\n  } finally {\n    // Always clear local state\n    clearLocalAuthenticationState();\n    redirectToLogin();\n  }\n}\n")),(0,a.kt)("h3",{id:"3-provide-user-feedback"},"3. Provide User Feedback"),(0,a.kt)("p",null,"Give users clear feedback about the logout process:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"async function logout() {\n  // Show loading indicator\n  showLoadingIndicator('Logging out...');\n  \n  try {\n    await callSSOLogout();\n    showSuccessMessage('Logged out successfully');\n  } catch (error) {\n    showErrorMessage('Logout failed, but you have been logged out locally');\n  } finally {\n    clearLocalAuthenticationState();\n    // Redirect after a short delay to allow users to see the message\n    setTimeout(() => redirectToLogin(), 1000);\n  }\n}\n")),(0,a.kt)("h3",{id:"4-implement-logout-timeout"},"4. Implement Logout Timeout"),(0,a.kt)("p",null,"Set a reasonable timeout for the logout request to prevent users from waiting indefinitely:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"async function logout() {\n  const timeout = 5000; // 5 seconds\n  \n  try {\n    await Promise.race([\n      callSSOLogout(),\n      new Promise((_, reject) => \n        setTimeout(() => reject(new Error('Logout timeout')), timeout)\n      )\n    ]);\n  } catch (error) {\n    console.error('Logout error:', error);\n  } finally {\n    clearLocalAuthenticationState();\n    redirectToLogin();\n  }\n}\n")),(0,a.kt)("h2",{id:"security-considerations"},"Security Considerations"),(0,a.kt)("h3",{id:"1-verify-logout-notification-signatures"},"1. Verify Logout Notification Signatures"),(0,a.kt)("p",null,"Always verify the HMAC-SHA256 signature of logout notifications to prevent malicious logout requests. The signature is computed using your application's client secret and includes all critical fields (owner, name, nonce, timestamp, sessionIds, accessTokenHashes). Reject any notification with an invalid signature."),(0,a.kt)("h3",{id:"2-check-notification-timestamp"},"2. Check Notification Timestamp"),(0,a.kt)("p",null,"Implement timestamp validation to prevent replay attacks. Reject notifications that are too old (e.g., more than 5 minutes old):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"function isNotificationValid(notification) {\n  const maxAge = 5 * 60 * 1000; // 5 minutes in milliseconds\n  const now = Date.now();\n  const notificationTime = notification.timestamp * 1000; // Convert to milliseconds\n  \n  if (now - notificationTime > maxAge) {\n    console.error('Notification is too old, possible replay attack');\n    return false;\n  }\n  \n  return verifyLogoutNotification(notification, clientSecret);\n}\n")),(0,a.kt)("h3",{id:"3-secure-communication"},"3. Secure Communication"),(0,a.kt)("p",null,"Always use HTTPS when calling the SSO logout endpoint to prevent token interception:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u2705 Good: Uses HTTPS\nconst logoutUrl = 'https://door.casdoor.com/api/sso-logout';\n\n// \u274c Bad: Uses HTTP (insecure)\nconst logoutUrl = 'http://door.casdoor.com/api/sso-logout';\n")),(0,a.kt)("h3",{id:"4-token-validation"},"4. Token Validation"),(0,a.kt)("p",null,"Casdoor validates the access token before processing the logout request. Ensure your token is valid and has not expired before making the logout call."),(0,a.kt)("h3",{id:"5-csrf-protection"},"5. CSRF Protection"),(0,a.kt)("p",null,"When using session cookies for authentication, ensure CSRF protection is enabled to prevent unauthorized logout requests:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// Include CSRF token in the request headers\n// Replace with your actual Casdoor server URL\nfetch('https://door.casdoor.com/api/sso-logout', {\n  method: 'POST',\n  headers: {\n    'X-CSRF-Token': getCsrfToken()\n  },\n  credentials: 'include'\n});\n")),(0,a.kt)("h3",{id:"6-protect-client-secrets"},"6. Protect Client Secrets"),(0,a.kt)("p",null,"Keep your application's client secret secure. It's used to sign logout notifications, so if compromised, attackers could forge valid logout requests. Store it securely (e.g., in environment variables or secret management systems) and never expose it in client-side code."),(0,a.kt)("h3",{id:"7-audit-logging"},"7. Audit Logging"),(0,a.kt)("p",null,"Consider logging logout events for security auditing and compliance:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'func logout(userID string, token string) error {\n    // Call SSO logout\n    err := casdoorsdk.Logout(token)\n    \n    // Log the logout event\n    auditLog.Info(map[string]interface{}{\n        "event": "sso_logout",\n        "user_id": userID,\n        "timestamp": time.Now(),\n        "success": err == nil,\n    })\n    \n    return err\n}\n')),(0,a.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("h3",{id:"logout-not-working-across-all-applications"},"Logout Not Working Across All Applications"),(0,a.kt)("p",null,"If users remain logged in to some applications after SSO logout:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Verify application integration"),": Ensure all applications are properly integrated with Casdoor and use the same organization"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Check token validation"),": Make sure all applications validate tokens on each request"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Review session management"),": Applications should not rely solely on local sessions; they must validate tokens with Casdoor")),(0,a.kt)("h3",{id:"token-still-valid-after-logout"},"Token Still Valid After Logout"),(0,a.kt)("p",null,"If access tokens or refresh tokens remain valid after logout:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Verify the logout endpoint"),": Ensure you're calling the correct endpoint (",(0,a.kt)("inlineCode",{parentName:"li"},"/api/sso-logout"),")"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Check authentication"),": Make sure you're sending valid authentication credentials with the logout request"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Review token caching"),": Ensure applications don't cache token validation results")),(0,a.kt)("p",null,"After SSO logout, both access tokens and refresh tokens are invalidated. The token records remain in the database with ",(0,a.kt)("inlineCode",{parentName:"p"},"ExpiresIn")," set to 0, but Casdoor's token introspection and refresh token endpoints will reject them. When a client attempts to use a refresh token after logout, they'll receive an ",(0,a.kt)("inlineCode",{parentName:"p"},"invalid_grant"),' error with the message "refresh token is invalid, expired or revoked". This ensures complete session termination and prevents token reuse even if the token hasn\'t reached its original expiration time.'),(0,a.kt)("h3",{id:"logout-endpoint-returns-error"},"Logout Endpoint Returns Error"),(0,a.kt)("p",null,"Common error scenarios:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"401 Unauthorized"),": The access token is invalid or expired. Clear local state and redirect to login."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"403 Forbidden"),": The user doesn't have permission to logout. This is rare and may indicate a configuration issue."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"500 Internal Server Error"),": Server-side error. Log the error and clear local state anyway.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"async function logout() {\n  try {\n    // Replace with your actual Casdoor server URL\n    const response = await fetch('https://door.casdoor.com/api/sso-logout', {\n      method: 'POST',\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    \n    if (!response.ok) {\n      console.error(`Logout failed with status: ${response.status}`);\n      // Clear local state anyway\n    }\n  } catch (error) {\n    console.error('Logout error:', error);\n  } finally {\n    clearLocalAuthenticationState();\n    redirectToLogin();\n  }\n}\n")),(0,a.kt)("h2",{id:"related-documentation"},"Related Documentation"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/session/single-sign-on"},"Single Sign-On (SSO)"),": Learn how to enable SSO for your applications"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/basic/public-api"},"Casdoor Public API"),": Complete API reference including authentication methods"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/token/overview"},"Tokens"),": Understand how Casdoor manages access tokens and sessions"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/how-to-connect/oauth"},"OAuth 2.0"),": Learn about OAuth 2.0 flows supported by Casdoor")))}p.isMDXComponent=!0}}]);