"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[6054],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(r),m=n,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return r?a.createElement(g,i(i({ref:t},c),{},{components:r})):a.createElement(g,i({ref:t},c))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3861:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=r(87462),n=(r(67294),r(3905));const o={title:"WeChat MiniProgram",description:"Utilisation de Casdoor dans WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},i=void 0,s={unversionedId:"integration/javascript/wechat_miniprogram",id:"integration/javascript/wechat_miniprogram",title:"WeChat MiniProgram",description:"Utilisation de Casdoor dans WeChat MiniProgram",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/integration/javascript/wechat_miniprogram.md",sourceDirName:"integration/javascript",slug:"/integration/javascript/wechat_miniprogram",permalink:"/fr/docs/integration/javascript/wechat_miniprogram",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/javascript/wechat_miniprogram.md",tags:[],version:"current",frontMatter:{title:"WeChat MiniProgram",description:"Utilisation de Casdoor dans WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Firebase",permalink:"/fr/docs/integration/javascript/firebase"},next:{title:"Lua",permalink:"/fr/docs/category/lua"}},l={},p=[{value:"Introduction",id:"introduction",level:2},{value:"\xc9tape 1 : D\xe9ployer Casdoor",id:"\xe9tape-1--d\xe9ployer-casdoor",level:2},{value:"\xc9tape 2 : Configurer l&#39;application Casdoor",id:"\xe9tape-2--configurer-lapplication-casdoor",level:2},{value:"\xc9tape 3 : \xc9crire le code WeChat MiniProgram",id:"\xe9tape-3--\xe9crire-le-code-wechat-miniprogram",level:2}],c={toc:p};function u(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Casdoor prend d\xe9sormais en charge WeChat Mini Program \xe0 partir de la version 1.41.0.")),(0,n.kt)("h2",{id:"introduction"},"Introduction"),(0,n.kt)("p",null,"Comme WeChat Mini Program ne prend pas en charge OAuth standardis\xe9, il ne peut pas rediriger vers la page Web auto-h\xe9berg\xe9e de Casdoor pour la connexion. Par cons\xe9quent, le processus d'utilisation de Casdoor pour WeChat Mini Program est diff\xe9rent de celui des programmes r\xe9guliers."),(0,n.kt)("p",null,"Ce document expliquera comment int\xe9grer Casdoor dans WeChat Mini Program. Vous pouvez trouver un exemple pour cette int\xe9gration sur GitHub ici : ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-wechat-miniprogram-example"},"casdoor-wechat-miniprogram-example"),". Pour plus d'informations d\xe9taill\xe9es, veuillez vous r\xe9f\xe9rer au document de connexion de WeChat Mini Program ",(0,n.kt)("a",{parentName:"p",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html"},"login document"),"."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"La configuration comprend les noms suivants :"),(0,n.kt)("p",{parentName:"blockquote"},(0,n.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME")," : Le nom de domaine ou l'adresse IP o\xf9 le serveur Casdoor est d\xe9ploy\xe9, par exemple, ",(0,n.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),".")),(0,n.kt)("h2",{id:"\xe9tape-1--d\xe9ployer-casdoor"},"\xc9tape 1 : D\xe9ployer Casdoor"),(0,n.kt)("p",null,"Tout d'abord, le ",(0,n.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"serveur Casdoor")," doit \xeatre d\xe9ploy\xe9."),(0,n.kt)("p",null,"Apr\xe8s avoir d\xe9ploy\xe9 avec succ\xe8s Casdoor, vous devez vous assurer que :"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Casdoor peut \xeatre acc\xe9d\xe9 et utilis\xe9 normalement."),(0,n.kt)("li",{parentName:"ol"},"D\xe9finissez la valeur ",(0,n.kt)("inlineCode",{parentName:"li"},"origin")," de Casdoor (conf/app.conf) sur ",(0,n.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,n.kt)("img",{alt:"Configuration de Casdoor",src:r(66496).Z,width:"1013",height:"448"}))),(0,n.kt)("h2",{id:"\xe9tape-2--configurer-lapplication-casdoor"},"\xc9tape 2 : Configurer l'application Casdoor"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Cr\xe9ez un IDP WeChat dans Casdoor et fournissez le ",(0,n.kt)("inlineCode",{parentName:"li"},"APPID")," et le ",(0,n.kt)("inlineCode",{parentName:"li"},"APPSECRET")," qui vous ont \xe9t\xe9 donn\xe9s par la plateforme de d\xe9veloppement de WeChat Mini Program. ",(0,n.kt)("img",{alt:"WeChat_MiniProgram.png",src:r(72503).Z,width:"937",height:"773"})),(0,n.kt)("li",{parentName:"ol"},"Cr\xe9ez une nouvelle application Casdoor ou utilisez-en une existante."),(0,n.kt)("li",{parentName:"ol"},"Ajoutez l'IDP cr\xe9\xe9 \xe0 l'\xe9tape pr\xe9c\xe9dente \xe0 l'application que vous souhaitez utiliser.")),(0,n.kt)("admonition",{title:"Tips",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Pour plus de commodit\xe9, Casdoor traitera par d\xe9faut le premier IDP de type WeChat dans l'application comme l'IDP WeChat Mini Program."),(0,n.kt)("p",{parentName:"admonition"},"Par cons\xe9quent, si vous souhaitez utiliser WeChat Mini Program dans cette application, n'ajoutez pas plusieurs IDP de type WeChat dans une seule application.")),(0,n.kt)("h2",{id:"\xe9tape-3--\xe9crire-le-code-wechat-miniprogram"},"\xc9tape 3 : \xc9crire le code WeChat MiniProgram"),(0,n.kt)("p",null,"WeChat Mini Program fournit une API pour se connecter en interne et obtenir le code. Le code doit ensuite \xeatre envoy\xe9 \xe0 Casdoor. Casdoor utilisera ce code pour r\xe9cup\xe9rer des informations (telles que OpenID et SessionKey) du serveur WeChat."),(0,n.kt)("p",null,"Le code suivant montre comment accomplir le processus ci-dessus :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'// Login in mini program\nwx.login({\n  success: res => {\n    // This is the login code that needs to be sent to Casdoor\n    console.log(res.code)\n\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/login/oauth/access_token`,\n      method: "POST",\n      data: {\n        "tag": "wechat_miniprogram", // Required\n        "client_id": "6825f4f0af45554c8952",\n        "code": res.code,\n        "username": this.data.userInfo.nickName, // Update user profile when you log in.\n        "avatar": this.data.userInfo.avatarUrl,\n      },\n      header:{\n        "content-type": "application/x-www-form-urlencoded",\n      },\n      success: res => {\n        console.log(res)\n        this.globalData.accessToken = res.data.access_token // Get Casdoor\'s access token\n      }\n    })\n  }\n})\n')),(0,n.kt)("p",null,"Il est important de noter que le param\xe8tre ",(0,n.kt)("inlineCode",{parentName:"p"},"tag")," est obligatoire pour informer Casdoor qu'il s'agit d'une demande de WeChat Mini Program."),(0,n.kt)("p",null,"Le code ci-dessus inclut le nom d'utilisateur et l'URI de l'avatar de l'utilisateur WeChat Mini Program lors de la connexion. Vous pouvez choisir de passer ces deux param\xe8tres s\xe9par\xe9ment, puis de les transmettre \xe0 Casdoor apr\xe8s une connexion r\xe9ussie et l'obtention du jeton d'acc\xe8s :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'wx.getUserProfile({\n  desc: \'share your info to Casdoor\', \n  success: (res) => {\n    this.setData({\n      userInfo: res.userInfo,\n      hasUserInfo: true\n    })\n    console.log(app.globalData.accessToken)\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/update-user`, // Casdoor URL\n      method: "POST",\n      data: {\n        "owner": "test",\n        "name": "wechat-oGk3T5tIiMFo3SazCO75f0HEiE7Q",\n        "displayName": this.data.userInfo.nickName,\n        "avatar": this.data.userInfo.avatarUrl\n      },\n      header: {\n        "Authorization": "Bearer " + app.globalData.accessToken, // Bearer token\n        "content-type": "application/json"\n      },\n      success: (res) => {\n        console.log(res)\n      }\n    })\n  }\n})\n')),(0,n.kt)("p",null,"De plus, vous pouvez utiliser le jeton d'acc\xe8s comme un jeton porteur pour toute op\xe9ration Casdoor dont vous avez besoin."),(0,n.kt)("admonition",{title:"Tips",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Actuellement, Casdoor est incapable de lier des comptes existants aux utilisateurs de WeChat Mini Program. Apr\xe8s que Casdoor ait r\xe9cup\xe9r\xe9 l'OpenID de WeChat, il cr\xe9era soit un nouvel utilisateur si l'ID n'existe pas, soit utilisera l'utilisateur existant s'il existe.")))}u.isMDXComponent=!0},66496:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},72503:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/WeChat_MiniProgram-701cc38162bc50d472b5226e5f167e3c.png"}}]);