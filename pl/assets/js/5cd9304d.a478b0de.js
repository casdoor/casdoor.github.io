"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[3426],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),p=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(a),m=n,k=c["".concat(s,".").concat(m)]||c[m]||u[m]||o;return a?r.createElement(k,i(i({ref:t},d),{},{components:a})):r.createElement(k,i({ref:t},d))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}c.displayName="MDXCreateElement"},5282:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=a(87462),n=(a(67294),a(3905));const o={title:"Traefik",description:"Using Casdoor for authentication with Traefik reverse proxy",keywords:["Traefik","middleware","authentication"],authors:["casdoor"]},i=void 0,l={unversionedId:"integration/go/traefik",id:"integration/go/traefik",title:"Traefik",description:"Using Casdoor for authentication with Traefik reverse proxy",source:"@site/docs/integration/go/traefik.md",sourceDirName:"integration/go",slug:"/integration/go/traefik",permalink:"/pl/docs/integration/go/traefik",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/go/traefik.md",tags:[],version:"current",frontMatter:{title:"Traefik",description:"Using Casdoor for authentication with Traefik reverse proxy",keywords:["Traefik","middleware","authentication"],authors:["casdoor"]},sidebar:"tutorialSidebar",previous:{title:"MinIO",permalink:"/pl/docs/integration/go/minio"},next:{title:"Portainer",permalink:"/pl/docs/integration/go/portainer"}},s={},p=[{value:"Using Casdoor for authentication with Traefik",id:"using-casdoor-for-authentication-with-traefik",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Deploy Casdoor",id:"step-1-deploy-casdoor",level:2},{value:"Step 2: Configure Casdoor Application",id:"step-2-configure-casdoor-application",level:2},{value:"Step 3: Deploy traefik-casdoor-auth Middleware",id:"step-3-deploy-traefik-casdoor-auth-middleware",level:2},{value:"Option 1: Using Docker Compose (Recommended)",id:"option-1-using-docker-compose-recommended",level:3},{value:"Option 2: Using Binary Deployment",id:"option-2-using-binary-deployment",level:3},{value:"Step 4: Test the Integration",id:"step-4-test-the-integration",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Using HTTPS",id:"using-https",level:3},{value:"Customizing Session Behavior",id:"customizing-session-behavior",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Redirect Loop",id:"redirect-loop",level:3},{value:"Authentication Fails",id:"authentication-fails",level:3},{value:"502 Bad Gateway",id:"502-bad-gateway",level:3},{value:"Resources",id:"resources",level:2}],d={toc:p};function u(e){let{components:t,...o}=e;return(0,n.kt)("wrapper",(0,r.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"using-casdoor-for-authentication-with-traefik"},"Using Casdoor for authentication with Traefik"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://traefik.io/"},"Traefik")," is a modern HTTP reverse proxy and load balancer that makes deploying microservices easy. This document shows how to use Casdoor as an authentication provider with Traefik using the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casdoor/traefik-casdoor-auth"},"traefik-casdoor-auth")," middleware."),(0,n.kt)("p",null,"The Traefik Casdoor Auth middleware allows you to protect your services behind Traefik with Casdoor authentication, providing a seamless Single Sign-On (SSO) experience."),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"Before you begin, ensure you have:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Traefik v2.x or v3.x installed and running"),(0,n.kt)("li",{parentName:"ul"},"A Casdoor instance deployed and accessible"),(0,n.kt)("li",{parentName:"ul"},"Docker and Docker Compose (if using the containerized approach)")),(0,n.kt)("h2",{id:"step-1-deploy-casdoor"},"Step 1: Deploy Casdoor"),(0,n.kt)("p",null,"First, deploy Casdoor if you haven't already."),(0,n.kt)("p",null,"You can refer to the Casdoor official documentation for ",(0,n.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Server Installation"),"."),(0,n.kt)("p",null,"After a successful deployment, make sure that:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"The Casdoor server is running and accessible"),(0,n.kt)("li",{parentName:"ul"},"You can log in to the Casdoor admin interface"),(0,n.kt)("li",{parentName:"ul"},"Test the login functionality by entering ",(0,n.kt)("inlineCode",{parentName:"li"},"admin")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"123"))),(0,n.kt)("h2",{id:"step-2-configure-casdoor-application"},"Step 2: Configure Casdoor Application"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create a new Casdoor application or use an existing one.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Add your redirect URL. The redirect URL should be in the format:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-text"},"http://<your-domain>/callback\n")),(0,n.kt)("p",{parentName:"li"},"For example: ",(0,n.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/callback"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Note down the following values from your application settings:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Client ID")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Client Secret")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Organization Name")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Application Name"))))),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Casdoor Application Setting",src:a(92116).Z,width:"866",height:"291"})),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Configure your application to use the appropriate authentication providers as needed.")),(0,n.kt)("h2",{id:"step-3-deploy-traefik-casdoor-auth-middleware"},"Step 3: Deploy traefik-casdoor-auth Middleware"),(0,n.kt)("p",null,"There are two ways to deploy the Traefik Casdoor Auth middleware:"),(0,n.kt)("h3",{id:"option-1-using-docker-compose-recommended"},"Option 1: Using Docker Compose (Recommended)"),(0,n.kt)("p",null,"Create a ",(0,n.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'3\'\n\nservices:\n  traefik:\n    image: traefik:v2.10\n    container_name: traefik\n    restart: unless-stopped\n    command:\n      - "--api.insecure=true"\n      - "--providers.docker=true"\n      - "--providers.docker.exposedbydefault=false"\n      - "--entrypoints.web.address=:80"\n    ports:\n      - "80:80"\n      - "8080:8080"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n    networks:\n      - traefik-network\n\n  casdoor-auth:\n    image: casbin/traefik-casdoor-auth:latest\n    container_name: casdoor-auth\n    restart: unless-stopped\n    environment:\n      - CASDOOR_ENDPOINT=http://localhost:8000\n      - CLIENT_ID=<your-client-id>\n      - CLIENT_SECRET=<your-client-secret>\n      - CASDOOR_ORGANIZATION=<your-organization>\n      - CASDOOR_APPLICATION=<your-application>\n      - CALLBACK_URL=http://localhost/callback\n    labels:\n      - "traefik.enable=true"\n      - "traefik.http.middlewares.casdoor-auth.forwardauth.address=http://casdoor-auth:8080/verify"\n      - "traefik.http.middlewares.casdoor-auth.forwardauth.authResponseHeaders=X-Forwarded-User"\n    networks:\n      - traefik-network\n\n  # Example protected service\n  whoami:\n    image: traefik/whoami\n    container_name: whoami\n    labels:\n      - "traefik.enable=true"\n      - "traefik.http.routers.whoami.rule=Host(`localhost`)"\n      - "traefik.http.routers.whoami.entrypoints=web"\n      - "traefik.http.routers.whoami.middlewares=casdoor-auth@docker"\n    networks:\n      - traefik-network\n\nnetworks:\n  traefik-network:\n    driver: bridge\n')),(0,n.kt)("p",null,"Replace the placeholder values:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"<your-client-id>"),": Your Casdoor application client ID"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"<your-client-secret>"),": Your Casdoor application client secret"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"<your-organization>"),": Your Casdoor organization name"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"<your-application>"),": Your Casdoor application name")),(0,n.kt)("p",null,"Start the services:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose up -d\n")),(0,n.kt)("h3",{id:"option-2-using-binary-deployment"},"Option 2: Using Binary Deployment"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Download the latest release from the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casdoor/traefik-casdoor-auth/releases"},"traefik-casdoor-auth releases page"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create a configuration file ",(0,n.kt)("inlineCode",{parentName:"p"},"config.yaml"),":"))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'casdoor:\n  endpoint: "http://localhost:8000"\n  clientId: "<your-client-id>"\n  clientSecret: "<your-client-secret>"\n  organizationName: "<your-organization>"\n  applicationName: "<your-application>"\n\nserver:\n  port: 8080\n  callbackUrl: "http://localhost/callback"\n')),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Run the middleware:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./traefik-casdoor-auth --config config.yaml\n")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Configure Traefik to use the middleware. Add to your Traefik dynamic configuration:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'http:\n  middlewares:\n    casdoor-auth:\n      forwardAuth:\n        address: "http://localhost:8080/verify"\n        authResponseHeaders:\n          - "X-Forwarded-User"\n\n  routers:\n    my-protected-service:\n      rule: "Host(`example.com`)"\n      middlewares:\n        - casdoor-auth\n      service: my-service\n')),(0,n.kt)("h2",{id:"step-4-test-the-integration"},"Step 4: Test the Integration"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Access your protected service through Traefik (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"http://localhost")," if using the Docker Compose example).")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"You should be redirected to the Casdoor login page.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Log in with your Casdoor credentials.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"After successful authentication, you will be redirected back to your protected service.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The middleware will set the ",(0,n.kt)("inlineCode",{parentName:"p"},"X-Forwarded-User")," header with the authenticated user's information, which your backend service can use."))),(0,n.kt)("h2",{id:"configuration-options"},"Configuration Options"),(0,n.kt)("p",null,"The traefik-casdoor-auth middleware supports the following environment variables:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Variable"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"),(0,n.kt)("th",{parentName:"tr",align:null},"Required"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"CASDOOR_ENDPOINT")),(0,n.kt)("td",{parentName:"tr",align:null},"URL of your Casdoor instance"),(0,n.kt)("td",{parentName:"tr",align:null},"Yes")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"CLIENT_ID")),(0,n.kt)("td",{parentName:"tr",align:null},"Casdoor application client ID"),(0,n.kt)("td",{parentName:"tr",align:null},"Yes")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"CLIENT_SECRET")),(0,n.kt)("td",{parentName:"tr",align:null},"Casdoor application client secret"),(0,n.kt)("td",{parentName:"tr",align:null},"Yes")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"CASDOOR_ORGANIZATION")),(0,n.kt)("td",{parentName:"tr",align:null},"Casdoor organization name"),(0,n.kt)("td",{parentName:"tr",align:null},"Yes")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"CASDOOR_APPLICATION")),(0,n.kt)("td",{parentName:"tr",align:null},"Casdoor application name"),(0,n.kt)("td",{parentName:"tr",align:null},"Yes")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"CALLBACK_URL")),(0,n.kt)("td",{parentName:"tr",align:null},"OAuth callback URL"),(0,n.kt)("td",{parentName:"tr",align:null},"Yes")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"JWT_SECRET")),(0,n.kt)("td",{parentName:"tr",align:null},"Secret for JWT token signing (auto-generated if not set)"),(0,n.kt)("td",{parentName:"tr",align:null},"No")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"SESSION_TIMEOUT")),(0,n.kt)("td",{parentName:"tr",align:null},"Session timeout in seconds (default: 3600)"),(0,n.kt)("td",{parentName:"tr",align:null},"No")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"LOG_LEVEL")),(0,n.kt)("td",{parentName:"tr",align:null},"Logging level: debug, info, warn, error (default: info)"),(0,n.kt)("td",{parentName:"tr",align:null},"No")))),(0,n.kt)("h2",{id:"advanced-configuration"},"Advanced Configuration"),(0,n.kt)("h3",{id:"using-https"},"Using HTTPS"),(0,n.kt)("p",null,"For production deployments, it's recommended to use HTTPS. Update your Traefik configuration to include TLS:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  traefik:\n    command:\n      - "--entrypoints.web.address=:80"\n      - "--entrypoints.websecure.address=:443"\n      - "--certificatesresolvers.myresolver.acme.tlschallenge=true"\n      - "--certificatesresolvers.myresolver.acme.email=your-email@example.com"\n      - "--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"\n    ports:\n      - "80:80"\n      - "443:443"\n    volumes:\n      - ./letsencrypt:/letsencrypt\n')),(0,n.kt)("p",null,"And update your service router configuration:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'labels:\n  - "traefik.http.routers.whoami.entrypoints=websecure"\n  - "traefik.http.routers.whoami.tls.certresolver=myresolver"\n')),(0,n.kt)("h3",{id:"customizing-session-behavior"},"Customizing Session Behavior"),(0,n.kt)("p",null,"You can customize session timeout and other behaviors:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"environment:\n  - SESSION_TIMEOUT=7200  # 2 hours\n  - LOG_LEVEL=debug\n")),(0,n.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,n.kt)("h3",{id:"redirect-loop"},"Redirect Loop"),(0,n.kt)("p",null,"If you experience a redirect loop:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Verify that the ",(0,n.kt)("inlineCode",{parentName:"li"},"CALLBACK_URL")," matches the redirect URL configured in your Casdoor application."),(0,n.kt)("li",{parentName:"ol"},"Check that cookies are enabled in your browser."),(0,n.kt)("li",{parentName:"ol"},"Ensure the middleware can reach the Casdoor endpoint.")),(0,n.kt)("h3",{id:"authentication-fails"},"Authentication Fails"),(0,n.kt)("p",null,"If authentication fails:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Check that the ",(0,n.kt)("inlineCode",{parentName:"li"},"CLIENT_ID")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"CLIENT_SECRET")," are correct."),(0,n.kt)("li",{parentName:"ol"},"Verify that the Casdoor organization and application names are correct."),(0,n.kt)("li",{parentName:"ol"},"Check the middleware logs for detailed error messages: ",(0,n.kt)("inlineCode",{parentName:"li"},"docker logs casdoor-auth"))),(0,n.kt)("h3",{id:"502-bad-gateway"},"502 Bad Gateway"),(0,n.kt)("p",null,"If you see a 502 error:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Ensure the casdoor-auth service is running: ",(0,n.kt)("inlineCode",{parentName:"li"},"docker ps")),(0,n.kt)("li",{parentName:"ol"},"Check that all services are on the same Docker network."),(0,n.kt)("li",{parentName:"ol"},"Verify the ForwardAuth address is correct in the Traefik configuration.")),(0,n.kt)("h2",{id:"resources"},"Resources"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/casdoor/traefik-casdoor-auth"},"Traefik Casdoor Auth GitHub Repository")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://doc.traefik.io/traefik/middlewares/http/forwardauth/"},"Traefik ForwardAuth Middleware Documentation")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/overview"},"Casdoor Documentation"))))}u.isMDXComponent=!0},92116:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/appsetting_spring_security-f2662d02db2032cea21f3b39b03b6c60.png"}}]);