"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4308],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>u});var i=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=i.createContext({}),d=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=d(e.components);return i.createElement(s.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},c=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=d(t),u=a,m=c["".concat(s,".").concat(u)]||c[u]||k[u]||r;return t?i.createElement(m,l(l({ref:n},p),{},{components:t})):i.createElement(m,l({ref:n},p))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=c;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var d=2;d<r;d++)l[d]=t[d];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}c.displayName="MDXCreateElement"},34222:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var i=t(87462),a=(t(67294),t(3905));const r={title:"Keycloak",description:"Keycloak zur Authentifizierung von Benutzern verwenden",keywords:["Keycloak"],authors:["seriouszyx"]},l=void 0,o={unversionedId:"provider/saml/keycloak",id:"provider/saml/keycloak",title:"Keycloak",description:"Keycloak zur Authentifizierung von Benutzern verwenden",source:"@site/i18n/de/docusaurus-plugin-content-docs/current/provider/saml/keycloak.md",sourceDirName:"provider/saml",slug:"/provider/saml/keycloak",permalink:"/de/docs/provider/saml/keycloak",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/provider/saml/keycloak.md",tags:[],version:"current",frontMatter:{title:"Keycloak",description:"Keycloak zur Authentifizierung von Benutzern verwenden",keywords:["Keycloak"],authors:["seriouszyx"]},sidebar:"tutorialSidebar",previous:{title:"Benutzerdefiniert",permalink:"/de/docs/provider/saml/custom"},next:{title:"Alibaba Cloud IDaaS",permalink:"/de/docs/provider/saml/aliyun"}},s={},d=[{value:"Keycloak konfigurieren",id:"keycloak-konfigurieren",level:2},{value:"Einen Client-Eintrag in Keycloak hinzuf\xfcgen",id:"einen-client-eintrag-in-keycloak-hinzuf\xfcgen",level:2},{value:"In Casdoor konfigurieren",id:"in-casdoor-konfigurieren",level:2},{value:"Die Wirkung validieren",id:"die-wirkung-validieren",level:2}],p={toc:d};function k(e){let{components:n,...r}=e;return(0,a.kt)("wrapper",(0,i.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Das JBoss ",(0,a.kt)("a",{parentName:"p",href:"https://www.keycloak.org/"},"Keycloak"),"-System ist ein weit verbreitetes und Open-Source-Identit\xe4tsmanagement-System, das die Integration mit Anwendungen \xfcber SAML und OpenID Connect unterst\xfctzt. Es kann auch als Identit\xe4tsbroker zwischen anderen Anbietern wie LDAP oder anderen SAML-Anbietern und Anwendungen, die SAML oder OpenID Connect unterst\xfctzen, fungieren."),(0,a.kt)("p",null,"Hier ist ein Beispiel, wie man einen neuen Client-Eintrag in Keycloak konfiguriert und Casdoor so einrichtet, dass es verwendet wird, um UI-Login durch Keycloak-Benutzer zu erm\xf6glichen, die \xfcber die Keycloak-Konfiguration Zugriff erhalten."),(0,a.kt)("h2",{id:"keycloak-konfigurieren"},"Keycloak konfigurieren"),(0,a.kt)("p",null,"F\xfcr dieses Beispiel machen wir die folgenden Konfigurationsentscheidungen und Annahmen:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Nehmen wir an, dass du Casdoor lokal im Entwicklungsmodus betreibst. Die Casdoor-UI ist verf\xfcgbar unter ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:7001")," und der Server ist verf\xfcgbar unter ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000"),". Ersetze die URL nach Bedarf durch die entsprechende."),(0,a.kt)("li",{parentName:"ul"},"Nehmen wir an, dass du Keycloak lokal betreibst. Die Keycloak-UI ist verf\xfcgbar unter ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8080/auth"),"."),(0,a.kt)("li",{parentName:"ul"},"Basierend darauf wird die SP ACS URL f\xfcr dieses Deployment sein: ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,a.kt)("li",{parentName:"ul"},"Unsere SP Entity ID wird dieselbe URL verwenden: ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")),(0,a.kt)("p",null,"Du kannst das Standard-Realm verwenden oder ein neues Realm erstellen."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak Realm hinzuf\xfcgen",src:t(78539).Z,width:"2560",height:"590"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak Realm",src:t(95491).Z,width:"2560",height:"965"})),(0,a.kt)("h2",{id:"einen-client-eintrag-in-keycloak-hinzuf\xfcgen"},"Einen Client-Eintrag in Keycloak hinzuf\xfcgen"),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Weitere Details zu Keycloak-Clients findest du in der ",(0,a.kt)("a",{parentName:"p",href:"https://www.keycloak.org/docs/latest/server_admin/index.html#_client-saml-configuration"},"Keycloak-Dokumentation"),".")),(0,a.kt)("p",null,"Klicke im Men\xfc auf ",(0,a.kt)("strong",{parentName:"p"},"Clients")," und dann auf ",(0,a.kt)("strong",{parentName:"p"},"Erstellen"),", um zur Seite ",(0,a.kt)("strong",{parentName:"p"},"Client hinzuf\xfcgen")," zu gelangen. F\xfclle die Felder wie folgt aus:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Client ID"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - Dies wird die SP Entity ID sein, die sp\xe4ter in der Casdoor-Konfiguration verwendet wird."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Client-Protokoll"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"saml"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Client SAML Endpoint"),": ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - Diese URL ist der Ort, an den der Keycloak-Server SAML-Anfragen und -Antworten senden soll. In der Regel haben Anwendungen eine URL zur Verarbeitung von SAML-Anfragen. Mehrere URLs k\xf6nnen im Einstellungstab des Clients festgelegt werden.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak-Client hinzuf\xfcgen",src:t(15582).Z,width:"2560",height:"961"})),(0,a.kt)("p",null,"Klicke auf ",(0,a.kt)("strong",{parentName:"p"},"Speichern"),". Diese Aktion erstellt den Client und bringt dich zum Tab ",(0,a.kt)("strong",{parentName:"p"},"Einstellungen"),"."),(0,a.kt)("p",null,"Die folgenden sind Teil der Einstellungen:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Name")," - ",(0,a.kt)("inlineCode",{parentName:"li"},"Casdoor"),". Dies wird nur verwendet, um einen freundlichen Namen f\xfcr Keycloak-Benutzer in der Keycloak-UI anzuzeigen. Du kannst jeden beliebigen Namen verwenden."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Aktiviert")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Authn Statement einbeziehen")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Dokumente signieren")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Behauptungen signieren")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Behauptungen verschl\xfcsseln")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Client-Signatur erforderlich")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Name ID Format erzwingen")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Name ID Format")," - W\xe4hle ",(0,a.kt)("inlineCode",{parentName:"li"},"username"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"G\xfcltige Redirect URIs")," - F\xfcge ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," hinzu."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Master SAML Processing URL")," - ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,a.kt)("li",{parentName:"ol"},"Feink\xf6rnige SAML-Endpunkt-Konfiguration",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Assertion Consumer Service POST Binding URL")," - ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Assertion Consumer Service Redirect Binding URL")," - ",(0,a.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")))),(0,a.kt)("p",null,"Die Konfiguration speichern."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Keycloak-Client konfigurieren",src:t(82142).Z,width:"2557",height:"3014"})),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Wenn du die Authn-Anfrage signieren m\xf6chtest, musst du die Option ",(0,a.kt)("strong",{parentName:"p"},"Client Signature Required")," aktivieren und das von dir generierte Zertifikat hochladen. Der private Schl\xfcssel und das Zertifikat, die in Casdoor verwendet werden, ",(0,a.kt)("inlineCode",{parentName:"p"},"token_jwt_key.key")," und ",(0,a.kt)("inlineCode",{parentName:"p"},"token_jwt_key.pem"),", befinden sich im Verzeichnis ",(0,a.kt)("strong",{parentName:"p"},"object"),". In Keycloak musst du auf den Tab ",(0,a.kt)("strong",{parentName:"p"},"Keys")," klicken, auf die Schaltfl\xe4che ",(0,a.kt)("strong",{parentName:"p"},"Import")," klicken, ",(0,a.kt)("strong",{parentName:"p"},"Archivformat")," als ",(0,a.kt)("strong",{parentName:"p"},"Certificate PEM")," ausw\xe4hlen und das Zertifikat hochladen.")),(0,a.kt)("p",null,"Klicke auf den Tab ",(0,a.kt)("strong",{parentName:"p"},"Installation"),"."),(0,a.kt)("p",null,"F\xfcr Keycloak <= 5.0.0, w\xe4hle Formatoption - ",(0,a.kt)("strong",{parentName:"p"},"SAML Metadata IDPSSODescriptor")," und kopiere die Metadaten."),(0,a.kt)("p",null,"F\xfcr Keycloak 6.0.0+, w\xe4hle Formatoption - ",(0,a.kt)("strong",{parentName:"p"},"Mod Auth Mellon Dateien")," und klicke auf ",(0,a.kt)("strong",{parentName:"p"},"Herunterladen"),". Entpacke die heruntergeladene .zip, finde ",(0,a.kt)("inlineCode",{parentName:"p"},"idp-metadata.xml")," und kopiere die Metadaten."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Metadaten herunterladen",src:t(82235).Z,width:"2560",height:"596"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Metadaten kopieren",src:t(7962).Z,width:"1002",height:"241"})),(0,a.kt)("h2",{id:"in-casdoor-konfigurieren"},"In Casdoor konfigurieren"),(0,a.kt)("p",null,"Einen neuen Anbieter in Casdoor erstellen."),(0,a.kt)("p",null,"W\xe4hle die Kategorie als ",(0,a.kt)("strong",{parentName:"p"},"SAML"),", Typ als ",(0,a.kt)("strong",{parentName:"p"},"Keycloak"),". Kopiere den Inhalt der Metadaten und f\xfcge ihn in das Feld ",(0,a.kt)("strong",{parentName:"p"},"Metadaten")," ein. Die Werte von ",(0,a.kt)("strong",{parentName:"p"},"Endpunkt"),", ",(0,a.kt)("strong",{parentName:"p"},"IdP")," und ",(0,a.kt)("strong",{parentName:"p"},"Aussteller-URL")," werden automatisch generiert, nachdem du auf die Schaltfl\xe4che ",(0,a.kt)("strong",{parentName:"p"},"Parse")," klickst. Klicke abschlie\xdfend auf die Schaltfl\xe4che ",(0,a.kt)("strong",{parentName:"p"},"Speichern"),"."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Wenn du die Option ",(0,a.kt)("strong",{parentName:"p"},"Client Signature Required")," in Keycloak aktivierst und das Zertifikat hochl\xe4dst, aktiviere bitte die Option ",(0,a.kt)("strong",{parentName:"p"},"Sign request")," in Casdoor.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Casdoor-Anbieter",src:t(33666).Z,width:"2505",height:"1272"})),(0,a.kt)("p",null,"Bearbeite die Anwendung, die du in Casdoor konfigurieren m\xf6chtest. W\xe4hle den Anbieter, den du gerade hinzugef\xfcgt hast, und klicke auf die Schaltfl\xe4che ",(0,a.kt)("strong",{parentName:"p"},"Speichern"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Anbieter f\xfcr App hinzuf\xfcgen",src:t(30464).Z,width:"2487",height:"255"})),(0,a.kt)("h2",{id:"die-wirkung-validieren"},"Die Wirkung validieren"),(0,a.kt)("p",null,"Gehe zur Anwendung, die du gerade konfiguriert hast, und du wirst ein Keycloak-Symbol auf der Login-Seite finden."),(0,a.kt)("p",null,"Klicke auf das Symbol und du wirst zur Keycloak-Login-Seite weitergeleitet. Nach erfolgreicher Authentifizierung wirst du in Casdoor eingeloggt sein."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Casdoor-Login",src:t(42062).Z,width:"1280",height:"720"})))}k.isMDXComponent=!0},30464:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_casdoor_app-c3afe561f88f7c5ade9973f8aa706dec.png"},42062:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_casdoor_login-5080e3bced4808bd768772ecfb15ca97.gif"},33666:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_casdoor_provider-238d41bdb7a2ce7eab3252b45b8f7d63.png"},15582:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_client_add-a22a58cfe1cac19aac7c471f4b95a391.png"},82142:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_client_configure-d8a4520b9809494ac277da30d02a8d35.png"},7962:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_client_copy-3233ceff3f6b91883873e5441c6e50fe.png"},82235:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_client_install-e8ed45db439c33e32b2f46fbdc476f40.png"},95491:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_realm-aa47ec9142083126d9c9f1ce79c75eac.png"},78539:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/keycloak_realm_add-9a27d681ede089b89474ebd0acc155c0.png"}}]);