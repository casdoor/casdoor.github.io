"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[1952],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),d=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(n),m=a,k=c["".concat(s,".").concat(m)]||c[m]||u[m]||o;return n?r.createElement(k,l(l({ref:t},p),{},{components:n})):r.createElement(k,l({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var d=2;d<o;d++)l[d]=n[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},69723:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=n(87462),a=(n(67294),n(3905));const o={title:"Next.js",description:"Utilisation de Casdoor dans un projet Next.js",keywords:["nextjs"],authors:["SamYSF"]},l=void 0,i={unversionedId:"how-to-connect/nextjs",id:"how-to-connect/nextjs",title:"Next.js",description:"Utilisation de Casdoor dans un projet Next.js",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/how-to-connect/nextjs.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/nextjs",permalink:"/fr/docs/how-to-connect/nextjs",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/nextjs.md",tags:[],version:"current",frontMatter:{title:"Next.js",description:"Utilisation de Casdoor dans un projet Next.js",keywords:["nextjs"],authors:["SamYSF"]},sidebar:"tutorialSidebar",previous:{title:"Plugin Casdoor",permalink:"/fr/docs/how-to-connect/plugin"},next:{title:"Nuxt",permalink:"/fr/docs/how-to-connect/nuxt"}},s={},d=[{value:"\xc9tape 1 : D\xe9ployer Casdoor",id:"\xe9tape-1--d\xe9ployer-casdoor",level:2},{value:"\xc9tape 2 : Ajouter un Middleware",id:"\xe9tape-2--ajouter-un-middleware",level:2},{value:"Exemple",id:"exemple",level:3},{value:"\xc9tape 3 : Utiliser le SDK Casdoor",id:"\xe9tape-3--utiliser-le-sdk-casdoor",level:2},{value:"1.Installer le SDK",id:"1installer-le-sdk",level:3},{value:"2.Initialiser le SDK",id:"2initialiser-le-sdk",level:3},{value:"Exemple",id:"exemple-1",level:3},{value:"3.Rediriger vers la Page de Connexion",id:"3rediriger-vers-la-page-de-connexion",level:3},{value:"4.Obtenir le Token et le Stockage",id:"4obtenir-le-token-et-le-stockage",level:3},{value:"\xc9tape 4 : Ajouter une Fonction d&#39;Authentification Middleware",id:"\xe9tape-4--ajouter-une-fonction-dauthentification-middleware",level:2},{value:"Exemple",id:"exemple-2",level:3}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/casdoor/nextjs-auth"},"nextjs-auth")," est un exemple d'int\xe9gration de casdoor dans un projet next-js. Nous allons vous guider \xe0 travers les \xe9tapes ci-dessous."),(0,a.kt)("h2",{id:"\xe9tape-1--d\xe9ployer-casdoor"},"\xc9tape 1 : D\xe9ployer Casdoor"),(0,a.kt)("p",null,"Tout d'abord, Casdoor doit \xeatre d\xe9ploy\xe9."),(0,a.kt)("p",null,"Vous pouvez vous r\xe9f\xe9rer \xe0 la documentation officielle de Casdoor pour l'",(0,a.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Installation du Serveur"),". Veuillez d\xe9ployer votre instance Casdoor en ",(0,a.kt)("strong",{parentName:"p"},"mode production"),"."),(0,a.kt)("p",null,"Apr\xe8s un d\xe9ploiement r\xe9ussi, assurez-vous de ce qui suit :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Ouvrez votre navigateur pr\xe9f\xe9r\xe9 et visitez ",(0,a.kt)("strong",{parentName:"li"},"http://localhost:8000"),". Vous verrez la page de connexion de Casdoor."),(0,a.kt)("li",{parentName:"ul"},"Testez la fonctionnalit\xe9 de connexion en entrant ",(0,a.kt)("inlineCode",{parentName:"li"},"admin")," comme nom d'utilisateur et ",(0,a.kt)("inlineCode",{parentName:"li"},"123")," comme mot de passe.")),(0,a.kt)("p",null,"Apr\xe8s cela, vous pouvez rapidement mettre en \u0153uvre une page de connexion bas\xe9e sur Casdoor dans votre propre application en suivant les \xe9tapes suivantes."),(0,a.kt)("h2",{id:"\xe9tape-2--ajouter-un-middleware"},"\xc9tape 2 : Ajouter un Middleware"),(0,a.kt)("p",null,"Le Middleware vous permet d'ex\xe9cuter du code avant qu'une requ\xeate ne soit compl\xe9t\xe9e. Ensuite, en fonction de la requ\xeate entrante, vous pouvez modifier la r\xe9ponse en r\xe9\xe9crivant, redirigeant, modifiant les en-t\xeates de la requ\xeate ou de la r\xe9ponse, ou en r\xe9pondant directement."),(0,a.kt)("p",null,"Utilisez le fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"middleware.ts")," (ou ",(0,a.kt)("inlineCode",{parentName:"p"},".js"),") \xe0 la racine de votre projet pour d\xe9finir le Middleware. Par exemple, au m\xeame niveau que ",(0,a.kt)("inlineCode",{parentName:"p"},"pages")," ou ",(0,a.kt)("inlineCode",{parentName:"p"},"app"),", ou \xe0 l'int\xe9rieur de ",(0,a.kt)("inlineCode",{parentName:"p"},"src")," si applicable."),(0,a.kt)("h3",{id:"exemple"},"Exemple"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'//define which paths Middleware will run on\nconst protectedRoutes = ["/profile"];\n\nexport default function middleware(req) {\n  if (protectedRoutes.includes(req.nextUrl.pathname)) {\n    //redirect the incoming request to a different URL\n    return NextResponse.redirect(new URL("/login", req.url));\n  }\n}\n')),(0,a.kt)("p",null,"Voir la documentation officielle de next.js ",(0,a.kt)("a",{parentName:"p",href:"https://nextjs.org/docs/app/building-your-application/routing/middleware"},"middleware")," pour plus de d\xe9tails."),(0,a.kt)("h2",{id:"\xe9tape-3--utiliser-le-sdk-casdoor"},"\xc9tape 3 : Utiliser le SDK Casdoor"),(0,a.kt)("h3",{id:"1installer-le-sdk"},"1.Installer le SDK"),(0,a.kt)("p",null,"Tout d'abord, installez ",(0,a.kt)("inlineCode",{parentName:"p"},"casdoor-js-sdk")," via NPM ou Yarn :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"npm install casdoor-js-sdk\n")),(0,a.kt)("p",null,"Ou :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add casdoor-js-sdk\n")),(0,a.kt)("h3",{id:"2initialiser-le-sdk"},"2.Initialiser le SDK"),(0,a.kt)("p",null,"Ensuite, initialisez 6 param\xe8tres de type cha\xeene de caract\xe8res dans l'ordre suivant :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Nom"),(0,a.kt)("th",{parentName:"tr",align:null},"Requis"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"serverUrl"),(0,a.kt)("td",{parentName:"tr",align:null},"Oui"),(0,a.kt)("td",{parentName:"tr",align:null},"URL du serveur Casdoor, comme ",(0,a.kt)("inlineCode",{parentName:"td"},"http://localhost:8000"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"clientId"),(0,a.kt)("td",{parentName:"tr",align:null},"Oui"),(0,a.kt)("td",{parentName:"tr",align:null},"ID client de l'application")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"clientSecret"),(0,a.kt)("td",{parentName:"tr",align:null},"Oui"),(0,a.kt)("td",{parentName:"tr",align:null},"Secret client de l'application")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"organizationName"),(0,a.kt)("td",{parentName:"tr",align:null},"Oui"),(0,a.kt)("td",{parentName:"tr",align:null},"Organisation de l'application")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"appName"),(0,a.kt)("td",{parentName:"tr",align:null},"Oui"),(0,a.kt)("td",{parentName:"tr",align:null},"Nom de l'application")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"redirectPath"),(0,a.kt)("td",{parentName:"tr",align:null},"Oui"),(0,a.kt)("td",{parentName:"tr",align:null},"URL redirig\xe9e")))),(0,a.kt)("h3",{id:"exemple-1"},"Exemple"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const sdkConfig = {\n  serverUrl: "https://door.casdoor.com",\n  clientId: "294b09fbc17f95daf2fe",\n  clientSecret: "dd8982f7046ccba1bbd7851d5c1ece4e52bf039d",\n  organizationName: "casbin",\n  appName: "app-vue-python-example",\n  redirectPath: "/callback",\n};\n')),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Remplacez les valeurs de configuration par celles de votre propre instance Casdoor, en particulier le ",(0,a.kt)("inlineCode",{parentName:"p"},"clientId"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"clientSecret"),", et ",(0,a.kt)("inlineCode",{parentName:"p"},"serverUrl"),".")),(0,a.kt)("h3",{id:"3rediriger-vers-la-page-de-connexion"},"3.Rediriger vers la Page de Connexion"),(0,a.kt)("p",null,"Lorsque vous avez besoin d'authentifier les utilisateurs qui acc\xe8dent \xe0 votre application, vous pouvez envoyer l'URL cible et rediriger vers la page de connexion fournie par Casdoor."),(0,a.kt)("p",null,"Assurez-vous d'avoir ajout\xe9 l'URL de rappel (par exemple ",(0,a.kt)("strong",{parentName:"p"},"http://localhost:8080/callback"),") dans la configuration de l'application au pr\xe9alable."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const CasdoorSDK = new Sdk(sdkConfig);\nCasdoorSDK.signin_redirect();\n")),(0,a.kt)("h3",{id:"4obtenir-le-token-et-le-stockage"},"4.Obtenir le Token et le Stockage"),(0,a.kt)("p",null,"Apr\xe8s que la v\xe9rification Casdoor est pass\xe9e, elle redirigera vers votre application avec le token."),(0,a.kt)("p",null,"Vous pouvez choisir d'utiliser un cookie pour stocker le token."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'CasdoorSDK.exchangeForAccessToken()\n  .then((res) => {\n    if (res && res.access_token) {\n      //Get Token\n      return CasdoorSDK.getUserInfo(res.access_token);\n    }\n  })\n  .then((res) => {\n    // Storage Token\n    Cookies.set("casdoorUser", JSON.stringify(res));\n  });\n')),(0,a.kt)("p",null,"Vous pouvez vous r\xe9f\xe9rer \xe0 la documentation officielle de Casdoor pour ",(0,a.kt)("a",{parentName:"p",href:"https://casdoor.org/docs/how-to-connect/sdk/#how-to-use-casdoor-sdk"},"Comment utiliser le SDK Casdoor"),"."),(0,a.kt)("h2",{id:"\xe9tape-4--ajouter-une-fonction-dauthentification-middleware"},"\xc9tape 4 : Ajouter une Fonction d'Authentification Middleware"),(0,a.kt)("p",null,"lorsque les utilisateurs tentent d'acc\xe9der \xe0 une route prot\xe9g\xe9e, la fonction d'Authentification Middleware v\xe9rifie leur identit\xe9. Si l'utilisateur n'est pas authentifi\xe9, il est redirig\xe9 vers une page de connexion ou l'acc\xe8s lui est refus\xe9."),(0,a.kt)("h3",{id:"exemple-2"},"Exemple"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'//protected route\nconst protectedRoutes = ["/profile"];\nconst casdoorUserCookie = req.cookies.get("casdoorUser");\nconst isAuthenticated = casdoorUserCookie ? true : false;\n\n//Authentication Function\nif (!isAuthenticated && protectedRoutes.includes(req.nextUrl.pathname)) {\n  return NextResponse.redirect(new URL("/login", req.url));\n}\n')))}u.isMDXComponent=!0}}]);