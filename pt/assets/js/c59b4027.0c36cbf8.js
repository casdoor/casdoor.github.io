"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4586],{3905:(e,o,a)=>{a.d(o,{Zo:()=>d,kt:()=>u});var r=a(67294);function t(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}function n(e,o){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?n(Object(a),!0).forEach((function(o){t(e,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))}))}return e}function s(e,o){if(null==e)return{};var a,r,t=function(e,o){if(null==e)return{};var a,r,t={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],o.indexOf(a)>=0||(t[a]=e[a]);return t}(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],o.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var p=r.createContext({}),c=function(e){var o=r.useContext(p),a=o;return e&&(a="function"==typeof e?e(o):i(i({},o),e)),a},d=function(e){var o=c(e.components);return r.createElement(p.Provider,{value:o},e.children)},l={inlineCode:"code",wrapper:function(e){var o=e.children;return r.createElement(r.Fragment,{},o)}},m=r.forwardRef((function(e,o){var a=e.components,t=e.mdxType,n=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=c(a),u=t,g=m["".concat(p,".").concat(u)]||m[u]||l[u]||n;return a?r.createElement(g,i(i({ref:o},d),{},{components:a})):r.createElement(g,i({ref:o},d))}));function u(e,o){var a=arguments,t=o&&o.mdxType;if("string"==typeof e||t){var n=a.length,i=new Array(n);i[0]=m;var s={};for(var p in o)hasOwnProperty.call(o,p)&&(s[p]=o[p]);s.originalType=e,s.mdxType="string"==typeof e?e:t,i[1]=s;for(var c=2;c<n;c++)i[c]=a[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},85990:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>p,contentTitle:()=>i,default:()=>l,frontMatter:()=>n,metadata:()=>s,toc:()=>c});var r=a(87462),t=(a(67294),a(3905));const n={title:"WeChat MiniProgram",description:"Usando Casdoor no WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},i=void 0,s={unversionedId:"integration/javascript/wechat_miniprogram",id:"integration/javascript/wechat_miniprogram",title:"WeChat MiniProgram",description:"Usando Casdoor no WeChat MiniProgram",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/integration/javascript/wechat_miniprogram.md",sourceDirName:"integration/javascript",slug:"/integration/javascript/wechat_miniprogram",permalink:"/pt/docs/integration/javascript/wechat_miniprogram",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/javascript/wechat_miniprogram.md",tags:[],version:"current",frontMatter:{title:"WeChat MiniProgram",description:"Usando Casdoor no WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Firebase",permalink:"/pt/docs/integration/javascript/firebase"},next:{title:"Lua",permalink:"/pt/docs/category/lua"}},p={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Passo 1: Implantar o Casdoor",id:"passo-1-implantar-o-casdoor",level:2},{value:"Passo 2: Configurar Aplica\xe7\xe3o Casdoor",id:"passo-2-configurar-aplica\xe7\xe3o-casdoor",level:2},{value:"Passo 3: Escrever C\xf3digo WeChat MiniProgram",id:"passo-3-escrever-c\xf3digo-wechat-miniprogram",level:2}],d={toc:c};function l(e){let{components:o,...n}=e;return(0,t.kt)("wrapper",(0,r.Z)({},d,n,{components:o,mdxType:"MDXLayout"}),(0,t.kt)("admonition",{type:"info"},(0,t.kt)("p",{parentName:"admonition"},"O Casdoor agora suporta WeChat Mini Program a partir da vers\xe3o 1.41.0.")),(0,t.kt)("h2",{id:"introdu\xe7\xe3o"},"Introdu\xe7\xe3o"),(0,t.kt)("p",null,"Como o WeChat Mini Program n\xe3o suporta OAuth padronizado, ele n\xe3o pode redirecionar para a p\xe1gina de login do Casdoor hospedada pelo pr\xf3prio usu\xe1rio. Portanto, o processo de usar o Casdoor para WeChat Mini Program \xe9 diferente daquele de programas regulares."),(0,t.kt)("p",null,"Este documento explicar\xe1 como integrar o Casdoor no WeChat Mini Program. Voc\xea pode encontrar um exemplo desta integra\xe7\xe3o no GitHub aqui: ",(0,t.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-wechat-miniprogram-example"},"casdoor-wechat-miniprogram-example"),". Para mais informa\xe7\xf5es detalhadas, por favor, consulte o ",(0,t.kt)("a",{parentName:"p",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html"},"documento de login")," do WeChat Mini Program."),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"A configura\xe7\xe3o inclui os seguintes nomes:"),(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": O nome de dom\xednio ou endere\xe7o IP onde o servidor Casdoor est\xe1 implantado, por exemplo, ",(0,t.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),".")),(0,t.kt)("h2",{id:"passo-1-implantar-o-casdoor"},"Passo 1: Implantar o Casdoor"),(0,t.kt)("p",null,"Primeiramente, o ",(0,t.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"servidor Casdoor")," deve ser implantado."),(0,t.kt)("p",null,"Ap\xf3s implantar com sucesso o Casdoor, voc\xea precisa garantir:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"O Casdoor pode ser acessado e usado normalmente."),(0,t.kt)("li",{parentName:"ol"},"Defina o valor de ",(0,t.kt)("inlineCode",{parentName:"li"},"origin")," do Casdoor (conf/app.conf) para ",(0,t.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,t.kt)("img",{alt:"Configura\xe7\xe3o do Casdoor",src:a(66496).Z,width:"1013",height:"448"}))),(0,t.kt)("h2",{id:"passo-2-configurar-aplica\xe7\xe3o-casdoor"},"Passo 2: Configurar Aplica\xe7\xe3o Casdoor"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Crie um IDP WeChat no Casdoor e forne\xe7a o ",(0,t.kt)("inlineCode",{parentName:"li"},"APPID")," e ",(0,t.kt)("inlineCode",{parentName:"li"},"APPSECRET")," fornecidos pela plataforma de desenvolvimento do WeChat Mini Program. ",(0,t.kt)("img",{alt:"WeChat_MiniProgram.png",src:a(72503).Z,width:"937",height:"773"})),(0,t.kt)("li",{parentName:"ol"},"Crie uma nova aplica\xe7\xe3o Casdoor ou use uma existente."),(0,t.kt)("li",{parentName:"ol"},"Adicione o IDP criado no passo anterior \xe0 aplica\xe7\xe3o que deseja usar.")),(0,t.kt)("admonition",{title:"Tips",type:"info"},(0,t.kt)("p",{parentName:"admonition"},"Para conveni\xeancia, o Casdoor tratar\xe1 o primeiro IDP do tipo WeChat na aplica\xe7\xe3o como o IDP do WeChat Mini Program por padr\xe3o."),(0,t.kt)("p",{parentName:"admonition"},"Portanto, se voc\xea deseja usar o WeChat Mini Program nesta aplica\xe7\xe3o, n\xe3o adicione v\xe1rios IDPs do tipo WeChat em uma \xfanica aplica\xe7\xe3o.")),(0,t.kt)("h2",{id:"passo-3-escrever-c\xf3digo-wechat-miniprogram"},"Passo 3: Escrever C\xf3digo WeChat MiniProgram"),(0,t.kt)("p",null,"O WeChat Mini Program fornece uma API para fazer login internamente e obter o c\xf3digo. O c\xf3digo deve ent\xe3o ser enviado ao Casdoor. O Casdoor usar\xe1 este c\xf3digo para recuperar informa\xe7\xf5es (como OpenID e SessionKey) do servidor WeChat."),(0,t.kt)("p",null,"O c\xf3digo a seguir demonstra como realizar o processo acima:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'// Login in mini program\nwx.login({\n  success: res => {\n    // This is the login code that needs to be sent to Casdoor\n    console.log(res.code)\n\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/login/oauth/access_token`,\n      method: "POST",\n      data: {\n        "tag": "wechat_miniprogram", // Required\n        "client_id": "6825f4f0af45554c8952",\n        "code": res.code,\n        "username": this.data.userInfo.nickName, // Update user profile when you log in.\n        "avatar": this.data.userInfo.avatarUrl,\n      },\n      header:{\n        "content-type": "application/x-www-form-urlencoded",\n      },\n      success: res => {\n        console.log(res)\n        this.globalData.accessToken = res.data.access_token // Get Casdoor\'s access token\n      }\n    })\n  }\n})\n')),(0,t.kt)("p",null,"\xc9 importante notar que o par\xe2metro ",(0,t.kt)("inlineCode",{parentName:"p"},"tag")," \xe9 obrigat\xf3rio para informar ao Casdoor que esta \xe9 uma solicita\xe7\xe3o do WeChat Mini Program."),(0,t.kt)("p",null,"O c\xf3digo acima inclui o nome de usu\xe1rio e o URI do avatar do usu\xe1rio do WeChat Mini Program durante o login. Voc\xea pode optar por passar esses dois par\xe2metros separadamente e depois envi\xe1-los ao Casdoor ap\xf3s um login bem-sucedido e a obten\xe7\xe3o do token de acesso:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-js"},'wx.getUserProfile({\n  desc: \'share your info to Casdoor\', \n  success: (res) => {\n    this.setData({\n      userInfo: res.userInfo,\n      hasUserInfo: true\n    })\n    console.log(app.globalData.accessToken)\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/update-user`, // Casdoor URL\n      method: "POST",\n      data: {\n        "owner": "test",\n        "name": "wechat-oGk3T5tIiMFo3SazCO75f0HEiE7Q",\n        "displayName": this.data.userInfo.nickName,\n        "avatar": this.data.userInfo.avatarUrl\n      },\n      header: {\n        "Authorization": "Bearer " + app.globalData.accessToken, // Bearer token\n        "content-type": "application/json"\n      },\n      success: (res) => {\n        console.log(res)\n      }\n    })\n  }\n})\n')),(0,t.kt)("p",null,"Al\xe9m disso, voc\xea pode usar o token de acesso como um token bearer para qualquer opera\xe7\xe3o do Casdoor que voc\xea necessitar."),(0,t.kt)("admonition",{title:"Tips",type:"info"},(0,t.kt)("p",{parentName:"admonition"},"Atualmente, o Casdoor \xe9 incapaz de vincular contas existentes a usu\xe1rios do WeChat Mini Program. Ap\xf3s o Casdoor recuperar o OpenID do WeChat, ele criar\xe1 um novo usu\xe1rio se o ID n\xe3o existir, ou usar\xe1 o usu\xe1rio existente se ele existir.")))}l.isMDXComponent=!0},66496:(e,o,a)=>{a.d(o,{Z:()=>r});const r=a.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},72503:(e,o,a)=>{a.d(o,{Z:()=>r});const r=a.p+"assets/images/WeChat_MiniProgram-701cc38162bc50d472b5226e5f167e3c.png"}}]);