"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[275],{3905:(e,n,r)=>{r.d(n,{Zo:()=>c,kt:()=>m});var t=r(67294);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,t,i=function(e,n){if(null==e)return{};var r,t,i={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(i[r]=e[r]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var d=t.createContext({}),l=function(e){var n=t.useContext(d),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},c=function(e){var n=l(e.components);return t.createElement(d.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var r=e.components,i=e.mdxType,a=e.originalType,d=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(r),m=i,g=p["".concat(d,".").concat(m)]||p[m]||u[m]||a;return r?t.createElement(g,o(o({ref:n},c),{},{components:r})):t.createElement(g,o({ref:n},c))}));function m(e,n){var r=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=r.length,o=new Array(a);o[0]=p;var s={};for(var d in n)hasOwnProperty.call(n,d)&&(s[d]=n[d]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<a;l++)o[l]=r[l];return t.createElement.apply(null,o)}return t.createElement.apply(null,r)}p.displayName="MDXCreateElement"},54462:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var t=r(87462),i=(r(67294),r(3905));const a={title:"WeChat MiniProgram",description:"Verwendung von Casdoor in WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},o=void 0,s={unversionedId:"integration/javascript/wechat_miniprogram",id:"integration/javascript/wechat_miniprogram",title:"WeChat MiniProgram",description:"Verwendung von Casdoor in WeChat MiniProgram",source:"@site/i18n/de/docusaurus-plugin-content-docs/current/integration/javascript/wechat_miniprogram.md",sourceDirName:"integration/javascript",slug:"/integration/javascript/wechat_miniprogram",permalink:"/de/docs/integration/javascript/wechat_miniprogram",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/javascript/wechat_miniprogram.md",tags:[],version:"current",frontMatter:{title:"WeChat MiniProgram",description:"Verwendung von Casdoor in WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Firebase",permalink:"/de/docs/integration/javascript/firebase"},next:{title:"Lua",permalink:"/de/docs/category/lua"}},d={},l=[{value:"Einf\xfchrung",id:"einf\xfchrung",level:2},{value:"Schritt 1: Casdoor bereitstellen",id:"schritt-1-casdoor-bereitstellen",level:2},{value:"Schritt 2: Casdoor-Anwendung konfigurieren",id:"schritt-2-casdoor-anwendung-konfigurieren",level:2},{value:"Schritt 3: WeChat MiniProgram-Code schreiben",id:"schritt-3-wechat-miniprogram-code-schreiben",level:2}],c={toc:l};function u(e){let{components:n,...a}=e;return(0,i.kt)("wrapper",(0,t.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Casdoor unterst\xfctzt nun ab Version 1.41.0 das WeChat Mini Program.")),(0,i.kt)("h2",{id:"einf\xfchrung"},"Einf\xfchrung"),(0,i.kt)("p",null,"Da das WeChat Mini Program keinen standardisierten OAuth unterst\xfctzt, kann es nicht zur selbst gehosteten Casdoor-Webseite f\xfcr die Anmeldung umleiten. Daher unterscheidet sich der Prozess der Verwendung von Casdoor f\xfcr das WeChat Mini Program von dem regul\xe4rer Programme."),(0,i.kt)("p",null,"Dieses Dokument wird erkl\xe4ren, wie man Casdoor in das WeChat Mini Program integriert. Hier finden Sie ein Beispiel f\xfcr diese Integration auf GitHub: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-wechat-miniprogram-example"},"casdoor-wechat-miniprogram-example"),". Weitere detaillierte Informationen finden Sie bitte im WeChat Mini Program ",(0,i.kt)("a",{parentName:"p",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html"},"Login-Dokument"),"."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Die Konfiguration umfasst die folgenden Namen:"),(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": Der Domainname oder die IP-Adresse, auf der der Casdoor-Server bereitgestellt ist, z.B. ",(0,i.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),".")),(0,i.kt)("h2",{id:"schritt-1-casdoor-bereitstellen"},"Schritt 1: Casdoor bereitstellen"),(0,i.kt)("p",null,"Zuerst sollte der ",(0,i.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Casdoor-Server")," bereitgestellt werden."),(0,i.kt)("p",null,"Nach erfolgreicher Bereitstellung von Casdoor m\xfcssen Sie sicherstellen:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Casdoor kann normal zugegriffen und verwendet werden."),(0,i.kt)("li",{parentName:"ol"},"Setzen Sie den ",(0,i.kt)("inlineCode",{parentName:"li"},"origin"),"-Wert von Casdoor (conf/app.conf) auf ",(0,i.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,i.kt)("img",{alt:"Casdoor-Konfiguration",src:r(66496).Z,width:"1013",height:"448"}))),(0,i.kt)("h2",{id:"schritt-2-casdoor-anwendung-konfigurieren"},"Schritt 2: Casdoor-Anwendung konfigurieren"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Erstellen Sie eine WeChat-IDP in Casdoor und geben Sie die von der WeChat Mini Program-Entwicklungsplattform bereitgestellten ",(0,i.kt)("inlineCode",{parentName:"li"},"APPID")," und ",(0,i.kt)("inlineCode",{parentName:"li"},"APPSECRET")," an. ",(0,i.kt)("img",{alt:"WeChat_MiniProgram.png",src:r(72503).Z,width:"937",height:"773"})),(0,i.kt)("li",{parentName:"ol"},"Erstellen Sie eine neue Casdoor-Anwendung oder verwenden Sie eine vorhandene."),(0,i.kt)("li",{parentName:"ol"},"F\xfcgen Sie die im vorherigen Schritt erstellte IDP der Anwendung hinzu, die Sie verwenden m\xf6chten.")),(0,i.kt)("admonition",{title:"Tips",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Zur Vereinfachung wird Casdoor die erste WeChat-Typ-IDP in der Anwendung standardm\xe4\xdfig als WeChat Mini Program-IDP behandeln."),(0,i.kt)("p",{parentName:"admonition"},"Daher, wenn Sie das WeChat Mini Program in dieser App verwenden m\xf6chten, f\xfcgen Sie nicht mehrere WeChat-Typ-IDPs in einer App hinzu.")),(0,i.kt)("h2",{id:"schritt-3-wechat-miniprogram-code-schreiben"},"Schritt 3: WeChat MiniProgram-Code schreiben"),(0,i.kt)("p",null,"WeChat Mini Program bietet eine API, um sich intern anzumelden und den Code zu erhalten. Der Code sollte dann an Casdoor gesendet werden. Casdoor wird diesen Code verwenden, um Informationen (wie OpenID und SessionKey) vom WeChat-Server abzurufen."),(0,i.kt)("p",null,"Der folgende Code zeigt, wie man den obigen Prozess durchf\xfchrt:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'// Login in mini program\nwx.login({\n  success: res => {\n    // This is the login code that needs to be sent to Casdoor\n    console.log(res.code)\n\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/login/oauth/access_token`,\n      method: "POST",\n      data: {\n        "tag": "wechat_miniprogram", // Required\n        "client_id": "6825f4f0af45554c8952",\n        "code": res.code,\n        "username": this.data.userInfo.nickName, // Update user profile when you log in.\n        "avatar": this.data.userInfo.avatarUrl,\n      },\n      header:{\n        "content-type": "application/x-www-form-urlencoded",\n      },\n      success: res => {\n        console.log(res)\n        this.globalData.accessToken = res.data.access_token // Get Casdoor\'s access token\n      }\n    })\n  }\n})\n')),(0,i.kt)("p",null,"Es ist wichtig zu beachten, dass der ",(0,i.kt)("inlineCode",{parentName:"p"},"tag"),"-Parameter obligatorisch ist, um Casdoor zu informieren, dass dies eine Anfrage vom WeChat Mini Program ist."),(0,i.kt)("p",null,"Der obige Code beinhaltet den Benutzernamen und die Avatar-URI des WeChat Mini Program-Benutzers w\xe4hrend der Anmeldung. Sie k\xf6nnen w\xe4hlen, diese beiden Parameter separat zu \xfcbergeben und sie dann nach einer erfolgreichen Anmeldung und dem Erhalt des Zugriffstokens an Casdoor weiterzugeben:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'wx.getUserProfile({\n  desc: \'share your info to Casdoor\', \n  success: (res) => {\n    this.setData({\n      userInfo: res.userInfo,\n      hasUserInfo: true\n    })\n    console.log(app.globalData.accessToken)\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/update-user`, // Casdoor URL\n      method: "POST",\n      data: {\n        "owner": "test",\n        "name": "wechat-oGk3T5tIiMFo3SazCO75f0HEiE7Q",\n        "displayName": this.data.userInfo.nickName,\n        "avatar": this.data.userInfo.avatarUrl\n      },\n      header: {\n        "Authorization": "Bearer " + app.globalData.accessToken, // Bearer token\n        "content-type": "application/json"\n      },\n      success: (res) => {\n        console.log(res)\n      }\n    })\n  }\n})\n')),(0,i.kt)("p",null,"Zus\xe4tzlich k\xf6nnen Sie das Zugriffstoken als Bearer-Token f\xfcr jede Casdoor-Operation verwenden, die Sie ben\xf6tigen."),(0,i.kt)("admonition",{title:"Tips",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Derzeit ist Casdoor nicht in der Lage, bestehende Konten an WeChat Mini Program-Benutzer zu binden. Nachdem Casdoor die OpenID von WeChat abgerufen hat, wird entweder ein neuer Benutzer erstellt, wenn die ID nicht existiert, oder der vorhandene Benutzer verwendet, wenn sie existiert.")))}u.isMDXComponent=!0},66496:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},72503:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/WeChat_MiniProgram-701cc38162bc50d472b5226e5f167e3c.png"}}]);