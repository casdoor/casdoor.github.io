"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[6229],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(r),m=o,h=d["".concat(u,".").concat(m)]||d[m]||c[m]||a;return r?n.createElement(h,i(i({ref:t},p),{},{components:r})):n.createElement(h,i({ref:t},p))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=d;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},44502:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var n=r(87462),o=(r(67294),r(3905));const a={title:"NginxCommunityVersion",description:"Utilisation de Casdoor avec Nginx (pas Nginx-Plus) et Oauth2-Proxy",keywords:["nginx","OAuth2-Proxy","nginx-community-version"],authors:["gzyzhy"]},i=void 0,s={unversionedId:"integration/C++/NginxCommunityVersion",id:"integration/C++/NginxCommunityVersion",title:"NginxCommunityVersion",description:"Utilisation de Casdoor avec Nginx (pas Nginx-Plus) et Oauth2-Proxy",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/integration/C++/NginxCommunityVersion.md",sourceDirName:"integration/C++",slug:"/integration/C++/NginxCommunityVersion",permalink:"/fr/docs/integration/C++/NginxCommunityVersion",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/C++/NginxCommunityVersion.md",tags:[],version:"current",frontMatter:{title:"NginxCommunityVersion",description:"Utilisation de Casdoor avec Nginx (pas Nginx-Plus) et Oauth2-Proxy",keywords:["nginx","OAuth2-Proxy","nginx-community-version"],authors:["gzyzhy"]},sidebar:"tutorialSidebar",previous:{title:"Nginx",permalink:"/fr/docs/integration/C++/Nginx"},next:{title:"Envoy",permalink:"/fr/docs/integration/C++/Envoy"}},u={},l=[{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"I. Configurer Casdoor",id:"i-configurer-casdoor",level:2},{value:"II. Configurer Oauth2-Proxy",id:"ii-configurer-oauth2-proxy",level:2},{value:"III. Configurer Nginx",id:"iii-configurer-nginx",level:2},{value:"Test",id:"test",level:2},{value:"D\xe9pannage",id:"d\xe9pannage",level:2}],p={toc:l};function c(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,o.kt)("p",null,"Ce guide suppose que vous avez les conditions suivantes :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Service Casdoor en fonctionnement. Si vous n'avez pas encore install\xe9 le service Casdoor, veuillez vous r\xe9f\xe9rer \xe0 ",(0,o.kt)("a",{parentName:"li",href:"https://casdoor.org/docs/basic/server-installation"},"Installation du Serveur")," ou ",(0,o.kt)("a",{parentName:"li",href:"https://casdoor.org/docs/basic/try-with-docker"},"Essayer avec Docker"),"."),(0,o.kt)("li",{parentName:"ul"},"\xc9dition open-source de Nginx avec le module ",(0,o.kt)("inlineCode",{parentName:"li"},"ngx_http_auth_request_module")," activ\xe9 lors de la compilation. Si vous ne savez pas comment activer le module ",(0,o.kt)("inlineCode",{parentName:"li"},"ngx_http_auth_request_module"),", veuillez vous r\xe9f\xe9rer au ",(0,o.kt)("a",{parentName:"li",href:"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html"},"Document du Module Nginx"),"."),(0,o.kt)("li",{parentName:"ul"},"Le site web sur lequel vous souhaitez activer l'authentification est d\xe9ploy\xe9 avec succ\xe8s sur Nginx, avec un ",(0,o.kt)("strong",{parentName:"li"},"nom de domaine configur\xe9")," (au lieu d'utiliser une adresse IP), et peut \xeatre normalement accessible."),(0,o.kt)("li",{parentName:"ul"},"Outil OAuth2-Proxy (actuellement, les deux projets populaires suivants avec un grand nombre d'\xe9toiles sont disponibles sur GitHub, et vous devez en choisir un) :")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"oauth2-proxy/oauth2-proxy (utilis\xe9 dans cet article) ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub")," OU ",(0,o.kt)("a",{parentName:"li",href:"https://oauth2-proxy.github.io/oauth2-proxy"},"Site Officiel")),(0,o.kt)("li",{parentName:"ol"},"vouch/vouch-proxy ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/vouch/vouch-proxy"},"GitHub"))),(0,o.kt)("h2",{id:"i-configurer-casdoor"},"I. Configurer Casdoor"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Remarque")," : Les op\xe9rations dans cet article sont bas\xe9es sur l'interface utilisateur de Casdoor au moment de la publication, mais l'interface utilisateur de Casdoor peut changer en fonction de la version. Veuillez suivre les r\xe9f\xe9rences fournies dans cet article pour configurer votre version de Casdoor d\xe9ploy\xe9e."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Remarque")," : Les cl\xe9s, mots de passe, noms d'utilisateur et autres informations confidentielles mentionn\xe9s dans cet article sont tous des exemples. Pour des raisons de s\xe9curit\xe9, vous devez les remplacer par votre propre contenu pertinent lors du d\xe9ploiement."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Connectez-vous \xe0 votre compte administrateur Casdoor.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Dans la barre sup\xe9rieure, s\xe9lectionnez "Authentification d\'Identit\xe9" > "Applications", puis cliquez sur "Ajouter" sur la page "Applications".'),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"addApp",src:r(17381).Z,width:"2532",height:"1170"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Compl\xe9tez la configuration de l'application en fonction des informations de votre projet. Dans cet article, nous utilisons \"Nginx-Community\" comme nom d'application exemple."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"ConfigureApp",src:r(42002).Z,width:"2532",height:"1170"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Prenez note des valeurs des champs "Client ID" et "Client Secret". Ils seront utilis\xe9s lors de la configuration d\'OAuth2-Proxy plus tard. Configurez ensuite l\'URL de redirection comme ',(0,o.kt)("inlineCode",{parentName:"p"},"https://project.yourdomain.com/oauth2/callback/"),"."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"RecordInfo",src:r(378).Z,width:"2532",height:"1170"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Dans la barre sup\xe9rieure, s\xe9lectionnez "Gestion des Permissions Casbin" > "R\xf4les", puis cliquez sur "Ajouter" sur la page "R\xf4les".'),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"AddRole",src:r(77228).Z,width:"2532",height:"1170"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Compl\xe9tez la configuration du r\xf4le en fonction des informations de votre projet. Dans cet article, nous utilisons "nginx_role" comme nom de r\xf4le exemple.'),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"ConfigureRole",src:r(76532).Z,width:"2532",height:"1170"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'(Facultatif) Dans la barre sup\xe9rieure, s\xe9lectionnez "Gestion des Utilisateurs" > "Utilisateurs", puis ajoutez de nouveaux utilisateurs en fonction de vos besoins. Si les utilisateurs dont vous avez besoin existent d\xe9j\xe0, vous pouvez ignorer cette \xe9tape. Dans cet article, nous cr\xe9ons un utilisateur exemple nomm\xe9 "user".')),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},'Revenez \xe0 la page "R\xf4les" mentionn\xe9e \xe0 l\'\xe9tape 5, \xe9ditez le r\xf4le ',(0,o.kt)("inlineCode",{parentName:"p"},"nginx_role")," et ajoutez les utilisateurs dont vous avez besoin \xe0 l'option \"Utilisateurs Inclus\". Dans cet article, nous ajoutons ici l'utilisateur pr\xe9alablement cr\xe9\xe9 ",(0,o.kt)("inlineCode",{parentName:"p"},"builtin/user"),"."))),(0,o.kt)("h2",{id:"ii-configurer-oauth2-proxy"},"II. Configurer Oauth2-Proxy"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Remarque")," : Cet article utilise le projet Oauth2-Proxy comme exemple. Si vous souhaitez utiliser Vouch au lieu d'Oauth2-Proxy, veuillez vous r\xe9f\xe9rer \xe0 leur documentation officielle sur ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/vouch/vouch-proxy"},"GitHub"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Remarque")," : Cet article suppose que votre site est configur\xe9 avec un certificat SSL de confiance et n'autorise que l'acc\xe8s HTTPS, ou que vous avez mis en place une redirection automatique des visiteurs HTTP vers HTTPS. Cela aide \xe0 maximiser la protection des cookies et \xe0 emp\xeacher la lecture malveillante des jetons de connexion. Si votre site doit \xeatre accessible via le protocole HTTP non s\xe9curis\xe9, veuillez modifier les commandes pertinentes en cons\xe9quence. Pour plus d'aide sur le d\xe9ploiement via HTTP, veuillez vous r\xe9f\xe9rer \xe0 la documentation officielle d'Oauth2-Proxy sur ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Conseils")," : ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"OAuth2-Proxy")," propose diff\xe9rentes m\xe9thodes de d\xe9ploiement (telles que la compilation du code source, l'installation Docker, etc.). Pour faciliter l'explication, cet article utilise le \"binaire pr\xe9-construit\" pour le d\xe9ploiement."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Allez sur la page ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy/releases"},"GitHub Releases")," et t\xe9l\xe9chargez le paquet binaire correspondant \xe0 votre syst\xe8me d'exploitation et \xe0 l'architecture de votre CPU.\nAu 1er janvier 2024, la derni\xe8re version de OAuth-Proxy est ",(0,o.kt)("inlineCode",{parentName:"p"},"V7.5.1"),". Si vous souhaitez t\xe9l\xe9charger le paquet binaire pour cette version, vous pouvez ex\xe9cuter la commande suivante pour Linux avec AMD64 :"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wget -O oauth2-proxy-linux.tar.gz https://github.com/oauth2-proxy/oauth2-proxy/releases/download/v7.5.1/oauth2-proxy-v7.5.1.linux-amd64.tar.gz\n")),(0,o.kt)("p",{parentName:"li"},"Il est fortement recommand\xe9 de v\xe9rifier la valeur ",(0,o.kt)("inlineCode",{parentName:"p"},"SHA256SUM")," fournie par le site officiel sur la page ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/oauth2-proxy/oauth2-proxy/releases"},"GitHub Releases")," apr\xe8s avoir t\xe9l\xe9charg\xe9 le paquet compress\xe9 et de la comparer caract\xe8re par caract\xe8re avec la valeur ",(0,o.kt)("inlineCode",{parentName:"p"},"SHA256SUM")," du paquet que vous avez t\xe9l\xe9charg\xe9.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Extrayez le paquet t\xe9l\xe9charg\xe9 :"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"tar -zxvf oauth2-proxy-*.tar.gz\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Entrez dans le r\xe9pertoire extrait :"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd oauth2-proxy-v7.5.1.linux-amd64\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"D\xe9placez le fichier binaire obtenu dans ",(0,o.kt)("inlineCode",{parentName:"p"},"/usr/local/bin")," et configurez-le avec des permissions ex\xe9cutables. Vous devrez peut-\xeatre \xe9lever les permissions en utilisant ",(0,o.kt)("inlineCode",{parentName:"p"},"sudo")," en fonction de votre situation."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cp ./oauth2-proxy /usr/local/bin\ncd /usr/local/bin\nchmod +x ./oauth2-proxy\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Testez l'installation binaire. Si l'installation est r\xe9ussie, apr\xe8s avoir ex\xe9cut\xe9 la commande suivante, vous devriez voir une sortie similaire \xe0 ",(0,o.kt)("inlineCode",{parentName:"p"},"oauth2-proxy v7.5.1 (construit avec go1.21.1)"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\noauth2-proxy --version\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Ex\xe9cutez oauth2-proxy avec des param\xe8tres en ligne de commande. Les param\xe8tres marqu\xe9s avec ","[requis]"," doivent \xeatre configur\xe9s selon votre situation sp\xe9cifique, tandis que les param\xe8tres marqu\xe9s avec ","[facultatif]"," peuvent optimiser les performances mais peuvent \xe9galement \xeatre omis. Pour vous assurer que oauth2-proxy peut fonctionner en arri\xe8re-plan, vous pouvez utiliser des outils de surveillance de processus comme ",(0,o.kt)("inlineCode",{parentName:"p"},"Screen")," ou ",(0,o.kt)("inlineCode",{parentName:"p"},"Supervisor")," ou des outils de terminal."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"oauth2-proxy \\ \n--provider=oidc \\ #[required] Do not change\n--client-id=abc123456def \\ #[required] \"Client ID\" obtained in step I.4 above\n--client-secret=abc123456def \\ #[required] \"Client Secret\" obtained in step I.4 above\n--oidc-issuer-url=https://auth.yourdomain.com \\ #[required] Your Casdoor URL (domain name or public IP)\n--redirect-url=https://project.yourdomain.com/oauth2/callback \\ #[required] https://domain-of-the-project-to-protect/oauth2/callback \n--scope=email+profile+groups+openid \\ #[required] Obtained from Casdoor: user email, user profile, groups, and login authentication\n--cookie-domain=project.yourdomain.com \\ #[required] Domain name of the project you want to protect\n--whitelist-domain=project.yourdomain.com \\ #[required] Domain name of the project you want to protect\n--cookie-secret=abc123456def \\ #[required] Please generate a random string of numbers and letters and fill it in here\n--email-domain=* \\ #[required] List of acceptable user email domains (* means accept all domains). If the user's email suffix is not in this list, a 403 error will be returned even if the login is successful.\n--insecure-oidc-allow-unverified-email=true \\ #[required] Whether to accept users with unverified email addresses\n--http-address=http://127.0.0.1:65534 \\ #[required] Address that oauth2-proxy listens on. The port number here can be set arbitrarily. Please record the value you set, as it will be needed for configuring Nginx later.\n--cookie-expire=24h0m0s \\ #[optional] Cookie expiration time. After this period, users will need to log in again.\n--custom-sign-in-logo=https://cdn.yourdomain.com/pic/proj.png \\ #[optional] Icon displayed on the login page. It is recommended to use a rectangular image rather than a square one.\n--session-store-type=redis \\ #[optional] Use Redis cache. If you don't need Redis, you can delete this item.\n--redis-connection-url=redis://127.0.0.1:6379/0 \\ #[optional] Redis URL. If you don't need Redis, you can delete this item.\n--redis-password=123456 #[optional] Redis connection password. If you don't need Redis or Redis has no password, you can delete this item.\n")))),(0,o.kt)("h2",{id:"iii-configurer-nginx"},"III. Configurer Nginx"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Remarque")," : Veuillez confirmer \xe0 nouveau que votre Nginx a activ\xe9 le module ",(0,o.kt)("inlineCode",{parentName:"p"},"ngx_http_auth_request_module")," lors de la compilation et de l'installation \xe0 partir du code source (la commande de compilation inclut ",(0,o.kt)("inlineCode",{parentName:"p"},"--with_http_auth_request_module"),"). Si vous ne savez pas comment activer le module ",(0,o.kt)("inlineCode",{parentName:"p"},"ngx_http_auth_request_module"),", veuillez vous r\xe9f\xe9rer au ",(0,o.kt)("a",{parentName:"p",href:"https://nginx.org/en/docs/http/ngx_http_auth_request_module.html"},"Document du Module Nginx"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Conseils")," : Nginx install\xe9 \xe0 l'aide de l'outil de panneau Baota n'active pas ce module par d\xe9faut."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Ouvrez le fichier de configuration du site web que vous avez d\xe9j\xe0 d\xe9ploy\xe9 et que vous souhaitez prot\xe9ger, et apportez les modifications suivantes :"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Remarque")," : Vous devez ajuster ce fichier de configuration en fonction de votre situation sp\xe9cifique. En raison des versions de Nginx et d'autres facteurs, ce fichier de configuration peut ne pas fonctionner correctement sur toutes les instances Nginx. Veuillez ajuster le contenu pertinent en fonction de vos propres informations Nginx."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-nginx"},'server {\n    listen 443 ssl http2;\n\n    include /path/to/ssl.conf;\n\n    # Add the following content\n    location ^~ /oauth2/ {\n        proxy_pass       http://127.0.0.1:65534; # Change this to the "--http-address" configured in step II.6\n\n        proxy_set_header Host                    $host;\n        proxy_set_header X-Real-IP               $remote_addr;\n        proxy_set_header X-Scheme                $scheme;\n\n        proxy_set_header X-Auth-Request-Redirect $request_uri;\n        # or, if you are handling multiple domains:\n        # proxy_set_header X-Auth-Request-Redirect $scheme://$host$request_uri;\n    }\n    location = /oauth2/auth {\n        proxy_pass       http://127.0.0.1:65534; # Change this to the "--http-address" configured in step II.6\n\n        proxy_set_header Host             $host;\n        proxy_set_header X-Real-IP        $remote_addr;\n        proxy_set_header X-Scheme         $scheme;\n        proxy_set_header Content-Length   "";\n        proxy_pass_request_body           off;\n    }\n    location ^~ / {\n        auth_request /oauth2/auth;\n        error_page 401 = /oauth2/sign_in;\n\n        auth_request_set $user   $upstream_http_x_auth_request_user; \n        auth_request_set $email  $upstream_http_x_auth_request_email; \n        proxy_set_header X-User  $user; # Pass the username of the user logged in to your backend service\n        proxy_set_header X-Email $email; # Pass the email of the user logged in to your backend service\n\n        auth_request_set $token  $upstream_http_x_auth_request_access_token;\n        proxy_set_header X-Access-Token $token; # Pass the user\'s login token to your backend service\n\n        # The following configurations are related to cookie validation for user login\n        auth_request_set $auth_cookie $upstream_http_set_cookie;\n        add_header Set-Cookie $auth_cookie;\n\n        auth_request_set $auth_cookie_name_upstream_1 $upstream_cookie_auth_cookie_name_1;\n\n        if ($auth_cookie ~* "(; .*)") {\n            set $auth_cookie_name_0 $auth_cookie;\n            set $auth_cookie_name_1 "auth_cookie_name_1=$auth_cookie_name_upstream_1$1";\n        }   \n\n        if ($auth_cookie_name_upstream_1) {\n            add_header Set-Cookie $auth_cookie_name_0;\n            add_header Set-Cookie $auth_cookie_name_1;\n        }\n        proxy_no_cache $cookie_session;\n\n        # Provide the web page to the user after successful validation\n\n        proxy_pass http://127.0.0.1:8080; # The address where your backend service runs\n        # Note: This is not the Casdoor deployment address or the Oauth2-Proxy running address, but the address where your backend service that needs login protection runs.\n\n        # Then add configurations to pass user IP, Connection request headers, etc., to your backend service, for example:\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection upgrade;\n        proxy_set_header Accept-Encoding gzip;\n    }\n    access_log /path/to/access_log.log;\n    error_log /path/to/error_log.log;\n}\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Enregistrez le fichier et rechargez votre Nginx."))),(0,o.kt)("h2",{id:"test"},"Test"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Ensuite, vous pouvez tester votre mise en \u0153uvre."),(0,o.kt)("li",{parentName:"ul"},"Dans des circonstances normales, vos utilisateurs passeront par le processus suivant lors de la connexion \xe0 votre service :"),(0,o.kt)("li",{parentName:"ul"},"Ouvrez l'URL ",(0,o.kt)("inlineCode",{parentName:"li"},"project.yourdomain.com")," dans un navigateur -> Ne voyez qu'une page n\xe9cessitant une connexion, y compris un bouton nomm\xe9 \"Se connecter avec OpenID Connect\" -> Cliquez sur le bouton et soyez redirig\xe9 vers votre adresse Casdoor, o\xf9 il vous sera demand\xe9 de vous connecter -> Les utilisateurs entrent leur nom d'utilisateur et leur mot de passe, et Casdoor v\xe9rifie leurs informations d'identification -> Redirection automatique vers votre URL ",(0,o.kt)("inlineCode",{parentName:"li"},"project.yourdomain.com")," -> Acc\xe8s r\xe9ussi \xe0 votre service -> On demandera aux utilisateurs de se connecter \xe0 nouveau lorsque le temps ",(0,o.kt)("inlineCode",{parentName:"li"},"--cookie-expire")," que vous avez d\xe9fini expirera.")),(0,o.kt)("h2",{id:"d\xe9pannage"},"D\xe9pannage"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Si votre projet ne fonctionne pas comme pr\xe9vu, veuillez v\xe9rifier la correction de votre configuration Nginx et des param\xe8tres de configuration d'Oauth2-Proxy."),(0,o.kt)("li",{parentName:"ul"},"Vous pouvez \xe9galement vous r\xe9f\xe9rer \xe0 la documentation officielle d'Oauth2-Proxy sur ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/oauth2-proxy/oauth2-proxy"},"GitHub"),"."),(0,o.kt)("li",{parentName:"ul"},"Si vous trouvez des erreurs dans ce document, n'h\xe9sitez pas \xe0 demander des modifications sur GitHub.")))}c.isMDXComponent=!0},77228:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/AddRole-b385b307305fe11ca476ee9d0b41ab0d.png"},42002:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/ConfigureApp-fc36fc06dd93b4e8ff438a160c34a255.png"},76532:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/ConfigureRole-ba58c31b5d67a3929107a49083d6c505.png"},378:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/RecordInfo-f8bf04f982122eba51e222fd47375ce0.png"},17381:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/addApp-ce709a1272f7c601539f9dc5dfe90894.png"}}]);