"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[6721],{3905:(e,a,r)=>{r.d(a,{Zo:()=>d,kt:()=>m});var o=r(67294);function n(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function t(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?t(Object(r),!0).forEach((function(a){n(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function s(e,a){if(null==e)return{};var r,o,n=function(e,a){if(null==e)return{};var r,o,n={},t=Object.keys(e);for(o=0;o<t.length;o++)r=t[o],a.indexOf(r)>=0||(n[r]=e[r]);return n}(e,a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(o=0;o<t.length;o++)r=t[o],a.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=o.createContext({}),l=function(e){var a=o.useContext(c),r=a;return e&&(r="function"==typeof e?e(a):i(i({},a),e)),r},d=function(e){var a=l(e.components);return o.createElement(c.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},u=o.forwardRef((function(e,a){var r=e.components,n=e.mdxType,t=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(r),m=n,g=u["".concat(c,".").concat(m)]||u[m]||p[m]||t;return r?o.createElement(g,i(i({ref:a},d),{},{components:r})):o.createElement(g,i({ref:a},d))}));function m(e,a){var r=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var t=r.length,i=new Array(t);i[0]=u;var s={};for(var c in a)hasOwnProperty.call(a,c)&&(s[c]=a[c]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var l=2;l<t;l++)i[l]=r[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}u.displayName="MDXCreateElement"},10514:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>l});var o=r(87462),n=(r(67294),r(3905));const t={title:"WeChat MiniProgram",description:"Usando Casdoor en WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},i=void 0,s={unversionedId:"integration/javascript/wechat_miniprogram",id:"integration/javascript/wechat_miniprogram",title:"WeChat MiniProgram",description:"Usando Casdoor en WeChat MiniProgram",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/integration/javascript/wechat_miniprogram.md",sourceDirName:"integration/javascript",slug:"/integration/javascript/wechat_miniprogram",permalink:"/es/docs/integration/javascript/wechat_miniprogram",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/javascript/wechat_miniprogram.md",tags:[],version:"current",frontMatter:{title:"WeChat MiniProgram",description:"Usando Casdoor en WeChat MiniProgram",keywords:["WeChat","MiniProgram"],authors:["Steve0x2a"]},sidebar:"tutorialSidebar",previous:{title:"Firebase",permalink:"/es/docs/integration/javascript/firebase"},next:{title:"Lua",permalink:"/es/docs/category/lua"}},c={},l=[{value:"Introducci\xf3n",id:"introducci\xf3n",level:2},{value:"Paso 1: Desplegar Casdoor",id:"paso-1-desplegar-casdoor",level:2},{value:"Paso 2: Configurar la Aplicaci\xf3n Casdoor",id:"paso-2-configurar-la-aplicaci\xf3n-casdoor",level:2},{value:"Paso 3: Escribir C\xf3digo WeChat MiniProgram",id:"paso-3-escribir-c\xf3digo-wechat-miniprogram",level:2}],d={toc:l};function p(e){let{components:a,...t}=e;return(0,n.kt)("wrapper",(0,o.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Casdoor ahora soporta WeChat Mini Program a partir de la versi\xf3n 1.41.0.")),(0,n.kt)("h2",{id:"introducci\xf3n"},"Introducci\xf3n"),(0,n.kt)("p",null,"Dado que WeChat Mini Program no soporta OAuth estandarizado, no puede redirigir a la p\xe1gina web de Casdoor alojada por s\xed misma para iniciar sesi\xf3n. Por lo tanto, el proceso de uso de Casdoor para WeChat Mini Program es diferente al de los programas regulares."),(0,n.kt)("p",null,"Este documento explicar\xe1 c\xf3mo integrar Casdoor en WeChat Mini Program. Puedes encontrar un ejemplo de esta integraci\xf3n en GitHub aqu\xed: ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-wechat-miniprogram-example"},"casdoor-wechat-miniprogram-example"),". Para obtener m\xe1s informaci\xf3n detallada, por favor consulta el ",(0,n.kt)("a",{parentName:"p",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html"},"documento de inicio de sesi\xf3n")," de WeChat Mini Program."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"La configuraci\xf3n incluye los siguientes nombres:"),(0,n.kt)("p",{parentName:"blockquote"},(0,n.kt)("inlineCode",{parentName:"p"},"CASDOOR_HOSTNAME"),": El nombre de dominio o direcci\xf3n IP donde se despliega el servidor de Casdoor, por ejemplo, ",(0,n.kt)("inlineCode",{parentName:"p"},"https://door.casbin.com"),".")),(0,n.kt)("h2",{id:"paso-1-desplegar-casdoor"},"Paso 1: Desplegar Casdoor"),(0,n.kt)("p",null,"En primer lugar, el ",(0,n.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"servidor Casdoor")," debe ser desplegado."),(0,n.kt)("p",null,"Despu\xe9s de desplegar Casdoor con \xe9xito, necesitas asegurarte de que:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Casdoor puede ser accedido y utilizado normalmente."),(0,n.kt)("li",{parentName:"ol"},"Establece el valor de ",(0,n.kt)("inlineCode",{parentName:"li"},"origin")," de Casdoor (conf/app.conf) en ",(0,n.kt)("inlineCode",{parentName:"li"},"CASDOOR_HOSTNAME"),". ",(0,n.kt)("img",{alt:"Configuraci\xf3n de Casdoor",src:r(66496).Z,width:"1013",height:"448"}))),(0,n.kt)("h2",{id:"paso-2-configurar-la-aplicaci\xf3n-casdoor"},"Paso 2: Configurar la Aplicaci\xf3n Casdoor"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Crea un IDP de WeChat en Casdoor y proporciona el ",(0,n.kt)("inlineCode",{parentName:"li"},"APPID")," y ",(0,n.kt)("inlineCode",{parentName:"li"},"APPSECRET")," que te da la plataforma de desarrollo de WeChat Mini Program. ",(0,n.kt)("img",{alt:"WeChat_MiniProgram.png",src:r(72503).Z,width:"937",height:"773"})),(0,n.kt)("li",{parentName:"ol"},"Crea una nueva aplicaci\xf3n Casdoor o usa una existente."),(0,n.kt)("li",{parentName:"ol"},"A\xf1ade el IDP creado en el paso anterior a la aplicaci\xf3n que quieras usar.")),(0,n.kt)("admonition",{title:"Tips",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Para conveniencia, Casdoor tratar\xe1 al primer IDP tipo WeChat en la aplicaci\xf3n como el IDP de WeChat Mini Program por defecto."),(0,n.kt)("p",{parentName:"admonition"},"Por lo tanto, si quieres usar WeChat Mini Program en esta app, no a\xf1adas m\xfaltiples IDPs tipo WeChat en una sola app.")),(0,n.kt)("h2",{id:"paso-3-escribir-c\xf3digo-wechat-miniprogram"},"Paso 3: Escribir C\xf3digo WeChat MiniProgram"),(0,n.kt)("p",null,"WeChat Mini Program proporciona una API para iniciar sesi\xf3n internamente y obtener el c\xf3digo. El c\xf3digo deber\xeda entonces ser enviado a Casdoor. Casdoor usar\xe1 este c\xf3digo para recuperar informaci\xf3n (como OpenID y SessionKey) del servidor de WeChat."),(0,n.kt)("p",null,"El siguiente c\xf3digo demuestra c\xf3mo lograr el proceso anterior:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'// Login in mini program\nwx.login({\n  success: res => {\n    // This is the login code that needs to be sent to Casdoor\n    console.log(res.code)\n\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/login/oauth/access_token`,\n      method: "POST",\n      data: {\n        "tag": "wechat_miniprogram", // Required\n        "client_id": "6825f4f0af45554c8952",\n        "code": res.code,\n        "username": this.data.userInfo.nickName, // Update user profile when you log in.\n        "avatar": this.data.userInfo.avatarUrl,\n      },\n      header:{\n        "content-type": "application/x-www-form-urlencoded",\n      },\n      success: res => {\n        console.log(res)\n        this.globalData.accessToken = res.data.access_token // Get Casdoor\'s access token\n      }\n    })\n  }\n})\n')),(0,n.kt)("p",null,"Es importante notar que el par\xe1metro ",(0,n.kt)("inlineCode",{parentName:"p"},"tag")," es obligatorio para informar a Casdoor que esta es una solicitud de WeChat Mini Program."),(0,n.kt)("p",null,"El c\xf3digo anterior incluye el nombre de usuario y URI del avatar del usuario de WeChat Mini Program durante el inicio de sesi\xf3n. Puedes elegir pasar estos dos par\xe1metros por separado y luego pasarlos a Casdoor despu\xe9s de un inicio de sesi\xf3n exitoso y obtener el token de acceso:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'wx.getUserProfile({\n  desc: \'share your info to Casdoor\', \n  success: (res) => {\n    this.setData({\n      userInfo: res.userInfo,\n      hasUserInfo: true\n    })\n    console.log(app.globalData.accessToken)\n    wx.request({\n      url: `${CASDOOR_HOSTNAME}/api/update-user`, // Casdoor URL\n      method: "POST",\n      data: {\n        "owner": "test",\n        "name": "wechat-oGk3T5tIiMFo3SazCO75f0HEiE7Q",\n        "displayName": this.data.userInfo.nickName,\n        "avatar": this.data.userInfo.avatarUrl\n      },\n      header: {\n        "Authorization": "Bearer " + app.globalData.accessToken, // Bearer token\n        "content-type": "application/json"\n      },\n      success: (res) => {\n        console.log(res)\n      }\n    })\n  }\n})\n')),(0,n.kt)("p",null,"Adem\xe1s, puedes usar el token de acceso como un token portador para cualquier operaci\xf3n de Casdoor que requieras."),(0,n.kt)("admonition",{title:"Tips",type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Actualmente, Casdoor no puede vincular cuentas existentes con usuarios de WeChat Mini Program. Despu\xe9s de que Casdoor recupera el OpenID de WeChat, crear\xe1 un nuevo usuario si el ID no existe, o usar\xe1 el usuario existente si existe.")))}p.isMDXComponent=!0},66496:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/casdoor_origin-8f5d9e44f6b58828ce69e6e6d896e122.png"},72503:(e,a,r)=>{r.d(a,{Z:()=>o});const o=r.p+"assets/images/WeChat_MiniProgram-701cc38162bc50d472b5226e5f167e3c.png"}}]);