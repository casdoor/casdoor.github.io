"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[9009],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=a,k=u["".concat(p,".").concat(m)]||u[m]||c[m]||r;return n?o.createElement(k,i(i({ref:t},d),{},{components:n})):o.createElement(k,i({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},37667:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=n(87462),a=(n(67294),n(3905));const r={title:"Standard OIDC Client",description:"Using OIDC discovery to migrate to Casdoor",keywords:["OIDC","discovery","client"],authors:["nomeguy"]},i=void 0,l={unversionedId:"how-to-connect/oidc-client",id:"how-to-connect/oidc-client",title:"Standard OIDC Client",description:"Using OIDC discovery to migrate to Casdoor",source:"@site/docs/how-to-connect/oidc-client.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/oidc-client",permalink:"/docs/how-to-connect/oidc-client",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/oidc-client.md",tags:[],version:"current",frontMatter:{title:"Standard OIDC Client",description:"Using OIDC discovery to migrate to Casdoor",keywords:["OIDC","discovery","client"],authors:["nomeguy"]},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docs/how-to-connect/overview"},next:{title:"Casdoor SDKs",permalink:"/docs/how-to-connect/sdk"}},p={},s=[{value:"OIDC Discovery",id:"oidc-discovery",level:2},{value:"Global OIDC Endpoint",id:"global-oidc-endpoint",level:3},{value:"Application-Specific OIDC Endpoints",id:"application-specific-oidc-endpoints",level:3},{value:"List of OIDC Client Libraries",id:"list-of-oidc-client-libraries",level:2},{value:"OIDC UserInfo Fields",id:"oidc-userinfo-fields",level:2}],d={toc:s};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"oidc-discovery"},"OIDC Discovery"),(0,a.kt)("p",null,"Casdoor has fully implemented the OIDC protocol. If your application is already using a standard OIDC client library to connect to another OAuth 2.0 identity provider, and you want to migrate to Casdoor, using OIDC discovery will make it very easy for you to switch."),(0,a.kt)("h3",{id:"global-oidc-endpoint"},"Global OIDC Endpoint"),(0,a.kt)("p",null,"Casdoor's global OIDC discovery URL is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"<your-casdoor-backend-host>/.well-known/openid-configuration\n")),(0,a.kt)("p",null,"For example, the OIDC discovery URL for the demo site is: ",(0,a.kt)("a",{parentName:"p",href:"https://door.casdoor.com/.well-known/openid-configuration"},"https://door.casdoor.com/.well-known/openid-configuration"),", and it contains the following information:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "issuer": "https://door.casdoor.com",\n  "authorization_endpoint": "https://door.casdoor.com/login/oauth/authorize",\n  "token_endpoint": "https://door.casdoor.com/api/login/oauth/access_token",\n  "userinfo_endpoint": "https://door.casdoor.com/api/userinfo",\n  "jwks_uri": "https://door.casdoor.com/.well-known/jwks",\n  "introspection_endpoint": "https://door.casdoor.com/api/login/oauth/introspect",\n  "response_types_supported": [\n    "code",\n    "token",\n    "id_token",\n    "code token",\n    "code id_token",\n    "token id_token",\n    "code token id_token",\n    "none"\n  ],\n  "response_modes_supported": [\n    "login",\n    "code",\n    "link"\n  ],\n  "grant_types_supported": [\n    "password",\n    "authorization_code"\n  ],\n  "subject_types_supported": [\n    "public"\n  ],\n  "id_token_signing_alg_values_supported": [\n    "RS256"\n  ],\n  "scopes_supported": [\n    "openid",\n    "email",\n    "profile",\n    "address",\n    "phone",\n    "offline_access"\n  ],\n  "claims_supported": [\n    "iss",\n    "ver",\n    "sub",\n    "aud",\n    "iat",\n    "exp",\n    "id",\n    "type",\n    "displayName",\n    "avatar",\n    "permanentAvatar",\n    "email",\n    "phone",\n    "location",\n    "affiliation",\n    "title",\n    "homepage",\n    "bio",\n    "tag",\n    "region",\n    "language",\n    "score",\n    "ranking",\n    "isOnline",\n    "isAdmin",\n    "isGlobalAdmin",\n    "isForbidden",\n    "signupApplication",\n    "ldap"\n  ],\n  "request_parameter_supported": true,\n  "request_object_signing_alg_values_supported": [\n    "HS256",\n    "HS384",\n    "HS512"\n  ]\n}\n')),(0,a.kt)("h3",{id:"application-specific-oidc-endpoints"},"Application-Specific OIDC Endpoints"),(0,a.kt)("p",null,"Besides the global discovery endpoint, you can use application-specific OIDC discovery endpoints. Each application gets its own isolated OIDC configuration with a unique issuer. This comes in handy when running multi-tenant deployments where applications need their own certificates or when you want to gradually migrate applications without affecting others."),(0,a.kt)("p",null,"The application-specific discovery URL follows this pattern:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"<your-casdoor-backend-host>/.well-known/<application-name>/openid-configuration\n")),(0,a.kt)("p",null,"For example, if you have an application named ",(0,a.kt)("inlineCode",{parentName:"p"},"app-example"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://door.casdoor.com/.well-known/app-example/openid-configuration\n")),(0,a.kt)("p",null,"The main difference is that the ",(0,a.kt)("inlineCode",{parentName:"p"},"issuer")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"jwks_uri")," fields in the discovery response contain the application path. The ",(0,a.kt)("inlineCode",{parentName:"p"},"issuer")," becomes ",(0,a.kt)("inlineCode",{parentName:"p"},"https://door.casdoor.com/.well-known/app-example")," instead of just ",(0,a.kt)("inlineCode",{parentName:"p"},"https://door.casdoor.com"),", and the ",(0,a.kt)("inlineCode",{parentName:"p"},"jwks_uri")," points to ",(0,a.kt)("inlineCode",{parentName:"p"},"/.well-known/app-example/jwks"),". Everything else, including the authorization and token endpoints, stays the same."),(0,a.kt)("p",null,"You can also access the JWKS and WebFinger endpoints for each application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"<your-casdoor-backend-host>/.well-known/<application-name>/jwks\n<your-casdoor-backend-host>/.well-known/<application-name>/webfinger\n")),(0,a.kt)("p",null,"The JWKS endpoint returns the public keys for verifying tokens. When an application has its own certificate configured, that certificate is used. Otherwise, it falls back to the global certificates."),(0,a.kt)("p",null,"Here's what the responses look like. The global endpoint returns:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "issuer": "https://door.casdoor.com",\n  "jwks_uri": "https://door.casdoor.com/.well-known/jwks",\n  "authorization_endpoint": "https://door.casdoor.com/login/oauth/authorize",\n  ...\n}\n')),(0,a.kt)("p",null,"While the application-specific endpoint for ",(0,a.kt)("inlineCode",{parentName:"p"},"app-example")," returns:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "issuer": "https://door.casdoor.com/.well-known/app-example",\n  "jwks_uri": "https://door.casdoor.com/.well-known/app-example/jwks",\n  "authorization_endpoint": "https://door.casdoor.com/login/oauth/authorize",\n  ...\n}\n')),(0,a.kt)("h2",{id:"list-of-oidc-client-libraries"},"List of OIDC Client Libraries"),(0,a.kt)("p",null,"Here is a list of some OIDC client libraries for languages like Go and Java:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"OIDC client library"),(0,a.kt)("th",{parentName:"tr",align:null},"Language"),(0,a.kt)("th",{parentName:"tr",align:null},"Link"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"go-oidc"),(0,a.kt)("td",{parentName:"tr",align:null},"Go"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://github.com/coreos/go-oidc"},"https://github.com/coreos/go-oidc"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"pac4j-oidc"),(0,a.kt)("td",{parentName:"tr",align:null},"Java"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://www.pac4j.org/docs/clients/openid-connect.html"},"https://www.pac4j.org/docs/clients/openid-connect.html"))))),(0,a.kt)("p",null,"Please note that the above table is not exhaustive. For a full list of OIDC client libraries, you can find more details at:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://oauth.net/code/"},"https://oauth.net/code/")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://openid.net/certified-open-id-developer-tools/"},"https://openid.net/certified-open-id-developer-tools/"))),(0,a.kt)("h2",{id:"oidc-userinfo-fields"},"OIDC UserInfo Fields"),(0,a.kt)("p",null,"The following table illustrates how OIDC UserInfo fields (via the ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/userinfo")," API) are mapped from properties of Casdoor's User table:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Casdoor User Field"),(0,a.kt)("th",{parentName:"tr",align:null},"OIDC UserInfo Field"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Id"),(0,a.kt)("td",{parentName:"tr",align:null},"sub")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"originBackend"),(0,a.kt)("td",{parentName:"tr",align:null},"iss")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Aud"),(0,a.kt)("td",{parentName:"tr",align:null},"aud")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Name"),(0,a.kt)("td",{parentName:"tr",align:null},"preferred_username")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"DisplayName"),(0,a.kt)("td",{parentName:"tr",align:null},"name")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Email"),(0,a.kt)("td",{parentName:"tr",align:null},"email")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Avatar"),(0,a.kt)("td",{parentName:"tr",align:null},"picture")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Location"),(0,a.kt)("td",{parentName:"tr",align:null},"address")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Phone"),(0,a.kt)("td",{parentName:"tr",align:null},"phone")))),(0,a.kt)("p",null,"You can see the definition of UserInfo ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor/blob/95ab2472ce84c479be43d6fc4db6533fc738b259/object/user.go#L175-L185"},"here"),"."))}c.isMDXComponent=!0}}]);