(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[7613],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(g,i(i({ref:t},p),{},{components:n})):r.createElement(g,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";var r=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},5064:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(4034),a=n(7294),o=n(2389),i=n(9443);var l=function(){var e=(0,a.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(9558),c=n(6010),p="tabItem_1uMI";function u(e){var t,n,r,o=e.lazy,i=e.block,u=e.defaultValue,d=e.values,m=e.groupId,g=e.className,v=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&"string"==typeof e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=d?d:v.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),f=(0,s.lx)(h,(function(e,t){return e.value===t.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var k=null===u?u:null!=(t=null!=u?u:null==(n=v.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(r=v[0])?void 0:r.props.value;if(null!==k&&!h.some((function(e){return e.value===k})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+k+'" but none of its children has the corresponding value. Available values are: '+h.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var b=l(),y=b.tabGroupChoices,C=b.setTabGroupChoices,S=(0,a.useState)(k),N=S[0],w=S[1],x=[],T=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var j=y[m];null!=j&&j!==N&&h.some((function(e){return e.value===j}))&&w(j)}var O=function(e){var t=e.currentTarget,n=x.indexOf(t),r=h[n].value;r!==N&&(T(t),w(r),null!=m&&C(m,r))},I=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=x.indexOf(e.currentTarget)+1;n=x[r]||x[0];break;case"ArrowLeft":var a=x.indexOf(e.currentTarget)-1;n=x[a]||x[x.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,c.Z)("tabs",{"tabs--block":i},g)},h.map((function(e){var t=e.value,n=e.label;return a.createElement("li",{role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,className:(0,c.Z)("tabs__item",p,{"tabs__item--active":N===t}),key:t,ref:function(e){return x.push(e)},onKeyDown:I,onFocus:O,onClick:O},null!=n?n:t)}))),o?(0,a.cloneElement)(v.filter((function(e){return e.props.value===N}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==N})}))))}function d(e){var t=(0,o.Z)();return a.createElement(u,(0,r.Z)({key:String(t)},e))}},9443:function(e,t,n){"use strict";var r=(0,n(7294).createContext)(void 0);t.Z=r},3751:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return p},metadata:function(){return u},toc:function(){return d},default:function(){return g}});var r=n(4034),a=n(9973),o=(n(7294),n(3905)),i=n(5064),l=n(8215),s=["components"],c={sidebar_position:1,title:"Spring Boot"},p=void 0,u={unversionedId:"integration/spring-boot",id:"integration/spring-boot",isDocsHomePage:!1,title:"Spring Boot",description:"casdoor-spring-boot-example is an example on how to use casdoor-java-sdk in SpringBoot project. We will show you the steps below.",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/integration/spring-boot.mdx",sourceDirName:"integration",slug:"/integration/spring-boot",permalink:"/zh/docs/integration/spring-boot",editUrl:"https://github.com/casdoor/casdoor-website/tree/master/docs/integration/spring-boot.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Spring Boot"},sidebar:"tutorialSidebar",previous:{title:"\u914d\u7f6e",permalink:"/zh/docs/ldap/config"},next:{title:"Internationalization",permalink:"/zh/docs/internationalization"}},d=[{value:"Step1. Deploy Casdoor",id:"step1-deploy-casdoor",children:[],level:2},{value:"Step2. Import casdoor-java-sdk",id:"step2-import-casdoor-java-sdk",children:[],level:2},{value:"Step3. Init Config",id:"step3-init-config",children:[],level:2},{value:"Step4. Redirect to the login page",id:"step4-redirect-to-the-login-page",children:[],level:2},{value:"Step5. Get token and parse",id:"step5-get-token-and-parse",children:[],level:2},{value:"Step6. UserService",id:"step6-userservice",children:[],level:2}],m={toc:d};function g(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-spring-boot-example"},"casdoor-spring-boot-example")," is an example on how to use ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-java-sdk"},"casdoor-java-sdk")," in SpringBoot project. We will show you the steps below."),(0,o.kt)("h2",{id:"step1-deploy-casdoor"},"Step1. Deploy Casdoor"),(0,o.kt)("p",null,"Firstly, the Casdoor should be deployed."),(0,o.kt)("p",null,"You can refer to the Casdoor official documentation for the ",(0,o.kt)("a",{parentName:"p",href:"https://casdoor.org/docs/basic/installation"},"Install Guide"),"."),(0,o.kt)("p",null,"After a successful deployment, you need to ensure:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The Casdoor server is successfully running on ",(0,o.kt)("strong",{parentName:"li"},"http://localhost:8000"),"."),(0,o.kt)("li",{parentName:"ul"},"Open your favorite browser and visit ",(0,o.kt)("strong",{parentName:"li"},"http://localhost:7001"),", you will see the login page of Casdoor."),(0,o.kt)("li",{parentName:"ul"},"Input ",(0,o.kt)("inlineCode",{parentName:"li"},"admin")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"123")," to test login functionality is working fine.")),(0,o.kt)("p",null,"Then you can quickly implement a casdoor based login page in your own app with the following steps."),(0,o.kt)("h2",{id:"step2-import-casdoor-java-sdk"},"Step2. Import casdoor-java-sdk"),(0,o.kt)("p",null,"You can import the casdoor-java-sdk with  maven or gradle."),(0,o.kt)(i.Z,{defaultValue:"maven",groupId:"import-sdk",values:[{label:"Maven",value:"maven"},{label:"Gradle",value:"gradle"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"maven",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.casbin</groupId>\n    <artifactId>casdoor-java-sdk</artifactId>\n    <version>1.x.y</version>\n</dependency>\n"))),(0,o.kt)(l.Z,{value:"gradle",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"implementation 'org.casbin:casdoor-java-sdk:1.x.y'\n")))),(0,o.kt)("h2",{id:"step3-init-config"},"Step3. Init Config"),(0,o.kt)("p",null,"Initialization requires 6 parameters, which are all string type.\n| Name (in order)  | Must | Description                                         |\n| ---------------- | ---- | --------------------------------------------------- |\n| endpoint         | Yes  | Casdoor Server Url, such as ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8000")," |\n| clientId         | Yes  | Application.client_id                               |\n| clientSecret     | Yes  | Application.client_secret                           |\n| jwtSecret        | Yes  | Same as Casdoor JWT secret.                         |\n| organizationName | Yes  | Application.organization                            |\n| applicationName  | Yes  | Application.name                                    |\nYou can use Java properties or YAML files to init as below."),(0,o.kt)(i.Z,{defaultValue:"properties",groupId:"configuration",values:[{label:"Properties",value:"properties"},{label:"YML",value:"yml"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"properties",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-properties"},"casdoor.endpoint = http://localhost:8000\ncasdoor.clientId = 874e3e05e58d50148c65\ncasdoor.clientSecret = 41510b84c7267ad2e4d2b51096b7f11dc9c5fdc8\ncasdoor.jwtSecret = CasdoorSecret\ncasdoor.organizationName = built-in\ncasdoor.applicationName = app-built-in\n"))),(0,o.kt)(l.Z,{value:"yml",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"casdoor:\n  endpoint: http://localhost:8000\n  client-id: 874e3e05e58d50148c65\n  client-secret: 41510b84c7267ad2e4d2b51096b7f11dc9c5fdc8\n  jwt-secret: CasdoorSecret\n  organization-name: built-in\n  application-name: app-built-in\n")))),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You should replace the configuration with your own Casdoor instance especially the ",(0,o.kt)("inlineCode",{parentName:"p"},"clientId")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"clientSecret"),"."))),(0,o.kt)("p",null,"Then create ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkProperties")," class, declare member variables corresponding to the configuration and provide getter and setter."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@Data\n@Component\n@ConfigurationProperties(prefix = "casdoor")\npublic class CasdoorSdkProperties {\n    private String endpoint;\n    private String clientId;\n    private String clientSecret;\n    private String jwtSecret;\n    private String organizationName;\n    private String applicationName;\n}\n')),(0,o.kt)("p",null,"Create ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkConfig")," class, init ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorConfig")," with the instance of CasdoorSdkProperties."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class CasdoorSdkConfig {\n\n    @Resource\n    private CasdoorSdkProperties casdoorSdkProperties;\n\n    @Bean\n    public CasdoorConfig getCasdoorConfig() {\n        return new CasdoorConfig(\n                casdoorSdkProperties.getEndpoint(),\n                casdoorSdkProperties.getClientId(),\n                casdoorSdkProperties.getClientSecret(),\n                casdoorSdkProperties.getJwtSecret(),\n                casdoorSdkProperties.getOrganizationName(),\n                casdoorSdkProperties.getApplicationName()\n        );\n    }\n}\n")),(0,o.kt)("p",null,"When SpringBoot Application starts, the configuration in Java properties or YAML is automatically injected into the member variables in ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkProperties")," class."),(0,o.kt)("p",null,"So you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"getCasdoorConfig")," method in ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkConfig")," class to get ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorConfig")," instance anywhere."),(0,o.kt)("h2",{id:"step4-redirect-to-the-login-page"},"Step4. Redirect to the login page"),(0,o.kt)("p",null,"When you need the authentication who access your app, you can send the target url and redirect to the login page provided by Casdoor."),(0,o.kt)("p",null,"Please be sure that you have added the callback url (e.g. ",(0,o.kt)("strong",{parentName:"p"},"http://localhost:8080/login"),") in application configuration in advance."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping("toLogin")\npublic String toLogin() {\n    CasdoorConfig casdoorConfig = casdoorSdkConfig.getCasdoorConfig();\n    String targetUrl = String.format("%s/login/oauth/authorize?client_id=%s&response_type=code&redirect_uri=%s&scope=read&state=%s",\n            "http://localhost:7001", casdoorConfig.getClientId(),\n            "http://localhost:8080/login", casdoorConfig.getApplicationName());\n    return "redirect:" + targetUrl;\n}\n')),(0,o.kt)("h2",{id:"step5-get-token-and-parse"},"Step5. Get token and parse"),(0,o.kt)("p",null,"After Casdoor verification passed, it will be redirected to your application with code and state."),(0,o.kt)("p",null,"You can get the code and call ",(0,o.kt)("inlineCode",{parentName:"p"},"getOAuthToken")," method, then parse out jwt token."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorUser")," contains the basic information about the user provided by Casdoor, you can use it as a keyword to set the session in your application."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping("login")\npublic String login(String code, String state, HttpServletRequest request) {\n    CasdoorAuthService casdoorAuthService = new CasdoorAuthService(casdoorSdkConfig.getCasdoorConfig());\n    String token = "";\n    CasdoorUser user = null;\n    try {\n        token = casdoorAuthService.getOAuthToken(code, state);\n        user = casdoorAuthService.parseJwtToken(token);\n    } catch (OAuthSystemException | OAuthProblemException | ParseException | InvocationTargetException | IllegalAccessException e) {\n        e.printStackTrace();\n    }\n    HttpSession session = request.getSession();\n    session.setAttribute("casdoorUser", user);\n    return "redirect:/";\n}\n')),(0,o.kt)("h2",{id:"step6-userservice"},"Step6. UserService"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorUserService")," support basic user operations, like:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GetUser(name string)"),", get one user by user name."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GetUsers()"),", get all users."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UpdateUser(auth.User)/AddUser(auth.User)/DeleteUser(auth.User)"),", write user to database.")))}g.isMDXComponent=!0}}]);