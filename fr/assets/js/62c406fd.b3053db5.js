"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[7316],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,k=d["".concat(l,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(k,i(i({ref:t},p),{},{components:n})):r.createElement(k,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},27054:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var r=n(87462),a=(n(67294),n(3905));const o={title:"OAuth 2.0",description:"Utilisation de l'Access Token pour authentifier les clients",keywords:["OAuth 2.0","access token","refresh token"],authors:["nomeguy"]},i=void 0,s={unversionedId:"how-to-connect/oauth",id:"how-to-connect/oauth",title:"OAuth 2.0",description:"Utilisation de l'Access Token pour authentifier les clients",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/how-to-connect/oauth.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/oauth",permalink:"/fr/docs/how-to-connect/oauth",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/oauth.md",tags:[],version:"current",frontMatter:{title:"OAuth 2.0",description:"Utilisation de l'Access Token pour authentifier les clients",keywords:["OAuth 2.0","access token","refresh token"],authors:["nomeguy"]},sidebar:"tutorialSidebar",previous:{title:"Nuxt",permalink:"/fr/docs/how-to-connect/nuxt"},next:{title:"Utilisation de Casdoor comme serveur CAS",permalink:"/fr/docs/how-to-connect/cas"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Comment obtenir un Access Token",id:"comment-obtenir-un-access-token",level:2},{value:'Authorization Code Grant<span id="1"></span>',id:"authorization-code-grant",level:3},{value:"Port\xe9es disponibles",id:"port\xe9es-disponibles",level:4},{value:"Implicit Grant",id:"implicit-grant",level:3},{value:"Resource Owner Password Credentials Grant",id:"resource-owner-password-credentials-grant",level:3},{value:"Client Credentials Grant",id:"client-credentials-grant",level:3},{value:"Refresh Token",id:"refresh-token",level:3},{value:"Comment v\xe9rifier l&#39;Access Token",id:"comment-v\xe9rifier-laccess-token",level:2},{value:"Comment utiliser <code>AccessToken</code>",id:"comment-utiliser-accesstoken",level:2},{value:"Diff\xe9rences entre les API <code>userinfo</code> et <code>get-account</code>",id:"diff\xe9rences-entre-les-api-userinfo-et-get-account",level:2}],p={toc:u};function c(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Casdoor prend en charge l'utilisation de l'Access Token pour authentifier les clients. Dans cette section, nous allons vous montrer comment obtenir un Access Token, comment v\xe9rifier un Access Token et comment utiliser un Access Token."),(0,a.kt)("h2",{id:"comment-obtenir-un-access-token"},"Comment obtenir un Access Token"),(0,a.kt)("p",null,"Il y a deux fa\xe7ons d'obtenir un Access Token : vous pouvez utiliser les ",(0,a.kt)("a",{parentName:"p",href:"/docs/how-to-connect/sdk"},"SDKs Casdoor"),". Pour des informations d\xe9taill\xe9es, veuillez vous r\xe9f\xe9rer \xe0 la documentation SDK. Ici, nous allons principalement vous montrer comment utiliser l'API pour obtenir l'Access Token."),(0,a.kt)("p",null,"Casdoor prend en charge quatre types d'autorisation OAuth : ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.1"},"Authorization Code Grant"),", ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.2"},"Implicit Grant"),", ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.3"},"Resource Owner Password Credentials Grant"),", et ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.4"},"Client Credentials Grant"),"."),(0,a.kt)("p",null,"Pour des raisons de s\xe9curit\xe9, l'application Casdoor a le mode code d'autorisation activ\xe9 par d\xe9faut. Si vous avez besoin d'utiliser d'autres modes, veuillez aller \xe0 l'application appropri\xe9e pour le configurer."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Types d&#39;autorisation",src:n(67093).Z,width:"1493",height:"529"})),(0,a.kt)("h3",{id:"authorization-code-grant"},"Authorization Code Grant",(0,a.kt)("span",{id:"1"})),(0,a.kt)("p",null,"Tout d'abord, redirigez vos utilisateurs vers :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/login/oauth/authorize?\nclient_id=CLIENT_ID&\nredirect_uri=REDIRECT_URI&\nresponse_type=code&\nscope=openid&\nstate=STATE\n")),(0,a.kt)("h4",{id:"port\xe9es-disponibles"},"Port\xe9es disponibles"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Nom"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"openid (no scope)"),(0,a.kt)("td",{parentName:"tr",align:null},"sub (id de l'utilisateur), iss (\xe9metteur), et aud (audience)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"profile"),(0,a.kt)("td",{parentName:"tr",align:null},"informations du profil utilisateur, y compris le nom, displayName, et avatar")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"email"),(0,a.kt)("td",{parentName:"tr",align:null},"adresse e-mail de l'utilisateur")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"address"),(0,a.kt)("td",{parentName:"tr",align:null},"adresse de l'utilisateur")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"phone"),(0,a.kt)("td",{parentName:"tr",align:null},"num\xe9ro de t\xe9l\xe9phone de l'utilisateur")))),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Votre application OAuth peut demander les port\xe9es lors de la redirection initiale. Vous pouvez sp\xe9cifier plusieurs port\xe9es en les s\xe9parant par un espace en utilisant %20 :"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-text"},"https://<CASDOOR_HOST>/login/oauth/authorize?\nclient_id=...&\nscope=openid%20email\n")),(0,a.kt)("p",{parentName:"admonition"},"Pour plus de d\xe9tails, veuillez consulter la ",(0,a.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfoResponse"},"norme OIDC"))),(0,a.kt)("p",null,"Apr\xe8s que votre utilisateur se soit authentifi\xe9 avec Casdoor, Casdoor le redirigera vers :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://REDIRECT_URI?code=CODE&state=STATE\n")),(0,a.kt)("p",null,"Maintenant que vous avez obtenu le code d'autorisation, faites une requ\xeate POST \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/api/login/oauth/access_token\n")),(0,a.kt)("p",null,"dans votre application backend :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "authorization_code",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n    "code": Code,\n}\n')),(0,a.kt)("p",null,"Vous obtiendrez la r\xe9ponse suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Casdoor prend \xe9galement en charge la fonctionnalit\xe9 ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7636"},"PKCE"),". Lors de l'obtention du code d'autorisation, vous pouvez ajouter deux param\xe8tres pour activer PKCE :"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-url"},"&code_challenge_method=S256&code_challenge=VOTRE_CHALLENGE\n")),(0,a.kt)("p",{parentName:"admonition"},"Lors de l'obtention du token, vous devez passer le param\xe8tre ",(0,a.kt)("inlineCode",{parentName:"p"},"code_verifier")," pour v\xe9rifier PKCE. Il est \xe0 noter qu'avec PKCE activ\xe9, ",(0,a.kt)("inlineCode",{parentName:"p"},"Client_Secret")," n'est pas requis, mais si vous le passez, il doit \xeatre la valeur correcte.")),(0,a.kt)("h3",{id:"implicit-grant"},"Implicit Grant"),(0,a.kt)("p",null,"Peut-\xeatre que votre application n'a pas de backend, et vous devez utiliser Implicit Grant. Tout d'abord, vous devez vous assurer que vous avez Implicit Grant activ\xe9, puis redirigez vos utilisateurs vers :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/login/oauth/authorize?client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&response_type=token&scope=openid&state=STATE\n")),(0,a.kt)("p",null,"Apr\xe8s que votre utilisateur se soit authentifi\xe9 avec Casdoor, Casdoor le redirigera vers :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://REDIRECT_URI/#access_token=ACCESS_TOKEN\n")),(0,a.kt)("p",null,"Casdoor prend \xe9galement en charge le ",(0,a.kt)("a",{parentName:"p",href:"https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html#id_token"},"id_token")," comme ",(0,a.kt)("inlineCode",{parentName:"p"},"response_type"),", qui est une fonctionnalit\xe9 d'OpenID."),(0,a.kt)("h3",{id:"resource-owner-password-credentials-grant"},"Resource Owner Password Credentials Grant"),(0,a.kt)("p",null,"Si votre application n'a pas de frontend qui redirige les utilisateurs vers Casdoor, alors vous pourriez avoir besoin de ceci."),(0,a.kt)("p",null,"Tout d'abord, vous devez vous assurer que vous avez Password Credentials Grant activ\xe9 et envoyer une requ\xeate POST \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/api/login/oauth/access_token\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "password",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n    "username": Username,\n    "password": Password,\n}\n')),(0,a.kt)("p",null,"Vous obtiendrez la r\xe9ponse suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("h3",{id:"client-credentials-grant"},"Client Credentials Grant"),(0,a.kt)("p",null,"Vous pouvez \xe9galement utiliser Client Credentials Grant lorsque votre application n'a pas de frontend."),(0,a.kt)("p",null,"Tout d'abord, vous devez vous assurer que vous avez Client Credentials Grant activ\xe9 et envoyer une requ\xeate POST \xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/login/oauth/access_token")," :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "client_credentials",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n}\n')),(0,a.kt)("p",null,"Vous obtiendrez la r\xe9ponse suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("p",null,"Il est important de noter que l'AccessToken obtenu de cette mani\xe8re diff\xe8re des trois premiers en ce qu'il correspond \xe0 l'application plut\xf4t qu'\xe0 l'utilisateur."),(0,a.kt)("h3",{id:"refresh-token"},"Refresh Token"),(0,a.kt)("p",null,"Peut-\xeatre que vous souhaitez mettre \xe0 jour votre Access Token, alors vous pouvez utiliser le ",(0,a.kt)("inlineCode",{parentName:"p"},"refreshToken")," que vous avez obtenu ci-dessus."),(0,a.kt)("p",null,"Tout d'abord, vous devez d\xe9finir le temps d'expiration du Refresh Token dans l'application (par d\xe9faut c'est 0 heures), et envoyer une requ\xeate POST \xe0 ",(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/login/oauth/refresh_token")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "refresh_token",\n    "refresh_token": REFRESH_TOKEN,\n    "scope": SCOPE,\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n}\n')),(0,a.kt)("p",null,"Vous obtiendrez une r\xe9ponse comme celle-ci :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("h2",{id:"comment-v\xe9rifier-laccess-token"},"Comment v\xe9rifier l'Access Token"),(0,a.kt)("p",null,"Casdoor prend actuellement en charge le point de terminaison ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7662"},"d'introspection de token"),". Ce point de terminaison est prot\xe9g\xe9 par une authentification de base (ClientId:ClientSecret)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-http"},"POST /api/login/oauth/introspect HTTP/1.1\nHost: CASDOOR_HOST\nAccept: application/json\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=\n\ntoken=ACCESS_TOKEN&token_type_hint=access_token\n")),(0,a.kt)("p",null,"Vous recevrez la r\xe9ponse suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "active": true,\n    "client_id": "c58c...",\n    "username": "admin",\n    "token_type": "Bearer",\n    "exp": 1647138242,\n    "iat": 1646533442,\n    "nbf": 1646533442,\n    "sub": "7a6b4a8a-b731-48da-bc44-36ae27338817",\n    "aud": [\n        "c58c..."\n    ],\n    "iss": "http://localhost:8000"\n}\n')),(0,a.kt)("h2",{id:"comment-utiliser-accesstoken"},"Comment utiliser ",(0,a.kt)("inlineCode",{parentName:"h2"},"AccessToken")),(0,a.kt)("p",null,"Vous pouvez utiliser AccessToken pour acc\xe9der aux API Casdoor qui n\xe9cessitent une authentification."),(0,a.kt)("p",null,"Par exemple, il existe deux fa\xe7ons diff\xe9rentes de demander ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/userinfo"),"."),(0,a.kt)("p",null,"Type 1 : Param\xe8tre de requ\xeate"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/userinfo?accessToken=<your_access_token>")),(0,a.kt)("p",null,"Type 2 : Token porteur HTTP"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/userinfo"),' with the header: "Authorization: Bearer <your_access_token>"'),(0,a.kt)("p",null,"Casdoor analysera l'access_token et retournera les informations utilisateur correspondantes selon le ",(0,a.kt)("inlineCode",{parentName:"p"},"scope"),". Vous recevrez la m\xeame r\xe9ponse, qui ressemble \xe0 ceci :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "sub": "7a6b4a8a-b731-48da-bc44-36ae27338817",\n    "iss": "http://localhost:8000",\n    "aud": "c58c..."\n}\n')),(0,a.kt)("p",null,"Si vous attendez plus d'informations sur l'utilisateur, ajoutez ",(0,a.kt)("inlineCode",{parentName:"p"},"scope")," lors de l'obtention de l'AccessToken \xe0 l'\xe9tape ",(0,a.kt)("a",{parentName:"p",href:"#1"},"Authorization Code Grant"),"."),(0,a.kt)("h2",{id:"diff\xe9rences-entre-les-api-userinfo-et-get-account"},"Diff\xe9rences entre les API ",(0,a.kt)("inlineCode",{parentName:"h2"},"userinfo")," et ",(0,a.kt)("inlineCode",{parentName:"h2"},"get-account")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"/api/userinfo")," : Cette API retourne des informations utilisateur dans le cadre du protocole OIDC. Elle fournit des informations limit\xe9es, incluant uniquement les informations de base d\xe9finies dans les normes OIDC. Pour une liste des port\xe9es disponibles prises en charge par Casdoor, veuillez vous r\xe9f\xe9rer \xe0 la section ",(0,a.kt)("a",{parentName:"p",href:"#available-scopes"},"port\xe9es disponibles"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"/api/get-account")," : Cette API r\xe9cup\xe8re l'objet utilisateur pour le compte actuellement connect\xe9. C'est une API sp\xe9cifique \xe0 Casdoor qui vous permet d'obtenir toutes les informations de l'",(0,a.kt)("a",{parentName:"p",href:"/docs/basic/core-concepts#user"},"utilisateur")," dans Casdoor."))))}c.isMDXComponent=!0},67093:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/accesstoken_grant_types-a3a06e2f0f56b34ddf752837c834771e.png"}}]);