(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[4062],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,v=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(v,i(i({ref:t},p),{},{components:n})):r.createElement(v,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";var r=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},5064:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(4034),a=n(7294),o=n(2389),i=n(9443);var l=function(){var e=(0,a.useContext)(i.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(9558),u=n(6010),p="tabItem_1uMI";function c(e){var t,n,r,o=e.lazy,i=e.block,c=e.defaultValue,d=e.values,m=e.groupId,v=e.className,g=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&"string"==typeof e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=d?d:g.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),k=(0,s.lx)(f,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===c?c:null!=(t=null!=c?c:null==(n=g.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(r=g[0])?void 0:r.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var h=l(),C=h.tabGroupChoices,y=h.setTabGroupChoices,N=(0,a.useState)(b),S=N[0],x=N[1],j=[],O=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var w=C[m];null!=w&&w!==S&&f.some((function(e){return e.value===w}))&&x(w)}var T=function(e){var t=e.currentTarget,n=j.indexOf(t),r=f[n].value;r!==S&&(O(t),x(r),null!=m&&y(m,r))},P=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=j.indexOf(e.currentTarget)+1;n=j[r]||j[0];break;case"ArrowLeft":var a=j.indexOf(e.currentTarget)-1;n=j[a]||j[j.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":i},v)},f.map((function(e){var t=e.value,n=e.label;return a.createElement("li",{role:"tab",tabIndex:S===t?0:-1,"aria-selected":S===t,className:(0,u.Z)("tabs__item",p,{"tabs__item--active":S===t}),key:t,ref:function(e){return j.push(e)},onKeyDown:P,onFocus:T,onClick:T},null!=n?n:t)}))),o?(0,a.cloneElement)(g.filter((function(e){return e.props.value===S}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},g.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==S})}))))}function d(e){var t=(0,o.Z)();return a.createElement(c,(0,r.Z)({key:String(t)},e))}},9443:function(e,t,n){"use strict";var r=(0,n(7294).createContext)(void 0);t.Z=r},6055:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return d},default:function(){return v}});var r=n(4034),a=n(9973),o=(n(7294),n(3905)),i=n(5064),l=n(8215),s=["components"],u={sidebar_position:1,title:"Boot de Printemps"},p=void 0,c={unversionedId:"integration/spring-boot",id:"integration/spring-boot",isDocsHomePage:!1,title:"Boot de Printemps",description:"casdoor-spring-boot-example est un exemple sur la fa\xe7on d'utiliser casdoor-java-sdk dans le projet SpringBoot. Nous vous montrerons les \xe9tapes ci-dessous.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/integration/spring-boot.mdx",sourceDirName:"integration",slug:"/integration/spring-boot",permalink:"/fr/docs/integration/spring-boot",editUrl:"https://github.com/casdoor/casdoor-website/tree/master/docs/integration/spring-boot.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Boot de Printemps"},sidebar:"tutorialSidebar",previous:{title:"Configuration",permalink:"/fr/docs/ldap/config"},next:{title:"Jenkins (OIDC)",permalink:"/fr/docs/integration/jenkins"}},d=[{value:"\xc9tape 1. D\xe9ployer la porte de caisse",id:"\xe9tape-1-d\xe9ployer-la-porte-de-caisse",children:[],level:2},{value:"\xc9tape 2. Importer casdoor-java-sdk",id:"\xe9tape-2-importer-casdoor-java-sdk",children:[],level:2},{value:"\xc9tape 3. Configuration d&#39;initialisation",id:"\xe9tape-3-configuration-dinitialisation",children:[],level:2},{value:"\xc9tape 4. Rediriger vers la page de connexion",id:"\xe9tape-4-rediriger-vers-la-page-de-connexion",children:[],level:2},{value:"\xc9tape 5. Obtenir le jeton et analyser",id:"\xe9tape-5-obtenir-le-jeton-et-analyser",children:[],level:2},{value:"\xc9tape 6. Service utilisateur",id:"\xe9tape-6-service-utilisateur",children:[],level:2}],m={toc:d};function v(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-spring-boot-example"},"casdoor-spring-boot-example")," est un exemple sur la fa\xe7on d'utiliser ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casdoor/casdoor-java-sdk"},"casdoor-java-sdk")," dans le projet SpringBoot. Nous vous montrerons les \xe9tapes ci-dessous."),(0,o.kt)("h2",{id:"\xe9tape-1-d\xe9ployer-la-porte-de-caisse"},"\xc9tape 1. D\xe9ployer la porte de caisse"),(0,o.kt)("p",null,"Premi\xe8rement, la Casdoor devrait \xeatre d\xe9ploy\xe9e."),(0,o.kt)("p",null,"Vous pouvez vous r\xe9f\xe9rer \xe0 la documentation officielle de Casdoor pour l'installation du ",(0,o.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Serveur"),"."),(0,o.kt)("p",null,"Apr\xe8s un d\xe9ploiement r\xe9ussi, vous devez vous assurer :"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Le serveur Casdoor fonctionne avec succ\xe8s sur ",(0,o.kt)("strong",{parentName:"li"},"http://localhost:8000"),"."),(0,o.kt)("li",{parentName:"ul"},"Ouvrez votre navigateur favori et visitez ",(0,o.kt)("strong",{parentName:"li"},"http://localhost:7001"),", vous verrez la page de connexion de Casdoor."),(0,o.kt)("li",{parentName:"ul"},"La saisie ",(0,o.kt)("inlineCode",{parentName:"li"},"admin")," et ",(0,o.kt)("inlineCode",{parentName:"li"},"123")," pour tester la fonctionnalit\xe9 de connexion fonctionne correctement.")),(0,o.kt)("p",null,"Ensuite, vous pouvez rapidement impl\xe9menter une page de connexion bas\xe9e sur casdoor dans votre propre application avec les \xe9tapes suivantes."),(0,o.kt)("h2",{id:"\xe9tape-2-importer-casdoor-java-sdk"},"\xc9tape 2. Importer casdoor-java-sdk"),(0,o.kt)("p",null,"Vous pouvez importer la casdoor-java-sdk avec maven ou gradle."),(0,o.kt)(i.Z,{defaultValue:"maven",groupId:"import-sdk",values:[{label:"Maven",value:"maven"},{label:"Gradle",value:"gradle"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"maven",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.casbin</groupId>\n    <artifactId>casdoor-java-sdk</artifactId>\n    <version>1.x.y</version>\n</dependency>\n"))),(0,o.kt)(l.Z,{value:"gradle",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"implementation 'org.casbin:casdoor-java-sdk:1.x.y'\n")))),(0,o.kt)("h2",{id:"\xe9tape-3-configuration-dinitialisation"},"\xc9tape 3. Configuration d'initialisation"),(0,o.kt)("p",null,"L'initialisation n\xe9cessite 6 param\xe8tres, qui sont tous de type cha\xeene.\n| Nom (dans ordre)      | Doit \xeatre | Libell\xe9                                                      |\n| --------------------- | --------- | ------------------------------------------------------------ |\n| endpoint              | Oui       | Adresse du serveur Casdoor telle que ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:8000")," |\n| clientId              | Oui       | ID client de l'application                                   |\n| clientSecret          | Oui       | Mot de passe client                                          |\n| jwtSecret             | Oui       | Identique \xe0 Casdoor JWT secret.                              |\n| Nom de l'organisation | Oui       | Application.organisation                                     |\n| Nom de l'application  | Oui       | Nom de l'application                                         |\nVous pouvez utiliser les propri\xe9t\xe9s Java ou les fichiers YAML pour l'initialiser comme ci-dessous."),(0,o.kt)(i.Z,{defaultValue:"properties",groupId:"configuration",values:[{label:"Properties",value:"properties"},{label:"YML",value:"yml"}],mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"properties",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-properties"},"casdoor.endpoint = http://localhost:8000\ncasdoor.clientId = 874e3e05e58d50148c65\ncasdoor.clientSecret = 41510b84c7267ad2e4d2b51096b7f11dc9c5fdc8\ncasdoor.jwtSecret = CasdoorSecret\ncasdoor.organizationName = built-in\ncasdoor.applicationName = app-built-in\n"))),(0,o.kt)(l.Z,{value:"yml",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"casdoor:\n  endpoint: http://localhost:8000\n  client-id: 874e3e05e58d50148c65\n  client-secret: 41510b84c7267ad2e4d2b51096b7f11dc9c5fdc8\n  jwt-secret: CasdoorSecret\n  organization-name: built-in\n  application-name: app-built-in\n")))),(0,o.kt)("p",null,":::prudence\nVous devriez remplacer la configuration par votre propre instance Casdoor en particulier le ",(0,o.kt)("inlineCode",{parentName:"p"},"clientId")," et le ",(0,o.kt)("inlineCode",{parentName:"p"},"clientSecret"),".\n:::\nEnsuite, cr\xe9ez la classe ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkProperties")," , d\xe9clarez les variables membres correspondant \xe0 la configuration et fournissez getter et setter."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@Data\n@Component\n@ConfigurationProperties(prefix = "casdoor")\npublic class CasdoorSdkProperties {\n    private String endpoint;\n    private String clientId;\n    private String clientSecret;\n    private String jwtSecret;\n    private String organizationName;\n    private String applicationName;\n}\n')),(0,o.kt)("p",null,"Cr\xe9ez la classe ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkConfig")," , init ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorConfig")," avec l'instance de CasdoorSdkProperties."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class CasdoorSdkConfig {\n\n    @Resource\n    private CasdoorSdkProperties casdoorSdkProperties;\n\n    @Bean\n    public CasdoorConfig getCasdoorConfig() {\n        return new CasdoorConfig(\n                casdoorSdkProperties.getEndpoint(),\n                casdoorSdkProperties.getClientId(),\n                casdoorSdkProperties.getClientSecret(),\n                casdoorSdkProperties.getJwtSecret(),\n                casdoorSdkProperties.getOrganizationName(),\n                casdoorSdkProperties.getApplicationName()\n        );\n    }\n}\n")),(0,o.kt)("p",null,"Lorsque l'application SpringBoot d\xe9marre, la configuration dans les propri\xe9t\xe9s Java ou YAML est automatiquement inject\xe9e dans les variables membres dans la classe ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkProperties"),"."),(0,o.kt)("p",null,"Vous pouvez donc utiliser la m\xe9thode ",(0,o.kt)("inlineCode",{parentName:"p"},"getCasdoorConfig")," dans la classe ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorSdkConfig")," pour obtenir l'instance ",(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorConfig")," n'importe o\xf9."),(0,o.kt)("h2",{id:"\xe9tape-4-rediriger-vers-la-page-de-connexion"},"\xc9tape 4. Rediriger vers la page de connexion"),(0,o.kt)("p",null,"Lorsque vous avez besoin de l'authentification qui acc\xe8de \xe0 votre application, vous pouvez envoyer l'URL cible et rediriger vers la page de connexion fournie par Casdoor."),(0,o.kt)("p",null,"Veuillez vous assurer que vous avez ajout\xe9 l'url de rappel (par exemple ",(0,o.kt)("strong",{parentName:"p"},"http://localhost:8080/login"),") dans la configuration de l'application \xe0 l'avance."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping("toLogin")\npublic String toLogin() {\n    CasdoorConfig casdoorConfig = casdoorSdkConfig.getCasdoorConfig();\n    String targetUrl = String.format("%s/login/oauth/authorize?client_id=%s&response_type=code&redirect_uri=%s&scope=read&state=%s",\n            "http://localhost:7001", casdoorConfig.getClientId(),\n            "http://localhost:8080/login", casdoorConfig.getApplicationName());\n    return "redirect:" + targetUrl;\n}\n')),(0,o.kt)("h2",{id:"\xe9tape-5-obtenir-le-jeton-et-analyser"},"\xc9tape 5. Obtenir le jeton et analyser"),(0,o.kt)("p",null,"Une fois que la v\xe9rification de Casdoor est pass\xe9e, elle sera redirig\xe9e vers votre application avec le code et l'\xe9tat."),(0,o.kt)("p",null,"Vous pouvez obtenir le code et appeler la m\xe9thode ",(0,o.kt)("inlineCode",{parentName:"p"},"getOAuthToken")," , puis analyser le jeton jwt."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorUser")," contient les informations de base sur l'utilisateur fourni par Casdoor, vous pouvez l'utiliser comme un mot cl\xe9 pour d\xe9finir la session dans votre application."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping("login")\npublic String login(String code, String state, HttpServletRequest request) {\n    CasdoorAuthService casdoorAuthService = new CasdoorAuthService(casdoorSdkConfig.getCasdoorConfig());\n    String token = "";\n    CasdoorUser user = null;\n    try {\n        token = casdoorAuthService.getOAuthToken(code, state);\n        user = casdoorAuthService.parseJwtToken(token);\n    } catch (OAuthSystemException | OAuthProblemException | ParseException | InvocationTargetException | IllegalAccessException e) {\n        e.printStackTrace();\n    }\n    HttpSession session = request.getSession();\n    session.setAttribute("casdoorUser", user);\n    return "redirect:/";\n}\n')),(0,o.kt)("h2",{id:"\xe9tape-6-service-utilisateur"},"\xc9tape 6. Service utilisateur"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CasdoorUserService")," prend en charge les op\xe9rations utilisateur de base, comme:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GetUser(cha\xeene de nom)"),", obtenez un utilisateur par nom d'utilisateur."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GetUsers()"),", obtenez tous les utilisateurs."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UpdateUser(auth.User)/AddUser(auth.User)/DeleteUser(auth.User)"),", \xe9crire l'utilisateur dans la base de donn\xe9es.")))}v.isMDXComponent=!0}}]);