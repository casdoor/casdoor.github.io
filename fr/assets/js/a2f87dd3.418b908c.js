"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[1790],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),g=i,m=d["".concat(l,".").concat(g)]||d[g]||u[g]||a;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<a;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},99241:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=n(87462),i=(n(67294),n(3905));const a={title:"Filtre de s\xe9curit\xe9 Spring avec int\xe9gration OIDC pour Casdoor",description:"Cet article explique comment utiliser le filtre de s\xe9curit\xe9 Spring pour connecter votre application \xe0 Casdoor en utilisant OIDC.",keywords:["OIDC","Spirng Security","Spring Security Filter","Filter","Casdoor"],authors:["wenxuan70"]},o=void 0,s={unversionedId:"integration/java/spring-security/spring-security-filter",id:"integration/java/spring-security/spring-security-filter",title:"Filtre de s\xe9curit\xe9 Spring avec int\xe9gration OIDC pour Casdoor",description:"Cet article explique comment utiliser le filtre de s\xe9curit\xe9 Spring pour connecter votre application \xe0 Casdoor en utilisant OIDC.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/integration/java/spring-security/spring-security-filter.md",sourceDirName:"integration/java/spring-security",slug:"/integration/java/spring-security/spring-security-filter",permalink:"/fr/docs/integration/java/spring-security/spring-security-filter",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/java/spring-security/spring-security-filter.md",tags:[],version:"current",frontMatter:{title:"Filtre de s\xe9curit\xe9 Spring avec int\xe9gration OIDC pour Casdoor",description:"Cet article explique comment utiliser le filtre de s\xe9curit\xe9 Spring pour connecter votre application \xe0 Casdoor en utilisant OIDC.",keywords:["OIDC","Spirng Security","Spring Security Filter","Filter","Casdoor"],authors:["wenxuan70"]},sidebar:"tutorialSidebar",previous:{title:"Spring Security OAuth",permalink:"/fr/docs/integration/java/spring-security/spring-security-oauth"},next:{title:"Plugin Jenkins",permalink:"/fr/docs/integration/java/jenkins-plugin"}},l={},p=[{value:"\xc9tape 1 : D\xe9ployez Casdoor",id:"\xe9tape-1--d\xe9ployez-casdoor",level:2},{value:"\xc9tape 2 : Configurez l&#39;application Casdoor",id:"\xe9tape-2--configurez-lapplication-casdoor",level:2},{value:"\xc9tape 3 : Configurez Spring Security",id:"\xe9tape-3--configurez-spring-security",level:2},{value:"\xc9tape 4 : Configurez le Frontend",id:"\xe9tape-4--configurez-le-frontend",level:2},{value:"\xc9tape 5 : Mettez en place une d\xe9mo",id:"\xe9tape-5--mettez-en-place-une-d\xe9mo",level:2},{value:"\xc9tape 6 : Essayez la d\xe9mo",id:"\xe9tape-6--essayez-la-d\xe9mo",level:2}],c={toc:p};function u(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Casdoor est un IDP open-source qui prend en charge OIDC et divers autres protocoles. Dans cet article, nous verrons comment int\xe9grer Casdoor \xe0 votre application en utilisant le filtre de s\xe9curit\xe9 Spring et OIDC."),(0,i.kt)("h2",{id:"\xe9tape-1--d\xe9ployez-casdoor"},"\xc9tape 1 : D\xe9ployez Casdoor"),(0,i.kt)("p",null,"Tout d'abord, vous devez d\xe9ployer le serveur Casdoor. Reportez-vous \xe0 la ",(0,i.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"documentation officielle")," pour les instructions d'installation du serveur. Apr\xe8s un d\xe9ploiement r\xe9ussi, assurez-vous que :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Le serveur Casdoor fonctionne \xe0 ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"http://localhost:8000"},"http://localhost:8000")),"."),(0,i.kt)("li",{parentName:"ul"},"Vous pouvez voir la page de connexion Casdoor \xe0 ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"http://localhost:7001"},"http://localhost:7001")),"."),(0,i.kt)("li",{parentName:"ul"},"Vous pouvez tester la fonctionnalit\xe9 de connexion en vous connectant avec les identifiants ",(0,i.kt)("inlineCode",{parentName:"li"},"admin")," et ",(0,i.kt)("inlineCode",{parentName:"li"},"123"),".")),(0,i.kt)("p",null,"Apr\xe8s avoir v\xe9rifi\xe9 ces \xe9tapes, suivez les \xe9tapes ci-dessous pour int\xe9grer Casdoor \xe0 votre application."),(0,i.kt)("h2",{id:"\xe9tape-2--configurez-lapplication-casdoor"},"\xc9tape 2 : Configurez l'application Casdoor"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Cr\xe9ez une nouvelle application Casdoor ou utilisez-en une existante."),(0,i.kt)("li",{parentName:"ul"},"Ajoutez votre URL de redirection. Vous pouvez trouver plus d'informations sur l'obtention de l'URL de redirection dans la section suivante. ",(0,i.kt)("img",{alt:"Param\xe8tres de l&#39;application Casdoor",src:n(14794).Z,width:"974",height:"935"})),(0,i.kt)("li",{parentName:"ul"},"Obtenez votre ",(0,i.kt)("inlineCode",{parentName:"li"},"Certificat")," sur la page d'\xe9dition du certificat. ",(0,i.kt)("img",{alt:"Param\xe8tres de certification Casdoor",src:n(23185).Z,width:"1726",height:"800"})),(0,i.kt)("li",{parentName:"ul"},"Ajoutez le fournisseur et les autres param\xe8tres selon les besoins.")),(0,i.kt)("p",null,"Vous pouvez obtenir les valeurs pour ",(0,i.kt)("inlineCode",{parentName:"p"},"Nom de l'application"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Nom de l'organisation"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"URL de redirection"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"ID client"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Secret client"),", et ",(0,i.kt)("inlineCode",{parentName:"p"},"Certificat")," sur la page des param\xe8tres de l'application. Nous les utiliserons \xe0 l'\xe9tape suivante."),(0,i.kt)("h2",{id:"\xe9tape-3--configurez-spring-security"},"\xc9tape 3 : Configurez Spring Security"),(0,i.kt)("p",null,"Vous pouvez personnaliser les param\xe8tres des filtres Spring Security pour traiter les tokens :"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Assurez-vous de remplacer les valeurs de configuration par celles de votre propre instance Casdoor, en particulier ",(0,i.kt)("inlineCode",{parentName:"p"},"<Client ID>")," et les autres.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yml"},"server:\n  port: 8080\ncasdoor:\n  endpoint: http://CASDOOR_HOSTNAME:8000\n  client-id: <Client ID>\n  client-secret: <Client Secret>\n  certificate: <Certificate>\n  organization-name: <Organization Name>\n  application-name: <Application Name>\n  redirect-url: http://FRONTEND_HOSTNAME/callback\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Pour les applications frontend, la valeur par d\xe9faut de ",(0,i.kt)("inlineCode",{parentName:"p"},"<FRONTEND_HOSTNAME>")," est ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost:3000"),". Dans cette d\xe9mo, l'URL de redirection est ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:3000/callback"),". Assurez-vous de configurer cela dans votre application ",(0,i.kt)("inlineCode",{parentName:"p"},"casdoor"),".")),(0,i.kt)("h2",{id:"\xe9tape-4--configurez-le-frontend"},"\xc9tape 4 : Configurez le Frontend"),(0,i.kt)("p",null,"Vous devez installer ",(0,i.kt)("inlineCode",{parentName:"p"},"casdoor-js-sdk")," et configurer le SDK comme suit :"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Installez ",(0,i.kt)("inlineCode",{parentName:"p"},"casdoor-js-sdk"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"npm i casdoor-js-sdk \n# or\nyarn add casdoor-js-sdk\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configurez ",(0,i.kt)("inlineCode",{parentName:"p"},"SDK"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'import Sdk from "casdoor-js-sdk";\n\n// Serverurl is the URL where spring security is deployed\nexport const ServerUrl = "http://BACKEND_HOSTNAME:8080";\n\nconst sdkConfig = {\n  serverUrl: "http://CASDOOR_HOSTNAME:8000",\n  clientId: "<your client id>",\n  appName: "<your application name>",\n  organizationName: "<your organization name>",\n  redirectPath: "/callback",\n};\n\nexport const CasdoorSDK = new Sdk(sdkConfig);\n')))),(0,i.kt)("h2",{id:"\xe9tape-5--mettez-en-place-une-d\xe9mo"},"\xc9tape 5 : Mettez en place une d\xe9mo"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Cr\xe9ez une application Spring Boot.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Ajoutez quelques configurations pour g\xe9rer JWT."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@EnableWebSecurity\npublic class SecurityConfig {\n\n    private final JwtTokenFilter jwtTokenFilter;\n\n    public SecurityConfig(JwtTokenFilter jwtTokenFilter) {\n        this.jwtTokenFilter = jwtTokenFilter;\n    }\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        // enable CORS and disable CSRF\n        http = http.cors(corsConfig -> corsConfig\n                .configurationSource(configurationSource())\n        ).csrf().disable();\n\n        // set session management to stateless\n        http = http\n                .sessionManagement()\n                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and();\n\n        // set permissions on endpoints\n        http.authorizeHttpRequests(authorize -> authorize\n                .mvcMatchers("/api/redirect-url", "/api/signin").permitAll()\n                .mvcMatchers("/api/**").authenticated()\n        );\n\n        // set unauthorized requests exception handler\n        http = http\n                .exceptionHandling()\n                .authenticationEntryPoint(\n                        (request, response, ex) -> ResponseUtils.fail(response, "unauthorized")\n                )\n                .and();\n\n        // add JWT token filter\n        http.addFilterBefore(\n                jwtTokenFilter,\n                UsernamePasswordAuthenticationFilter.class\n        );\n        return http.build();\n    }\n\n    // ...\n')))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"}\n```\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Ajoutez un simple filtre JWT pour intercepter les requ\xeates qui n\xe9cessitent une v\xe9rification de token."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class JwtTokenFilter extends OncePerRequestFilter {\n\n    private final CasdoorAuthService casdoorAuthService;\n\n    public JwtTokenFilter(CasdoorAuthService casdoorAuthService) {\n        this.casdoorAuthService = casdoorAuthService;\n    }\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request,\n                                    HttpServletResponse response,\n                                    FilterChain chain)\n            throws ServletException, IOException {\n        // get authorization header and validate\n        final String header = request.getHeader(HttpHeaders.AUTHORIZATION);\n        if (!StringUtils.hasText(header) || !header.startsWith("Bearer ")) {\n            chain.doFilter(request, response);\n            return;\n        }\n\n        // get jwt token and validate\n        final String token = header.split(" ")[1].trim();\n\n        // get user identity and set it on the spring security context\n        UserDetails userDetails = null;\n        try {\n            CasdoorUser casdoorUser = casdoorAuthService.parseJwtToken(token);\n            userDetails = new CustomUserDetails(casdoorUser);\n        } catch (CasdoorAuthException exception) {\n            logger.error("casdoor auth exception", exception);\n            chain.doFilter(request, response);\n            return;\n        }\n\n        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(\n                userDetails,\n                null,\n                AuthorityUtils.createAuthorityList("ROLE_casdoor")\n        );\n\n        authentication.setDetails(\n                new WebAuthenticationDetailsSource().buildDetails(request)\n        );\n\n        SecurityContextHolder.getContext().setAuthentication(authentication);\n        chain.doFilter(request, response);\n    }\n\n}\n')),(0,i.kt)("p",{parentName:"li"},"Lorsque l'utilisateur acc\xe8de \xe0 l'interface n\xe9cessitant une authentification, ",(0,i.kt)("inlineCode",{parentName:"p"},"JwtTokenFilter")," obtiendra le token de l'en-t\xeate de la requ\xeate ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," et le v\xe9rifiera.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"D\xe9finissez un ",(0,i.kt)("inlineCode",{parentName:"p"},"Controller")," pour g\xe9rer lorsque l'utilisateur se connecte \xe0 Casdoor. Apr\xe8s la connexion de l'utilisateur, il sera redirig\xe9 vers le serveur et portera le ",(0,i.kt)("inlineCode",{parentName:"p"},"code")," et le ",(0,i.kt)("inlineCode",{parentName:"p"},"state"),". Le serveur doit alors v\xe9rifier l'identit\xe9 de l'utilisateur aupr\xe8s de Casdoor et obtenir le ",(0,i.kt)("inlineCode",{parentName:"p"},"token")," \xe0 travers ces deux param\xe8tres."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},"@RestController\npublic class UserController {\n\n    private static final Logger logger = LoggerFactory.getLogger(UserController.class);\n\n    private final CasdoorAuthService casdoorAuthService;\n\n    // ...\n")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'    @PostMapping("/api/signin")\n    public Result signin(@RequestParam("code") String code, @RequestParam("state") String state) {\n        try {\n            String token = casdoorAuthService.getOAuthToken(code, state);\n            return Result.success(token);\n        } catch (CasdoorAuthException exception) {\n            logger.error("casdoor auth exception", exception);\n            return Result.failure(exception.getMessage());\n        }\n    }\n\n    // ...\n}\n```\n')),(0,i.kt)("h2",{id:"\xe9tape-6--essayez-la-d\xe9mo"},"\xc9tape 6 : Essayez la d\xe9mo"),(0,i.kt)("p",null,"Vous pouvez acc\xe9der \xe0 l'application frontend via votre navigateur. Si vous n'\xeates pas connect\xe9, vous verrez un bouton de connexion. Cliquez dessus, et vous serez redirig\xe9 vers la page de connexion Casdoor."),(0,i.kt)("p",null,"Si vous visitez votre page racine,",(0,i.kt)("img",{alt:"bienvenue",src:n(2189).Z,width:"1920",height:"942"})),(0,i.kt)("p",null,"Cliquez sur le bouton ",(0,i.kt)("inlineCode",{parentName:"p"},"Connexion Casdoor"),", et la page vous redirigera vers la page de connexion de Casdoor. ",(0,i.kt)("img",{alt:"casdoor",src:n(7763).Z,width:"1920",height:"942"})),(0,i.kt)("p",null,"Apr\xe8s vous \xeatre connect\xe9, vous serez redirig\xe9 vers ",(0,i.kt)("inlineCode",{parentName:"p"},"/"),". ",(0,i.kt)("img",{alt:"ressource",src:n(83922).Z,width:"1920",height:"942"})))}u.isMDXComponent=!0},23185:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/casdoor_certification-fab3970e250b9e55213bb833f35f09d0.png"},14794:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/casdoor_setting-fca4ce21a48b644d6bbe251ca27271b7.png"},7763:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/spring_security_filter_casdoor-cd320a7fc7fb2a735740d4a57d56e7d8.png"},83922:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/spring_security_filter_resource-1095701ba0a994c50e87885b53e22a77.png"},2189:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/spring_security_filter_welcome-3258334efe51769aea33778f46287a78.png"}}]);