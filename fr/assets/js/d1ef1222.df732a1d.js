"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[6271],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},89039:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={title:"Keycloak",description:"Utiliser Keycloak pour authentifier les utilisateurs",keywords:["Keycloak"],authors:["seriouszyx"]},i=void 0,l={unversionedId:"provider/saml/keycloak",id:"provider/saml/keycloak",title:"Keycloak",description:"Utiliser Keycloak pour authentifier les utilisateurs",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/provider/saml/keycloak.md",sourceDirName:"provider/saml",slug:"/provider/saml/keycloak",permalink:"/fr/docs/provider/saml/keycloak",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/provider/saml/keycloak.md",tags:[],version:"current",frontMatter:{title:"Keycloak",description:"Utiliser Keycloak pour authentifier les utilisateurs",keywords:["Keycloak"],authors:["seriouszyx"]},sidebar:"tutorialSidebar",previous:{title:"Personnalis\xe9",permalink:"/fr/docs/provider/saml/custom"},next:{title:"Alibaba Cloud IDaaS",permalink:"/fr/docs/provider/saml/aliyun"}},s={},c=[{value:"Configurer Keycloak",id:"configurer-keycloak",level:2},{value:"Ajouter une entr\xe9e de client dans Keycloak",id:"ajouter-une-entr\xe9e-de-client-dans-keycloak",level:2},{value:"Configurer dans Casdoor",id:"configurer-dans-casdoor",level:2},{value:"Valider l&#39;effet",id:"valider-leffet",level:2}],p={toc:c};function u(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Le syst\xe8me Keycloak de JBoss ",(0,r.kt)("a",{parentName:"p",href:"https://www.keycloak.org/"},"Keycloak")," est un syst\xe8me de gestion d'identit\xe9 open-source et largement utilis\xe9 qui prend en charge l'int\xe9gration avec des applications via SAML et OpenID Connect. Il peut \xe9galement fonctionner comme un courtier d'identit\xe9 entre d'autres fournisseurs tels que LDAP ou d'autres fournisseurs SAML et des applications qui prennent en charge SAML ou OpenID Connect."),(0,r.kt)("p",null,"Voici un exemple de la fa\xe7on de configurer une nouvelle entr\xe9e de client dans Keycloak et de configurer Casdoor pour l'utiliser afin de permettre la connexion \xe0 l'interface utilisateur par les utilisateurs de Keycloak qui sont autoris\xe9s \xe0 acc\xe9der via la configuration de Keycloak."),(0,r.kt)("h2",{id:"configurer-keycloak"},"Configurer Keycloak"),(0,r.kt)("p",null,"Pour cet exemple, faisons les choix de configuration suivants et suppositions :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Supposons que vous ex\xe9cutez Casdoor en mode dev localement. L'interface utilisateur de Casdoor est disponible \xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:7001")," et le serveur est disponible \xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000"),". Remplacez par l'URL appropri\xe9e si n\xe9cessaire."),(0,r.kt)("li",{parentName:"ul"},"Supposons que vous ex\xe9cutez Keycloak localement. L'interface utilisateur de Keycloak est disponible \xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8080/auth"),"."),(0,r.kt)("li",{parentName:"ul"},"Sur cette base, l'URL ACS SP pour ce d\xe9ploiement sera : ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ul"},"Notre ID d'entit\xe9 SP utilisera la m\xeame URL : ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")),(0,r.kt)("p",null,"Vous pouvez utiliser le domaine par d\xe9faut ou cr\xe9er un nouveau domaine."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Ajouter un domaine Keycloak",src:n(78539).Z,width:"2560",height:"590"})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Domaine Keycloak",src:n(95491).Z,width:"2560",height:"965"})),(0,r.kt)("h2",{id:"ajouter-une-entr\xe9e-de-client-dans-keycloak"},"Ajouter une entr\xe9e de client dans Keycloak"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Pour plus de d\xe9tails sur les clients Keycloak, reportez-vous \xe0 la ",(0,r.kt)("a",{parentName:"p",href:"https://www.keycloak.org/docs/latest/server_admin/index.html#_client-saml-configuration"},"documentation Keycloak"),".")),(0,r.kt)("p",null,"Cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Clients")," dans le menu puis cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Cr\xe9er")," pour aller \xe0 la page ",(0,r.kt)("strong",{parentName:"p"},"Ajouter un client"),". Remplissez les champs comme suit :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"ID du client")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - Ceci sera l'ID d'entit\xe9 SP utilis\xe9 dans la configuration de Casdoor plus tard."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Protocole du client")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"saml"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Point de terminaison SAML du client")," : ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs")," - Cette URL est l'endroit o\xf9 vous souhaitez que le serveur Keycloak envoie les demandes et r\xe9ponses SAML. G\xe9n\xe9ralement, les applications ont une URL pour traiter les demandes SAML. Plusieurs URL peuvent \xeatre d\xe9finies dans l'onglet Param\xe8tres du client.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Ajouter un client Keycloak",src:n(15582).Z,width:"2560",height:"961"})),(0,r.kt)("p",null,"Cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"Enregistrer"),". Cette action cr\xe9e le client et vous am\xe8ne \xe0 l'onglet ",(0,r.kt)("strong",{parentName:"p"},"Param\xe8tres"),"."),(0,r.kt)("p",null,"Les \xe9l\xe9ments suivants font partie des param\xe8tres :"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Nom")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"Casdoor"),". Ceci est uniquement utilis\xe9 pour afficher un nom convivial aux utilisateurs de Keycloak dans l'interface utilisateur de Keycloak. Vous pouvez utiliser n'importe quel nom que vous pr\xe9f\xe9rez."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Activ\xe9")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Inclure la d\xe9claration Authn")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Signer les documents")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Signer les assertions")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Chiffrer les assertions")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Signature du client requise")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Forcer le format de l'ID de nom")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"on"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Format de l'ID de nom")," - S\xe9lectionnez ",(0,r.kt)("inlineCode",{parentName:"li"},"username"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URI de redirection valides")," - Ajouter ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL de traitement SAML principal")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ol"},"Configuration fine des points de terminaison SAML",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL de liaison POST du service de consommation d'assertion")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL de liaison de redirection du service de consommation d'assertion")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:8000/api/acs"),".")))),(0,r.kt)("p",null,"Enregistrer la configuration."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Configurer le client Keycloak",src:n(82142).Z,width:"2557",height:"3014"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Si vous souhaitez signer la demande d'authentification, vous devez activer l'option ",(0,r.kt)("strong",{parentName:"p"},"Signature du client requise")," et t\xe9l\xe9charger le certificat g\xe9n\xe9r\xe9 par vous-m\xeame. La cl\xe9 priv\xe9e et le certificat utilis\xe9s dans Casdoor, ",(0,r.kt)("inlineCode",{parentName:"p"},"token_jwt_key.key")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"token_jwt_key.pem"),", se trouvent dans le r\xe9pertoire ",(0,r.kt)("strong",{parentName:"p"},"object"),". Dans Keycloak, vous devez cliquer sur l'onglet ",(0,r.kt)("strong",{parentName:"p"},"Cl\xe9s"),", cliquer sur le bouton ",(0,r.kt)("strong",{parentName:"p"},"Importer"),", s\xe9lectionner ",(0,r.kt)("strong",{parentName:"p"},"Format d'archive")," comme ",(0,r.kt)("strong",{parentName:"p"},"Certificat PEM"),", et t\xe9l\xe9charger le certificat.")),(0,r.kt)("p",null,"Cliquez sur l'onglet ",(0,r.kt)("strong",{parentName:"p"},"Installation"),"."),(0,r.kt)("p",null,"Pour Keycloak <= 5.0.0, s\xe9lectionnez l'option de format - ",(0,r.kt)("strong",{parentName:"p"},"Descripteur IDPSSODescriptor des m\xe9tadonn\xe9es SAML")," et copiez les m\xe9tadonn\xe9es."),(0,r.kt)("p",null,"Pour Keycloak 6.0.0+, s\xe9lectionnez l'option de format - ",(0,r.kt)("strong",{parentName:"p"},"Fichiers Mod Auth Mellon")," et cliquez sur ",(0,r.kt)("strong",{parentName:"p"},"T\xe9l\xe9charger"),". D\xe9compressez le fichier .zip t\xe9l\xe9charg\xe9, localisez ",(0,r.kt)("inlineCode",{parentName:"p"},"idp-metadata.xml")," et copiez les m\xe9tadonn\xe9es."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"T\xe9l\xe9charger les m\xe9tadonn\xe9es",src:n(82235).Z,width:"2560",height:"596"})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Copier les m\xe9tadonn\xe9es",src:n(7962).Z,width:"1002",height:"241"})),(0,r.kt)("h2",{id:"configurer-dans-casdoor"},"Configurer dans Casdoor"),(0,r.kt)("p",null,"Cr\xe9er un nouveau fournisseur dans Casdoor."),(0,r.kt)("p",null,"S\xe9lectionnez la cat\xe9gorie comme ",(0,r.kt)("strong",{parentName:"p"},"SAML"),", le type comme ",(0,r.kt)("strong",{parentName:"p"},"Keycloak"),". Copiez le contenu des m\xe9tadonn\xe9es et collez-le dans le champ ",(0,r.kt)("strong",{parentName:"p"},"M\xe9tadonn\xe9es"),". Les valeurs de ",(0,r.kt)("strong",{parentName:"p"},"Point de terminaison"),", ",(0,r.kt)("strong",{parentName:"p"},"IdP"),", et ",(0,r.kt)("strong",{parentName:"p"},"URL de l'\xe9metteur")," seront g\xe9n\xe9r\xe9es automatiquement apr\xe8s avoir cliqu\xe9 sur le bouton ",(0,r.kt)("strong",{parentName:"p"},"Analyser"),". Enfin, cliquez sur le bouton ",(0,r.kt)("strong",{parentName:"p"},"Enregistrer"),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Si vous activez l'option ",(0,r.kt)("strong",{parentName:"p"},"Signature du client requise")," dans Keycloak et t\xe9l\xe9chargez le certificat, veuillez activer l'option ",(0,r.kt)("strong",{parentName:"p"},"Signer la demande")," dans Casdoor.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Fournisseur Casdoor",src:n(33666).Z,width:"2505",height:"1272"})),(0,r.kt)("p",null,"Modifier l'application que vous souhaitez configurer dans Casdoor. S\xe9lectionnez le fournisseur que vous venez d'ajouter et cliquez sur le bouton ",(0,r.kt)("strong",{parentName:"p"},"Enregistrer"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Ajouter un fournisseur pour l&#39;application",src:n(96960).Z,width:"2487",height:"255"})),(0,r.kt)("h2",{id:"valider-leffet"},"Valider l'effet"),(0,r.kt)("p",null,"Allez \xe0 l'application que vous venez de configurer et vous trouverez une ic\xf4ne Keycloak sur la page de connexion."),(0,r.kt)("p",null,"Cliquez sur l'ic\xf4ne et vous serez redirig\xe9 vers la page de connexion Keycloak. Apr\xe8s une authentification r\xe9ussie, vous serez connect\xe9 \xe0 Casdoor."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Connexion Casdoor",src:n(42062).Z,width:"1280",height:"720"})))}u.isMDXComponent=!0},96960:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_casdoor_app-c3afe561f88f7c5ade9973f8aa706dec.png"},42062:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_casdoor_login-5080e3bced4808bd768772ecfb15ca97.gif"},33666:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_casdoor_provider-238d41bdb7a2ce7eab3252b45b8f7d63.png"},15582:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_client_add-a22a58cfe1cac19aac7c471f4b95a391.png"},82142:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_client_configure-d8a4520b9809494ac277da30d02a8d35.png"},7962:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_client_copy-3233ceff3f6b91883873e5441c6e50fe.png"},82235:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_client_install-e8ed45db439c33e32b2f46fbdc476f40.png"},95491:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_realm-aa47ec9142083126d9c9f1ce79c75eac.png"},78539:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/keycloak_realm_add-9a27d681ede089b89474ebd0acc155c0.png"}}]);