"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[3817],{3905:(a,e,r)=>{r.d(e,{Zo:()=>l,kt:()=>f});var o=r(67294);function t(a,e,r){return e in a?Object.defineProperty(a,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[e]=r,a}function n(a,e){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.push.apply(r,o)}return r}function i(a){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){t(a,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(r,e))}))}return a}function s(a,e){if(null==a)return{};var r,o,t=function(a,e){if(null==a)return{};var r,o,t={},n=Object.keys(a);for(o=0;o<n.length;o++)r=n[o],e.indexOf(r)>=0||(t[r]=a[r]);return t}(a,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);for(o=0;o<n.length;o++)r=n[o],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(a,r)&&(t[r]=a[r])}return t}var p=o.createContext({}),c=function(a){var e=o.useContext(p),r=e;return a&&(r="function"==typeof a?a(e):i(i({},e),a)),r},l=function(a){var e=c(a.components);return o.createElement(p.Provider,{value:e},a.children)},u={inlineCode:"code",wrapper:function(a){var e=a.children;return o.createElement(o.Fragment,{},e)}},d=o.forwardRef((function(a,e){var r=a.components,t=a.mdxType,n=a.originalType,p=a.parentName,l=s(a,["components","mdxType","originalType","parentName"]),d=c(r),f=t,m=d["".concat(p,".").concat(f)]||d[f]||u[f]||n;return r?o.createElement(m,i(i({ref:e},l),{},{components:r})):o.createElement(m,i({ref:e},l))}));function f(a,e){var r=arguments,t=e&&e.mdxType;if("string"==typeof a||t){var n=r.length,i=new Array(n);i[0]=d;var s={};for(var p in e)hasOwnProperty.call(e,p)&&(s[p]=e[p]);s.originalType=a,s.mdxType="string"==typeof a?a:t,i[1]=s;for(var c=2;c<n;c++)i[c]=r[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}d.displayName="MDXCreateElement"},20415:(a,e,r)=>{r.r(e),r.d(e,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>n,metadata:()=>s,toc:()=>c});var o=r(87462),t=(r(67294),r(3905));const n={title:"Grafana",description:"Usando Casdoor para autentica\xe7\xe3o no Grafana",keywords:["Grafana"],authors:["ComradeProgrammer"]},i=void 0,s={unversionedId:"integration/go/grafana",id:"integration/go/grafana",title:"Grafana",description:"Usando Casdoor para autentica\xe7\xe3o no Grafana",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/integration/go/grafana.md",sourceDirName:"integration/go",slug:"/integration/go/grafana",permalink:"/pt/docs/integration/go/grafana",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/go/grafana.md",tags:[],version:"current",frontMatter:{title:"Grafana",description:"Usando Casdoor para autentica\xe7\xe3o no Grafana",keywords:["Grafana"],authors:["ComradeProgrammer"]},sidebar:"tutorialSidebar",previous:{title:"Gitea",permalink:"/pt/docs/integration/go/gitea"},next:{title:"MinIO",permalink:"/pt/docs/integration/go/minio"}},p={},c=[{value:"Usando Casdoor para autentica\xe7\xe3o no Grafana",id:"usando-casdoor-para-autentica\xe7\xe3o-no-grafana",level:2},{value:"Passo 1: Criar um aplicativo para o Grafana no Casdoor",id:"passo-1-criar-um-aplicativo-para-o-grafana-no-casdoor",level:2},{value:"Passo 2: Modificar a configura\xe7\xe3o do Grafana",id:"passo-2-modificar-a-configura\xe7\xe3o-do-grafana",level:2},{value:"Sobre HTTPS",id:"sobre-https",level:3},{value:"Sobre redirectURI ap\xf3s Entrar com Casdoor",id:"sobre-redirecturi-ap\xf3s-entrar-com-casdoor",level:3},{value:"Sobre Mapeamento de Pap\xe9is",id:"sobre-mapeamento-de-pap\xe9is",level:3},{value:"Passo 3: Veja se funciona",id:"passo-3-veja-se-funciona",level:2}],l={toc:c};function u(a){let{components:e,...n}=a;return(0,t.kt)("wrapper",(0,o.Z)({},l,n,{components:e,mdxType:"MDXLayout"}),(0,t.kt)("h2",{id:"usando-casdoor-para-autentica\xe7\xe3o-no-grafana"},"Usando Casdoor para autentica\xe7\xe3o no Grafana"),(0,t.kt)("p",null,(0,t.kt)("a",{parentName:"p",href:"https://grafana.com/oss/grafana/"},"Grafana")," suporta autentica\xe7\xe3o via OAuth. Portanto, \xe9 extremamente f\xe1cil para os usu\xe1rios usarem Casdoor para fazer login no Grafana. Apenas alguns passos e configura\xe7\xf5es simples s\xe3o necess\xe1rios para conseguir isso."),(0,t.kt)("p",null,"Aqui est\xe1 um tutorial sobre como usar Casdoor para autentica\xe7\xe3o no Grafana. Antes de prosseguir, por favor, certifique-se de que voc\xea tem o Grafana instalado e em funcionamento."),(0,t.kt)("h2",{id:"passo-1-criar-um-aplicativo-para-o-grafana-no-casdoor"},"Passo 1: Criar um aplicativo para o Grafana no Casdoor"),(0,t.kt)("p",null,"Aqui est\xe1 um exemplo de como criar um aplicativo no Casdoor:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Criar um aplicativo no Casdoor",src:r(34709).Z,width:"1367",height:"810"})),(0,t.kt)("p",null,"Por favor, copie o segredo do cliente e o ID do cliente para o pr\xf3ximo passo."),(0,t.kt)("p",null,"Por favor, adicione a URL de callback do Grafana. Por padr\xe3o, o callback OAuth do Grafana \xe9 ",(0,t.kt)("inlineCode",{parentName:"p"},"/login/generic_oauth"),". Ent\xe3o, por favor, concatene esta URL corretamente."),(0,t.kt)("h2",{id:"passo-2-modificar-a-configura\xe7\xe3o-do-grafana"},"Passo 2: Modificar a configura\xe7\xe3o do Grafana"),(0,t.kt)("p",null,"Por padr\xe3o, o arquivo de configura\xe7\xe3o para OAuth est\xe1 localizado em ",(0,t.kt)("inlineCode",{parentName:"p"},"conf/defaults.ini")," no diret\xf3rio de trabalho do Grafana."),(0,t.kt)("p",null,"Por favor, encontre a se\xe7\xe3o ",(0,t.kt)("inlineCode",{parentName:"p"},"[auth.generic_oauth]")," e modifique os seguintes campos:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"[auth.generic_oauth]\nname = Casdoor\nicon = signin\nenabled = true\nallow_sign_up = true\nclient_id = <client ID from previous step>\nclient_secret = <client secret from previous step>\nauth_url = <Casdoor endpoint>/login/oauth/authorize\ntoken_url = <Casdoor endpoint>/api/login/oauth/access_token\n\n")),(0,t.kt)("h3",{id:"sobre-https"},"Sobre HTTPS"),(0,t.kt)("p",null,"Se voc\xea n\xe3o quer HTTPS habilitado para o Casdoor ou se voc\xea implantar o Grafana sem HTTPS habilitado, por favor, tamb\xe9m defina ",(0,t.kt)("inlineCode",{parentName:"p"},"tls_skip_verify_insecure = true"),"."),(0,t.kt)("h3",{id:"sobre-redirecturi-ap\xf3s-entrar-com-casdoor"},"Sobre redirectURI ap\xf3s Entrar com Casdoor"),(0,t.kt)("p",null,"Se o URI de redirecionamento n\xe3o estiver correto ap\xf3s entrar com Casdoor no Grafana, voc\xea pode querer configurar ",(0,t.kt)("a",{parentName:"p",href:"https://stackoverflow.com/a/69814805"},"root_url"),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"[server]\nhttp_port = 3000\n# The public-facing domain name used to access Grafana from a browser\ndomain = <your IP here>\n# The full public-facing URL\nroot_url = %(protocol)s://%(domain)s:%(http_port)s/\n")),(0,t.kt)("p",null,"Links relacionados:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("a",{parentName:"p",href:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/#root_url"},"Documenta\xe7\xe3o do Grafana"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("a",{parentName:"p",href:"https://github.com/grafana/grafana/blob/main/conf/defaults.ini"},"Grafana defaults.ini")))),(0,t.kt)("h3",{id:"sobre-mapeamento-de-pap\xe9is"},"Sobre Mapeamento de Pap\xe9is"),(0,t.kt)("p",null,"Voc\xea pode querer configurar ",(0,t.kt)("inlineCode",{parentName:"p"},"role_attribute_path")," para mapear o papel do seu usu\xe1rio para o Grafana via ",(0,t.kt)("a",{parentName:"p",href:"https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-authentication/generic-oauth/#role-mapping"},"role_attribute_path"),"."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-ini"},"[auth.generic_oauth]\nrole_attribute_path = contains(roles[*].name, 'admin') && 'Admin' || contains(roles[*].name, 'editor') && 'Editor' || 'Viewer'\nrole_attribute_strict = true\nallow_assign_grafana_admin = true\n")),(0,t.kt)("p",null,"A express\xe3o JMESPath ap\xf3s ",(0,t.kt)("inlineCode",{parentName:"p"},"role_attribute_path")," \xe9 muito importante aqui. Por favor, consulte a documenta\xe7\xe3o do Grafana."),(0,t.kt)("h2",{id:"passo-3-veja-se-funciona"},"Passo 3: Veja se funciona"),(0,t.kt)("p",null,"Desligue o Grafana e reinicie-o."),(0,t.kt)("p",null,"V\xe1 para a p\xe1gina de login. Voc\xea deve ver algo assim:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Resultado final",src:r(60591).Z,width:"1384",height:"739"})))}u.isMDXComponent=!0},34709:(a,e,r)=>{r.d(e,{Z:()=>o});const o=r.p+"assets/images/grafana_1-9f197ebf06da48585fe18ce1d66ce212.png"},60591:(a,e,r)=>{r.d(e,{Z:()=>o});const o=r.p+"assets/images/grafana_2-5136a37a917e1c899feedb23e218fa13.png"}}]);