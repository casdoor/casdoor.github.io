"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[586],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>h});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(t),h=a,k=p["".concat(l,".").concat(h)]||p[h]||u[h]||i;return t?r.createElement(k,o(o({ref:n},d),{},{components:t})):r.createElement(k,o({ref:n},d))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=p;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},17108:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var r=t(87462),a=(t(67294),t(3905));const i={title:"OAuth 2.0",description:"Verwendung von Access Token zur Authentifizierung von Clients",keywords:["OAuth 2.0","access token","refresh token"],authors:["nomeguy"]},o=void 0,s={unversionedId:"how-to-connect/oauth",id:"how-to-connect/oauth",title:"OAuth 2.0",description:"Verwendung von Access Token zur Authentifizierung von Clients",source:"@site/i18n/de/docusaurus-plugin-content-docs/current/how-to-connect/oauth.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/oauth",permalink:"/de/docs/how-to-connect/oauth",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/oauth.md",tags:[],version:"current",frontMatter:{title:"OAuth 2.0",description:"Verwendung von Access Token zur Authentifizierung von Clients",keywords:["OAuth 2.0","access token","refresh token"],authors:["nomeguy"]},sidebar:"tutorialSidebar",previous:{title:"Nuxt",permalink:"/de/docs/how-to-connect/nuxt"},next:{title:"Verwendung von Casdoor als CAS-Server",permalink:"/de/docs/how-to-connect/cas"}},l={},c=[{value:"Einf\xfchrung",id:"einf\xfchrung",level:2},{value:"Wie man ein Access Token erh\xe4lt",id:"wie-man-ein-access-token-erh\xe4lt",level:2},{value:'Authorization Code Grant<span id="1"></span>',id:"authorization-code-grant",level:3},{value:"Verf\xfcgbare Bereiche",id:"verf\xfcgbare-bereiche",level:4},{value:"Implicit Grant",id:"implicit-grant",level:3},{value:"Resource Owner Password Credentials Grant",id:"resource-owner-password-credentials-grant",level:3},{value:"Client Credentials Grant",id:"client-credentials-grant",level:3},{value:"Refresh Token",id:"refresh-token",level:3},{value:"Wie man Access Token \xfcberpr\xfcft",id:"wie-man-access-token-\xfcberpr\xfcft",level:2},{value:"Wie man <code>AccessToken</code> verwendet",id:"wie-man-accesstoken-verwendet",level:2},{value:"Unterschiede zwischen den APIs <code>userinfo</code> und <code>get-account</code>",id:"unterschiede-zwischen-den-apis-userinfo-und-get-account",level:2}],d={toc:c};function u(e){let{components:n,...i}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,i,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"einf\xfchrung"},"Einf\xfchrung"),(0,a.kt)("p",null,"Casdoor unterst\xfctzt die Verwendung von Access Token zur Authentifizierung von Clients. In diesem Abschnitt zeigen wir Ihnen, wie Sie ein Access Token erhalten, wie Sie ein Access Token \xfcberpr\xfcfen und wie Sie ein Access Token verwenden."),(0,a.kt)("h2",{id:"wie-man-ein-access-token-erh\xe4lt"},"Wie man ein Access Token erh\xe4lt"),(0,a.kt)("p",null,"Es gibt zwei M\xf6glichkeiten, ein Access Token zu erhalten: Sie k\xf6nnen die ",(0,a.kt)("a",{parentName:"p",href:"/docs/how-to-connect/sdk"},"Casdoor SDKs")," verwenden. Weitere Informationen finden Sie in der SDK-Dokumentation. Hier zeigen wir Ihnen haupts\xe4chlich, wie Sie das Access Token \xfcber die API erhalten."),(0,a.kt)("p",null,"Casdoor unterst\xfctzt vier OAuth-Erteilungstypen: ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.1"},"Authorization Code Grant"),", ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.2"},"Implicit Grant"),", ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.3"},"Resource Owner Password Credentials Grant")," und ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.4"},"Client Credentials Grant"),"."),(0,a.kt)("p",null,"Aus Sicherheitsgr\xfcnden ist der Autorisierungscode-Modus in der Casdoor-App standardm\xe4\xdfig aktiviert. Wenn Sie andere Modi verwenden m\xfcssen, gehen Sie bitte zur entsprechenden App, um dies einzustellen."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Erteilungstypen",src:t(67093).Z,width:"1493",height:"529"})),(0,a.kt)("h3",{id:"authorization-code-grant"},"Authorization Code Grant",(0,a.kt)("span",{id:"1"})),(0,a.kt)("p",null,"Zuerst leiten Sie Ihre Benutzer um zu:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/login/oauth/authorize?\nclient_id=CLIENT_ID&\nredirect_uri=REDIRECT_URI&\nresponse_type=code&\nscope=openid&\nstate=STATE\n")),(0,a.kt)("h4",{id:"verf\xfcgbare-bereiche"},"Verf\xfcgbare Bereiche"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Beschreibung"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"openid (no scope)"),(0,a.kt)("td",{parentName:"tr",align:null},"sub (Benutzer-ID), iss (Aussteller) und aud (Publikum)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"profile"),(0,a.kt)("td",{parentName:"tr",align:null},"Benutzerprofilinformationen, einschlie\xdflich Name, Anzeigename und Avatar")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"email"),(0,a.kt)("td",{parentName:"tr",align:null},"E-Mail-Adresse des Benutzers")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"address"),(0,a.kt)("td",{parentName:"tr",align:null},"Adresse des Benutzers")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"phone"),(0,a.kt)("td",{parentName:"tr",align:null},"Telefonnummer des Benutzers")))),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Ihre OAuth-Anwendung kann die Bereiche in der anf\xe4nglichen Umleitung anfordern. Sie k\xf6nnen mehrere Bereiche angeben, indem Sie sie mit einem Leerzeichen trennen und %20 verwenden:"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-text"},"https://<CASDOOR_HOST>/login/oauth/authorize?\nclient_id=...&\nscope=openid%20email\n")),(0,a.kt)("p",{parentName:"admonition"},"Weitere Details finden Sie im ",(0,a.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfoResponse"},"OIDC-Standard"))),(0,a.kt)("p",null,"Nachdem sich Ihr Benutzer bei Casdoor authentifiziert hat, wird Casdoor ihn umleiten zu:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://REDIRECT_URI?code=CODE&state=STATE\n")),(0,a.kt)("p",null,"Nachdem Sie den Autorisierungscode erhalten haben, machen Sie eine POST-Anfrage an:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/api/login/oauth/access_token\n")),(0,a.kt)("p",null,"in Ihrer Backend-Anwendung:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "authorization_code",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n    "code": Code,\n}\n')),(0,a.kt)("p",null,"Sie erhalten die folgende Antwort:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Casdoor unterst\xfctzt auch die ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7636"},"PKCE"),"-Funktion. Beim Erhalten des Autorisierungscodes k\xf6nnen Sie zwei Parameter hinzuf\xfcgen, um PKCE zu aktivieren:"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-url"},"&code_challenge_method=S256&code_challenge=IHRE_HERAUSFORDERUNG\n")),(0,a.kt)("p",{parentName:"admonition"},"Beim Erhalten des Tokens m\xfcssen Sie den ",(0,a.kt)("inlineCode",{parentName:"p"},"code_verifier"),"-Parameter \xfcbergeben, um PKCE zu \xfcberpr\xfcfen. Es ist erw\xe4hnenswert, dass mit aktiviertem PKCE ",(0,a.kt)("inlineCode",{parentName:"p"},"Client_Secret")," nicht erforderlich ist, aber wenn Sie es \xfcbergeben, muss es der korrekte Wert sein.")),(0,a.kt)("h3",{id:"implicit-grant"},"Implicit Grant"),(0,a.kt)("p",null,"M\xf6glicherweise hat Ihre Anwendung kein Backend, und Sie m\xfcssen Implicit Grant verwenden. Zuerst m\xfcssen Sie sicherstellen, dass Sie Implicit Grant aktiviert haben, dann leiten Sie Ihre Benutzer um zu:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/login/oauth/authorize?client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&response_type=token&scope=openid&state=STATE\n")),(0,a.kt)("p",null,"Nachdem sich Ihr Benutzer bei Casdoor authentifiziert hat, wird Casdoor ihn umleiten zu:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://REDIRECT_URI/#access_token=ACCESS_TOKEN\n")),(0,a.kt)("p",null,"Casdoor unterst\xfctzt auch das ",(0,a.kt)("a",{parentName:"p",href:"https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html#id_token"},"id_token")," als ",(0,a.kt)("inlineCode",{parentName:"p"},"response_type"),", was ein Merkmal von OpenID ist."),(0,a.kt)("h3",{id:"resource-owner-password-credentials-grant"},"Resource Owner Password Credentials Grant"),(0,a.kt)("p",null,"Wenn Ihre Anwendung kein Frontend hat, das Benutzer zu Casdoor umleitet, dann ben\xf6tigen Sie dies m\xf6glicherweise."),(0,a.kt)("p",null,"Zuerst m\xfcssen Sie sicherstellen, dass Sie Password Credentials Grant aktiviert haben und senden eine POST-Anfrage an:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-url"},"https://<CASDOOR_HOST>/api/login/oauth/access_token\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "password",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n    "username": Username,\n    "password": Password,\n}\n')),(0,a.kt)("p",null,"Sie erhalten die folgende Antwort:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("h3",{id:"client-credentials-grant"},"Client Credentials Grant"),(0,a.kt)("p",null,"Sie k\xf6nnen auch Client Credentials Grant verwenden, wenn Ihre Anwendung kein Frontend hat."),(0,a.kt)("p",null,"Zuerst m\xfcssen Sie sicherstellen, dass Sie Client Credentials Grant aktiviert haben und senden eine POST-Anfrage an ",(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/login/oauth/access_token"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "client_credentials",\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n}\n')),(0,a.kt)("p",null,"Sie erhalten die folgende Antwort:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("p",null,"Es ist wichtig zu beachten, dass der auf diese Weise erhaltene AccessToken sich von den ersten drei unterscheidet, da er der Anwendung und nicht dem Benutzer entspricht."),(0,a.kt)("h3",{id:"refresh-token"},"Refresh Token"),(0,a.kt)("p",null,"Vielleicht m\xf6chten Sie Ihr Access Token aktualisieren, dann k\xf6nnen Sie den oben erhaltenen ",(0,a.kt)("inlineCode",{parentName:"p"},"refreshToken")," verwenden."),(0,a.kt)("p",null,"Zuerst m\xfcssen Sie die Ablaufzeit des Refresh Tokens in der Anwendung festlegen (Standard ist 0 Stunden) und eine POST-Anfrage an ",(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/login/oauth/refresh_token")," senden"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "grant_type": "refresh_token",\n    "refresh_token": REFRESH_TOKEN,\n    "scope": SCOPE,\n    "client_id": ClientId,\n    "client_secret": ClientSecret,\n}\n')),(0,a.kt)("p",null,"Sie erhalten eine Antwort wie diese:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token": "eyJhb...",\n    "id_token": "eyJhb...",\n    "refresh_token": "eyJhb...",\n    "token_type": "Bearer",\n    "expires_in": 10080,\n    "scope": "openid"\n}\n')),(0,a.kt)("h2",{id:"wie-man-access-token-\xfcberpr\xfcft"},"Wie man Access Token \xfcberpr\xfcft"),(0,a.kt)("p",null,"Casdoor unterst\xfctzt derzeit den ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7662"},"Token-Introspektions"),"-Endpunkt. Dieser Endpunkt ist durch Basic Authentication (ClientId:ClientSecret) gesch\xfctzt."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-http"},"POST /api/login/oauth/introspect HTTP/1.1\nHost: CASDOOR_HOST\nAccept: application/json\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic Y2xpZW50X2lkOmNsaWVudF9zZWNyZXQ=\n\ntoken=ACCESS_TOKEN&token_type_hint=access_token\n")),(0,a.kt)("p",null,"Sie erhalten die folgende Antwort:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "active": true,\n    "client_id": "c58c...",\n    "username": "admin",\n    "token_type": "Bearer",\n    "exp": 1647138242,\n    "iat": 1646533442,\n    "nbf": 1646533442,\n    "sub": "7a6b4a8a-b731-48da-bc44-36ae27338817",\n    "aud": [\n        "c58c..."\n    ],\n    "iss": "http://localhost:8000"\n}\n')),(0,a.kt)("h2",{id:"wie-man-accesstoken-verwendet"},"Wie man ",(0,a.kt)("inlineCode",{parentName:"h2"},"AccessToken")," verwendet"),(0,a.kt)("p",null,"Sie k\xf6nnen AccessToken verwenden, um auf Casdoor-APIs zuzugreifen, die eine Authentifizierung erfordern."),(0,a.kt)("p",null,"Zum Beispiel gibt es zwei verschiedene M\xf6glichkeiten, ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/userinfo")," anzufordern."),(0,a.kt)("p",null,"Typ 1: Query-Parameter"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/userinfo?accessToken=<your_access_token>")),(0,a.kt)("p",null,"Typ 2: HTTP Bearer-Token"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://<CASDOOR_HOST>/api/userinfo"),' with the header: "Authorization: Bearer <your_access_token>"'),(0,a.kt)("p",null,"Casdoor wird das access_token analysieren und entsprechende Benutzerinformationen gem\xe4\xdf dem ",(0,a.kt)("inlineCode",{parentName:"p"},"scope")," zur\xfcckgeben. Sie erhalten dieselbe Antwort, die so aussieht:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "sub": "7a6b4a8a-b731-48da-bc44-36ae27338817",\n    "iss": "http://localhost:8000",\n    "aud": "c58c..."\n}\n')),(0,a.kt)("p",null,"Wenn Sie mehr Benutzerinformationen erwarten, f\xfcgen Sie ",(0,a.kt)("inlineCode",{parentName:"p"},"scope")," hinzu, wenn Sie das AccessToken in Schritt ",(0,a.kt)("a",{parentName:"p",href:"#1"},"Authorization Code Grant")," erhalten."),(0,a.kt)("h2",{id:"unterschiede-zwischen-den-apis-userinfo-und-get-account"},"Unterschiede zwischen den APIs ",(0,a.kt)("inlineCode",{parentName:"h2"},"userinfo")," und ",(0,a.kt)("inlineCode",{parentName:"h2"},"get-account")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"/api/userinfo"),": Diese API gibt Benutzerinformationen als Teil des OIDC-Protokolls zur\xfcck. Sie bietet begrenzte Informationen, einschlie\xdflich nur der grundlegenden Informationen, die in den OIDC-Standards definiert sind. Eine Liste der von Casdoor unterst\xfctzten verf\xfcgbaren Bereiche finden Sie im Abschnitt ",(0,a.kt)("a",{parentName:"p",href:"#available-scopes"},"verf\xfcgbare Bereiche"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"/api/get-account"),": Diese API ruft das Benutzerobjekt f\xfcr das derzeit eingeloggte Konto ab. Es handelt sich um eine spezifische API von Casdoor, die es Ihnen erm\xf6glicht, alle Informationen des ",(0,a.kt)("a",{parentName:"p",href:"/docs/basic/core-concepts#user"},"Benutzers")," in Casdoor zu erhalten."))))}u.isMDXComponent=!0},67093:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/accesstoken_grant_types-a3a06e2f0f56b34ddf752837c834771e.png"}}]);